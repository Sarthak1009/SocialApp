"use strict";(self.webpackChunkApnaSocial=self.webpackChunkApnaSocial||[]).push([[246],{8246:(Ya,ar,ut)=>{ut.r(ar),ut.d(ar,{UserModule:()=>Ye});var Me=ut(9808),g=ut(843),_=ut(5e3),Xt=ut(4559),Ft=ut(8472);ut(9361);class Oe{constructor(){this.listeners=new Map}appendArray(y){return Ft.t._getFirestore().FieldValue.arrayUnion(y)}increment(y){return Ft.t._getFirestore().FieldValue.increment(y)}genDocId(){return Ft.t.getFirestore().collection("TEMP").doc().id}all(y){const T=Ft.t.getFirestore().batch();for(let R of y.operations)R.getOperation(T);return new Promise((R,M)=>{T.commit().then(()=>{try{y.onComplete()}catch(k){}R()}).catch(k=>{try{y.onFail(k)}catch(Y){}M(k)})})}create(y){return new Promise((T,R)=>{if(null==y.data||null==y.data)throw new Error("Error creating data. Data is null or undefined.");if(this.isCollectionPath(y.path)){let M=this.genCollectionReference(y.path).doc();M.set(y.data).then(()=>{try{y.onComplete(M.id)}catch(k){}T(M.id)}).catch(k=>{try{y.onFail(k)}catch(Y){}R(k)})}else if(this.isDocumentPath(y.path)){let M=this.genDocumentReference(y.path);M.set(y.data).then(()=>{try{y.onComplete(M.id)}catch(k){}T(M.id)}).catch(k=>{try{y.onFail(k)}catch(Y){}R(k)})}})}delete(y){return new Promise((T,R)=>{this.checkDocumentPathValidity(y.path),this.genDocumentReference(y.path).delete().then(()=>{try{y.onComplete()}catch(M){}T()}).catch(M=>{try{y.onFail(M)}catch(k){}R(M)})})}update(y){return new Promise((T,R)=>{this.checkDocumentPathValidity(y.path);const M=this.genDocumentReference(y.path);M.update(y.data).then(()=>{try{y.onComplete(M)}catch(k){}T(M)}).catch(k=>{try{y.onFail(k)}catch(Y){}R(k)})})}getCollection(y){let T=this.genCollectionReference(y.path);return new Promise((null!=y.where||null!=y.where)&&y.where.length>0?(R,M)=>{let k;const Y=Array(y.where)[0];for(let lt=0;lt<Y.length;lt++)k=null==k?Y[lt].getQuery(T):Y[lt].concatQuery(k);k.get().then(lt=>{try{y.onComplete(lt)}catch(gr){}R(lt)}).catch(lt=>{try{y.onFail(lt)}catch(gr){}M(lt)})}:(R,M)=>{T.get().then(k=>{try{y.onComplete(k)}catch(Y){}R(k)}).catch(k=>{try{y.onFail(k)}catch(Y){}M(k)})})}getDocument(y){return new Promise((T,R)=>{this.genDocumentReference(y.path).get().then(M=>{try{y.onComplete(M)}catch(k){}T(M)}).catch(M=>{try{y.onFail(M)}catch(k){}R(M)})})}listenToDocument(y){this.validateListenerName(y.name),this.addListener(y.name,this.genDocumentReference(y.path).onSnapshot(T=>{try{y.onUpdate(T)}catch(R){}}))}listenToCollection(y){this.validateListenerName(y.name);let T=this.genCollectionReference(y.path);if((null!=y.where||null!=y.where)&&y.where.length>0){let R;const M=Array(y.where)[0];for(let k=0;k<M.length;k++)R=null==R?M[k].getQuery(T):M[k].concatQuery(R);this.addListener(y.name,R.onSnapshot(k=>{try{y.onUpdate(k)}catch(Y){}}))}else this.addListener(y.name,T.onSnapshot(R=>{try{y.onUpdate(R)}catch(M){}}))}genCollectionReference(y){this.checkCollectionPathValidity(y);const T=Array(y)[0];let R,M;for(let k=0;k<T.length;k++)k%2==0?R=null==R?Ft.t.getFirestore().collection(T[k]):M.collection(T[k]):M=R.doc(T[k]);return R}genDocumentReference(y){this.checkDocumentPathValidity(y);const T=Array(y)[0];let R,M;for(let k=0;k<T.length;k++)k%2==0?R=null==R?Ft.t.getFirestore().collection(T[k]):M.collection(T[k]):M=R.doc(T[k]);return M}addListener(y,T){return this.listeners.set(y,T),T}stopListeningTo(y){try{this.listeners.get(y)(),this.listeners.delete(y)}catch(T){}}stopListeningToAll(){this.listeners.forEach((y,T,R)=>{this.stopListeningTo(T)})}validateListenerName(y){if(null==y||null==y||"string"!=typeof y||y.trim().length<=0)throw"Listener name cannot be empty.";if(null!=this.listeners.get(y))throw`Listener name: ${y} is already taken.`}checkCollectionPathValidity(y){if(null==y||null==y||y.length<=0||!this.isCollectionPath(y))throw"Not a valid path to a collection."}isCollectionPath(y){return Array(y)[0].length%2==1}checkDocumentPathValidity(y){if(null==y||null==y||y.length<=0||!this.isDocumentPath(y))throw"Not a valid path to a document."}isDocumentPath(y){return Array(y)[0].length%2==0}}class F{constructor(y,T){this.field=y,this.direction=T}getQuery(y){return y.orderBy(this.field,this.direction)}concatQuery(y){return y.orderBy(this.field,this.direction)}}class Le{constructor(y){this.limit=y}getQuery(y){return y.limit(this.limit)}concatQuery(y){return y.limit(this.limit)}}var he=ut(8966),Sn=ut(6360),Ie=ut(508);const ci=["*",[["mat-card-footer"]]],Cn=["*","mat-card-footer"],li=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],ur=["[mat-card-avatar], [matCardAvatar]","mat-card-title, mat-card-subtitle,\n      [mat-card-title], [mat-card-subtitle],\n      [matCardTitle], [matCardSubtitle]","*"];let Fe=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275dir=_.lG2({type:D,selectors:[["mat-card-content"],["","mat-card-content",""],["","matCardContent",""]],hostAttrs:[1,"mat-card-content"]}),D})(),ft=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275dir=_.lG2({type:D,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-card-title"]}),D})(),fe=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275dir=_.lG2({type:D,selectors:[["mat-card-subtitle"],["","mat-card-subtitle",""],["","matCardSubtitle",""]],hostAttrs:[1,"mat-card-subtitle"]}),D})(),cr=(()=>{class D{constructor(){this.align="start"}}return D.\u0275fac=function(T){return new(T||D)},D.\u0275dir=_.lG2({type:D,selectors:[["mat-card-actions"]],hostAttrs:[1,"mat-card-actions"],hostVars:2,hostBindings:function(T,R){2&T&&_.ekj("mat-card-actions-align-end","end"===R.align)},inputs:{align:"align"},exportAs:["matCardActions"]}),D})(),An=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275dir=_.lG2({type:D,selectors:[["","mat-card-image",""],["","matCardImage",""]],hostAttrs:[1,"mat-card-image"]}),D})(),Ee=(()=>{class D{constructor(T){this._animationMode=T}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(Sn.Qb,8))},D.\u0275cmp=_.Xpm({type:D,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(T,R){2&T&&_.ekj("_mat-animation-noopable","NoopAnimations"===R._animationMode)},exportAs:["matCard"],ngContentSelectors:Cn,decls:2,vars:0,template:function(T,R){1&T&&(_.F$t(ci),_.Hsn(0),_.Hsn(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}._mat-animation-noopable.mat-card{transition:none;animation:none}.mat-card .mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card .mat-divider-horizontal{left:auto;right:0}.mat-card .mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card .mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}\n"],encapsulation:2,changeDetection:0}),D})(),mt=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275cmp=_.Xpm({type:D,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-card-header"],ngContentSelectors:ur,decls:4,vars:0,consts:[[1,"mat-card-header-text"]],template:function(T,R){1&T&&(_.F$t(li),_.Hsn(0),_.TgZ(1,"div",0),_.Hsn(2,1),_.qZA(),_.Hsn(3,2))},encapsulation:2,changeDetection:0}),D})(),xt=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275mod=_.oAB({type:D}),D.\u0275inj=_.cJS({imports:[[Ie.BQ],Ie.BQ]}),D})(),Ze=(()=>{class D{constructor(T,R){this.router=T,this.dialog=R,this.profileClose=new _.vpe,this.firestore=new Oe,this.firebaseAuth=new Xt.l}onContinueClick(T,R){this.dialog.close();let M=T.value,k=R.value;this.firestore.create({path:["Users",this.firebaseAuth.getAuth().currentUser.uid],data:{publicName:M,description:k},onComplete:Y=>{T.value="",R.value="",this.router.navigate(["/user/home"]),this.profileClose.emit(!1),window.location.reload()},onFail:Y=>{alert(Y.message)}})}ngOnInit(){}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(g.F0),_.Y36(he.so))},D.\u0275cmp=_.Xpm({type:D,selectors:[["app-profile"]],outputs:{profileClose:"profileClose"},decls:16,vars:0,consts:[[1,"container"],["id","contact"],["placeholder","Name","type","text","tabindex","1","required","","autofocus",""],["nameInput",""],["placeholder","Description","type","text","tabindex","2","required","","autofocus",""],["descInput",""],[1,"submit",3,"click"]],template:function(T,R){if(1&T){const M=_.EpF();_.TgZ(0,"div",0),_.TgZ(1,"div",1),_.TgZ(2,"mat-card"),_.TgZ(3,"mat-card-header"),_.TgZ(4,"mat-card-title"),_._uU(5," Hey, Tell us about Yourself! "),_.qZA(),_.qZA(),_.TgZ(6,"mat-card-content"),_.TgZ(7,"fieldset"),_._UZ(8,"input",2,3),_.qZA(),_.TgZ(10,"fieldset"),_._UZ(11,"textarea",4,5),_.qZA(),_.TgZ(13,"fieldset"),_.TgZ(14,"button",6),_.NdJ("click",function(){_.CHM(M);const Y=_.MAs(9),lt=_.MAs(12);return R.onContinueClick(Y,lt)}),_._uU(15,"Update"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()}},directives:[Ee,mt,ft,Fe],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-font-smoothing:antialiased;-o-font-smoothing:antialiased;text-rendering:optimizeLegibility}p[_ngcontent-%COMP%]{margin-bottom:15px}body[_ngcontent-%COMP%]{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:100;font-size:12px;line-height:30px;color:#777;background:#4CAF50}.container[_ngcontent-%COMP%]{max-width:400px;width:80%;margin:0 auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:100}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{font:400 12px/16px Roboto,Helvetica,Arial,sans-serif}#contact[_ngcontent-%COMP%]{background:#F9F9F9;padding:0;margin:150px 0;box-shadow:0 0 20px #0003,0 5px 5px #0000003d}#contact[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:block;font-size:30px;font-weight:300;margin-bottom:10px}#contact[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:5px 0 15px;display:block;font-size:13px;font-weight:400}fieldset[_ngcontent-%COMP%]{border:medium none!important;margin:0 0 10px;min-width:100%;padding:0;width:100%}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #ccc;background:#FFF;margin:0 0 5px;padding:10px}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:hover{transition:border-color .3s ease-in-out;border:1px solid #aaa}#contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px;max-width:100%;resize:none}#contact[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{cursor:pointer;width:100%;border:none;border-radius:8px;background:#4CAF50;color:#fff;margin:0 0 5px;padding:10px;font-size:15px}#contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:#43A047;transition:background-color .3s ease-in-out}#contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:active{box-shadow:inset 0 1px 3px #00000080}.copyright[_ngcontent-%COMP%]{text-align:center}#contact[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:0;border:1px solid #aaa}[_ngcontent-%COMP%]::-webkit-input-placeholder{color:#888}[_ngcontent-%COMP%]:-moz-placeholder{color:#888}[_ngcontent-%COMP%]::-moz-placeholder{color:#888}[_ngcontent-%COMP%]:-ms-input-placeholder{color:#888}#contact[_ngcontent-%COMP%]{border-radius:8px}mat-card[_ngcontent-%COMP%]{margin:0;box-shadow:none!important}mat-header[_ngcontent-%COMP%]{margin:10px}mat-card-content[_ngcontent-%COMP%]{margin:10px}"]}),D})();var We=ut(7556),Se=ut(7423);let Rn=(()=>{class D{constructor(T,R,M){this.router=T,this.auth=R,this.dialog=M,this.profilleClickListner=new _.vpe,this.profileValue=!1,this.firebaseAuth=new Xt.l}LogOut(){this.auth.logOut()}onProfileClick(T){this.profileValue=!this.profileValue,this.dialog.open(Ze)}ngOnInit(){}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(g.F0),_.Y36(We.e),_.Y36(he.uw))},D.\u0275cmp=_.Xpm({type:D,selectors:[["app-header"]],outputs:{profilleClickListner:"profilleClickListner"},decls:5,vars:0,consts:[[1,"container"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",2,"margin-left","15px",3,"click"]],template:function(T,R){1&T&&(_.TgZ(0,"div",0),_.TgZ(1,"button",1),_.NdJ("click",function(){return R.LogOut()}),_._uU(2,"Log out"),_.qZA(),_.TgZ(3,"button",2),_.NdJ("click",function(){return R.onProfileClick(!0)}),_._uU(4,"Profile"),_.qZA(),_.qZA())},directives:[Se.lW],styles:[".container[_ngcontent-%COMP%]{position:fixed;top:3px;right:5px;z-index:10;background:white}"]}),D})();ut(1589);class fr{constructor(){this.listeners=new Map}downloadToLocalStorage(y){return new Promise((T,R)=>{if(y instanceof Array)this.getDownloadUrl({path:y,onComplete:M=>{T(M),window.open(M,"Download")},onFail:M=>{R(M)}});else try{window.open(y,"Download"),T()}catch(M){R(M)}})}upload(y){return new Promise((T,R)=>{let M=null,k=this.genStorageRef(y.path);M=null==y.data.metadata||null==y.data.metadata?k.put(y.data.data):k.put(y.data.data,y.data.metadata),M.on("state_changed",Y=>{try{y.onUpload(Y)}catch(lt){}},Y=>{R(Y);try{y.onFail(Y)}catch(lt){}},()=>{k.getDownloadURL().then(Y=>{T(Y);try{y.onComplete(Y)}catch(lt){}})}),this.listeners.set(y.uploadName,M)})}deleteWithUrl(y){return new Promise((T,R)=>{Ft.t.getStorage().refFromURL(y.url).delete().then(()=>{T();try{y.onComplete()}catch(k){}}).catch(k=>{R(k);try{y.onFail(k)}catch(Y){}})})}delete(y){return new Promise((T,R)=>{this.genStorageRef(y.path).delete().then(()=>{T();try{y.onComplete()}catch(k){}}).catch(k=>{R(k);try{y.onFail(k)}catch(Y){}})})}getDownloadUrl(y){return new Promise((T,R)=>{const M=this.genStorageRef(y.path);try{M.getDownloadURL().then(k=>{T(k);try{y.onComplete(k)}catch(Y){}})}catch(k){R(k);try{y.onFail(k)}catch(Y){}}})}genStorageRef(y){let T=Ft.t.getStorage().ref();for(let R=0;R<y.length;R++)T=T.child(y[R]);return T}}var Xe=ut(9095);function yt(D,y){1&D&&(_.TgZ(0,"div",9),_._UZ(1,"img",10),_.qZA())}let Dn=(()=>{class D{constructor(T){this.dialog=T,this.firebaseAuth=new Xt.l,this.firestore=new Oe,this.storage=new fr,this.name="",this.description=""}ngOnInit(){}onPhotoSelected(T){if(this.selectedImagefile=T.files[0],!this.selectedImagefile)return;let R=new FileReader;R.readAsDataURL(this.selectedImagefile),R.addEventListener("loadend",M=>{let k=R.result.toString();document.getElementById("post-preview-img").src=k})}uploadImagePost(T){let R=this.firestore.genDocId();this.storage.upload({uploadName:"upload image Post",path:["Posts",R,"image"],data:{data:this.selectedImagefile},onComplete:M=>{this.firestore.create({path:["Posts",R],data:{comment:T,creatorId:this.firebaseAuth.getAuth().currentUser.uid,imageUrl:M,timestamp:Ft.t.getFirestoreTimestamp(),name:this.name,desc:this.description},onComplete:k=>{this.dialog.close(),window.location.reload()},onFail:k=>{alert(k.message)}})}})}uploadPost(T){this.firestore.create({path:["Posts"],data:{comment:T,creatorId:this.firebaseAuth.getAuth().currentUser.uid,timestamp:Ft.t.getFirestoreTimestamp(),name:this.name,desc:this.description},onComplete:R=>{this.dialog.close(),window.location.reload()},onFail:R=>{alert(R.message)}})}onPostClick(T){this.dialog.close();let R=T.value;this.selectedImagefile&&0===R.length&&(R=" "),!(R.length<=0)&&(this.selectedImagefile?this.uploadImagePost(R):this.uploadPost(R))}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(he.so))},D.\u0275cmp=_.Xpm({type:D,selectors:[["app-create-post"]],decls:17,vars:1,consts:[["placeholder","Type Message..."],["commentInput",""],["class","post-preview","align","end",4,"ngIf"],["align","end"],["mat-button","","color","warn"],["for","photo-upload"],["id","photo-upload","type","file","accept","images/*",3,"change"],["photoselector",""],["mat-flat-button","","color","warn",3,"click"],["align","end",1,"post-preview"],["id","post-preview-img"]],template:function(T,R){if(1&T){const M=_.EpF();_.TgZ(0,"mat-card"),_.TgZ(1,"mat-card-header"),_.TgZ(2,"mat-card-title"),_._uU(3,"Create Post"),_.qZA(),_.qZA(),_.TgZ(4,"div"),_._UZ(5,"textarea",0,1),_.qZA(),_.YNc(7,yt,2,0,"div",2),_.TgZ(8,"mat-card-actions",3),_.TgZ(9,"button",4),_.TgZ(10,"label",5),_.TgZ(11,"input",6,7),_.NdJ("change",function(){_.CHM(M);const Y=_.MAs(12);return R.onPhotoSelected(Y)}),_.qZA(),_.TgZ(13,"mat-icon"),_._uU(14,"insert_photo"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(15,"button",8),_.NdJ("click",function(){_.CHM(M);const Y=_.MAs(6);return R.onPostClick(Y)}),_._uU(16," Post "),_.qZA(),_.qZA(),_.qZA()}2&T&&(_.xp6(7),_.Q6J("ngIf",R.selectedImagefile))},directives:[Ee,mt,ft,Me.O5,cr,Se.lW,Xe.Hw],styles:["#photo-upload[_ngcontent-%COMP%]{display:none}textarea[_ngcontent-%COMP%]{font-size:1.5em;padding:1em;resize:none;width:250px;min-height:200px;border:none;outline:none}#post-preview[_ngcontent-%COMP%]{text-align:right;margin-top:1em}#post-preview-img[_ngcontent-%COMP%]{object-fit:cover;object-position:center;width:150px;height:100px;border-radius:1em;border:1px dashed gray}"]}),D})();function de(D,y){if(1&D&&(_.TgZ(0,"div",2),_.TgZ(1,"div",3),_.TgZ(2,"mat-card"),_.TgZ(3,"mat-card-header"),_.TgZ(4,"mat-card-title"),_._uU(5),_.qZA(),_.TgZ(6,"mat-card-subtitle"),_._uU(7),_.qZA(),_.qZA(),_._UZ(8,"img",4),_.TgZ(9,"mat-card-content"),_._uU(10),_.qZA(),_.TgZ(11,"mat-card-actions"),_.TgZ(12,"mat-icon",5),_._uU(13,"chat_bubble_outline"),_.qZA(),_.TgZ(14,"mat-icon",5),_._uU(15,"favorite_border"),_.qZA(),_.TgZ(16,"mat-icon",5),_._uU(17,"save"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&D){const T=y.$implicit;_.xp6(5),_.Oqu(T.name),_.xp6(2),_.Oqu(T.desc),_.xp6(1),_.s9C("src",null==T?null:T.imageUrl,_.LSH),_.xp6(2),_.hij(" ",null==T?null:T.comment," ")}}let Ce=(()=>{class D{constructor(T){this.dialog=T,this.firestore=new Oe,this.posts=[],this.PostData=[],this.creatorName=[],this.creatorDesc=[]}postCreatorArray(){this.posts.forEach(T=>{this.PostData.push(T.creatorId)})}ngOnInit(){this.getPosts()}ngOnChanges(T){}onCreatePostClick(){this.dialog.open(Dn)}getCreatorInfo(){this.postCreatorArray();for(let T=0;T<this.PostData.length;T++)this.firestore.getDocument({path:["Users",this.PostData[T]],onComplete:R=>{let M=this.PostData[T],k=R.data();this.posts.forEach(Y=>{Y.creatorId===M&&(Y.name=null==k?void 0:k.publicName,Y.desc=null==k?void 0:k.description)})}})}getPosts(){this.firestore.getCollection({path:["Posts"],where:[new F("timestamp","desc"),new Le(100)],onComplete:T=>{T.docs.forEach(R=>{let M=R.data();this.postCId=M.creatorId,this.posts.push(M),this.getCreatorInfo()})},onFail:T=>{}})}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(he.uw))},D.\u0275cmp=_.Xpm({type:D,selectors:[["app-post"]],features:[_.TTD],decls:4,vars:1,consts:[["mat-fab","","color","warn","id","post-feed",3,"click"],["class","post_container",4,"ngFor","ngForOf"],[1,"post_container"],[1,"container"],["mat-card-image","","alt","",3,"src"],["color","warn",1,"action-item"]],template:function(T,R){1&T&&(_.TgZ(0,"button",0),_.NdJ("click",function(){return R.onCreatePostClick()}),_.TgZ(1,"mat-icon"),_._uU(2,"add"),_.qZA(),_.qZA(),_.YNc(3,de,18,4,"div",1)),2&T&&(_.xp6(3),_.Q6J("ngForOf",R.posts))},directives:[Se.lW,Xe.Hw,Me.sg,Ee,mt,ft,fe,An,Fe,cr],styles:["#post-feed[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;z-index:11}.action-item[_ngcontent-%COMP%]{margin-left:.5em;cursor:pointer}.post_container[_ngcontent-%COMP%]{display:block;margin-top:40px}.container[_ngcontent-%COMP%]{max-width:500px;max-height:600px;margin-top:.5em;margin-left:auto;margin-right:auto;z-index:-1}img[_ngcontent-%COMP%]{max-width:500px;max-height:600px}"]}),D})();function dr(D,y){if(1&D&&(_.TgZ(0,"div",4),_._uU(1),_.qZA()),2&D){const T=_.oxw();_.xp6(1),_.hij("Hey, ",T.userdocument.publicName,"")}}function kn(D,y){if(1&D){const T=_.EpF();_.TgZ(0,"app-profile",5),_.NdJ("profileClose",function(M){return _.CHM(T),_.oxw().onUpdateProfile(M)}),_.qZA()}}const hi=[{path:"",component:(()=>{class D{constructor(T){this.auth=T,this.fs=new Oe,this.firebaseAuth=new Xt.l,this.userdocument={publicName:"",description:""},this.profileShow=!1,this.userhasProfile=!1}ngOnInit(){this.getProfile()}ngOnChanges(T){}onProfile(T){this.profileShow=T}onUpdateProfile(T){this.profileShow=T}getProfile(){this.firebaseAuth.listenToSignInStateChanges(R=>{this.fs.listenToDocument({name:"Getting Documnet",path:["Users",this.firebaseAuth.getAuth().currentUser.uid],onUpdate:M=>{this.userhasProfile=M.exists,M.exists&&(this.userdocument=M.data())}})})}}return D.\u0275fac=function(T){return new(T||D)(_.Y36(We.e))},D.\u0275cmp=_.Xpm({type:D,selectors:[["app-user-dashboard"]],features:[_.TTD],decls:5,vars:2,consts:[[1,"container"],[3,"profilleClickListner"],["class","fr",4,"ngIf"],[3,"profileClose",4,"ngIf"],[1,"fr"],[3,"profileClose"]],template:function(T,R){1&T&&(_._UZ(0,"div",0),_.TgZ(1,"app-header",1),_.NdJ("profilleClickListner",function(k){return R.onProfile(k)}),_.qZA(),_.YNc(2,dr,2,1,"div",2),_.YNc(3,kn,1,0,"app-profile",3),_._UZ(4,"router-outlet")),2&T&&(_.xp6(2),_.Q6J("ngIf",R.userhasProfile),_.xp6(1),_.Q6J("ngIf",R.profileShow))},directives:[Rn,Me.O5,Ze,g.lC],styles:[".fr[_ngcontent-%COMP%]{position:fixed;left:15px;top:3px;z-index:11}.container[_ngcontent-%COMP%]{width:100vw;background-color:#fff;height:40px;z-index:10;position:fixed;top:0}"]}),D})(),children:[{path:"home",component:Ce},{path:"about",component:Rn},{path:"",redirectTo:"/user/home",pathMatch:"full"}]}];let pr=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275mod=_.oAB({type:D}),D.\u0275inj=_.cJS({imports:[[g.Bz.forChild(hi)],g.Bz]}),D})(),Ye=(()=>{class D{}return D.\u0275fac=function(T){return new(T||D)},D.\u0275mod=_.oAB({type:D}),D.\u0275inj=_.cJS({imports:[[Me.ez,pr,he.Is,Xe.Ps,Se.ot,xt]]}),D})()},9361:(Ya,ar,ut)=>{ut.r(ar);var Me=ut(8367),g=ut(655),_=ut(492),Xt=ut(4003),Ft=function(e,t){return(Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])})(e,t)};function ui(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],o=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var F,lo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Le=Le||{},J=lo||self;function he(){}function Sn(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Ie(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Cn="closure_uid_"+(1e9*Math.random()>>>0),li=0;function ur(e,t,i){return e.call.apply(e.bind,arguments)}function ho(e,t,i){if(!e)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,o),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function wt(e,t,i){return(wt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ur:ho).apply(null,arguments)}function Fe(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var o=i.slice();return o.push.apply(o,arguments),e.apply(this,o)}}function ft(e,t){function i(){}i.prototype=t.prototype,e.Z=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.Vb=function(o,s,a){for(var u=Array(arguments.length-2),c=2;c<arguments.length;c++)u[c-2]=arguments[c];return t.prototype[s].apply(o,u)}}function fe(){this.s=this.s,this.o=this.o}var Ue={};fe.prototype.s=!1,fe.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function ci(e){return Object.prototype.hasOwnProperty.call(e,Cn)&&e[Cn]||(e[Cn]=++li)}(this);delete Ue[e]}},fe.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var An=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var i=0;i<e.length;i++)if(i in e&&e[i]===t)return i;return-1},lr=Array.prototype.forEach?function(e,t,i){Array.prototype.forEach.call(e,t,i)}:function(e,t,i){for(var o=e.length,s="string"==typeof e?e.split(""):e,a=0;a<o;a++)a in s&&t.call(i,s[a],a,e)};function Je(e){return Array.prototype.concat.apply([],arguments)}function hr(e){var t=e.length;if(0<t){for(var i=Array(t),o=0;o<t;o++)i[o]=e[o];return i}return[]}function Dt(e){return/^[\s\xa0]*$/.test(e)}var xt,Ee=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function mt(e,t){return-1!=e.indexOf(t)}function xn(e,t){return e<t?-1:e>t?1:0}t:{var Ze=J.navigator;if(Ze){var We=Ze.userAgent;if(We){xt=We;break t}}xt=""}function Se(e,t,i){for(var o in e)t.call(i,e[o],o,e)}function Rn(e){var t={};for(var i in e)t[i]=e[i];return t}var fr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xe(e,t){for(var i,o,s=1;s<arguments.length;s++){for(i in o=arguments[s])e[i]=o[i];for(var a=0;a<fr.length;a++)i=fr[a],Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}}function yt(e){return yt[" "](e),e}yt[" "]=he;var Ye,e,de=mt(xt,"Opera"),Ce=mt(xt,"Trident")||mt(xt,"MSIE"),dr=mt(xt,"Edge"),kn=dr||Ce,Gt=mt(xt,"Gecko")&&!(mt(xt.toLowerCase(),"webkit")&&!mt(xt,"Edge"))&&!(mt(xt,"Trident")||mt(xt,"MSIE"))&&!mt(xt,"Edge"),hi=mt(xt.toLowerCase(),"webkit")&&!mt(xt,"Edge");function pr(){var e=J.document;return e?e.documentMode:void 0}t:{var D="",y=(e=xt,Gt?/rv:([^\);]+)(\)|;)/.exec(e):dr?/Edge\/([\d\.]+)/.exec(e):Ce?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):hi?/WebKit\/(\S+)/.exec(e):de?/(?:Version)[ \/]?(\S+)/.exec(e):void 0);if(y&&(D=y?y[1]:""),Ce){var T=pr();if(null!=T&&T>parseFloat(D)){Ye=String(T);break t}}Ye=D}var R={};var lt=J.document&&Ce&&(pr()||parseInt(Ye,10))||void 0,gr=function(){if(!J.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{J.addEventListener("test",he,t),J.removeEventListener("test",he,t)}catch(i){}return e}();function kt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Ae(e,t){if(kt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var i=this.type=e.type,o=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Gt){t:{try{yt(t.nodeName);var s=!0;break t}catch(a){}s=!1}s||(t=null)}}else"mouseover"==i?t=e.fromElement:"mouseout"==i&&(t=e.toElement);this.relatedTarget=t,o?(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Es[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Ae.Z.h.call(this)}}kt.prototype.h=function(){this.defaultPrevented=!0},ft(Ae,kt);var Es={2:"touch",3:"pen",4:"mouse"};Ae.prototype.h=function(){Ae.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Pn="closure_listenable_"+(1e6*Math.random()|0),Ss=0;function Cs(e,t,i,o,s){this.listener=e,this.proxy=null,this.src=t,this.type=i,this.capture=!!o,this.ia=s,this.key=++Ss,this.ca=this.fa=!1}function mr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function vr(e){this.src=e,this.g={},this.h=0}function fi(e,t){var i=t.type;if(i in e.g){var a,o=e.g[i],s=An(o,t);(a=0<=s)&&Array.prototype.splice.call(o,s,1),a&&(mr(t),0==e.g[i].length&&(delete e.g[i],e.h--))}}function di(e,t,i,o){for(var s=0;s<e.length;++s){var a=e[s];if(!a.ca&&a.listener==t&&a.capture==!!i&&a.ia==o)return s}return-1}vr.prototype.add=function(e,t,i,o,s){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var u=di(e,t,o,s);return-1<u?(t=e[u],i||(t.fa=!1)):((t=new Cs(t,this.src,a,!!o,s)).fa=i,e.push(t)),t};var Nn="closure_lm_"+(1e6*Math.random()|0),Mn={};function fo(e,t,i,o,s){if(o&&o.once)return mo(e,t,i,o,s);if(Array.isArray(t)){for(var a=0;a<t.length;a++)fo(e,t[a],i,o,s);return null}return i=br(i),e&&e[Pn]?e.N(t,i,Ie(o)?!!o.capture:!!o,s):po(e,t,i,!1,o,s)}function po(e,t,i,o,s,a){if(!t)throw Error("Invalid event type");var u=Ie(s)?!!s.capture:!!s,c=pi(e);if(c||(e[Nn]=c=new vr(e)),(i=c.add(t,i,o,u,a)).proxy)return i;if(o=function go(){var t=yr;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=o,o.src=e,o.listener=i,e.addEventListener)gr||(s=u),void 0===s&&(s=!1),e.addEventListener(t.toString(),o,s);else if(e.attachEvent)e.attachEvent(vo(t.toString()),o);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(o)}return i}function mo(e,t,i,o,s){if(Array.isArray(t)){for(var a=0;a<t.length;a++)mo(e,t[a],i,o,s);return null}return i=br(i),e&&e[Pn]?e.O(t,i,Ie(o)?!!o.capture:!!o,s):po(e,t,i,!0,o,s)}function Pt(e,t,i,o,s){if(Array.isArray(t))for(var a=0;a<t.length;a++)Pt(e,t[a],i,o,s);else o=Ie(o)?!!o.capture:!!o,i=br(i),e&&e[Pn]?(e=e.i,(t=String(t).toString())in e.g&&-1<(i=di(a=e.g[t],i,o,s))&&(mr(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete e.g[t],e.h--))):e&&(e=pi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=di(t,i,o,s)),(i=-1<e?t[e]:null)&&$e(i))}function $e(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[Pn])fi(t.i,e);else{var i=e.type,o=e.proxy;t.removeEventListener?t.removeEventListener(i,o,e.capture):t.detachEvent?t.detachEvent(vo(i),o):t.addListener&&t.removeListener&&t.removeListener(o),(i=pi(t))?(fi(i,e),0==i.h&&(i.src=null,t[Nn]=null)):mr(e)}}}function vo(e){return e in Mn?Mn[e]:Mn[e]="on"+e}function yr(e,t){if(e.ca)e=!0;else{t=new Ae(t,this);var i=e.listener,o=e.ia||e.src;e.fa&&$e(e),e=i.call(o,t)}return e}function pi(e){return(e=e[Nn])instanceof vr?e:null}var gi="__closure_events_fn_"+(1e9*Math.random()>>>0);function br(e){return"function"==typeof e?e:(e[gi]||(e[gi]=function(t){return e.handleEvent(t)}),e[gi])}function Tt(){fe.call(this),this.i=new vr(this),this.P=this,this.I=null}function bt(e,t){var i,o=e.I;if(o)for(i=[];o;o=o.I)i.push(o);if(e=e.P,o=t.type||t,"string"==typeof t)t=new kt(t,e);else if(t instanceof kt)t.target=t.target||e;else{var s=t;Xe(t=new kt(o,e),s)}if(s=!0,i)for(var a=i.length-1;0<=a;a--){var u=t.g=i[a];s=On(u,o,!0,t)&&s}if(s=On(u=t.g=e,o,!0,t)&&s,s=On(u,o,!1,t)&&s,i)for(a=0;a<i.length;a++)s=On(u=t.g=i[a],o,!1,t)&&s}function On(e,t,i,o){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,a=0;a<t.length;++a){var u=t[a];if(u&&!u.ca&&u.capture==i){var c=u.listener,l=u.ia||u.src;u.fa&&fi(e.i,u),s=!1!==c.call(l,o)&&s}}return s&&!o.defaultPrevented}ft(Tt,fe),Tt.prototype[Pn]=!0,Tt.prototype.removeEventListener=function(e,t,i,o){Pt(this,e,t,i,o)},Tt.prototype.M=function(){if(Tt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],o=0;o<i.length;o++)mr(i[o]);delete e.g[t],e.h--}}this.I=null},Tt.prototype.N=function(e,t,i,o){return this.i.add(String(e),t,!1,i,o)},Tt.prototype.O=function(e,t,i,o){return this.i.add(String(e),t,!0,i,o)};var _r=J.JSON.stringify;function As(){var e=yi,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var vi,xs=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,i){var o=pe.get();o.set(t,i),this.h?this.h.next=o:this.g=o,this.h=o},e}(),pe=new(function(){function e(t,i){this.i=t,this.j=i,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},e}())(function(){return new ge},function(e){return e.reset()}),ge=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,i){this.h=t,this.g=i,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function wr(e){J.setTimeout(function(){throw e},0)}function mi(e,t){vi||function tn(){var e=J.Promise.resolve(void 0);vi=function(){e.then(Rs)}}(),en||(vi(),en=!0),yi.add(e,t)}var en=!1,yi=new xs;function Rs(){for(var e;e=As();){try{e.h.call(e.g)}catch(i){wr(i)}var t=pe;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}en=!1}function Tr(e,t){Tt.call(this),this.h=e||1,this.g=t||J,this.j=wt(this.kb,this),this.l=Date.now()}function bi(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function _i(e,t,i){if("function"==typeof e)i&&(e=wt(e,i));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=wt(e.handleEvent,e)}return 2147483647<Number(t)?-1:J.setTimeout(e,t||0)}function yo(e){e.g=_i(function(){e.g=null,e.i&&(e.i=!1,yo(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}ft(Tr,Tt),(F=Tr.prototype).da=!1,F.S=null,F.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),bt(this,"tick"),this.da&&(bi(this),this.start()))}},F.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},F.M=function(){Tr.Z.M.call(this),bi(this),delete this.g};var bo=function(e){function t(i,o){var s=e.call(this)||this;return s.m=i,s.j=o,s.h=null,s.i=!1,s.g=null,s}return function Oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Ft(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t.prototype.l=function(i){this.h=arguments,this.g?this.i=!0:yo(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(J.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(fe);function Ln(e){fe.call(this),this.h=e,this.g={}}ft(Ln,fe);var Fn=[];function Ir(e,t,i,o){Array.isArray(i)||(i&&(Fn[0]=i.toString()),i=Fn);for(var s=0;s<i.length;s++){var a=fo(t,i[s],o||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function _o(e){Se(e.g,function(t,i){this.g.hasOwnProperty(i)&&$e(t)},e),e.g={}}function Er(){this.g=!0}function nn(e,t,i,o){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function To(e,t){if(!e.g)return t;if(!t)return null;try{var i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var o=i[e];if(!(2>o.length)){var s=o[1];if(Array.isArray(s)&&!(1>s.length)){var a=s[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var u=1;u<s.length;u++)s[u]=""}}}return _r(i)}catch(c){return t}}(e,i)+(o?" "+o:"")})}Ln.prototype.M=function(){Ln.Z.M.call(this),_o(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Er.prototype.Aa=function(){this.g=!1},Er.prototype.info=function(){};var me={},Io=null;function Sr(){return Io=Io||new Tt}function wi(e){kt.call(this,me.Ma,e)}function on(e){var t=Sr();bt(t,new wi(t,e))}function Eo(e,t){kt.call(this,me.STAT_EVENT,e),this.stat=t}function Ut(e){var t=Sr();bt(t,new Eo(t,e))}function So(e,t){kt.call(this,me.Na,e),this.size=t}function Un(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return J.setTimeout(function(){e()},t)}me.Ma="serverreachability",ft(wi,kt),me.STAT_EVENT="statevent",ft(Eo,kt),me.Na="timingevent",ft(So,kt);var qn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Cr={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ti(){}function Co(){}Ti.prototype.h=null;var Si,sn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ei(){kt.call(this,"d")}function an(){kt.call(this,"c")}function Ar(){}function Vn(e,t,i,o){this.l=e,this.j=t,this.m=i,this.X=o||1,this.V=new Ln(this),this.P=ks,this.W=new Tr(e=kn?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ao}function Ao(){this.i=null,this.g="",this.h=!1}ft(Ei,kt),ft(an,kt),ft(Ar,Ti),Ar.prototype.g=function(){return new XMLHttpRequest},Ar.prototype.i=function(){return{}},Si=new Ar;var ks=45e3,Ci={},xr={};function Rr(e,t,i){e.K=1,e.v=dt(P(t)),e.s=i,e.U=!0,xo(e,null)}function xo(e,t){e.F=Date.now(),un(e),e.A=P(e.v);var i=e.A,o=e.X;Array.isArray(o)||(o=[String(o)]),tu(i.h,"t",o),e.C=0,i=e.l.H,e.h=new Ao,e.g=Iu(e.l,i?t:null,!e.s),0<e.O&&(e.L=new bo(wt(e.Ia,e,e.g),e.O)),Ir(e.V,e.g,"readystatechange",e.gb),t=e.H?Rn(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),on(1),function wo(e,t,i,o,s,a){e.info(function(){if(e.g)if(a)for(var u="",c=a.split("&"),l=0;l<c.length;l++){var d=c[l].split("=");if(1<d.length){var p=d[0];d=d[1];var v=p.split("_");u=2<=v.length&&"type"==v[1]?u+(p+"=")+d+"&":u+(p+"=redacted&")}}else u=null;else u=a;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+t+"\n"+i+"\n"+u})}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ro(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function jn(e,t,i){for(var s,o=!0;!e.I&&e.C<i.length;){if((s=Do(e,i))==xr){4==t&&(e.o=4,Ut(14),o=!1),nn(e.j,e.m,null,"[Incomplete Response]");break}if(s==Ci){e.o=4,Ut(15),nn(e.j,e.m,i,"[Invalid Chunk]"),o=!1;break}nn(e.j,e.m,s,null),Ai(e,s)}Ro(e)&&s!=xr&&s!=Ci&&(e.h.g="",e.C=0),4!=t||0!=i.length||e.h.h||(e.o=1,Ut(16),o=!1),e.i=e.i&&o,o?0<i.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),js(t),t.L=!0,Ut(11))):(nn(e.j,e.m,i,"[Invalid Chunked Response]"),qe(e),Bn(e))}function Do(e,t){var i=e.C,o=t.indexOf("\n",i);return-1==o?xr:(i=Number(t.substring(i,o)),isNaN(i)?Ci:(o+=1)+i>t.length?xr:(t=t.substr(o,i),e.C=o+i,t))}function un(e){e.Y=Date.now()+e.P,cn(e,e.P)}function cn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Un(wt(e.eb,e),t)}function Dr(e){e.B&&(J.clearTimeout(e.B),e.B=null)}function Bn(e){0==e.l.G||e.I||bu(e.l,e)}function qe(e){Dr(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,bi(e.W),_o(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ai(e,t){try{var i=e.l;if(0!=i.G&&(i.g==e||Ns(i.i,e)))if(i.I=e.N,!e.J&&Ns(i.i,e)&&3==i.G){try{var o=i.Ca.g.parse(t)}catch(L){o=null}if(Array.isArray(o)&&3==o.length){var s=o;if(0==s[0])t:if(i.u)i.ta=s[1],0<i.ta-i.U&&37500>s[2]&&i.N&&0==i.A&&!i.v&&(i.v=Un(wt(i.ab,i),6e3));else{if(i.g){if(!(i.g.F+3e3<e.F))break t;Lo(i),Mo(i)}Vs(i),Ut(18)}if(1>=ru(i.i)&&i.ka){try{i.ka()}catch(L){}i.ka=void 0}}else Gn(i,11)}else if((e.J||i.g==e)&&Lo(i),!Dt(t))for(s=i.Ca.g.parse(t),t=0;t<s.length;t++){var a=s[t];if(i.U=a[0],a=a[1],2==i.G)if("c"==a[0]){i.J=a[1],i.la=a[2];var u=a[3];null!=u&&(i.ma=u,i.h.info("VER="+i.ma));var c=a[4];null!=c&&(i.za=c,i.h.info("SVER="+i.za));var l=a[5];null!=l&&"number"==typeof l&&0<l&&(i.K=o=1.5*l,i.h.info("backChannelRequestTimeoutMs_="+o)),o=i;var d=e.g;if(d){var p=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var v=o.i;!v.g&&(mt(p,"spdy")||mt(p,"quic")||mt(p,"h2"))&&(v.j=v.l,v.g=new Set,v.h&&(Ms(v,v.h),v.h=null))}if(o.D){var w=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(o.sa=w,W(o.F,o.D,w))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-e.F,i.h.info("Handshake RTT: "+i.O+"ms"));var S=e;if((o=i).oa=Tu(o,o.H?o.la:null,o.W),S.J){iu(o.i,S);var E=S,x=o.K;x&&E.setTimeout(x),E.B&&(Dr(E),un(E)),o.g=S}else vu(o);0<i.l.length&&Oo(i)}else"stop"!=a[0]&&"close"!=a[0]||Gn(i,7);else 3==i.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Gn(i,7):Us(i):"noop"!=a[0]&&i.j&&i.j.wa(a),i.A=0)}on(4)}catch(L){}}function xi(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Sn(e)||"string"==typeof e)lr(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var i=e.T();else if(e.R&&"function"==typeof e.R)i=void 0;else if(Sn(e)||"string"==typeof e){i=[];for(var o=e.length,s=0;s<o;s++)i.push(s)}else for(s in i=[],o=0,e)i[o++]=s;o=function Ps(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Sn(e)){for(var t=[],i=e.length,o=0;o<i;o++)t.push(e[o]);return t}for(o in t=[],i=0,e)t[i++]=e[o];return t}(e),s=o.length;for(var a=0;a<s;a++)t.call(void 0,o[a],i&&i[a],e)}}function f(e,t){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var o=0;o<i;o+=2)this.set(arguments[o],arguments[o+1])}else if(e)if(e instanceof f)for(i=e.T(),o=0;o<i.length;o++)this.set(i[o],e.get(i[o]));else for(o in e)this.set(o,e[o])}function h(e){if(e.i!=e.g.length){for(var t=0,i=0;t<e.g.length;){var o=e.g[t];m(e.h,o)&&(e.g[i++]=o),t++}e.g.length=i}if(e.i!=e.g.length){var s={};for(i=t=0;t<e.g.length;)m(s,o=e.g[t])||(e.g[i++]=o,s[o]=1),t++;e.g.length=i}}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(F=Vn.prototype).setTimeout=function(e){this.P=e},F.gb=function(e){e=e.target;var t=this.L;t&&3==je(e)?t.l():this.Ia(e)},F.Ia=function(e){try{if(e==this.g)t:{var t=je(this.g),i=this.g.Da(),o=this.g.ba();if(!(3>t)&&(3!=t||kn||this.g&&(this.h.h||this.g.ga()||fu(this.g)))){this.I||4!=t||7==i||on(8==i||0>=o?3:2),Dr(this);var s=this.g.ba();this.N=s;e:if(Ro(this)){var a=fu(this.g);e="";var u=a.length,c=4==je(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){qe(this),Bn(this);var l="";break e}this.h.i=new J.TextDecoder}for(i=0;i<u;i++)this.h.h=!0,e+=this.h.i.decode(a[i],{stream:c&&i==u-1});a.splice(0,u),this.h.g+=e,this.C=0,l=this.h.g}else l=this.g.ga();if(this.i=200==s,function Ds(e,t,i,o,s,a,u){e.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+s+"]: "+t+"\n"+i+"\n"+a+" "+u})}(this.j,this.u,this.A,this.m,this.X,t,s),this.i){if(this.$&&!this.J){e:{if(this.g){var d,p=this.g;if((d=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Dt(d)){var v=d;break e}}v=null}if(!(s=v)){this.i=!1,this.o=3,Ut(12),qe(this),Bn(this);break t}nn(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ai(this,s)}this.U?(jn(this,t,l),kn&&this.i&&3==t&&(Ir(this.V,this.W,"tick",this.fb),this.W.start())):(nn(this.j,this.m,l,null),Ai(this,l)),4==t&&qe(this),this.i&&!this.I&&(4==t?bu(this.l,this):(this.i=!1,un(this)))}else 400==s&&0<l.indexOf("Unknown SID")?(this.o=3,Ut(12)):(this.o=0,Ut(13)),qe(this),Bn(this)}}}catch(w){}},F.fb=function(){if(this.g){var e=je(this.g),t=this.g.ga();this.C<t.length&&(Dr(this),jn(this,e,t),this.i&&4!=e&&un(this))}},F.cancel=function(){this.I=!0,qe(this)},F.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function rn(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(on(3),Ut(17)),qe(this),this.o=2,Bn(this)):cn(this,this.Y-e)},(F=f.prototype).R=function(){h(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},F.T=function(){return h(this),this.g.concat()},F.get=function(e,t){return m(this.h,e)?this.h[e]:t},F.set=function(e,t){m(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},F.forEach=function(e,t){for(var i=this.T(),o=0;o<i.length;o++){var s=i[o],a=this.get(s);e.call(t,a,s,this)}};var b=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function C(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof C){this.g=void 0!==t?t:e.g,B(this,e.j),this.s=e.s,q(this,e.i),G(this,e.m),this.l=e.l,t=e.h;var i=new Ve;i.i=t.i,t.g&&(i.g=new f(t.g),i.h=t.h),Z(this,i),this.o=e.o}else e&&(i=String(e).match(b))?(this.g=!!t,B(this,i[1]||"",!0),this.s=pt(i[2]||""),q(this,i[3]||"",!0),G(this,i[4]),this.l=pt(i[5]||"",!0),Z(this,i[6]||"",!0),this.o=pt(i[7]||"")):(this.g=!!t,this.h=new Ve(null,this.g))}function P(e){return new C(e)}function B(e,t,i){e.j=i?pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function q(e,t,i){e.i=i?pt(t,!0):t}function G(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Z(e,t,i){t instanceof Ve?(e.h=t,function Mh(e,t){t&&!e.j&&($t(e),e.i=null,e.g.forEach(function(i,o){var s=o.toLowerCase();o!=s&&(te(this,o),tu(this,s,i))},e)),e.j=t}(e.h,e.g)):(i||(t=It(t,ln)),e.h=new Ve(t,e.g))}function W(e,t,i){e.h.set(t,i)}function dt(e){return W(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function It(e,t,i){return"string"==typeof e?(e=encodeURI(e).replace(t,xe),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function xe(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}C.prototype.toString=function(){var e=[],t=this.j;t&&e.push(It(t,Kt,!0),":");var i=this.i;return(i||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(It(t,Kt,!0),"@"),e.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&e.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&e.push("/"),e.push(It(i,"/"==i.charAt(0)?be:Yt,!0))),(i=this.h.toString())&&e.push("?",i),(i=this.o)&&e.push("#",It(i,hn)),e.join("")};var Kt=/[#\/\?@]/g,Yt=/[#\?:]/g,be=/[#\?]/g,ln=/[#\?@]/g,hn=/#/g;function Ve(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function $t(e){e.g||(e.g=new f,e.h=0,e.i&&function I(e,t){if(e){e=e.split("&");for(var i=0;i<e.length;i++){var o=e[i].indexOf("="),s=null;if(0<=o){var a=e[i].substring(0,o);s=e[i].substring(o+1)}else a=e[i];t(a,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,i){e.add(decodeURIComponent(t.replace(/\+/g," ")),i)}))}function te(e,t){$t(e),t=kr(e,t),m(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,m((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&h(e)))}function $a(e,t){return $t(e),t=kr(e,t),m(e.g.h,t)}function tu(e,t,i){te(e,t),0<i.length&&(e.i=null,e.g.set(kr(e,t),hr(i)),e.h+=i.length)}function kr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(F=Ve.prototype).add=function(e,t){$t(this),this.i=null,e=kr(this,e);var i=this.g.get(e);return i||this.g.set(e,i=[]),i.push(t),this.h+=1,this},F.forEach=function(e,t){$t(this),this.g.forEach(function(i,o){lr(i,function(s){e.call(t,s,o,this)},this)},this)},F.T=function(){$t(this);for(var e=this.g.R(),t=this.g.T(),i=[],o=0;o<t.length;o++)for(var s=e[o],a=0;a<s.length;a++)i.push(t[o]);return i},F.R=function(e){$t(this);var t=[];if("string"==typeof e)$a(this,e)&&(t=Je(t,this.g.get(kr(this,e))));else{e=this.g.R();for(var i=0;i<e.length;i++)t=Je(t,e[i])}return t},F.set=function(e,t){return $t(this),this.i=null,$a(this,e=kr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},F.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},F.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),i=0;i<t.length;i++){var o=t[i],s=encodeURIComponent(String(o));o=this.R(o);for(var a=0;a<o.length;a++){var u=s;""!==o[a]&&(u+="="+encodeURIComponent(String(o[a]))),e.push(u)}}return this.i=e.join("&")};var Oh=function e(t,i){this.h=t,this.g=i};function eu(e){this.l=e||Lh,e=J.PerformanceNavigationTiming?0<(e=J.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(J.g&&J.g.Ea&&J.g.Ea()&&J.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Lh=10;function nu(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ru(e){return e.h?1:e.g?e.g.size:0}function Ns(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ms(e,t){e.g?e.g.add(t):e.h=t}function iu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ou(e){var t,i;if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var o=e.i;try{for(var s=ui(e.g.values()),a=s.next();!a.done;a=s.next())o=o.concat(a.value.D)}catch(c){t={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return o}return hr(e.i)}function Os(){}function Fh(){this.g=new Os}function Uh(e,t,i){var o=i||"";try{xi(e,function(s,a){var u=s;Ie(s)&&(u=_r(s)),t.push(o+a+"="+encodeURIComponent(u))})}catch(s){throw t.push(o+"type="+encodeURIComponent("_badmap")),s}}function ko(e,t,i,o,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(o)}catch(a){}}function Ri(e){this.l=e.$b||null,this.j=e.ib||!1}function Po(e,t){Tt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ls,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}eu.prototype.cancel=function(){var e,t;if(this.i=ou(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var i=ui(this.g.values()),o=i.next();!o.done;o=i.next())o.value.cancel()}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.g.clear()}},Os.prototype.stringify=function(e){return J.JSON.stringify(e,void 0)},Os.prototype.parse=function(e){return J.JSON.parse(e,void 0)},ft(Ri,Ti),Ri.prototype.g=function(){return new Po(this.l,this.j)},Ri.prototype.i=function(e){return function(){return e}}({}),ft(Po,Tt);var Ls=0;function su(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Di(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ki(e)}function ki(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(F=Po.prototype).open=function(e,t){if(this.readyState!=Ls)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ki(this)},F.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||J).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Di(this)),this.readyState=Ls},F.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ki(this)),this.g&&(this.readyState=3,ki(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==J.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;su(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},F.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Di(this):ki(this),3==this.readyState&&su(this)}},F.Ua=function(e){this.g&&(this.response=this.responseText=e,Di(this))},F.Ta=function(e){this.g&&(this.response=e,Di(this))},F.ha=function(){this.g&&Di(this)},F.setRequestHeader=function(e,t){this.v.append(e,t)},F.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},F.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),i=t.next();!i.done;)e.push((i=i.value)[0]+": "+i[1]),i=t.next();return e.join("\r\n")},Object.defineProperty(Po.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Vh=J.JSON.parse;function Et(e){Tt.call(this),this.headers=new f,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=au,this.K=this.L=!1}ft(Et,Tt);var au="",jh=/^https?$/i,Bh=["POST","PUT"];function Kh(e){return"content-type"==e.toLowerCase()}function uu(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,cu(e),No(e)}function cu(e){e.D||(e.D=!0,bt(e,"complete"),bt(e,"error"))}function lu(e){if(e.h&&void 0!==Le&&(!e.C[1]||4!=je(e)||2!=e.ba()))if(e.v&&4==je(e))_i(e.Fa,0,e);else if(bt(e,"readystatechange"),4==je(e)){e.h=!1;try{var o,t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(o=i)){var s;if(s=0===t){var a=String(e.H).match(b)[1]||null;if(!a&&J.self&&J.self.location){var u=J.self.location.protocol;a=u.substr(0,u.length-1)}s=!jh.test(a?a.toLowerCase():"")}o=s}if(o)bt(e,"complete"),bt(e,"success");else{e.m=6;try{var c=2<je(e)?e.g.statusText:""}catch(l){c=""}e.j=c+" ["+e.ba()+"]",cu(e)}}finally{No(e)}}}function No(e,t){if(e.g){hu(e);var i=e.g,o=e.C[0]?he:null;e.g=null,e.C=null,t||bt(e,"ready");try{i.onreadystatechange=o}catch(s){}}}function hu(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(J.clearTimeout(e.A),e.A=null)}function je(e){return e.g?e.g.readyState:0}function fu(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case au:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fs(e,t,i){t:{for(o in i){var o=!1;break t}o=!0}o||(i=function zh(e){var t="";return Se(e,function(i,o){t+=o,t+=":",t+=i,t+="\r\n"}),t}(i),"string"==typeof e?null!=i&&encodeURIComponent(String(i)):W(e,t,i))}function Pi(e,t,i){return i&&i.internalChannelParams&&i.internalChannelParams[e]||t}function du(e){this.za=0,this.l=[],this.h=new Er,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Pi("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Pi("baseRetryDelayMs",5e3,e),this.$a=Pi("retryDelaySeedMs",1e4,e),this.Ya=Pi("forwardChannelMaxRetries",2,e),this.ra=Pi("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new eu(e&&e.concurrentRequestLimit),this.Ca=new Fh,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Us(e){if(pu(e),3==e.G){var t=e.V++,i=P(e.F);W(i,"SID",e.J),W(i,"RID",t),W(i,"TYPE","terminate"),Ni(e,i),(t=new Vn(e,e.h,t,void 0)).K=2,t.v=dt(P(i)),i=!1,J.navigator&&J.navigator.sendBeacon&&(i=J.navigator.sendBeacon(t.v.toString(),"")),!i&&J.Image&&((new Image).src=t.v,i=!0),i||(t.g=Iu(t.l,null),t.g.ea(t.v)),t.F=Date.now(),un(t)}wu(e)}function Mo(e){e.g&&(js(e),e.g.cancel(),e.g=null)}function pu(e){Mo(e),e.u&&(J.clearTimeout(e.u),e.u=null),Lo(e),e.i.cancel(),e.m&&("number"==typeof e.m&&J.clearTimeout(e.m),e.m=null)}function qs(e,t){e.l.push(new Oh(e.Za++,t)),3==e.G&&Oo(e)}function Oo(e){nu(e.i)||e.m||(e.m=!0,mi(e.Ha,e),e.C=0)}function gu(e,t){var i;i=t?t.m:e.V++;var o=P(e.F);W(o,"SID",e.J),W(o,"RID",i),W(o,"AID",e.U),Ni(e,o),e.o&&e.s&&Fs(o,e.o,e.s),i=new Vn(e,e.h,i,e.C+1),null===e.o&&(i.H=e.s),t&&(e.l=t.D.concat(e.l)),t=mu(e,i,1e3),i.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Ms(e.i,i),Rr(i,o,t)}function Ni(e,t){e.j&&xi({},function(i,o){W(t,o,i)})}function mu(e,t,i){i=Math.min(e.l.length,i);var o=e.j?wt(e.j.Oa,e.j,e):null;t:for(var s=e.l,a=-1;;){var u=["count="+i];-1==a?0<i?u.push("ofs="+(a=s[0].h)):a=0:u.push("ofs="+a);for(var c=!0,l=0;l<i;l++){var d=s[l].h,p=s[l].g;if(0>(d-=a))a=Math.max(0,s[l].h-100),c=!1;else try{Uh(p,u,"req"+d+"_")}catch(v){o&&o(p)}}if(c){o=u.join("&");break t}}return e=e.l.splice(0,i),t.D=e,o}function vu(e){e.g||e.u||(e.Y=1,mi(e.Ga,e),e.A=0)}function Vs(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=Un(wt(e.Ga,e),_u(e,e.A)),e.A++,0))}function js(e){null!=e.B&&(J.clearTimeout(e.B),e.B=null)}function yu(e){e.g=new Vn(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=P(e.oa);W(t,"RID","rpc"),W(t,"SID",e.J),W(t,"CI",e.N?"0":"1"),W(t,"AID",e.U),Ni(e,t),W(t,"TYPE","xmlhttp"),e.o&&e.s&&Fs(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var i=e.g;e=e.la,i.K=1,i.v=dt(P(t)),i.s=null,i.U=!0,xo(i,e)}function Lo(e){null!=e.v&&(J.clearTimeout(e.v),e.v=null)}function bu(e,t){var i=null;if(e.g==t){Lo(e),js(e),e.g=null;var o=2}else{if(!Ns(e.i,t))return;i=t.D,iu(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==o){i=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;bt(o=Sr(),new So(o,i,t,s)),Oo(e)}else vu(e);else if(3==(s=t.o)||0==s&&0<e.I||!(1==o&&function Hh(e,t){return!(ru(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Un(wt(e.Ha,e,t),_u(e,e.C)),e.C++,0)))}(e,t)||2==o&&Vs(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),s){case 1:Gn(e,5);break;case 4:Gn(e,10);break;case 3:Gn(e,6);break;default:Gn(e,2)}}function _u(e,t){var i=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(i*=2),i*t}function Gn(e,t){if(e.h.info("Error code "+t),2==t){var i=null;e.j&&(i=null);var o=wt(e.jb,e);i||(i=new C("//www.google.com/images/cleardot.gif"),J.location&&"http"==J.location.protocol||B(i,"https"),dt(i)),function qh(e,t){var i=new Er;if(J.Image){var o=new Image;o.onload=Fe(ko,i,o,"TestLoadImage: loaded",!0,t),o.onerror=Fe(ko,i,o,"TestLoadImage: error",!1,t),o.onabort=Fe(ko,i,o,"TestLoadImage: abort",!1,t),o.ontimeout=Fe(ko,i,o,"TestLoadImage: timeout",!1,t),J.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=e}else t(!1)}(i.toString(),o)}else Ut(2);e.G=0,e.j&&e.j.va(t),wu(e),pu(e)}function wu(e){e.G=0,e.I=-1,e.j&&((0!=ou(e.i).length||0!=e.l.length)&&(e.i.i.length=0,hr(e.l),e.l.length=0),e.j.ua())}function Tu(e,t,i){var o=function Nt(e){return e instanceof C?P(e):new C(e,void 0)}(i);if(""!=o.i)t&&q(o,t+"."+o.i),G(o,o.m);else{var s=J.location;o=function ct(e,t,i,o){var s=new C(null,void 0);return e&&B(s,e),t&&q(s,t),i&&G(s,i),o&&(s.l=o),s}(s.protocol,t?t+"."+s.hostname:s.hostname,+s.port,i)}return e.aa&&Se(e.aa,function(a,u){W(o,u,a)}),i=e.sa,(t=e.D)&&i&&W(o,t,i),W(o,"VER",e.ma),Ni(e,o),o}function Iu(e,t,i){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Et(i&&e.Ba&&!e.qa?new Ri({ib:!0}):e.qa)).L=e.H,t}function Eu(){}function Fo(){if(Ce&&!(10<=Number(lt)))throw Error("Environmental error: no available transport.")}function oe(e,t){Tt.call(this),this.g=new du(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Dt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Dt(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Pr(this)}function Su(e){Ei.call(this);var t=e.__sm__;if(t){t:{for(var i in t){e=i;break t}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Cu(){an.call(this),this.status=1}function Pr(e){this.g=e}(F=Et.prototype).ea=function(e,t,i,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Si.g(),this.C=function Ii(e){return e.h||(e.h=e.i())}(this.u?this.u:Si),this.g.onreadystatechange=wt(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void uu(this,a)}e=i||"";var s=new f(this.headers);o&&xi(o,function(a,u){s.set(u,a)}),o=function Qe(e){t:{for(var t=Kh,i=e.length,o="string"==typeof e?e.split(""):e,s=0;s<i;s++)if(s in o&&t.call(void 0,o[s],s,e)){t=s;break t}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),i=J.FormData&&e instanceof J.FormData,!(0<=An(Bh,t))||o||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(a,u){this.g.setRequestHeader(u,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{hu(this),0<this.B&&((this.K=function Gh(e){return Ce&&function M(){return function Dn(e){var t=R;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}(function(){for(var e=0,t=Ee(String(Ye)).split("."),i=Ee("9").split("."),o=Math.max(t.length,i.length),s=0;0==e&&s<o;s++){var a=t[s]||"",u=i[s]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==a[0].length&&0==u[0].length)break;e=xn(0==a[1].length?0:parseInt(a[1],10),0==u[1].length?0:parseInt(u[1],10))||xn(0==a[2].length,0==u[2].length)||xn(a[2],u[2]),a=a[3],u=u[3]}while(0==e)}return 0<=e})}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=wt(this.pa,this)):this.A=_i(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){uu(this,a)}},F.pa=function(){void 0!==Le&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bt(this,"timeout"),this.abort(8))},F.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,bt(this,"complete"),bt(this,"abort"),No(this))},F.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),No(this,!0)),Et.Z.M.call(this)},F.Fa=function(){this.s||(this.F||this.v||this.l?lu(this):this.cb())},F.cb=function(){lu(this)},F.ba=function(){try{return 2<je(this)?this.g.status:-1}catch(e){return-1}},F.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},F.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Vh(t)}},F.Da=function(){return this.m},F.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(F=du.prototype).ma=8,F.G=1,F.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},F.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Vn(this,this.h,e,void 0),i=this.s;if(this.P&&(i?Xe(i=Rn(i),this.P):i=this.P),null===this.o&&(t.H=i),this.ja)t:{for(var o=0,s=0;s<this.l.length;s++){var a=this.l[s];if(void 0===(a="__data__"in a.g&&"string"==typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(o+=a)){o=s;break t}if(4096===o||s===this.l.length-1){o=s+1;break t}}o=1e3}else o=1e3;o=mu(this,t,o),W(s=P(this.F),"RID",e),W(s,"CVER",22),this.D&&W(s,"X-HTTP-Session-Id",this.D),Ni(this,s),this.o&&i&&Fs(s,this.o,i),Ms(this.i,t),this.Ra&&W(s,"TYPE","init"),this.ja?(W(s,"$req",o),W(s,"SID","null"),t.$=!0,Rr(t,s,null)):Rr(t,s,o),this.G=2}}else 3==this.G&&(e?gu(this,e):0==this.l.length||nu(this.i)||gu(this))},F.Ga=function(){if(this.u=null,yu(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Un(wt(this.bb,this),e)}},F.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ut(10),Mo(this),yu(this))},F.ab=function(){null!=this.v&&(this.v=null,Mo(this),Vs(this),Ut(19))},F.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Ut(2)):(this.h.info("Failed to ping google.com"),Ut(1))},(F=Eu.prototype).xa=function(){},F.wa=function(){},F.va=function(){},F.ua=function(){},F.Oa=function(){},Fo.prototype.g=function(e,t){return new oe(e,t)},ft(oe,Tt),oe.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,i=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),mi(wt(e.hb,e,t))),Ut(0),e.W=t,e.aa=i||{},e.N=e.X,e.F=Tu(e,null,e.W),Oo(e)},oe.prototype.close=function(){Us(this.g)},oe.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,qs(this.g,t)}else this.v?((t={}).__data__=_r(e),qs(this.g,t)):qs(this.g,e)},oe.prototype.M=function(){this.g.j=null,delete this.j,Us(this.g),delete this.g,oe.Z.M.call(this)},ft(Su,Ei),ft(Cu,an),ft(Pr,Eu),Pr.prototype.xa=function(){bt(this.g,"a")},Pr.prototype.wa=function(e){bt(this.g,new Su(e))},Pr.prototype.va=function(e){bt(this.g,new Cu(e))},Pr.prototype.ua=function(){bt(this.g,"b")},Fo.prototype.createWebChannel=Fo.prototype.g,oe.prototype.send=oe.prototype.u,oe.prototype.open=oe.prototype.m,oe.prototype.close=oe.prototype.close,qn.NO_ERROR=0,qn.TIMEOUT=8,qn.HTTP_ERROR=6,Cr.COMPLETE="complete",Co.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",Tt.prototype.listen=Tt.prototype.N,Et.prototype.listenOnce=Et.prototype.O,Et.prototype.getLastError=Et.prototype.La,Et.prototype.getLastErrorCode=Et.prototype.Da,Et.prototype.getStatus=Et.prototype.ba,Et.prototype.getResponseJson=Et.prototype.Qa,Et.prototype.getResponseText=Et.prototype.ga,Et.prototype.send=Et.prototype.ea;var Uo=qn,Ru=Cr,Du=me,Bs_PROXY=10,Bs_NOPROXY=11,ku=Ri,Mi=Co,Pu=Et,se=function(){function e(t,i){var o=this;this.previousValue=t,i&&(i.sequenceNumberHandler=function(s){return o.t(s)},this.i=function(s){return i.writeSequenceNumber(s)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();se.o=-1;var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=function(e){function t(i,o){var s=this;return(s=e.call(this,o)||this).code=i,s.message=o,s.name="FirebaseError",s.toString=function(){return s.name+": [code="+s.code+"]: "+s.message},s}return(0,g.ZT)(t,e),t}(Error),_e=new Xt.Yd("@firebase/firestore");function Gs(){return _e.logLevel}function U(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(_e.logLevel<=Xt.in.DEBUG){var o=t.map(Ks);_e.debug.apply(_e,(0,g.ev)(["Firestore (8.10.1): "+e],o))}}function St(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(_e.logLevel<=Xt.in.ERROR){var o=t.map(Ks);_e.error.apply(_e,(0,g.ev)(["Firestore (8.10.1): "+e],o))}}function Oi(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(_e.logLevel<=Xt.in.WARN){var o=t.map(Ks);_e.warn.apply(_e,(0,g.ev)(["Firestore (8.10.1): "+e],o))}}function Ks(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(i){return e}}function K(e){void 0===e&&(e="Unexpected state");var t="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+e;throw St(t),new Error(t)}function X(e,t){e||K()}function j(e,t){return e}function Qh(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(i);else for(var o=0;o<e;o++)i[o]=Math.floor(256*Math.random());return i}var Nu=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/t.length)*t.length,o="";o.length<20;)for(var s=Qh(40),a=0;a<s.length;++a)o.length<20&&s[a]<i&&(o+=t.charAt(s[a]%t.length));return o},e}();function et(e,t){return e<t?-1:e>t?1:0}function Nr(e,t,i){return e.length===t.length&&e.every(function(o,s){return i(o,t[s])})}function Mu(e){return e+"\0"}var ee=function(){function e(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<-62135596800)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var i=Math.floor(t/1e3);return new e(i,Math.floor(1e6*(t-1e3*i)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?et(this.nanoseconds,t.nanoseconds):et(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),$=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new ee(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();function Ou(e){var t=0;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t}function Kn(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t(i,e[i])}function Lu(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Fu=function(){function e(t,i,o){void 0===i?i=0:i>t.length&&K(),void 0===o?o=t.length-i:o>t.length-i&&K(),this.segments=t,this.offset=i,this.len=o}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return 0===e.comparator(this,t)},e.prototype.child=function(t){var i=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(o){i.push(o)}):i.push(t),this.construct(i)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.forEach=function(t){for(var i=this.offset,o=this.limit();i<o;i++)t(this.segments[i])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,i){for(var o=Math.min(t.length,i.length),s=0;s<o;s++){var a=t.get(s),u=i.get(s);if(a<u)return-1;if(a>u)return 1}return t.length<i.length?-1:t.length>i.length?1:0},e}(),it=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=[],a=0,u=i;a<u.length;a++){var c=u[a];if(c.indexOf("//")>=0)throw new N(A.INVALID_ARGUMENT,"Invalid segment ("+c+"). Paths must not contain // in them.");s.push.apply(s,c.split("/").filter(function(l){return l.length>0}))}return new t(s)},t.emptyPath=function(){return new t([])},t}(Fu),Jh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.isValidIdentifier=function(i){return Jh.test(i)},t.prototype.canonicalString=function(){return this.toArray().map(function(i){return i=i.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(i)||(i="`"+i+"`"),i}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(i){for(var o=[],s="",a=0,u=function(){if(0===s.length)throw new N(A.INVALID_ARGUMENT,"Invalid field path ("+i+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");o.push(s),s=""},c=!1;a<i.length;){var l=i[a];if("\\"===l){if(a+1===i.length)throw new N(A.INVALID_ARGUMENT,"Path has trailing escape character: "+i);var d=i[a+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new N(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+i);s+=d,a+=2}else"`"===l?(c=!c,a++):"."!==l||c?(s+=l,a++):(u(),a++)}if(u(),c)throw new N(A.INVALID_ARGUMENT,"Unterminated ` in path: "+i);return new t(o)},t.emptyPath=function(){return new t([])},t}(Fu),Mr=function(){function e(t){this.fields=t,t.sort(we.comparator)}return e.prototype.covers=function(t){for(var i=0,o=this.fields;i<o.length;i++)if(o[i].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return Nr(this.fields,t.fields,function(i,o){return i.isEqual(o)})},e}(),Zt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(i){for(var o="",s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(t))},e.prototype.toBase64=function(){return btoa(this.binaryString)},e.prototype.toUint8Array=function(){return function(t){for(var i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return et(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();Zt.EMPTY_BYTE_STRING=new Zt("");var Zh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fn(e){if(X(!!e),"string"==typeof e){var t=0,i=Zh.exec(e);if(X(!!i),i[1]){var o=i[1];o=(o+"000000000").substr(0,9),t=Number(o)}var s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Ct(e.seconds),nanos:Ct(e.nanos)}}function Ct(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Or(e){return"string"==typeof e?Zt.fromBase64String(e):Zt.fromUint8Array(e)}function zs(e){var t,i;return"server_timestamp"===(null===(i=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function Uu(e){var t=e.mapValue.fields.__previous_value__;return zs(t)?Uu(t):t}function Li(e){var t=fn(e.mapValue.fields.__local_write_time__.timestampValue);return new ee(t.seconds,t.nanos)}function zn(e){return null==e}function qo(e){return 0===e&&1/e==-1/0}function qu(e){return"number"==typeof e&&Number.isInteger(e)&&!qo(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var z=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(it.fromString(t))},e.fromName=function(t){return new e(it.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===it.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,i){return it.comparator(t.path,i.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new it(t.slice()))},e}();function Hn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?zs(e)?4:10:K()}function Re(e,t){var s,i=Hn(e);if(i!==Hn(t))return!1;switch(i){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Li(e).isEqual(Li(t));case 3:return function(o,s){if("string"==typeof o.timestampValue&&"string"==typeof s.timestampValue&&o.timestampValue.length===s.timestampValue.length)return o.timestampValue===s.timestampValue;var a=fn(o.timestampValue),u=fn(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,Or(e.bytesValue).isEqual(Or(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(o,s){return Ct(o.geoPointValue.latitude)===Ct(s.geoPointValue.latitude)&&Ct(o.geoPointValue.longitude)===Ct(s.geoPointValue.longitude)}(e,t);case 2:return function(o,s){if("integerValue"in o&&"integerValue"in s)return Ct(o.integerValue)===Ct(s.integerValue);if("doubleValue"in o&&"doubleValue"in s){var a=Ct(o.doubleValue),u=Ct(s.doubleValue);return a===u?qo(a)===qo(u):isNaN(a)&&isNaN(u)}return!1}(e,t);case 9:return Nr(e.arrayValue.values||[],t.arrayValue.values||[],Re);case 10:return function(o,s){var a=o.mapValue.fields||{},u=s.mapValue.fields||{};if(Ou(a)!==Ou(u))return!1;for(var c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!Re(a[c],u[c])))return!1;return!0}(e,t);default:return K()}}function Fi(e,t){return void 0!==(e.values||[]).find(function(i){return Re(i,t)})}function Lr(e,t){var s,a,u,c,i=Hn(e),o=Hn(t);if(i!==o)return et(i,o);switch(i){case 0:return 0;case 1:return et(e.booleanValue,t.booleanValue);case 2:return a=t,(u=Ct((s=e).integerValue||s.doubleValue))<(c=Ct(a.integerValue||a.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return Vu(e.timestampValue,t.timestampValue);case 4:return Vu(Li(e),Li(t));case 5:return et(e.stringValue,t.stringValue);case 6:return function(s,a){var u=Or(s),c=Or(a);return u.compareTo(c)}(e.bytesValue,t.bytesValue);case 7:return function(s,a){for(var u=s.split("/"),c=a.split("/"),l=0;l<u.length&&l<c.length;l++){var d=et(u[l],c[l]);if(0!==d)return d}return et(u.length,c.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,a){var u=et(Ct(s.latitude),Ct(a.latitude));return 0!==u?u:et(Ct(s.longitude),Ct(a.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(s,a){for(var u=s.values||[],c=a.values||[],l=0;l<u.length&&l<c.length;++l){var d=Lr(u[l],c[l]);if(d)return d}return et(u.length,c.length)}(e.arrayValue,t.arrayValue);case 10:return function(s,a){var u=s.fields||{},c=Object.keys(u),l=a.fields||{},d=Object.keys(l);c.sort(),d.sort();for(var p=0;p<c.length&&p<d.length;++p){var v=et(c[p],d[p]);if(0!==v)return v;var w=Lr(u[c[p]],l[d[p]]);if(0!==w)return w}return et(c.length,d.length)}(e.mapValue,t.mapValue);default:throw K()}}function Vu(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return et(e,t);var i=fn(e),o=fn(t),s=et(i.seconds,o.seconds);return 0!==s?s:et(i.nanos,o.nanos)}function Hs(e){return Qs(e)}function Qs(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?"time("+(s=fn(e.timestampValue)).seconds+","+s.nanos+")":"stringValue"in e?e.stringValue:"bytesValue"in e?Or(e.bytesValue).toBase64():"referenceValue"in e?z.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(o){for(var s="[",a=!0,u=0,c=o.values||[];u<c.length;u++)a?a=!1:s+=",",s+=Qs(c[u]);return s+"]"}(e.arrayValue):"mapValue"in e?function(o){for(var s="{",a=!0,u=0,c=Object.keys(o.fields||{}).sort();u<c.length;u++){var l=c[u];a?a=!1:s+=",",s+=l+":"+Qs(o.fields[l])}return s+"}"}(e.mapValue):K();var s,t}function Vo(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Js(e){return!!e&&"integerValue"in e}function Zs(e){return!!e&&"arrayValue"in e}function ju(e){return!!e&&"nullValue"in e}function Bu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function jo(e){return!!e&&"mapValue"in e}function Ui(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Kn(e.mapValue.fields,function(s,a){return t.mapValue.fields[s]=Ui(a)}),t}if(e.arrayValue){for(var i={arrayValue:{values:[]}},o=0;o<(e.arrayValue.values||[]).length;++o)i.arrayValue.values[o]=Ui(e.arrayValue.values[o]);return i}return Object.assign({},e)}var ae=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var i=this.value,o=0;o<t.length-1;++o)if(!jo(i=(i.mapValue.fields||{})[t.get(o)]))return null;return(i=(i.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ui(i)},e.prototype.setAll=function(t){var i=this,o=we.emptyPath(),s={},a=[];t.forEach(function(c,l){if(!o.isImmediateParentOf(l)){var d=i.getFieldsMap(o);i.applyChanges(d,s,a),s={},a=[],o=l.popLast()}c?s[l.lastSegment()]=Ui(c):a.push(l.lastSegment())});var u=this.getFieldsMap(o);this.applyChanges(u,s,a)},e.prototype.delete=function(t){var i=this.field(t.popLast());jo(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return Re(this.value,t.value)},e.prototype.getFieldsMap=function(t){var i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(var o=0;o<t.length;++o){var s=i.mapValue.fields[t.get(o)];jo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},i.mapValue.fields[t.get(o)]=s),i=s}return i.mapValue.fields},e.prototype.applyChanges=function(t,i,o){Kn(i,function(c,l){return t[c]=l});for(var s=0,a=o;s<a.length;s++)delete t[a[s]]},e.prototype.clone=function(){return new e(Ui(this.value))},e}();function Gu(e){var t=[];return Kn(e.fields,function(i,o){var s=new we([i]);if(jo(o)){var a=Gu(o.mapValue).fields;if(0===a.length)t.push(s);else for(var u=0,c=a;u<c.length;u++)t.push(s.child(c[u]))}else t.push(s)}),new Mr(t)}var qt=function(){function e(t,i,o,s,a){this.key=t,this.documentType=i,this.version=o,this.data=s,this.documentState=a}return e.newInvalidDocument=function(t){return new e(t,0,$.min(),ae.empty(),0)},e.newFoundDocument=function(t,i,o){return new e(t,1,i,o,0)},e.newNoDocument=function(t,i){return new e(t,2,i,ae.empty(),0)},e.newUnknownDocument=function(t,i){return new e(t,3,i,ae.empty(),2)},e.prototype.convertToFoundDocument=function(t,i){return this.version=t,this.documentType=1,this.data=i,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ae.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ae.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return 0!==this.documentType},e.prototype.isFoundDocument=function(){return 1===this.documentType},e.prototype.isNoDocument=function(){return 2===this.documentType},e.prototype.isUnknownDocument=function(){return 3===this.documentType},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Wh=function(e,t,i,o,s,a,u){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=s,this.startAt=a,this.endAt=u,this.h=null};function Ku(e,t,i,o,s,a,u){return void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),new Wh(e,t,i,o,s,a,u)}function qi(e){var t=j(e);if(null===t.h){var i=t.path.canonicalString();null!==t.collectionGroup&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(function(o){return(s=o).field.canonicalString()+s.op.toString()+Hs(s.value);var s}).join(","),i+="|ob:",i+=t.orderBy.map(function(o){return(s=o).field.canonicalString()+s.dir;var s}).join(","),zn(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=Ko(t.startAt)),t.endAt&&(i+="|ub:",i+=Ko(t.endAt)),t.h=i}return t.h}function Bo(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var i=0;i<e.orderBy.length;i++)if(!of(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o=0;o<e.filters.length;o++)if((s=e.filters[o]).op!==(a=t.filters[o]).op||!s.field.isEqual(a.field)||!Re(s.value,a.value))return!1;var s,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Qu(e.startAt,t.startAt)&&Qu(e.endAt,t.endAt)}function Go(e){return z.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ue=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).field=i,a.op=o,a.value=s,a}return(0,g.ZT)(t,e),t.create=function(i,o,s){return i.isKeyField()?"in"===o||"not-in"===o?this.l(i,o,s):new Xh(i,o,s):"array-contains"===o?new tf(i,s):"in"===o?new ef(i,s):"not-in"===o?new nf(i,s):"array-contains-any"===o?new rf(i,s):new t(i,o,s)},t.l=function(i,o,s){return"in"===o?new Yh(i,s):new $h(i,s)},t.prototype.matches=function(i){var o=i.data.field(this.field);return"!="===this.op?null!==o&&this.m(Lr(o,this.value)):null!==o&&Hn(this.value)===Hn(o)&&this.m(Lr(o,this.value))},t.prototype.m=function(i){switch(this.op){case"<":return i<0;case"<=":return i<=0;case"==":return 0===i;case"!=":return 0!==i;case">":return i>0;case">=":return i>=0;default:return K()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),Xh=function(e){function t(i,o,s){var a=this;return(a=e.call(this,i,o,s)||this).key=z.fromName(s.referenceValue),a}return(0,g.ZT)(t,e),t.prototype.matches=function(i){var o=z.comparator(i.key,this.key);return this.m(o)},t}(ue),Yh=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"in",o)||this).keys=zu(0,o),s}return(0,g.ZT)(t,e),t.prototype.matches=function(i){return this.keys.some(function(o){return o.isEqual(i.key)})},t}(ue),$h=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"not-in",o)||this).keys=zu(0,o),s}return(0,g.ZT)(t,e),t.prototype.matches=function(i){return!this.keys.some(function(o){return o.isEqual(i.key)})},t}(ue);function zu(e,t){var i;return((null===(i=t.arrayValue)||void 0===i?void 0:i.values)||[]).map(function(o){return z.fromName(o.referenceValue)})}var tf=function(e){function t(i,o){return e.call(this,i,"array-contains",o)||this}return(0,g.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return Zs(o)&&Fi(o.arrayValue,this.value)},t}(ue),ef=function(e){function t(i,o){return e.call(this,i,"in",o)||this}return(0,g.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return null!==o&&Fi(this.value.arrayValue,o)},t}(ue),nf=function(e){function t(i,o){return e.call(this,i,"not-in",o)||this}return(0,g.ZT)(t,e),t.prototype.matches=function(i){if(Fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var o=i.data.field(this.field);return null!==o&&!Fi(this.value.arrayValue,o)},t}(ue),rf=function(e){function t(i,o){return e.call(this,i,"array-contains-any",o)||this}return(0,g.ZT)(t,e),t.prototype.matches=function(i){var o=this,s=i.data.field(this.field);return!(!Zs(s)||!s.arrayValue.values)&&s.arrayValue.values.some(function(a){return Fi(o.value.arrayValue,a)})},t}(ue),Vi=function(e,t){this.position=e,this.before=t};function Ko(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return Hs(t)}).join(",")}var Fr=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t};function of(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Hu(e,t,i){for(var o=0,s=0;s<e.position.length;s++){var a=t[s],u=e.position[s];if(o=a.field.isKeyField()?z.comparator(z.fromName(u.referenceValue),i.key):Lr(u,i.data.field(a.field)),"desc"===a.dir&&(o*=-1),0!==o)break}return e.before?o<=0:o<0}function Qu(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var i=0;i<e.position.length;i++)if(!Re(e.position[i],t.position[i]))return!1;return!0}var Be=function(e,t,i,o,s,a,u,c){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a="F"),void 0===u&&(u=null),void 0===c&&(c=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.p=null,this.T=null};function Ju(e,t,i,o,s,a,u,c){return new Be(e,t,i,o,s,a,u,c)}function Ur(e){return new Be(e)}function zo(e){return!zn(e.limit)&&"F"===e.limitType}function Ho(e){return!zn(e.limit)&&"L"===e.limitType}function Ws(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Xs(e){for(var t=0,i=e.filters;t<i.length;t++){var o=i[t];if(o.g())return o.field}return null}function Ys(e){return null!==e.collectionGroup}function qr(e){var t=j(e);if(null===t.p){t.p=[];var i=Xs(t),o=Ws(t);if(null!==i&&null===o)i.isKeyField()||t.p.push(new Fr(i)),t.p.push(new Fr(we.keyField(),"asc"));else{for(var s=!1,a=0,u=t.explicitOrderBy;a<u.length;a++){var c=u[a];t.p.push(c),c.field.isKeyField()&&(s=!0)}if(!s){var l=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new Fr(we.keyField(),l))}}}return t.p}function ve(e){var t=j(e);if(!t.T)if("F"===t.limitType)t.T=Ku(t.path,t.collectionGroup,qr(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var i=[],o=0,s=qr(t);o<s.length;o++){var a=s[o];i.push(new Fr(a.field,"desc"===a.dir?"asc":"desc"))}var c=t.endAt?new Vi(t.endAt.position,!t.endAt.before):null,l=t.startAt?new Vi(t.startAt.position,!t.startAt.before):null;t.T=Ku(t.path,t.collectionGroup,i,t.filters,t.limit,c,l)}return t.T}function Zu(e,t,i){return new Be(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,i,e.startAt,e.endAt)}function ji(e,t){return Bo(ve(e),ve(t))&&e.limitType===t.limitType}function Wu(e){return qi(ve(e))+"|lt:"+e.limitType}function $s(e){return"Query(target="+(i=(t=ve(e)).path.canonicalString(),null!==t.collectionGroup&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=", filters: ["+t.filters.map(function(o){return(s=o).field.canonicalString()+" "+s.op+" "+Hs(s.value);var s}).join(", ")+"]"),zn(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=", orderBy: ["+t.orderBy.map(function(o){return(s=o).field.canonicalString()+" ("+s.dir+")";var s}).join(", ")+"]"),t.startAt&&(i+=", startAt: "+Ko(t.startAt)),t.endAt&&(i+=", endAt: "+Ko(t.endAt)),"Target("+i+"); limitType=")+e.limitType+")";var t,i}function Bi(e,t){return t.isFoundDocument()&&(s=(o=t).key.path,null!==(i=e).collectionGroup?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):z.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s))&&function(i,o){for(var s=0,a=i.explicitOrderBy;s<a.length;s++){var u=a[s];if(!u.field.isKeyField()&&null===o.data.field(u.field))return!1}return!0}(e,t)&&function(i,o){for(var s=0,a=i.filters;s<a.length;s++)if(!a[s].matches(o))return!1;return!0}(e,t)&&function(i,o){return!(i.startAt&&!Hu(i.startAt,qr(i),o)||i.endAt&&Hu(i.endAt,qr(i),o))}(e,t);var i,o,s}function Xu(e){return function(t,i){for(var o=!1,s=0,a=qr(e);s<a.length;s++){var u=a[s],c=sf(u,t,i);if(0!==c)return c;o=o||u.field.isKeyField()}return 0}}function sf(e,t,i){var s,u,c,l,o=e.field.isKeyField()?z.comparator(t.key,i.key):(u=i,c=t.data.field(s=e.field),l=u.data.field(s),null!==c&&null!==l?Lr(c,l):K());switch(e.dir){case"asc":return o;case"desc":return-1*o;default:return K()}}function Yu(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qo(t)?"-0":t}}function $u(e){return{integerValue:""+e}}function tc(e,t){return qu(t)?$u(t):Yu(e,t)}var Qo=function(){this._=void 0};function af(e,t,i){return e instanceof Vr?(a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(o=i).seconds,nanos:o.nanoseconds}}}},(s=t)&&(a.fields.__previous_value__=s),{mapValue:a}):e instanceof Qn?nc(e,t):e instanceof Jn?rc(e,t):function(o,s){var a=ec(o,s),u=ic(a)+ic(o.A);return Js(a)&&Js(o.A)?$u(u):Yu(o.R,u)}(e,t);var o,s,a}function uf(e,t,i){return e instanceof Qn?nc(e,t):e instanceof Jn?rc(e,t):i}function ec(e,t){return e instanceof jr?Js(i=t)||(o=i)&&"doubleValue"in o?t:{integerValue:0}:null;var o,i}var Vr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t}(Qo),Qn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,g.ZT)(t,e),t}(Qo);function nc(e,t){for(var i=oc(t),o=function(u){i.some(function(c){return Re(c,u)})||i.push(u)},s=0,a=e.elements;s<a.length;s++)o(a[s]);return{arrayValue:{values:i}}}var Jn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,g.ZT)(t,e),t}(Qo);function rc(e,t){for(var i=oc(t),o=function(u){i=i.filter(function(c){return!Re(c,u)})},s=0,a=e.elements;s<a.length;s++)o(a[s]);return{arrayValue:{values:i}}}var jr=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).R=i,s.A=o,s}return(0,g.ZT)(t,e),t}(Qo);function ic(e){return Ct(e.integerValue||e.doubleValue)}function oc(e){return Zs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Gi=function(e,t){this.field=e,this.transform=t},cf=function(e,t){this.version=e,this.transformResults=t},zt=function(){function e(t,i){this.updateTime=t,this.exists=i}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function Jo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Zo=function(){};function lf(e,t,i){var o,s,a,u,c;e instanceof Ki?(s=t,a=i,u=(o=e).value.clone(),c=cc(o.fieldTransforms,s,a.transformResults),u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()):e instanceof dn?function(o,s,a){if(Jo(o.precondition,s)){var u=cc(o.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(uc(o)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}else s.convertToUnknownDocument(a.version)}(e,t,i):function(o,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,i)}function ta(e,t,i){var s;e instanceof Ki?function(o,s,a){if(Jo(o.precondition,s)){var u=o.value.clone(),c=lc(o.fieldTransforms,a,s);u.setAll(c),s.convertToFoundDocument(ac(s),u).setHasLocalMutations()}}(e,t,i):e instanceof dn?function(o,s,a){if(Jo(o.precondition,s)){var u=lc(o.fieldTransforms,a,s),c=s.data;c.setAll(uc(o)),c.setAll(u),s.convertToFoundDocument(ac(s),c).setHasLocalMutations()}}(e,t,i):Jo(e.precondition,s=t)&&s.convertToNoDocument($.min())}function hf(e,t){for(var i=null,o=0,s=e.fieldTransforms;o<s.length;o++){var a=s[o],u=t.data.field(a.field),c=ec(a.transform,u||null);null!=c&&(null==i&&(i=ae.empty()),i.set(a.field,c))}return i||null}function sc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(o=t.fieldTransforms,!!(void 0===(i=e.fieldTransforms)&&void 0===o||i&&o&&Nr(i,o,function(s,a){return(u=s).field.isEqual((c=a).field)&&(d=c.transform,(l=u.transform)instanceof Qn&&d instanceof Qn||l instanceof Jn&&d instanceof Jn?Nr(l.elements,d.elements,Re):l instanceof jr&&d instanceof jr?Re(l.A,d.A):l instanceof Vr&&d instanceof Vr);var u,c,l,d})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var i,o}function ac(e){return e.isFoundDocument()?e.version:$.min()}var Ki=function(e){function t(i,o,s,a){void 0===a&&(a=[]);var u=this;return(u=e.call(this)||this).key=i,u.value=o,u.precondition=s,u.fieldTransforms=a,u.type=0,u}return(0,g.ZT)(t,e),t}(Zo),dn=function(e){function t(i,o,s,a,u){void 0===u&&(u=[]);var c=this;return(c=e.call(this)||this).key=i,c.data=o,c.fieldMask=s,c.precondition=a,c.fieldTransforms=u,c.type=1,c}return(0,g.ZT)(t,e),t}(Zo);function uc(e){var t=new Map;return e.fieldMask.fields.forEach(function(i){if(!i.isEmpty()){var o=e.data.field(i);t.set(i,o)}}),t}function cc(e,t,i){var o=new Map;X(e.length===i.length);for(var s=0;s<i.length;s++){var a=e[s],u=a.transform,c=t.data.field(a.field);o.set(a.field,uf(u,c,i[s]))}return o}function lc(e,t,i){for(var o=new Map,s=0,a=e;s<a.length;s++){var u=a[s],c=u.transform,l=i.data.field(u.field);o.set(u.field,af(c,l,t))}return o}var At,nt,zi=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=2,s.fieldTransforms=[],s}return(0,g.ZT)(t,e),t}(Zo),ea=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=3,s.fieldTransforms=[],s}return(0,g.ZT)(t,e),t}(Zo),ff=function(e){this.count=e};function hc(e){switch(e){case A.OK:return K();case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return K()}}function fc(e){if(void 0===e)return St("GRPC error has no .code"),A.UNKNOWN;switch(e){case At.OK:return A.OK;case At.CANCELLED:return A.CANCELLED;case At.UNKNOWN:return A.UNKNOWN;case At.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case At.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case At.INTERNAL:return A.INTERNAL;case At.UNAVAILABLE:return A.UNAVAILABLE;case At.UNAUTHENTICATED:return A.UNAUTHENTICATED;case At.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case At.NOT_FOUND:return A.NOT_FOUND;case At.ALREADY_EXISTS:return A.ALREADY_EXISTS;case At.PERMISSION_DENIED:return A.PERMISSION_DENIED;case At.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case At.ABORTED:return A.ABORTED;case At.OUT_OF_RANGE:return A.OUT_OF_RANGE;case At.UNIMPLEMENTED:return A.UNIMPLEMENTED;case At.DATA_LOSS:return A.DATA_LOSS;default:return K()}}(nt=At||(At={}))[nt.OK=0]="OK",nt[nt.CANCELLED=1]="CANCELLED",nt[nt.UNKNOWN=2]="UNKNOWN",nt[nt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nt[nt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nt[nt.NOT_FOUND=5]="NOT_FOUND",nt[nt.ALREADY_EXISTS=6]="ALREADY_EXISTS",nt[nt.PERMISSION_DENIED=7]="PERMISSION_DENIED",nt[nt.UNAUTHENTICATED=16]="UNAUTHENTICATED",nt[nt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nt[nt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nt[nt.ABORTED=10]="ABORTED",nt[nt.OUT_OF_RANGE=11]="OUT_OF_RANGE",nt[nt.UNIMPLEMENTED=12]="UNIMPLEMENTED",nt[nt.INTERNAL=13]="INTERNAL",nt[nt.UNAVAILABLE=14]="UNAVAILABLE",nt[nt.DATA_LOSS=15]="DATA_LOSS";var Ht=function(){function e(t,i){this.comparator=t,this.root=i||pn.EMPTY}return e.prototype.insert=function(t,i){return new e(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,pn.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,pn.BLACK,null,null))},e.prototype.get=function(t){for(var i=this.root;!i.isEmpty();){var o=this.comparator(t,i.key);if(0===o)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null},e.prototype.indexOf=function(t){for(var i=0,o=this.root;!o.isEmpty();){var s=this.comparator(t,o.key);if(0===s)return i+o.left.size;s<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(i,o){return t(i,o),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(i,o){return t.push(i+":"+o),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new Wo(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new Wo(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new Wo(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new Wo(this.root,t,this.comparator,!0)},e}(),Wo=function(){function e(t,i,o,s){this.isReverse=s,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=i?o(t.key,i):1,s&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),pn=function(){function e(t,i,o,s,a){this.key=t,this.value=i,this.color=null!=o?o:e.RED,this.left=null!=s?s:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,i,o,s,a){return new e(null!=t?t:this.key,null!=i?i:this.value,null!=o?o:this.color,null!=s?s:this.left,null!=a?a:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,i,o){var s=this,a=o(t,s.key);return(s=a<0?s.copy(null,null,null,s.left.insert(t,i,o),null):0===a?s.copy(null,i,null,null,null):s.copy(null,null,null,null,s.right.insert(t,i,o))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,i){var o,s=this;if(i(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===i(t,s.key)){if(s.right.isEmpty())return e.EMPTY;o=s.right.min(),s=s.copy(o.key,o.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw K();var t=this.left.check();if(t!==this.right.check())throw K();return t+(this.isRed()?0:1)},e}();pn.EMPTY=null,pn.RED=!0,pn.BLACK=!1,pn.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw K()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw K()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw K()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw K()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw K()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,i,o,s,a){return this},e.prototype.insert=function(t,i,o){return new pn(t,i)},e.prototype.remove=function(t,i){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());var Rt=function(){function e(t){this.comparator=t,this.data=new Ht(this.comparator)}return e.prototype.has=function(t){return null!==this.data.get(t)},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.forEachInRange=function(t,i){for(var o=this.data.getIteratorFrom(t[0]);o.hasNext();){var s=o.getNext();if(this.comparator(s.key,t[1])>=0)return;i(s.key)}},e.prototype.forEachWhile=function(t,i){var o;for(o=void 0!==i?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!t(o.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null},e.prototype.getIterator=function(){return new dc(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new dc(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var i=this;return i.size<t.size&&(i=t,t=this),t.forEach(function(o){i=i.add(o)}),i},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.data.getIterator(),o=t.data.getIterator();i.hasNext();){var s=i.getNext().key,a=o.getNext().key;if(0!==this.comparator(s,a))return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(i){t.push(i)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(i){return t.push(i)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var i=new e(this.comparator);return i.data=t,i},e}(),dc=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),df=new Ht(z.comparator);function ye(){return df}var pf=new Ht(z.comparator);function na(){return pf}var gf=new Ht(z.comparator);function pc(){return gf}var mf=new Rt(z.comparator);function st(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=mf,o=0,s=e;o<s.length;o++){var a=s[o];i=i.add(a)}return i}var vf=new Rt(et);function Xo(){return vf}var ra=function(){function e(t,i,o,s,a){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=s,this.resolvedLimboDocuments=a}return e.createSynthesizedRemoteEventForCurrentChange=function(t,i){var o=new Map;return o.set(t,ia.createSynthesizedTargetChangeForCurrentChange(t,i)),new e($.min(),o,Xo(),ye(),st())},e}(),ia=function(){function e(t,i,o,s,a){this.resumeToken=t,this.current=i,this.addedDocuments=o,this.modifiedDocuments=s,this.removedDocuments=a}return e.createSynthesizedTargetChangeForCurrentChange=function(t,i){return new e(Zt.EMPTY_BYTE_STRING,i,st(),st(),st())},e}(),Yo=function(e,t,i,o){this.v=e,this.removedTargetIds=t,this.key=i,this.P=o},gc=function(e,t){this.targetId=e,this.V=t},mc=function(e,t,i,o){void 0===i&&(i=Zt.EMPTY_BYTE_STRING),void 0===o&&(o=null),this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o},vc=function(){function e(){this.S=0,this.D=bc(),this.C=Zt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=st(),i=st(),o=st();return this.D.forEach(function(s,a){switch(a){case 0:t=t.add(s);break;case 2:i=i.add(s);break;case 1:o=o.add(s);break;default:K()}}),new ia(this.C,this.N,t,i,o)},e.prototype.L=function(){this.k=!1,this.D=bc()},e.prototype.B=function(t,i){this.k=!0,this.D=this.D.insert(t,i)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),yf=function(){function e(t){this.W=t,this.G=new Map,this.H=ye(),this.J=yc(),this.Y=new Rt(et)}return e.prototype.X=function(t){for(var i=0,o=t.v;i<o.length;i++){var s=o[i];t.P&&t.P.isFoundDocument()?this.Z(s,t.P):this.tt(s,t.key,t.P)}for(var a=0,u=t.removedTargetIds;a<u.length;a++)this.tt(s=u[a],t.key,t.P)},e.prototype.et=function(t){var i=this;this.forEachTarget(t,function(o){var s=i.nt(o);switch(t.state){case 0:i.st(o)&&s.O(t.resumeToken);break;case 1:s.K(),s.F||s.L(),s.O(t.resumeToken);break;case 2:s.K(),s.F||i.removeTarget(o);break;case 3:i.st(o)&&(s.j(),s.O(t.resumeToken));break;case 4:i.st(o)&&(i.it(o),s.O(t.resumeToken));break;default:K()}})},e.prototype.forEachTarget=function(t,i){var o=this;t.targetIds.length>0?t.targetIds.forEach(i):this.G.forEach(function(s,a){o.st(a)&&i(a)})},e.prototype.rt=function(t){var i=t.targetId,o=t.V.count,s=this.ot(i);if(s){var a=s.target;if(Go(a))if(0===o){var u=new z(a.path);this.tt(i,u,qt.newNoDocument(u,$.min()))}else X(1===o);else this.ct(i)!==o&&(this.it(i),this.Y=this.Y.add(i))}},e.prototype.ut=function(t){var i=this,o=new Map;this.G.forEach(function(u,c){var l=i.ot(c);if(l){if(u.current&&Go(l.target)){var d=new z(l.target.path);null!==i.H.get(d)||i.at(c,d)||i.tt(c,d,qt.newNoDocument(d,t))}u.$&&(o.set(c,u.M()),u.L())}});var s=st();this.J.forEach(function(u,c){var l=!0;c.forEachWhile(function(d){var p=i.ot(d);return!p||2===p.purpose||(l=!1,!1)}),l&&(s=s.add(u))});var a=new ra(t,o,this.Y,this.H,s);return this.H=ye(),this.J=yc(),this.Y=new Rt(et),a},e.prototype.Z=function(t,i){if(this.st(t)){var o=this.at(t,i.key)?2:0;this.nt(t).B(i.key,o),this.H=this.H.insert(i.key,i),this.J=this.J.insert(i.key,this.ht(i.key).add(t))}},e.prototype.tt=function(t,i,o){if(this.st(t)){var s=this.nt(t);this.at(t,i)?s.B(i,1):s.q(i),this.J=this.J.insert(i,this.ht(i).delete(t)),o&&(this.H=this.H.insert(i,o))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var i=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var i=this.G.get(t);return i||(i=new vc,this.G.set(t,i)),i},e.prototype.ht=function(t){var i=this.J.get(t);return i||(i=new Rt(et),this.J=this.J.insert(t,i)),i},e.prototype.st=function(t){var i=null!==this.ot(t);return i||U("WatchChangeAggregator","Detected inactive target",t),i},e.prototype.ot=function(t){var i=this.G.get(t);return i&&i.F?null:this.W.lt(t)},e.prototype.it=function(t){var i=this;this.G.set(t,new vc),this.W.getRemoteKeysForTarget(t).forEach(function(o){i.tt(t,o,null)})},e.prototype.at=function(t,i){return this.W.getRemoteKeysForTarget(t).has(i)},e}();function yc(){return new Ht(z.comparator)}function bc(){return new Ht(z.comparator)}var bf={asc:"ASCENDING",desc:"DESCENDING"},_f={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wf=function(e,t){this.databaseId=e,this.I=t};function Hi(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function _c(e,t){return e.I?t.toBase64():t.toUint8Array()}function Tf(e,t){return Hi(e,t.toTimestamp())}function Mt(e){return X(!!e),$.fromTimestamp((i=fn(e),new ee(i.seconds,i.nanos)));var i}function oa(e,t){return(i=e,new it(["projects",i.projectId,"databases",i.database])).child("documents").child(t).canonicalString();var i}function wc(e){var t=it.fromString(e);return X(Nc(t)),t}function Qi(e,t){return oa(e.databaseId,t.path)}function De(e,t){var i=wc(t);if(i.get(1)!==e.databaseId.projectId)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+e.databaseId.projectId);if(i.get(3)!==e.databaseId.database)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+e.databaseId.database);return new z(Ic(i))}function sa(e,t){return oa(e.databaseId,t)}function Tc(e){var t=wc(e);return 4===t.length?it.emptyPath():Ic(t)}function Ji(e){return new it(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ic(e){return X(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ec(e,t,i){return{name:Qi(e,t),fields:i.value.mapValue.fields}}function Sc(e,t,i){var o=De(e,t.name),s=Mt(t.updateTime),a=new ae({mapValue:{fields:t.fields}}),u=qt.newFoundDocument(o,s,a);return i&&u.setHasCommittedMutations(),i?u.setHasCommittedMutations():u}function $o(e,t){var i,s;if(t instanceof Ki)i={update:Ec(e,t.key,t.value)};else if(t instanceof zi)i={delete:Qi(e,t.key)};else if(t instanceof dn)i={update:Ec(e,t.key,t.data),updateMask:Af(t.fieldMask)};else{if(!(t instanceof ea))return K();i={verify:Qi(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(function(o){return function(s,a){var u=a.transform;if(u instanceof Vr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Qn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Jn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof jr)return{fieldPath:a.field.canonicalString(),increment:u.A};throw K()}(0,o)})),t.precondition.isNone||(i.currentDocument=void 0!==(s=t.precondition).updateTime?{updateTime:Tf(e,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:K()),i}function Cc(e,t){var d,i=t.currentDocument?void 0!==(d=t.currentDocument).updateTime?zt.updateTime(Mt(d.updateTime)):void 0!==d.exists?zt.exists(d.exists):zt.none():zt.none(),o=t.updateTransforms?t.updateTransforms.map(function(d){return function(p,v){var w=null;"setToServerValue"in v?(X("REQUEST_TIME"===v.setToServerValue),w=new Vr):"appendMissingElements"in v?w=new Qn(v.appendMissingElements.values||[]):"removeAllFromArray"in v?w=new Jn(v.removeAllFromArray.values||[]):"increment"in v?w=new jr(p,v.increment):K();var x=we.fromServerFormat(v.fieldPath);return new Gi(x,w)}(e,d)}):[];if(t.update){var s=De(e,t.update.name),a=new ae({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(d){return new Mr((d.fieldPaths||[]).map(function(v){return we.fromServerFormat(v)}))}(t.updateMask);return new dn(s,a,u,i,o)}return new Ki(s,a,i,o)}if(t.delete){var c=De(e,t.delete);return new zi(c,i)}if(t.verify){var l=De(e,t.verify);return new ea(l,i)}return K()}function Ac(e,t){return{documents:[sa(e,t.path)]}}function xc(e,t){var i={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(i.parent=sa(e,o),i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i.parent=sa(e,o.popLast()),i.structuredQuery.from=[{collectionId:o.lastSegment()}]);var s=function(c){if(0!==c.length){var l=c.map(function(d){return function(p){if("=="===p.op){if(Bu(p.value))return{unaryFilter:{field:Br(p.field),op:"IS_NAN"}};if(ju(p.value))return{unaryFilter:{field:Br(p.field),op:"IS_NULL"}}}else if("!="===p.op){if(Bu(p.value))return{unaryFilter:{field:Br(p.field),op:"IS_NOT_NAN"}};if(ju(p.value))return{unaryFilter:{field:Br(p.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Br(p.field),op:Ef(p.op),value:p.value}}}(d)});return 1===l.length?l[0]:{compositeFilter:{op:"AND",filters:l}}}}(t.filters);s&&(i.structuredQuery.where=s);var a=function(c){if(0!==c.length)return c.map(function(l){return{field:Br((d=l).field),direction:If(d.dir)};var d})}(t.orderBy);a&&(i.structuredQuery.orderBy=a);var l,u=(l=t.limit,e.I||zn(l)?l:{value:l});return null!==u&&(i.structuredQuery.limit=u),t.startAt&&(i.structuredQuery.startAt=kc(t.startAt)),t.endAt&&(i.structuredQuery.endAt=kc(t.endAt)),i}function Rc(e){var t=Tc(e.parent),i=e.structuredQuery,o=i.from?i.from.length:0,s=null;if(o>0){X(1===o);var a=i.from[0];a.allDescendants?s=a.collectionId:t=t.child(a.collectionId)}var u=[];i.where&&(u=Dc(i.where));var c=[];i.orderBy&&(c=i.orderBy.map(function(v){return new Fr(Gr((w=v).field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction));var w}));var v,w,l=null;i.limit&&(l=zn(w="object"==typeof(v=i.limit)?v.value:v)?null:w);var d=null;i.startAt&&(d=Pc(i.startAt));var p=null;return i.endAt&&(p=Pc(i.endAt)),Ju(t,s,c,u,l,"F",d,p)}function Dc(e){return e?void 0!==e.unaryFilter?[Cf(e)]:void 0!==e.fieldFilter?[Sf(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(t){return Dc(t)}).reduce(function(t,i){return t.concat(i)}):K():[]}function kc(e){return{before:e.before,values:e.position}}function Pc(e){return new Vi(e.values||[],!!e.before)}function If(e){return bf[e]}function Ef(e){return _f[e]}function Br(e){return{fieldPath:e.canonicalString()}}function Gr(e){return we.fromServerFormat(e.fieldPath)}function Sf(e){return ue.create(Gr(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return K()}}(e.fieldFilter.op),e.fieldFilter.value)}function Cf(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Gr(e.unaryFilter.field);return ue.create(t,"==",{doubleValue:NaN});case"IS_NULL":var i=Gr(e.unaryFilter.field);return ue.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var o=Gr(e.unaryFilter.field);return ue.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var s=Gr(e.unaryFilter.field);return ue.create(s,"!=",{nullValue:"NULL_VALUE"});default:return K()}}function Af(e){var t=[];return e.fields.forEach(function(i){return t.push(i.canonicalString())}),{fieldPaths:t}}function Nc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Te(e){for(var t="",i=0;i<e.length;i++)t.length>0&&(t=Mc(t)),t=xf(e.get(i),t);return Mc(t)}function xf(e,t){for(var i=t,o=e.length,s=0;s<o;s++){var a=e.charAt(s);switch(a){case"\0":i+="\x01\x10";break;case"\x01":i+="\x01\x11";break;default:i+=a}}return i}function Mc(e){return e+"\x01\x01"}function Ge(e){var t=e.length;if(X(t>=2),2===t)return X("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),it.emptyPath();for(var i=t-2,o=[],s="",a=0;a<t;){var u=e.indexOf("\x01",a);switch((u<0||u>i)&&K(),e.charAt(u+1)){case"\x01":var c=e.substring(a,u),l=void 0;0===s.length?l=c:(l=s+=c,s=""),o.push(l);break;case"\x10":s+=e.substring(a,u),s+="\0";break;case"\x11":s+=e.substring(a,u+1);break;default:K()}a=u+2}return new it(o)}var Rf=function(e,t){this.seconds=e,this.nanoseconds=t},ce=function(e,t,i){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=i};ce.store="owner",ce.key="owner";var gn=function(e,t,i){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=i};gn.store="mutationQueues",gn.keyPath="userId";var ht=function(e,t,i,o,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=i,this.baseMutations=o,this.mutations=s};ht.store="mutations",ht.keyPath="batchId",ht.userMutationsIndex="userMutationsIndex",ht.userMutationsKeyPath=["userId","batchId"];var Qt=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,i){return[t,Te(i)]},e.key=function(t,i,o){return[t,Te(i),o]},e}();Qt.store="documentMutations",Qt.PLACEHOLDER=new Qt;var Df=function(e,t){this.path=e,this.readTime=t},kf=function(e,t){this.path=e,this.version=t},vt=function(e,t,i,o,s,a){this.unknownDocument=e,this.noDocument=t,this.document=i,this.hasCommittedMutations=o,this.readTime=s,this.parentPath=a};vt.store="remoteDocuments",vt.readTimeIndex="readTimeIndex",vt.readTimeIndexPath="readTime",vt.collectionReadTimeIndex="collectionReadTimeIndex",vt.collectionReadTimeIndexPath=["parentPath","readTime"];var ke=function(e){this.byteSize=e};ke.store="remoteDocumentGlobal",ke.key="remoteDocumentGlobalKey";var ne=function(e,t,i,o,s,a,u){this.targetId=e,this.canonicalId=t,this.readTime=i,this.resumeToken=o,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=a,this.query=u};ne.store="targets",ne.keyPath="targetId",ne.queryTargetsIndexName="queryTargetsIndex",ne.queryTargetsKeyPath=["canonicalId","targetId"];var Vt=function(e,t,i){this.targetId=e,this.path=t,this.sequenceNumber=i};Vt.store="targetDocuments",Vt.keyPath=["targetId","path"],Vt.documentTargetsIndex="documentTargetsIndex",Vt.documentTargetsKeyPath=["path","targetId"];var le=function(e,t,i,o){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=i,this.targetCount=o};le.key="targetGlobalKey",le.store="targetGlobal";var Zn=function(e,t){this.collectionId=e,this.parent=t};Zn.store="collectionParents",Zn.keyPath=["collectionId","parent"];var Ke=function(e,t,i,o){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=i,this.inForeground=o};Ke.store="clientMetadata",Ke.keyPath="clientId";var Kr=function(e,t,i){this.bundleId=e,this.createTime=t,this.version=i};Kr.store="bundles",Kr.keyPath="bundleId";var zr=function(e,t,i){this.name=e,this.readTime=t,this.bundledQuery=i};zr.store="namedQueries",zr.keyPath="name";var Pf=(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],[gn.store,ht.store,Qt.store,vt.store,ne.store,ce.store,le.store,Vt.store]),[Ke.store])),[ke.store])),[Zn.store])),[Kr.store,zr.store]),Oc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lc=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),Jt=function(){var e=this;this.promise=new Promise(function(t,i){e.resolve=t,e.reject=i})},O=function(){function e(t){var i=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(o){i.isDone=!0,i.result=o,i.nextCallback&&i.nextCallback(o)},function(o){i.isDone=!0,i.error=o,i.catchCallback&&i.catchCallback(o)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,i){var o=this;return this.callbackAttached&&K(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new e(function(s,a){o.nextCallback=function(u){o.wrapSuccess(t,u).next(s,a)},o.catchCallback=function(u){o.wrapFailure(i,u).next(s,a)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(i,o){t.next(i,o)})},e.prototype.wrapUserFunction=function(t){try{var i=t();return i instanceof e?i:e.resolve(i)}catch(o){return e.reject(o)}},e.prototype.wrapSuccess=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.resolve(i)},e.prototype.wrapFailure=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.reject(i)},e.resolve=function(t){return new e(function(i,o){i(t)})},e.reject=function(t){return new e(function(i,o){o(t)})},e.waitFor=function(t){return new e(function(i,o){var s=0,a=0,u=!1;t.forEach(function(c){++s,c.next(function(){++a,u&&a===s&&i()},function(l){return o(l)})}),u=!0,a===s&&i()})},e.or=function(t){for(var i=e.resolve(!1),o=function(u){i=i.next(function(c){return c?e.resolve(c):u()})},s=0,a=t;s<a.length;s++)o(a[s]);return i},e.forEach=function(t,i){var o=this,s=[];return t.forEach(function(a,u){s.push(i.call(o,a,u))}),this.waitFor(s)},e}(),Fc=function(){function e(t,i){var o=this;this.action=t,this.transaction=i,this.aborted=!1,this.ft=new Jt,this.transaction.oncomplete=function(){o.ft.resolve()},this.transaction.onabort=function(){i.error?o.ft.reject(new Zi(t,i.error)):o.ft.resolve()},this.transaction.onerror=function(s){var a=aa(s.target.error);o.ft.reject(new Zi(t,a))}}return e.open=function(t,i,o,s){try{return new e(i,t.transaction(s,o))}catch(a){throw new Zi(i,a)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(U("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var i=this.transaction.objectStore(t);return new Mf(i)},e}(),Hr=function(){function e(t,i,o){this.name=t,this.version=i,this.wt=o,12.2===e._t((0,_.z$)())&&St("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return U("SimpleDb","Removing database:",t),Xn(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if("undefined"==typeof indexedDB)return!1;if(e.gt())return!0;var t=(0,_.z$)(),i=e._t(t),o=0<i&&i<10,s=e.Et(t),a=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||o||a)},e.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},e.It=function(t,i){return t.store(i)},e._t=function(t){var i=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),o=i?i[1].split("_").slice(0,2).join("."):"-1";return Number(o)},e.Et=function(t){var i=t.match(/Android ([\d.]+)/i),o=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(o)},e.prototype.At=function(t){return(0,g.mG)(this,void 0,void 0,function(){var i,o=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return this.db?[3,2]:(U("SimpleDb","Opening database:",this.name),i=this,[4,new Promise(function(a,u){var c=indexedDB.open(o.name,o.version);c.onsuccess=function(l){a(l.target.result)},c.onblocked=function(){u(new Zi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},c.onerror=function(l){var d=l.target.error;u("VersionError"===d.name?new N(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Zi(t,d))},c.onupgradeneeded=function(l){U("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',l.oldVersion),o.wt.Rt(l.target.result,c.transaction,l.oldVersion,o.version).next(function(){U("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:i.db=s.sent(),s.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(a){return o.bt(a)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(i){return t(i)})},e.prototype.runTransaction=function(t,i,o,s){return(0,g.mG)(this,void 0,void 0,function(){var a,u,c,l,d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:a="readonly"===i,u=0,c=function(){var v,w,S,E,x;return(0,g.Jh)(this,function(L){switch(L.label){case 0:++u,L.label=1;case 1:return L.trys.push([1,4,,5]),[4,l.At(t)];case 2:return l.db=L.sent(),v=Fc.open(l.db,t,a?"readonly":"readwrite",o),w=s(v).catch(function(V){return v.abort(V),O.reject(V)}).toPromise(),S={},w.catch(function(){}),[4,v.dt];case 3:return[2,(S.value=(L.sent(),w),S)];case 4:return U("SimpleDb","Transaction failed with error:",(E=L.sent()).message,"Retrying:",x="FirebaseError"!==E.name&&u<3),l.close(),x?[3,5]:[2,{value:Promise.reject(E)}];case 5:return[2]}})},l=this,p.label=1;case 1:return[5,c()];case 2:if("object"==typeof(d=p.sent()))return[2,d.value];p.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Nf=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return Xn(this.Pt.delete())},e}(),Zi=function(e){function t(i,o){var s=this;return(s=e.call(this,A.UNAVAILABLE,"IndexedDB transaction '"+i+"' failed: "+o)||this).name="IndexedDbTransactionError",s}return(0,g.ZT)(t,e),t}(N);function Wn(e){return"IndexedDbTransactionError"===e.name}var Mf=function(){function e(t){this.store=t}return e.prototype.put=function(t,i){var o;return void 0!==i?(U("SimpleDb","PUT",this.store.name,t,i),o=this.store.put(i,t)):(U("SimpleDb","PUT",this.store.name,"<auto-key>",t),o=this.store.put(t)),Xn(o)},e.prototype.add=function(t){return U("SimpleDb","ADD",this.store.name,t,t),Xn(this.store.add(t))},e.prototype.get=function(t){var i=this;return Xn(this.store.get(t)).next(function(o){return void 0===o&&(o=null),U("SimpleDb","GET",i.store.name,t,o),o})},e.prototype.delete=function(t){return U("SimpleDb","DELETE",this.store.name,t),Xn(this.store.delete(t))},e.prototype.count=function(){return U("SimpleDb","COUNT",this.store.name),Xn(this.store.count())},e.prototype.Nt=function(t,i){var o=this.cursor(this.options(t,i)),s=[];return this.xt(o,function(a,u){s.push(u)}).next(function(){return s})},e.prototype.kt=function(t,i){U("SimpleDb","DELETE ALL",this.store.name);var o=this.options(t,i);o.Ft=!1;var s=this.cursor(o);return this.xt(s,function(a,u,c){return c.delete()})},e.prototype.$t=function(t,i){var o;i?o=t:(o={},i=t);var s=this.cursor(o);return this.xt(s,i)},e.prototype.Ot=function(t){var i=this.cursor({});return new O(function(o,s){i.onerror=function(a){var u=aa(a.target.error);s(u)},i.onsuccess=function(a){var u=a.target.result;u?t(u.primaryKey,u.value).next(function(c){c?u.continue():o()}):o()}})},e.prototype.xt=function(t,i){var o=[];return new O(function(s,a){t.onerror=function(u){a(u.target.error)},t.onsuccess=function(u){var c=u.target.result;if(c){var l=new Nf(c),d=i(c.primaryKey,c.value,l);if(d instanceof O){var p=d.catch(function(v){return l.done(),O.reject(v)});o.push(p)}l.isDone?s():null===l.Dt?c.continue():c.continue(l.Dt)}else s()}}).next(function(){return O.waitFor(o)})},e.prototype.options=function(t,i){var o;return void 0!==t&&("string"==typeof t?o=t:i=t),{index:o,range:i}},e.prototype.cursor=function(t){var i="next";if(t.reverse&&(i="prev"),t.index){var o=this.store.index(t.index);return t.Ft?o.openKeyCursor(t.range,i):o.openCursor(t.range,i)}return this.store.openCursor(t.range,i)},e}();function Xn(e){return new O(function(t,i){e.onsuccess=function(o){t(o.target.result)},e.onerror=function(o){var s=aa(o.target.error);i(s)}})}var Uc=!1;function aa(e){var t=Hr._t((0,_.z$)());if(t>=12.2&&t<13){var i="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(i)>=0){var o=new N("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+i+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Uc||(Uc=!0,setTimeout(function(){throw o},0)),o}}return e}var qc=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Mt=i,s.currentSequenceNumber=o,s}return(0,g.ZT)(t,e),t}(Lc);function re(e,t){var i=j(e);return Hr.It(i.Mt,t)}var ua=function(){function e(t,i,o,s){this.batchId=t,this.localWriteTime=i,this.baseMutations=o,this.mutations=s}return e.prototype.applyToRemoteDocument=function(t,i){for(var o=i.mutationResults,s=0;s<this.mutations.length;s++){var a=this.mutations[s];a.key.isEqual(t.key)&&lf(a,t,o[s])}},e.prototype.applyToLocalView=function(t){for(var i=0,o=this.baseMutations;i<o.length;i++)(u=o[i]).key.isEqual(t.key)&&ta(u,t,this.localWriteTime);for(var s=0,a=this.mutations;s<a.length;s++){var u;(u=a[s]).key.isEqual(t.key)&&ta(u,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var i=this;this.mutations.forEach(function(o){var s=t.get(o.key),a=s;i.applyToLocalView(a),s.isValidDocument()||a.convertToNoDocument($.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,i){return t.add(i.key)},st())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&Nr(this.mutations,t.mutations,function(i,o){return sc(i,o)})&&Nr(this.baseMutations,t.baseMutations,function(i,o){return sc(i,o)})},e}(),Of=function(){function e(t,i,o,s){this.batch=t,this.commitVersion=i,this.mutationResults=o,this.docVersions=s}return e.from=function(t,i,o){X(t.mutations.length===o.length);for(var s=pc(),a=t.mutations,u=0;u<a.length;u++)s=s.insert(a[u].key,o[u].version);return new e(t,i,o,s)},e}(),ts=function(){function e(t,i,o,s,a,u,c){void 0===a&&(a=$.min()),void 0===u&&(u=$.min()),void 0===c&&(c=Zt.EMPTY_BYTE_STRING),this.target=t,this.targetId=i,this.purpose=o,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=c}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,i){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),Vc=function(e){this.Lt=e};function ca(e,t){if(t.document)return Sc(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var i=z.fromSegments(t.noDocument.path),o=Jr(t.noDocument.readTime),s=qt.newNoDocument(i,o);return t.hasCommittedMutations?s.setHasCommittedMutations():s}if(t.unknownDocument){var a=z.fromSegments(t.unknownDocument.path);return o=Jr(t.unknownDocument.version),qt.newUnknownDocument(a,o)}return K()}function jc(e,t,i){var v,w,o=la(i),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a={name:Qi(v=e.Lt,(w=t).key),fields:w.data.value.mapValue.fields,updateTime:Hi(v,w.version.toTimestamp())},u=t.hasCommittedMutations;return new vt(null,null,a,u,o,s)}if(t.isNoDocument()){var c=t.key.path.toArray(),l=Qr(t.version);return u=t.hasCommittedMutations,new vt(null,new Df(c,l),null,u,o,s)}if(t.isUnknownDocument()){var d=t.key.path.toArray(),p=Qr(t.version);return new vt(new kf(d,p),null,null,!0,o,s)}return K()}function la(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Bc(e){var t=new ee(e[0],e[1]);return $.fromTimestamp(t)}function Qr(e){var t=e.toTimestamp();return new Rf(t.seconds,t.nanoseconds)}function Jr(e){var t=new ee(e.seconds,e.nanoseconds);return $.fromTimestamp(t)}function Zr(e,t){for(var i=(t.baseMutations||[]).map(function(l){return Cc(e.Lt,l)}),o=0;o<t.mutations.length-1;++o)o+1<t.mutations.length&&void 0!==t.mutations[o+1].transform&&(t.mutations[o].updateTransforms=t.mutations[o+1].transform.fieldTransforms,t.mutations.splice(o+1,1),++o);var u=t.mutations.map(function(l){return Cc(e.Lt,l)}),c=ee.fromMillis(t.localWriteTimeMs);return new ua(t.batchId,c,i,u)}function Wi(e){var t,i,o=Jr(e.readTime),s=void 0!==e.lastLimboFreeSnapshotVersion?Jr(e.lastLimboFreeSnapshotVersion):$.min();return void 0!==e.query.documents?(X(1===(i=e.query).documents.length),t=ve(Ur(Tc(i.documents[0])))):t=ve(Rc(e.query)),new ts(t,e.targetId,0,e.lastListenSequenceNumber,o,s,Zt.fromBase64String(e.resumeToken))}function Gc(e,t){var i,o=Qr(t.snapshotVersion),s=Qr(t.lastLimboFreeSnapshotVersion);i=Go(t.target)?Ac(e.Lt,t.target):xc(e.Lt,t.target);var a=t.resumeToken.toBase64();return new ne(t.targetId,qi(t.target),o,a,t.sequenceNumber,s,i)}function ha(e){var t=Rc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Zu(t,t.limit,"L"):t}var Lf=function(){function e(){}return e.prototype.getBundleMetadata=function(t,i){return Kc(t).get(i).next(function(o){if(o)return{id:(s=o).bundleId,createTime:Jr(s.createTime),version:s.version};var s})},e.prototype.saveBundleMetadata=function(t,i){return Kc(t).put({bundleId:(o=i).id,createTime:Qr(Mt(o.createTime)),version:o.version});var o},e.prototype.getNamedQuery=function(t,i){return zc(t).get(i).next(function(o){if(o)return{name:(s=o).name,query:ha(s.bundledQuery),readTime:Jr(s.readTime)};var s})},e.prototype.saveNamedQuery=function(t,i){return zc(t).put({name:(o=i).name,readTime:Qr(Mt(o.readTime)),bundledQuery:o.bundledQuery});var o},e}();function Kc(e){return re(e,Kr.store)}function zc(e){return re(e,zr.store)}var Ff=function(){function e(){this.Bt=new fa}return e.prototype.addToCollectionParentIndex=function(t,i){return this.Bt.add(i),O.resolve()},e.prototype.getCollectionParents=function(t,i){return O.resolve(this.Bt.getEntries(i))},e}(),fa=function(){function e(){this.index={}}return e.prototype.add=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i]||new Rt(it.comparator),a=!s.has(o);return this.index[i]=s.add(o),a},e.prototype.has=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i];return s&&s.has(o)},e.prototype.getEntries=function(t){return(this.index[t]||new Rt(it.comparator)).toArray()},e}(),Uf=function(){function e(){this.qt=new fa}return e.prototype.addToCollectionParentIndex=function(t,i){var o=this;if(!this.qt.has(i)){var s=i.lastSegment(),a=i.popLast();t.addOnCommittedListener(function(){o.qt.add(i)});var u={collectionId:s,parent:Te(a)};return Hc(t).put(u)}return O.resolve()},e.prototype.getCollectionParents=function(t,i){var o=[],s=IDBKeyRange.bound([i,""],[Mu(i),""],!1,!0);return Hc(t).Nt(s).next(function(a){for(var u=0,c=a;u<c.length;u++){var l=c[u];if(l.collectionId!==i)break;o.push(Ge(l.parent))}return o})},e}();function Hc(e){return re(e,Zn.store)}var Qc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pe=function(){function e(t,i,o){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();function Jc(e,t,i){var o=e.store(ht.store),s=e.store(Qt.store),a=[],u=IDBKeyRange.only(i.batchId),c=0,l=o.$t({range:u},function(E,x,L){return c++,L.delete()});a.push(l.next(function(){X(1===c)}));for(var d=[],p=0,v=i.mutations;p<v.length;p++){var w=v[p],S=Qt.key(t,w.key.path,i.batchId);a.push(s.delete(S)),d.push(w.key)}return O.waitFor(a).next(function(){return d})}function es(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw K();t=e.noDocument}return JSON.stringify(t).length}Pe.DEFAULT_COLLECTION_PERCENTILE=10,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pe.DEFAULT=new Pe(41943040,Pe.DEFAULT_COLLECTION_PERCENTILE,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pe.DISABLED=new Pe(-1,0,0);var qf=function(){function e(t,i,o,s){this.userId=t,this.R=i,this.Ut=o,this.referenceDelegate=s,this.Kt={}}return e.Qt=function(t,i,o,s){return X(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",i,o,s)},e.prototype.checkEmpty=function(t){var i=!0,o=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mn(t).$t({index:ht.userMutationsIndex,range:o},function(s,a,u){i=!1,u.done()}).next(function(){return i})},e.prototype.addMutationBatch=function(t,i,o,s){var a=this,u=Wr(t),c=mn(t);return c.add({}).next(function(l){X("number"==typeof l);for(var d=new ua(l,i,o,s),p=function(V,H,Q){var tt=Q.baseMutations.map(function(at){return $o(V.Lt,at)}),rt=Q.mutations.map(function(at){return $o(V.Lt,at)});return new ht(H,Q.batchId,Q.localWriteTime.toMillis(),tt,rt)}(a.R,a.userId,d),v=[],w=new Rt(function(V,H){return et(V.canonicalString(),H.canonicalString())}),S=0,E=s;S<E.length;S++){var x=E[S],L=Qt.key(a.userId,x.key.path,l);w=w.add(x.key.path.popLast()),v.push(c.put(p)),v.push(u.put(L,Qt.PLACEHOLDER))}return w.forEach(function(V){v.push(a.Ut.addToCollectionParentIndex(t,V))}),t.addOnCommittedListener(function(){a.Kt[l]=d.keys()}),O.waitFor(v).next(function(){return d})})},e.prototype.lookupMutationBatch=function(t,i){var o=this;return mn(t).get(i).next(function(s){return s?(X(s.userId===o.userId),Zr(o.R,s)):null})},e.prototype.jt=function(t,i){var o=this;return this.Kt[i]?O.resolve(this.Kt[i]):this.lookupMutationBatch(t,i).next(function(s){if(s){var a=s.keys();return o.Kt[i]=a,a}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var o=this,s=i+1,a=IDBKeyRange.lowerBound([this.userId,s]),u=null;return mn(t).$t({index:ht.userMutationsIndex,range:a},function(c,l,d){l.userId===o.userId&&(X(l.batchId>=s),u=Zr(o.R,l)),d.done()}).next(function(){return u})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var i=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),o=-1;return mn(t).$t({index:ht.userMutationsIndex,range:i,reverse:!0},function(s,a,u){o=a.batchId,u.done()}).next(function(){return o})},e.prototype.getAllMutationBatches=function(t){var i=this,o=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mn(t).Nt(ht.userMutationsIndex,o).next(function(s){return s.map(function(a){return Zr(i.R,a)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=Qt.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(s),u=[];return Wr(t).$t({range:a},function(c,l,d){var p=c[0],w=c[2],S=Ge(c[1]);if(p===o.userId&&i.path.isEqual(S))return mn(t).get(w).next(function(E){if(!E)throw K();X(E.userId===o.userId),u.push(Zr(o.R,E))});d.done()}).next(function(){return u})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new Rt(et),a=[];return i.forEach(function(u){var c=Qt.prefixForPath(o.userId,u.path),l=IDBKeyRange.lowerBound(c),d=Wr(t).$t({range:l},function(p,v,w){var S=p[0],x=p[2],L=Ge(p[1]);S===o.userId&&u.path.isEqual(L)?s=s.add(x):w.done()});a.push(d)}),O.waitFor(a).next(function(){return o.Wt(t,s)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=this,s=i.path,a=s.length+1,u=Qt.prefixForPath(this.userId,s),c=IDBKeyRange.lowerBound(u),l=new Rt(et);return Wr(t).$t({range:c},function(d,p,v){var w=d[0],E=d[2],x=Ge(d[1]);w===o.userId&&s.isPrefixOf(x)?x.length===a&&(l=l.add(E)):v.done()}).next(function(){return o.Wt(t,l)})},e.prototype.Wt=function(t,i){var o=this,s=[],a=[];return i.forEach(function(u){a.push(mn(t).get(u).next(function(c){if(null===c)throw K();X(c.userId===o.userId),s.push(Zr(o.R,c))}))}),O.waitFor(a).next(function(){return s})},e.prototype.removeMutationBatch=function(t,i){var o=this;return Jc(t.Mt,this.userId,i).next(function(s){return t.addOnCommittedListener(function(){o.Gt(i.batchId)}),O.forEach(s,function(a){return o.referenceDelegate.markPotentiallyOrphaned(t,a)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var i=this;return this.checkEmpty(t).next(function(o){if(!o)return O.resolve();var s=IDBKeyRange.lowerBound(Qt.prefixForUser(i.userId)),a=[];return Wr(t).$t({range:s},function(u,c,l){if(u[0]===i.userId){var d=Ge(u[1]);a.push(d)}else l.done()}).next(function(){X(0===a.length)})})},e.prototype.containsKey=function(t,i){return Zc(t,this.userId,i)},e.prototype.zt=function(t){var i=this;return Wc(t).get(this.userId).next(function(o){return o||new gn(i.userId,-1,"")})},e}();function Zc(e,t,i){var o=Qt.prefixForPath(t,i.path),s=o[1],a=IDBKeyRange.lowerBound(o),u=!1;return Wr(e).$t({range:a,Ft:!0},function(c,l,d){c[0]===t&&c[1]===s&&(u=!0),d.done()}).next(function(){return u})}function mn(e){return re(e,ht.store)}function Wr(e){return re(e,Qt.store)}function Wc(e){return re(e,gn.store)}var ns=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),Vf=function(){function e(t,i){this.referenceDelegate=t,this.R=i}return e.prototype.allocateTargetId=function(t){var i=this;return this.Xt(t).next(function(o){var s=new ns(o.highestTargetId);return o.highestTargetId=s.next(),i.Zt(t,o).next(function(){return o.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(i){return $.fromTimestamp(new ee(i.lastRemoteSnapshotVersion.seconds,i.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(i){return i.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,i,o){var s=this;return this.Xt(t).next(function(a){return a.highestListenSequenceNumber=i,o&&(a.lastRemoteSnapshotVersion=o.toTimestamp()),i>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=i),s.Zt(t,a)})},e.prototype.addTargetData=function(t,i){var o=this;return this.te(t,i).next(function(){return o.Xt(t).next(function(s){return s.targetCount+=1,o.ee(i,s),o.Zt(t,s)})})},e.prototype.updateTargetData=function(t,i){return this.te(t,i)},e.prototype.removeTargetData=function(t,i){var o=this;return this.removeMatchingKeysForTargetId(t,i.targetId).next(function(){return Xr(t).delete(i.targetId)}).next(function(){return o.Xt(t)}).next(function(s){return X(s.targetCount>0),s.targetCount-=1,o.Zt(t,s)})},e.prototype.removeTargets=function(t,i,o){var s=this,a=0,u=[];return Xr(t).$t(function(c,l){var d=Wi(l);d.sequenceNumber<=i&&null===o.get(d.targetId)&&(a++,u.push(s.removeTargetData(t,d)))}).next(function(){return O.waitFor(u)}).next(function(){return a})},e.prototype.forEachTarget=function(t,i){return Xr(t).$t(function(o,s){var a=Wi(s);i(a)})},e.prototype.Xt=function(t){return Xc(t).get(le.key).next(function(i){return X(null!==i),i})},e.prototype.Zt=function(t,i){return Xc(t).put(le.key,i)},e.prototype.te=function(t,i){return Xr(t).put(Gc(this.R,i))},e.prototype.ee=function(t,i){var o=!1;return t.targetId>i.highestTargetId&&(i.highestTargetId=t.targetId,o=!0),t.sequenceNumber>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t.sequenceNumber,o=!0),o},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(i){return i.targetCount})},e.prototype.getTargetData=function(t,i){var o=qi(i),s=IDBKeyRange.bound([o,Number.NEGATIVE_INFINITY],[o,Number.POSITIVE_INFINITY]),a=null;return Xr(t).$t({range:s,index:ne.queryTargetsIndexName},function(u,c,l){var d=Wi(c);Bo(i,d.target)&&(a=d,l.done())}).next(function(){return a})},e.prototype.addMatchingKeys=function(t,i,o){var s=this,a=[],u=vn(t);return i.forEach(function(c){var l=Te(c.path);a.push(u.put(new Vt(o,l))),a.push(s.referenceDelegate.addReference(t,o,c))}),O.waitFor(a)},e.prototype.removeMatchingKeys=function(t,i,o){var s=this,a=vn(t);return O.forEach(i,function(u){var c=Te(u.path);return O.waitFor([a.delete([o,c]),s.referenceDelegate.removeReference(t,o,u)])})},e.prototype.removeMatchingKeysForTargetId=function(t,i){var o=vn(t),s=IDBKeyRange.bound([i],[i+1],!1,!0);return o.delete(s)},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=IDBKeyRange.bound([i],[i+1],!1,!0),s=vn(t),a=st();return s.$t({range:o,Ft:!0},function(u,c,l){var d=Ge(u[1]),p=new z(d);a=a.add(p)}).next(function(){return a})},e.prototype.containsKey=function(t,i){var o=Te(i.path),s=IDBKeyRange.bound([o],[Mu(o)],!1,!0),a=0;return vn(t).$t({index:Vt.documentTargetsIndex,Ft:!0,range:s},function(u,c,l){0!==u[0]&&(a++,l.done())}).next(function(){return a>0})},e.prototype.lt=function(t,i){return Xr(t).get(i).next(function(o){return o?Wi(o):null})},e}();function Xr(e){return re(e,ne.store)}function Xc(e){return re(e,le.store)}function vn(e){return re(e,Vt.store)}function Yn(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){if(e.code!==A.FAILED_PRECONDITION||e.message!==Oc)throw e;return U("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Yc(e,t){var o=e[1],a=t[1],u=et(e[0],t[0]);return 0===u?et(o,a):u}var jf=function(){function e(t){this.ne=t,this.buffer=new Rt(Yc),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var i=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(i);else{var o=this.buffer.last();Yc(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),Bf=function(){function e(t,i){this.garbageCollector=t,this.asyncQueue=i,this.oe=!1,this.ce=null}return e.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var i=this,o=this.oe?3e5:6e4;U("LruGarbageCollector","Garbage collection scheduled in "+o+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",o,function(){return(0,g.mG)(i,void 0,void 0,function(){var s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:this.ce=null,this.oe=!0,a.label=1;case 1:return a.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return a.sent(),[3,7];case 3:return Wn(s=a.sent())?(U("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s),[3,6]):[3,4];case 4:return[4,Yn(s)];case 5:a.sent(),a.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return a.sent(),[2]}})})})},e}(),Gf=function(){function e(t,i){this.ae=t,this.params=i}return e.prototype.calculateTargetCount=function(t,i){return this.ae.he(t).next(function(o){return Math.floor(i/100*o)})},e.prototype.nthSequenceNumber=function(t,i){var o=this;if(0===i)return O.resolve(se.o);var s=new jf(i);return this.ae.forEachTarget(t,function(a){return s.re(a.sequenceNumber)}).next(function(){return o.ae.le(t,function(a){return s.re(a)})}).next(function(){return s.maxValue})},e.prototype.removeTargets=function(t,i,o){return this.ae.removeTargets(t,i,o)},e.prototype.removeOrphanedDocuments=function(t,i){return this.ae.removeOrphanedDocuments(t,i)},e.prototype.collect=function(t,i){var o=this;return-1===this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Qc)):this.getCacheSize(t).next(function(s){return s<o.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector","Garbage collection skipped; Cache size "+s+" is lower than threshold "+o.params.cacheSizeCollectionThreshold),Qc):o.fe(t,i)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,i){var o,s,a,u,c,l,d,p=this,v=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(w){return w>p.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+p.params.maximumSequenceNumbersToCollect+" from "+w),s=p.params.maximumSequenceNumbersToCollect):s=w,u=Date.now(),p.nthSequenceNumber(t,s)}).next(function(w){return o=w,c=Date.now(),p.removeTargets(t,o,i)}).next(function(w){return a=w,l=Date.now(),p.removeOrphanedDocuments(t,o)}).next(function(w){return d=Date.now(),Gs()<=Xt.in.DEBUG&&U("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(u-v)+"ms\n\tDetermined least recently used "+s+" in "+(c-u)+"ms\n\tRemoved "+a+" targets in "+(l-c)+"ms\n\tRemoved "+w+" documents in "+(d-l)+"ms\nTotal Duration: "+(d-v)+"ms"),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:a,documentsRemoved:w})})},e}(),Kf=function(){function e(t,i){this.db=t,this.garbageCollector=new Gf(this,i)}return e.prototype.he=function(t){var i=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(o){return i.next(function(s){return o+s})})},e.prototype.de=function(t){var i=0;return this.le(t,function(o){i++}).next(function(){return i})},e.prototype.forEachTarget=function(t,i){return this.db.getTargetCache().forEachTarget(t,i)},e.prototype.le=function(t,i){return this.we(t,function(o,s){return i(s)})},e.prototype.addReference=function(t,i,o){return rs(t,o)},e.prototype.removeReference=function(t,i,o){return rs(t,o)},e.prototype.removeTargets=function(t,i,o){return this.db.getTargetCache().removeTargets(t,i,o)},e.prototype.markPotentiallyOrphaned=function(t,i){return rs(t,i)},e.prototype._e=function(t,i){return s=i,a=!1,Wc(o=t).Ot(function(u){return Zc(o,u,s).next(function(c){return c&&(a=!0),O.resolve(!c)})}).next(function(){return a});var o,s,a},e.prototype.removeOrphanedDocuments=function(t,i){var o=this,s=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[],u=0;return this.we(t,function(c,l){if(l<=i){var d=o._e(t,c).next(function(p){if(!p)return u++,s.getEntry(t,c).next(function(){return s.removeEntry(c),vn(t).delete([0,Te(c.path)])})});a.push(d)}}).next(function(){return O.waitFor(a)}).next(function(){return s.apply(t)}).next(function(){return u})},e.prototype.removeTarget=function(t,i){var o=i.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,o)},e.prototype.updateLimboDocument=function(t,i){return rs(t,i)},e.prototype.we=function(t,i){var o,s=vn(t),a=se.o;return s.$t({index:Vt.documentTargetsIndex},function(u,c){var d=c.path,p=c.sequenceNumber;0===u[0]?(a!==se.o&&i(new z(Ge(o)),a),a=p,o=d):a=se.o}).next(function(){a!==se.o&&i(new z(Ge(o)),a)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function rs(e,t){return vn(e).put((o=e.currentSequenceNumber,new Vt(0,Te(t.path),o)));var o}var Yr=function(){function e(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={}}return e.prototype.get=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0!==o)for(var s=0,a=o;s<a.length;s++){var u=a[s],l=u[1];if(this.equalsFn(u[0],t))return l}},e.prototype.has=function(t){return void 0!==this.get(t)},e.prototype.set=function(t,i){var o=this.mapKeyFn(t),s=this.inner[o];if(void 0!==s){for(var a=0;a<s.length;a++)if(this.equalsFn(s[a][0],t))return void(s[a]=[t,i]);s.push([t,i])}else this.inner[o]=[[t,i]]},e.prototype.delete=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0===o)return!1;for(var s=0;s<o.length;s++)if(this.equalsFn(o[s][0],t))return 1===o.length?delete this.inner[i]:o.splice(s,1),!0;return!1},e.prototype.forEach=function(t){Kn(this.inner,function(i,o){for(var s=0,a=o;s<a.length;s++){var u=a[s];t(u[0],u[1])}})},e.prototype.isEmpty=function(){return Lu(this.inner)},e}(),$c=function(){function e(){this.changes=new Yr(function(t){return t.toString()},function(t,i){return t.isEqual(i)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var i=this.changes.get(t);return i?i.readTime:$.min()},e.prototype.addEntry=function(t,i){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:i})},e.prototype.removeEntry=function(t,i){void 0===i&&(i=null),this.assertNotApplied(),this.changes.set(t,{document:qt.newInvalidDocument(t),readTime:i})},e.prototype.getEntry=function(t,i){this.assertNotApplied();var o=this.changes.get(i);return void 0!==o?O.resolve(o.document):this.getFromCache(t,i)},e.prototype.getEntries=function(t,i){return this.getAllFromCache(t,i)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),zf=function(){function e(t,i){this.R=t,this.Ut=i}return e.prototype.addEntry=function(t,i,o){return yn(t).put(is(i),o)},e.prototype.removeEntry=function(t,i){var o=yn(t),s=is(i);return o.delete(s)},e.prototype.updateMetadata=function(t,i){var o=this;return this.getMetadata(t).next(function(s){return s.byteSize+=i,o.me(t,s)})},e.prototype.getEntry=function(t,i){var o=this;return yn(t).get(is(i)).next(function(s){return o.ye(i,s)})},e.prototype.ge=function(t,i){var o=this;return yn(t).get(is(i)).next(function(s){return{document:o.ye(i,s),size:es(s)}})},e.prototype.getEntries=function(t,i){var o=this,s=ye();return this.pe(t,i,function(a,u){var c=o.ye(a,u);s=s.insert(a,c)}).next(function(){return s})},e.prototype.Ee=function(t,i){var o=this,s=ye(),a=new Ht(z.comparator);return this.pe(t,i,function(u,c){var l=o.ye(u,c);s=s.insert(u,l),a=a.insert(u,es(c))}).next(function(){return{documents:s,Te:a}})},e.prototype.pe=function(t,i,o){if(i.isEmpty())return O.resolve();var s=IDBKeyRange.bound(i.first().path.toArray(),i.last().path.toArray()),a=i.getIterator(),u=a.getNext();return yn(t).$t({range:s},function(c,l,d){for(var p=z.fromSegments(c);u&&z.comparator(u,p)<0;)o(u,null),u=a.getNext();u&&u.isEqual(p)&&(o(u,l),u=a.hasNext()?a.getNext():null),u?d.Ct(u.path.toArray()):d.done()}).next(function(){for(;u;)o(u,null),u=a.hasNext()?a.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){var s=this,a=ye(),u=i.path.length+1,c={};if(o.isEqual($.min())){var l=i.path.toArray();c.range=IDBKeyRange.lowerBound(l)}else{var d=i.path.toArray(),p=la(o);c.range=IDBKeyRange.lowerBound([d,p],!0),c.index=vt.collectionReadTimeIndex}return yn(t).$t(c,function(v,w,S){if(v.length===u){var E=ca(s.R,w);i.path.isPrefixOf(E.key.path)?Bi(i,E)&&(a=a.insert(E.key,E)):S.done()}}).next(function(){return a})},e.prototype.newChangeBuffer=function(t){return new Hf(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(i){return i.byteSize})},e.prototype.getMetadata=function(t){return tl(t).get(ke.key).next(function(i){return X(!!i),i})},e.prototype.me=function(t,i){return tl(t).put(ke.key,i)},e.prototype.ye=function(t,i){if(i){var o=ca(this.R,i);if(!o.isNoDocument()||!o.version.isEqual($.min()))return o}return qt.newInvalidDocument(t)},e}(),Hf=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Ie=i,s.trackRemovals=o,s.Ae=new Yr(function(a){return a.toString()},function(a,u){return a.isEqual(u)}),s}return(0,g.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new Rt(function(c,l){return et(c.canonicalString(),l.canonicalString())});return this.changes.forEach(function(c,l){var d=o.Ae.get(c);if(l.document.isValidDocument()){var p=jc(o.Ie.R,l.document,o.getReadTime(c));u=u.add(c.path.popLast());var v=es(p);a+=v-d,s.push(o.Ie.addEntry(i,c,p))}else if(a-=d,o.trackRemovals){var w=jc(o.Ie.R,qt.newNoDocument(c,$.min()),o.getReadTime(c));s.push(o.Ie.addEntry(i,c,w))}else s.push(o.Ie.removeEntry(i,c))}),u.forEach(function(c){s.push(o.Ie.Ut.addToCollectionParentIndex(i,c))}),s.push(this.Ie.updateMetadata(i,a)),O.waitFor(s)},t.prototype.getFromCache=function(i,o){var s=this;return this.Ie.ge(i,o).next(function(a){return s.Ae.set(o,a.size),a.document})},t.prototype.getAllFromCache=function(i,o){var s=this;return this.Ie.Ee(i,o).next(function(a){var u=a.documents;return a.Te.forEach(function(c,l){s.Ae.set(c,l)}),u})},t}($c);function tl(e){return re(e,ke.store)}function yn(e){return re(e,vt.store)}function is(e){return e.path.toArray()}var Qf=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,i,o,s){var a=this;X(o<s&&o>=0&&s<=11);var l,u=new Fc("createOrUpgrade",i);o<1&&s>=1&&(t.createObjectStore(ce.store),(l=t).createObjectStore(gn.store,{keyPath:gn.keyPath}),l.createObjectStore(ht.store,{keyPath:ht.keyPath,autoIncrement:!0}).createIndex(ht.userMutationsIndex,ht.userMutationsKeyPath,{unique:!0}),l.createObjectStore(Qt.store),el(t),function(l){l.createObjectStore(vt.store)}(t));var c=O.resolve();return o<3&&s>=3&&(0!==o&&(function(l){l.deleteObjectStore(Vt.store),l.deleteObjectStore(ne.store),l.deleteObjectStore(le.store)}(t),el(t)),c=c.next(function(){return function(l){var d=l.store(le.store),p=new le(0,0,$.min().toTimestamp(),0);return d.put(le.key,p)}(u)})),o<4&&s>=4&&(0!==o&&(c=c.next(function(){return function(l,d){return d.store(ht.store).Nt().next(function(p){l.deleteObjectStore(ht.store),l.createObjectStore(ht.store,{keyPath:ht.keyPath,autoIncrement:!0}).createIndex(ht.userMutationsIndex,ht.userMutationsKeyPath,{unique:!0});var v=d.store(ht.store),w=p.map(function(S){return v.put(S)});return O.waitFor(w)})}(t,u)})),c=c.next(function(){!function(l){l.createObjectStore(Ke.store,{keyPath:Ke.keyPath})}(t)})),o<5&&s>=5&&(c=c.next(function(){return a.Re(u)})),o<6&&s>=6&&(c=c.next(function(){return function(l){l.createObjectStore(ke.store)}(t),a.be(u)})),o<7&&s>=7&&(c=c.next(function(){return a.ve(u)})),o<8&&s>=8&&(c=c.next(function(){return a.Pe(t,u)})),o<9&&s>=9&&(c=c.next(function(){(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t),function(l){var d=l.objectStore(vt.store);d.createIndex(vt.readTimeIndex,vt.readTimeIndexPath,{unique:!1}),d.createIndex(vt.collectionReadTimeIndex,vt.collectionReadTimeIndexPath,{unique:!1})}(i)})),o<10&&s>=10&&(c=c.next(function(){return a.Ve(u)})),o<11&&s>=11&&(c=c.next(function(){(function(l){l.createObjectStore(Kr.store,{keyPath:Kr.keyPath})})(t),function(l){l.createObjectStore(zr.store,{keyPath:zr.keyPath})}(t)})),c},e.prototype.be=function(t){var i=0;return t.store(vt.store).$t(function(o,s){i+=es(s)}).next(function(){var o=new ke(i);return t.store(ke.store).put(ke.key,o)})},e.prototype.Re=function(t){var i=this,o=t.store(gn.store),s=t.store(ht.store);return o.Nt().next(function(a){return O.forEach(a,function(u){var c=IDBKeyRange.bound([u.userId,-1],[u.userId,u.lastAcknowledgedBatchId]);return s.Nt(ht.userMutationsIndex,c).next(function(l){return O.forEach(l,function(d){X(d.userId===u.userId);var p=Zr(i.R,d);return Jc(t,u.userId,p).next(function(){})})})})})},e.prototype.ve=function(t){var i=t.store(Vt.store),o=t.store(vt.store);return t.store(le.store).get(le.key).next(function(s){var a=[];return o.$t(function(u,c){var l=new it(u),d=[0,Te(l)];a.push(i.get(d).next(function(p){return p?O.resolve():i.put(new Vt(0,Te(l),s.highestListenSequenceNumber))}))}).next(function(){return O.waitFor(a)})})},e.prototype.Pe=function(t,i){t.createObjectStore(Zn.store,{keyPath:Zn.keyPath});var o=i.store(Zn.store),s=new fa,a=function(u){if(s.add(u)){var c=u.lastSegment(),l=u.popLast();return o.put({collectionId:c,parent:Te(l)})}};return i.store(vt.store).$t({Ft:!0},function(u,c){var l=new it(u);return a(l.popLast())}).next(function(){return i.store(Qt.store).$t({Ft:!0},function(u,c){var d=Ge(u[1]);return a(d.popLast())})})},e.prototype.Ve=function(t){var i=this,o=t.store(ne.store);return o.$t(function(s,a){var u=Wi(a),c=Gc(i.R,u);return o.put(c)})},e}();function el(e){e.createObjectStore(Vt.store,{keyPath:Vt.keyPath}).createIndex(Vt.documentTargetsIndex,Vt.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(ne.store,{keyPath:ne.keyPath}).createIndex(ne.queryTargetsIndexName,ne.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(le.store)}var da="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Jf=function(){function e(t,i,o,s,a,u,c,l,d,p){if(this.allowTabSynchronization=t,this.persistenceKey=i,this.clientId=o,this.Se=a,this.window=u,this.document=c,this.De=d,this.Ce=p,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(v){return Promise.resolve()},!e.yt())throw new N(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Kf(this,s),this.Le=i+"main",this.R=new Vc(l),this.Be=new Hr(this.Le,11,new Qf(this.R)),this.qe=new Vf(this.referenceDelegate,this.R),this.Ut=new Uf,this.Ue=new zf(this.R,this.Ut),this.Ke=new Lf,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===p&&St("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new N(A.FAILED_PRECONDITION,da);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(i){return t.qe.getHighestSequenceNumber(i)})}).then(function(i){t.Ne=new se(i,t.De)}).then(function(){t.xe=!0}).catch(function(i){return t.Be&&t.Be.close(),Promise.reject(i)})},e.prototype.He=function(t){var i=this;return this.Me=function(o){return(0,g.mG)(i,void 0,void 0,function(){return(0,g.Jh)(this,function(s){return this.started?[2,t(o)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var i=this;this.Be.vt(function(o){return(0,g.mG)(i,void 0,void 0,function(){return(0,g.Jh)(this,function(s){switch(s.label){case 0:return null===o.newVersion?[4,t()]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var i=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,g.mG)(i,void 0,void 0,function(){return(0,g.Jh)(this,function(o){switch(o.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(i){return os(i).put(new Ke(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(i).next(function(o){o||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(i)}).next(function(o){return t.isPrimary&&!o?t.Xe(i).next(function(){return!1}):!!o&&t.Ze(i).next(function(){return!0})})}).catch(function(i){if(Wn(i))return U("IndexedDbPersistence","Failed to extend owner lease: ",i),t.isPrimary;if(!t.allowTabSynchronization)throw i;return U("IndexedDbPersistence","Releasing owner lease after error during lease refresh",i),!1}).then(function(i){t.isPrimary!==i&&t.Se.enqueueRetryable(function(){return t.Me(i)}),t.isPrimary=i})},e.prototype.Je=function(t){var i=this;return Xi(t).get(ce.key).next(function(o){return O.resolve(i.tn(o))})},e.prototype.en=function(t){return os(t).delete(this.clientId)},e.prototype.nn=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o,a=this;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(c){var l=re(c,Ke.store);return l.Nt().next(function(d){var p=a.rn(d,18e5),v=d.filter(function(w){return-1===p.indexOf(w)});return O.forEach(v,function(w){return l.delete(w.clientId)}).next(function(){return v})})}).catch(function(){return[]})]);case 1:if(t=u.sent(),this.Qe)for(i=0,o=t;i<o.length;i++)this.Qe.removeItem(this.on(o[i].clientId));u.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var i=this;return this.Ce?O.resolve(!0):Xi(t).get(ce.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)){if(i.tn(o)&&i.networkEnabled)return!0;if(!i.tn(o)){if(!o.allowTabSynchronization)throw new N(A.FAILED_PRECONDITION,da);return!1}}return!(!i.networkEnabled||!i.inForeground)||os(t).Nt().next(function(s){return void 0===i.rn(s,5e3).find(function(a){return!(i.clientId===a.clientId||!(!i.networkEnabled&&a.networkEnabled||!i.inForeground&&a.inForeground&&i.networkEnabled===a.networkEnabled))})})}).next(function(o){return i.isPrimary!==o&&U("IndexedDbPersistence","Client "+(o?"is":"is not")+" eligible for a primary lease."),o})},e.prototype.shutdown=function(){return(0,g.mG)(this,void 0,void 0,function(){var t=this;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ce.store,Ke.store],function(o){var s=new qc(o,se.o);return t.Xe(s).next(function(){return t.en(s)})})];case 1:return i.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,i){var o=this;return t.filter(function(s){return o.sn(s.updateTimeMs,i)&&!o.cn(s.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(i){return os(i).Nt().next(function(o){return t.rn(o,18e5).map(function(s){return s.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return qf.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var a,s=this;return U("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===i?"readonly":"readwrite",Pf,function(c){return a=new qc(c,s.Ne?s.Ne.next():se.o),"readwrite-primary"===i?s.Je(a).next(function(l){return!!l||s.Ye(a)}).next(function(l){if(!l)throw St("Failed to obtain primary lease for action '"+t+"'."),s.isPrimary=!1,s.Se.enqueueRetryable(function(){return s.Me(!1)}),new N(A.FAILED_PRECONDITION,Oc);return o(a)}).next(function(l){return s.Ze(a).next(function(){return l})}):s.dn(a).next(function(){return o(a)})}).then(function(c){return a.raiseOnCommittedEvent(),c})},e.prototype.dn=function(t){var i=this;return Xi(t).get(ce.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)&&!i.tn(o)&&!(i.Ce||i.allowTabSynchronization&&o.allowTabSynchronization))throw new N(A.FAILED_PRECONDITION,da)})},e.prototype.Ze=function(t){var i=new ce(this.clientId,this.allowTabSynchronization,Date.now());return Xi(t).put(ce.key,i)},e.yt=function(){return Hr.yt()},e.prototype.Xe=function(t){var i=this,o=Xi(t);return o.get(ce.key).next(function(s){return i.tn(s)?(U("IndexedDbPersistence","Releasing primary lease."),o.delete(ce.key)):O.resolve()})},e.prototype.sn=function(t,i){var o=Date.now();return!(t<o-i||t>o&&(St("Detected an update time that is in the future: "+t+" > "+o),1))},e.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,i=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){i.un(),(0,_.G6)()&&navigator.appVersion.match("Version/14")&&i.Se.enterRestrictedMode(!0),i.Se.enqueueAndForget(function(){return i.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var i;try{var o=null!==(null===(i=this.Qe)||void 0===i?void 0:i.getItem(this.on(t)));return U("IndexedDbPersistence","Client '"+t+"' "+(o?"is":"is not")+" zombied in LocalStorage"),o}catch(s){return St("IndexedDbPersistence","Failed to get zombied client id.",s),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){St("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function Xi(e){return re(e,ce.store)}function os(e){return re(e,Ke.store)}function pa(e,t){var i=e.projectId;return e.isDefaultDatabase||(i+="."+e.database),"firestore/"+t+"/"+i+"/"}var Zf=function(e,t){this.progress=e,this.wn=t},nl=function(){function e(t,i,o){this.Ue=t,this._n=i,this.Ut=o}return e.prototype.mn=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,i).next(function(s){return o.yn(t,i,s)})},e.prototype.yn=function(t,i,o){return this.Ue.getEntry(t,i).next(function(s){for(var a=0,u=o;a<u.length;a++)u[a].applyToLocalView(s);return s})},e.prototype.gn=function(t,i){t.forEach(function(o,s){for(var a=0,u=i;a<u.length;a++)u[a].applyToLocalView(s)})},e.prototype.pn=function(t,i){var o=this;return this.Ue.getEntries(t,i).next(function(s){return o.En(t,s).next(function(){return s})})},e.prototype.En=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,i).next(function(s){return o.gn(i,s)})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){return z.isDocumentKey((s=i).path)&&null===s.collectionGroup&&0===s.filters.length?this.Tn(t,i.path):Ys(i)?this.In(t,i,o):this.An(t,i,o);var s},e.prototype.Tn=function(t,i){return this.mn(t,new z(i)).next(function(o){var s=na();return o.isFoundDocument()&&(s=s.insert(o.key,o)),s})},e.prototype.In=function(t,i,o){var s=this,a=i.collectionGroup,u=na();return this.Ut.getCollectionParents(t,a).next(function(c){return O.forEach(c,function(l){var p,v,d=(p=i,v=l.child(a),new Be(v,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));return s.An(t,d,o).next(function(p){p.forEach(function(v,w){u=u.insert(v,w)})})}).next(function(){return u})})},e.prototype.An=function(t,i,o){var s,a,u=this;return this.Ue.getDocumentsMatchingQuery(t,i,o).next(function(c){return s=c,u._n.getAllMutationBatchesAffectingQuery(t,i)}).next(function(c){return u.Rn(t,a=c,s).next(function(l){s=l;for(var d=0,p=a;d<p.length;d++)for(var v=p[d],w=0,S=v.mutations;w<S.length;w++){var E=S[w],x=E.key,L=s.get(x);null==L&&(L=qt.newInvalidDocument(x),s=s.insert(x,L)),ta(E,L,v.localWriteTime),L.isFoundDocument()||(s=s.remove(x))}})}).next(function(){return s.forEach(function(c,l){Bi(i,l)||(s=s.remove(c))}),s})},e.prototype.Rn=function(t,i,o){for(var s=st(),a=0,u=i;a<u.length;a++)for(var c=0,l=u[a].mutations;c<l.length;c++){var d=l[c];d instanceof dn&&null===o.get(d.key)&&(s=s.add(d.key))}var p=o;return this.Ue.getEntries(t,s).next(function(v){return v.forEach(function(w,S){S.isFoundDocument()&&(p=p.insert(w,S))}),p})},e}(),Wf=function(){function e(t,i,o,s){this.targetId=t,this.fromCache=i,this.bn=o,this.vn=s}return e.Pn=function(t,i){for(var o=st(),s=st(),a=0,u=i.docChanges;a<u.length;a++){var c=u[a];switch(c.type){case 0:o=o.add(c.doc.key);break;case 1:s=s.add(c.doc.key)}}return new e(t,i.fromCache,o,s)},e}(),rl=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,i,o,s){var u,a=this;return 0===(u=i).filters.length&&null===u.limit&&null==u.startAt&&null==u.endAt&&(0===u.explicitOrderBy.length||1===u.explicitOrderBy.length&&u.explicitOrderBy[0].field.isKeyField())||o.isEqual($.min())?this.Dn(t,i):this.Sn.pn(t,s).next(function(u){var c=a.Cn(i,u);return(zo(i)||Ho(i))&&a.Nn(i.limitType,c,s,o)?a.Dn(t,i):(Gs()<=Xt.in.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),$s(i)),a.Sn.getDocumentsMatchingQuery(t,i,o).next(function(l){return c.forEach(function(d){l=l.insert(d.key,d)}),l}))})},e.prototype.Cn=function(t,i){var o=new Rt(Xu(t));return i.forEach(function(s,a){Bi(t,a)&&(o=o.add(a))}),o},e.prototype.Nn=function(t,i,o,s){if(o.size!==i.size)return!0;var a="F"===t?i.last():i.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)},e.prototype.Dn=function(t,i){return Gs()<=Xt.in.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",$s(i)),this.Sn.getDocumentsMatchingQuery(t,i,$.min())},e}(),Xf=function(){function e(t,i,o,s){this.persistence=t,this.xn=i,this.R=s,this.kn=new Ht(et),this.Fn=new Yr(function(a){return qi(a)},Bo),this.$n=$.min(),this._n=t.getMutationQueue(o),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new nl(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var i=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(o){return t.collect(o,i.kn)})},e}();function il(e,t,i,o){return new Xf(e,t,i,o)}function ol(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return i=j(e),o=i._n,s=i.Mn,[4,i.persistence.runTransaction("Handle user change","readonly",function(c){var l;return i._n.getAllMutationBatches(c).next(function(d){return l=d,o=i.persistence.getMutationQueue(t),s=new nl(i.On,o,i.persistence.getIndexManager()),o.getAllMutationBatches(c)}).next(function(d){for(var p=[],v=[],w=st(),S=0,E=l;S<E.length;S++){var x=E[S];p.push(x.batchId);for(var L=0,V=x.mutations;L<V.length;L++)w=w.add(V[L].key)}for(var Q=0,tt=d;Q<tt.length;Q++){var rt=tt[Q];v.push(rt.batchId);for(var at=0,Bt=rt.mutations;at<Bt.length;at++)w=w.add(Bt[at].key)}return s.pn(c,w).next(function(co){return{Ln:co,removedBatchIds:p,addedBatchIds:v}})})})];case 1:return a=u.sent(),[2,(i._n=o,i.Mn=s,i.xn.Vn(i.Mn),a)]}})})}function Yf(e,t){var i=j(e);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(o){var u,c,l,d,p,v,w,s=t.batch.keys(),a=i.On.newChangeBuffer({trackRemovals:!0});return(u=i,c=o,l=t,d=a,p=l.batch,v=p.keys(),w=O.resolve(),v.forEach(function(S){w=w.next(function(){return d.getEntry(c,S)}).next(function(E){var x=l.docVersions.get(S);X(null!==x),E.version.compareTo(x)<0&&(p.applyToRemoteDocument(E,l),E.isValidDocument()&&d.addEntry(E,l.commitVersion))})}),w.next(function(){return u._n.removeMutationBatch(c,p)})).next(function(){return a.apply(o)}).next(function(){return i._n.performConsistencyCheck(o)}).next(function(){return i.Mn.pn(o,s)})})}function sl(e){var t=j(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(i){return t.qe.getLastRemoteSnapshotVersion(i)})}function $f(e,t){var i=j(e),o=t.snapshotVersion,s=i.kn;return i.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var u=i.On.newChangeBuffer({trackRemovals:!0});s=i.kn;var c=[];t.targetChanges.forEach(function(p,v){var x,L,V,w=s.get(v);if(w){c.push(i.qe.removeMatchingKeys(a,p.removedDocuments,v).next(function(){return i.qe.addMatchingKeys(a,p.addedDocuments,v)}));var S=p.resumeToken;if(S.approximateByteSize()>0){var E=w.withResumeToken(S,o).withSequenceNumber(a.currentSequenceNumber);s=s.insert(v,E),x=w,V=p,X((L=E).resumeToken.approximateByteSize()>0),(0===x.resumeToken.approximateByteSize()||L.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&c.push(i.qe.updateTargetData(a,E))}}});var l=ye();if(t.documentUpdates.forEach(function(p,v){t.resolvedLimboDocuments.has(p)&&c.push(i.persistence.referenceDelegate.updateLimboDocument(a,p))}),c.push(al(a,u,t.documentUpdates,o,void 0).next(function(p){l=p})),!o.isEqual($.min())){var d=i.qe.getLastRemoteSnapshotVersion(a).next(function(p){return i.qe.setTargetsMetadata(a,a.currentSequenceNumber,o)});c.push(d)}return O.waitFor(c).next(function(){return u.apply(a)}).next(function(){return i.Mn.En(a,l)}).next(function(){return l})}).then(function(a){return i.kn=s,a})}function al(e,t,i,o,s){var a=st();return i.forEach(function(u){return a=a.add(u)}),t.getEntries(e,a).next(function(u){var c=ye();return i.forEach(function(l,d){var p=u.get(l),v=(null==s?void 0:s.get(l))||o;d.isNoDocument()&&d.version.isEqual($.min())?(t.removeEntry(l,v),c=c.insert(l,d)):!p.isValidDocument()||d.version.compareTo(p.version)>0||0===d.version.compareTo(p.version)&&p.hasPendingWrites?(t.addEntry(d,v),c=c.insert(l,d)):U("LocalStore","Ignoring outdated watch update for ",l,". Current version:",p.version," Watch version:",d.version)}),c})}function td(e,t){var i=j(e);return i.persistence.runTransaction("Get next mutation batch","readonly",function(o){return void 0===t&&(t=-1),i._n.getNextMutationBatchAfterBatchId(o,t)})}function $r(e,t){var i=j(e);return i.persistence.runTransaction("Allocate target","readwrite",function(o){var s;return i.qe.getTargetData(o,t).next(function(a){return a?O.resolve(s=a):i.qe.allocateTargetId(o).next(function(u){return s=new ts(t,u,0,o.currentSequenceNumber),i.qe.addTargetData(o,s).next(function(){return s})})})}).then(function(o){var s=i.kn.get(o.targetId);return(null===s||o.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(i.kn=i.kn.insert(o.targetId,o),i.Fn.set(t,o.targetId)),o})}function ti(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:o=j(e),s=o.kn.get(t),a=i?"readwrite":"readwrite-primary",c.label=1;case 1:return c.trys.push([1,4,,5]),i?[3,3]:[4,o.persistence.runTransaction("Release target",a,function(l){return o.persistence.referenceDelegate.removeTarget(l,s)})];case 2:c.sent(),c.label=3;case 3:return[3,5];case 4:if(!Wn(u=c.sent()))throw u;return U("LocalStore","Failed to update sequence numbers for target "+t+": "+u),[3,5];case 5:return o.kn=o.kn.remove(t),o.Fn.delete(s.target),[2]}})})}function ss(e,t,i){var o=j(e),s=$.min(),a=st();return o.persistence.runTransaction("Execute query","readonly",function(u){return(c=o,l=u,d=ve(t),p=j(c),v=p.Fn.get(d),void 0!==v?O.resolve(p.kn.get(v)):p.qe.getTargetData(l,d)).next(function(c){if(c)return s=c.lastLimboFreeSnapshotVersion,o.qe.getMatchingKeysForTargetId(u,c.targetId).next(function(l){a=l})}).next(function(){return o.xn.getDocumentsMatchingQuery(u,t,i?s:$.min(),i?a:st())}).next(function(c){return{documents:c,Bn:a}});var c,l,d,p,v})}function ul(e,t){var i=j(e),o=j(i.qe),s=i.kn.get(t);return s?Promise.resolve(s.target):i.persistence.runTransaction("Get target data","readonly",function(a){return o.lt(a,t).next(function(u){return u?u.target:null})})}function cl(e){var t=j(e);return t.persistence.runTransaction("Get new document changes","readonly",function(i){return s=i,a=t.$n,u=j(t.On),c=ye(),l=la(a),d=yn(s),p=IDBKeyRange.lowerBound(l,!0),d.$t({index:vt.readTimeIndex,range:p},function(v,w){var S=ca(u.R,w);c=c.insert(S.key,S),l=w.readTime}).next(function(){return{wn:c,readTime:Bc(l)}});var s,a,u,c,l,d,p}).then(function(i){var o=i.wn;return t.$n=i.readTime,o})}function ed(e){return(0,g.mG)(this,void 0,void 0,function(){var t;return(0,g.Jh)(this,function(i){return[2,(t=j(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(o){return a=yn(o),u=$.min(),a.$t({index:vt.readTimeIndex,reverse:!0},function(c,l,d){l.readTime&&(u=Bc(l.readTime)),d.done()}).next(function(){return u});var a,u}).then(function(o){t.$n=o})]})})}function nd(e,t,i,o){return(0,g.mG)(this,void 0,void 0,function(){var s,a,u,c,l,d,p,v,w,S;return(0,g.Jh)(this,function(E){switch(E.label){case 0:for(s=j(e),a=st(),u=ye(),c=pc(),l=0,d=i;l<d.length;l++)v=t.qn((p=d[l]).metadata.name),p.document&&(a=a.add(v)),u=u.insert(v,t.Un(p)),c=c.insert(v,t.Kn(p.metadata.readTime));return w=s.On.newChangeBuffer({trackRemovals:!0}),[4,$r(s,(x=o,ve(Ur(it.fromString("__bundle__/docs/"+x)))))];case 1:return S=E.sent(),[2,s.persistence.runTransaction("Apply bundle documents","readwrite",function(x){return al(x,w,u,$.min(),c).next(function(L){return w.apply(x),L}).next(function(L){return s.qe.removeMatchingKeysForTargetId(x,S.targetId).next(function(){return s.qe.addMatchingKeys(x,a,S.targetId)}).next(function(){return s.Mn.En(x,L)}).next(function(){return L})})})]}var x})})}function rd(e,t,i){return void 0===i&&(i=st()),(0,g.mG)(this,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,$r(e,ve(ha(t.bundledQuery)))];case 1:return o=a.sent(),[2,(s=j(e)).persistence.runTransaction("Save named query","readwrite",function(u){var c=Mt(t.readTime);if(o.snapshotVersion.compareTo(c)>=0)return s.Ke.saveNamedQuery(u,t);var l=o.withResumeToken(Zt.EMPTY_BYTE_STRING,c);return s.kn=s.kn.insert(l.targetId,l),s.qe.updateTargetData(u,l).next(function(){return s.qe.removeMatchingKeysForTargetId(u,o.targetId)}).next(function(){return s.qe.addMatchingKeys(u,i,o.targetId)}).next(function(){return s.Ke.saveNamedQuery(u,t)})})]}})})}var id=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,i){return O.resolve(this.Qn.get(i))},e.prototype.saveBundleMetadata=function(t,i){var o;return this.Qn.set(i.id,{id:(o=i).id,version:o.version,createTime:Mt(o.createTime)}),O.resolve()},e.prototype.getNamedQuery=function(t,i){return O.resolve(this.jn.get(i))},e.prototype.saveNamedQuery=function(t,i){return this.jn.set(i.name,{name:(o=i).name,query:ha(o.bundledQuery),readTime:Mt(o.readTime)}),O.resolve();var o},e}(),ga=function(){function e(){this.Wn=new Rt(Ot.Gn),this.zn=new Rt(Ot.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,i){var o=new Ot(t,i);this.Wn=this.Wn.add(o),this.zn=this.zn.add(o)},e.prototype.Jn=function(t,i){var o=this;t.forEach(function(s){return o.addReference(s,i)})},e.prototype.removeReference=function(t,i){this.Yn(new Ot(t,i))},e.prototype.Xn=function(t,i){var o=this;t.forEach(function(s){return o.removeReference(s,i)})},e.prototype.Zn=function(t){var i=this,o=new z(new it([])),s=new Ot(o,t),a=new Ot(o,t+1),u=[];return this.zn.forEachInRange([s,a],function(c){i.Yn(c),u.push(c.key)}),u},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(i){return t.Yn(i)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var i=new z(new it([])),o=new Ot(i,t),s=new Ot(i,t+1),a=st();return this.zn.forEachInRange([o,s],function(u){a=a.add(u.key)}),a},e.prototype.containsKey=function(t){var i=new Ot(t,0),o=this.Wn.firstAfterOrEqual(i);return null!==o&&t.isEqual(o.key)},e}(),Ot=function(){function e(t,i){this.key=t,this.ns=i}return e.Gn=function(t,i){return z.comparator(t.key,i.key)||et(t.ns,i.ns)},e.Hn=function(t,i){return et(t.ns,i.ns)||z.comparator(t.key,i.key)},e}(),od=function(){function e(t,i){this.Ut=t,this.referenceDelegate=i,this._n=[],this.ss=1,this.rs=new Rt(Ot.Gn)}return e.prototype.checkEmpty=function(t){return O.resolve(0===this._n.length)},e.prototype.addMutationBatch=function(t,i,o,s){var a=this.ss;this.ss++;var u=new ua(a,i,o,s);this._n.push(u);for(var c=0,l=s;c<l.length;c++){var d=l[c];this.rs=this.rs.add(new Ot(d.key,a)),this.Ut.addToCollectionParentIndex(t,d.key.path.popLast())}return O.resolve(u)},e.prototype.lookupMutationBatch=function(t,i){return O.resolve(this.os(i))},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var s=this.cs(i+1),a=s<0?0:s;return O.resolve(this._n.length>a?this._n[a]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return O.resolve(0===this._n.length?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return O.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=new Ot(i,0),a=new Ot(i,Number.POSITIVE_INFINITY),u=[];return this.rs.forEachInRange([s,a],function(c){var l=o.os(c.ns);u.push(l)}),O.resolve(u)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new Rt(et);return i.forEach(function(a){var u=new Ot(a,0),c=new Ot(a,Number.POSITIVE_INFINITY);o.rs.forEachInRange([u,c],function(l){s=s.add(l.ns)})}),O.resolve(this.us(s))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=i.path,s=o.length+1,a=o;z.isDocumentKey(a)||(a=a.child(""));var u=new Ot(new z(a),0),c=new Rt(et);return this.rs.forEachWhile(function(l){var d=l.key.path;return!!o.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.ns)),!0)},u),O.resolve(this.us(c))},e.prototype.us=function(t){var i=this,o=[];return t.forEach(function(s){var a=i.os(s);null!==a&&o.push(a)}),o},e.prototype.removeMutationBatch=function(t,i){var o=this;X(0===this.hs(i.batchId,"removed")),this._n.shift();var s=this.rs;return O.forEach(i.mutations,function(a){var u=new Ot(a.key,i.batchId);return s=s.delete(u),o.referenceDelegate.markPotentiallyOrphaned(t,a.key)}).next(function(){o.rs=s})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,i){var o=new Ot(i,0),s=this.rs.firstAfterOrEqual(o);return O.resolve(i.isEqual(s&&s.key))},e.prototype.performConsistencyCheck=function(t){return O.resolve()},e.prototype.hs=function(t,i){return this.cs(t)},e.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},e.prototype.os=function(t){var i=this.cs(t);return i<0||i>=this._n.length?null:this._n[i]},e}(),sd=function(){function e(t,i){this.Ut=t,this.ls=i,this.docs=new Ht(z.comparator),this.size=0}return e.prototype.addEntry=function(t,i,o){var s=i.key,a=this.docs.get(s),u=a?a.size:0,c=this.ls(i);return this.docs=this.docs.insert(s,{document:i.clone(),size:c,readTime:o}),this.size+=c-u,this.Ut.addToCollectionParentIndex(t,s.path.popLast())},e.prototype.removeEntry=function(t){var i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)},e.prototype.getEntry=function(t,i){var o=this.docs.get(i);return O.resolve(o?o.document.clone():qt.newInvalidDocument(i))},e.prototype.getEntries=function(t,i){var o=this,s=ye();return i.forEach(function(a){var u=o.docs.get(a);s=s.insert(a,u?u.document.clone():qt.newInvalidDocument(a))}),O.resolve(s)},e.prototype.getDocumentsMatchingQuery=function(t,i,o){for(var s=ye(),a=new z(i.path.child("")),u=this.docs.getIteratorFrom(a);u.hasNext();){var c=u.getNext(),d=c.value,p=d.document,v=d.readTime;if(!i.path.isPrefixOf(c.key.path))break;v.compareTo(o)<=0||Bi(i,p)&&(s=s.insert(p.key,p.clone()))}return O.resolve(s)},e.prototype.fs=function(t,i){return O.forEach(this.docs,function(o){return i(o)})},e.prototype.newChangeBuffer=function(t){return new ad(this)},e.prototype.getSize=function(t){return O.resolve(this.size)},e}(),ad=function(e){function t(i){var o=this;return(o=e.call(this)||this).Ie=i,o}return(0,g.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[];return this.changes.forEach(function(a,u){u.document.isValidDocument()?s.push(o.Ie.addEntry(i,u.document,o.getReadTime(a))):o.Ie.removeEntry(a)}),O.waitFor(s)},t.prototype.getFromCache=function(i,o){return this.Ie.getEntry(i,o)},t.prototype.getAllFromCache=function(i,o){return this.Ie.getEntries(i,o)},t}($c),ud=function(){function e(t){this.persistence=t,this.ds=new Yr(function(i){return qi(i)},Bo),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.ws=0,this._s=new ga,this.targetCount=0,this.ys=ns.Jt()}return e.prototype.forEachTarget=function(t,i){return this.ds.forEach(function(o,s){return i(s)}),O.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return O.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return O.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),O.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.ws&&(this.ws=i),O.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var i=t.targetId;i>this.highestTargetId&&(this.ys=new ns(i),this.highestTargetId=i),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,i){return this.te(i),this.targetCount+=1,O.resolve()},e.prototype.updateTargetData=function(t,i){return this.te(i),O.resolve()},e.prototype.removeTargetData=function(t,i){return this.ds.delete(i.target),this._s.Zn(i.targetId),this.targetCount-=1,O.resolve()},e.prototype.removeTargets=function(t,i,o){var s=this,a=0,u=[];return this.ds.forEach(function(c,l){l.sequenceNumber<=i&&null===o.get(l.targetId)&&(s.ds.delete(c),u.push(s.removeMatchingKeysForTargetId(t,l.targetId)),a++)}),O.waitFor(u).next(function(){return a})},e.prototype.getTargetCount=function(t){return O.resolve(this.targetCount)},e.prototype.getTargetData=function(t,i){var o=this.ds.get(i)||null;return O.resolve(o)},e.prototype.addMatchingKeys=function(t,i,o){return this._s.Jn(i,o),O.resolve()},e.prototype.removeMatchingKeys=function(t,i,o){this._s.Xn(i,o);var s=this.persistence.referenceDelegate,a=[];return s&&i.forEach(function(u){a.push(s.markPotentiallyOrphaned(t,u))}),O.waitFor(a)},e.prototype.removeMatchingKeysForTargetId=function(t,i){return this._s.Zn(i),O.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=this._s.es(i);return O.resolve(o)},e.prototype.containsKey=function(t,i){return O.resolve(this._s.containsKey(i))},e}(),cd=function(){function e(t,i){var o=this;this.gs={},this.Ne=new se(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ud(this),this.Ut=new Ff,this.Ue=new sd(this.Ut,function(u){return o.referenceDelegate.ps(u)}),this.R=new Vc(i),this.Ke=new id(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var i=this.gs[t.toKey()];return i||(i=new od(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=i),i},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var s=this;U("MemoryPersistence","Starting transaction:",t);var a=new ld(this.Ne.next());return this.referenceDelegate.Es(),o(a).next(function(u){return s.referenceDelegate.Ts(a).next(function(){return u})}).toPromise().then(function(u){return a.raiseOnCommittedEvent(),u})},e.prototype.Is=function(t,i){return O.or(Object.values(this.gs).map(function(o){return function(){return o.containsKey(t,i)}}))},e}(),ld=function(e){function t(i){var o=this;return(o=e.call(this)||this).currentSequenceNumber=i,o}return(0,g.ZT)(t,e),t}(Lc),hd=function(){function e(t){this.persistence=t,this.As=new ga,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw K()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,i,o){return this.As.addReference(o,i),this.vs.delete(o.toString()),O.resolve()},e.prototype.removeReference=function(t,i,o){return this.As.removeReference(o,i),this.vs.add(o.toString()),O.resolve()},e.prototype.markPotentiallyOrphaned=function(t,i){return this.vs.add(i.toString()),O.resolve()},e.prototype.removeTarget=function(t,i){var o=this;this.As.Zn(i.targetId).forEach(function(a){return o.vs.add(a.toString())});var s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,i.targetId).next(function(a){a.forEach(function(u){return o.vs.add(u.toString())})}).next(function(){return s.removeTargetData(t,i)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var i=this,o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.vs,function(s){var a=z.fromPath(s);return i.Ps(t,a).next(function(u){u||o.removeEntry(a)})}).next(function(){return i.Rs=null,o.apply(t)})},e.prototype.updateLimboDocument=function(t,i){var o=this;return this.Ps(t,i).next(function(s){s?o.vs.delete(i.toString()):o.vs.add(i.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,i){var o=this;return O.or([function(){return O.resolve(o.As.containsKey(i))},function(){return o.persistence.getTargetCache().containsKey(t,i)},function(){return o.persistence.Is(t,i)}])},e}(),jt=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return null!=this.uid},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();function ll(e,t){return"firestore_clients_"+e+"_"+t}function hl(e,t,i){var o="firestore_mutations_"+e+"_"+i;return t.isAuthenticated()&&(o+="_"+t.uid),o}function ma(e,t){return"firestore_targets_"+e+"_"+t}jt.UNAUTHENTICATED=new jt(null),jt.GOOGLE_CREDENTIALS=new jt("google-credentials-uid"),jt.FIRST_PARTY=new jt("first-party-uid"),jt.MOCK_USER=new jt("mock-user");var fl=function(){function e(t,i,o,s){this.user=t,this.batchId=i,this.state=o,this.error=s}return e.Vs=function(t,i,o){var s,a=JSON.parse(o),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&(u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(s=new N(a.error.code,a.error.message)),u?new e(t,i,a.state,s):(St("SharedClientState","Failed to parse mutation state for ID '"+i+"': "+o),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),va=function(){function e(t,i,o){this.targetId=t,this.state=i,this.error=o}return e.Vs=function(t,i){var o,s=JSON.parse(i),a="object"==typeof s&&-1!==["not-current","current","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return a&&s.error&&(a="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(o=new N(s.error.code,s.error.message)),a?new e(t,s.state,o):(St("SharedClientState","Failed to parse target state for ID '"+t+"': "+i),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),dl=function(){function e(t,i){this.clientId=t,this.activeTargetIds=i}return e.Vs=function(t,i){for(var o=JSON.parse(i),s="object"==typeof o&&o.activeTargetIds instanceof Array,a=Xo(),u=0;s&&u<o.activeTargetIds.length;++u)s=qu(o.activeTargetIds[u]),a=a.add(o.activeTargetIds[u]);return s?new e(t,a):(St("SharedClientState","Failed to parse client data for instance '"+t+"': "+i),null)},e}(),fd=function(){function e(t,i){this.clientId=t,this.onlineState=i}return e.Vs=function(t){var i=JSON.parse(t);return"object"==typeof i&&-1!==["Unknown","Online","Offline"].indexOf(i.onlineState)&&"string"==typeof i.clientId?new e(i.clientId,i.onlineState):(St("SharedClientState","Failed to parse online state: "+t),null)},e}(),ya=function(){function e(){this.activeTargetIds=Xo()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),ba=function(){function e(t,i,o,s,a){this.window=t,this.Se=i,this.persistenceKey=o,this.Ns=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Ht(et),this.started=!1,this.$s=[];var u=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Os=ll(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new ya),this.Ls=new RegExp("^firestore_clients_"+u+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+u+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+u+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks=function(c){return"firestore_bundle_loaded_"+c}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o,s,a,u,c,l,d,p,w=this;return(0,g.Jh)(this,function(S){switch(S.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=S.sent(),i=0,o=t;i<o.length;i++)(s=o[i])!==this.Ns&&(a=this.getItem(ll(this.persistenceKey,s)))&&(u=dl.Vs(s,a))&&(this.Fs=this.Fs.insert(u.clientId,u));for(this.Qs(),(c=this.storage.getItem(this.Us))&&(l=this.js(c))&&this.Ws(l),d=0,p=this.$s;d<p.length;d++)this.ks(p[d]);return this.$s=[],this.window.addEventListener("pagehide",function(){return w.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var i=!1;return this.Fs.forEach(function(o,s){s.activeTargetIds.has(t)&&(i=!0)}),i},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,i,o){this.zs(t,i,o),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var i="not-current";if(this.isActiveQueryTarget(t)){var o=this.storage.getItem(ma(this.persistenceKey,t));if(o){var s=va.Vs(t,o);s&&(i=s.state)}}return this.Js.Ds(t),this.Qs(),i},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(ma(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,i,o){this.Ys(t,i,o)},e.prototype.handleUserChange=function(t,i,o){var s=this;i.forEach(function(a){s.Hs(a)}),this.currentUser=t,o.forEach(function(a){s.addPendingMutation(a)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var i=this.storage.getItem(t);return U("SharedClientState","READ",t,i),i},e.prototype.setItem=function(t,i){U("SharedClientState","SET",t,i),this.storage.setItem(t,i)},e.prototype.removeItem=function(t){U("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var i=this,o=t;if(o.storageArea===this.storage){if(U("SharedClientState","EVENT",o.key,o.newValue),o.key===this.Os)return void St("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,g.mG)(i,void 0,void 0,function(){var s,a,u,c,l,d;return(0,g.Jh)(this,function(p){if(this.started){if(null!==o.key)if(this.Ls.test(o.key)){if(null==o.newValue)return s=this.ti(o.key),[2,this.ei(s,null)];if(a=this.ni(o.key,o.newValue))return[2,this.ei(a.clientId,a)]}else if(this.Bs.test(o.key)){if(null!==o.newValue&&(u=this.si(o.key,o.newValue)))return[2,this.ii(u)]}else if(this.qs.test(o.key)){if(null!==o.newValue&&(c=this.ri(o.key,o.newValue)))return[2,this.oi(c)]}else if(o.key===this.Us){if(null!==o.newValue&&(l=this.js(o.newValue)))return[2,this.Ws(l)]}else if(o.key===this.Ms)(d=function(v){var w=se.o;if(null!=v)try{var S=JSON.parse(v);X("number"==typeof S),w=S}catch(E){St("SharedClientState","Failed to read sequence number from WebStorage",E)}return w}(o.newValue))!==se.o&&this.sequenceNumberHandler(d);else if(o.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(o);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,i,o){var s=new fl(this.currentUser,t,i,o),a=hl(this.persistenceKey,this.currentUser,t);this.setItem(a,s.Ss())},e.prototype.Hs=function(t){var i=hl(this.persistenceKey,this.currentUser,t);this.removeItem(i)},e.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},e.prototype.Ys=function(t,i,o){var s=ma(this.persistenceKey,t),a=new va(t,i,o);this.setItem(s,a.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var i=this.Ls.exec(t);return i?i[1]:null},e.prototype.ni=function(t,i){var o=this.ti(t);return dl.Vs(o,i)},e.prototype.si=function(t,i){var o=this.Bs.exec(t),s=Number(o[1]);return fl.Vs(new jt(void 0!==o[2]?o[2]:null),s,i)},e.prototype.ri=function(t,i){var o=this.qs.exec(t),s=Number(o[1]);return va.Vs(s,i)},e.prototype.js=function(t){return fd.Vs(t)},e.prototype.ii=function(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(i){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(U("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,i){var o=this,s=i?this.Fs.insert(t,i):this.Fs.remove(t),a=this.Gs(this.Fs),u=this.Gs(s),c=[],l=[];return u.forEach(function(d){a.has(d)||c.push(d)}),a.forEach(function(d){u.has(d)||l.push(d)}),this.syncEngine.hi(c,l).then(function(){o.Fs=s})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var i=Xo();return t.forEach(function(o,s){i=i.unionWith(s.activeTargetIds)}),i},e}(),pl=function(){function e(){this.li=new ya,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,i,o){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,i,o){this.fi[t]=i},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new ya,Promise.resolve()},e.prototype.handleUserChange=function(t,i,o){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),dd=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),gl=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(0)},e.prototype.yi=function(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(1)},e.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},e}(),pd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},gd=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),md=function(e){function t(i){var o=this;return(o=e.call(this,i)||this).forceLongPolling=i.forceLongPolling,o.autoDetectLongPolling=i.autoDetectLongPolling,o.useFetchStreams=i.useFetchStreams,o}return(0,g.ZT)(t,e),t.prototype.Fi=function(i,o,s,a){return new Promise(function(u,c){var l=new Pu;l.listenOnce(Ru.COMPLETE,function(){try{switch(l.getLastErrorCode()){case Uo.NO_ERROR:var p=l.getResponseJson();U("Connection","XHR received:",JSON.stringify(p)),u(p);break;case Uo.TIMEOUT:U("Connection",'RPC "'+i+'" timed out'),c(new N(A.DEADLINE_EXCEEDED,"Request time out"));break;case Uo.HTTP_ERROR:var v=l.getStatus();if(U("Connection",'RPC "'+i+'" failed with status:',v,"response text:",l.getResponseText()),v>0){var w=l.getResponseJson().error;if(w&&w.status&&w.message){var S=(x=w.status.toLowerCase().replace(/_/g,"-"),Object.values(A).indexOf(x)>=0?x:A.UNKNOWN);c(new N(S,w.message))}else c(new N(A.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new N(A.UNAVAILABLE,"Connection failed."));break;default:K()}}finally{U("Connection",'RPC "'+i+'" completed.')}var x});var d=JSON.stringify(a);l.send(o,"POST",d,s,15)})},t.prototype.Oi=function(i,o){var s=[this.Di,"/","google.firestore.v1.Firestore","/",i,"/channel"],a=new Fo,u=Sr(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new ku({})),this.ki(c.initMessageHeaders,o),(0,_.uI)()||(0,_.b$)()||(0,_.d)()||(0,_.w1)()||(0,_.Mn)()||(0,_.ru)()||(c.httpHeadersOverwriteParam="$httpHeaders");var l=s.join("");U("Connection","Creating WebChannel: "+l,c);var d=a.createWebChannel(l,c),p=!1,v=!1,w=new gd({Ei:function(E){v?U("Connection","Not sending because WebChannel is closed:",E):(p||(U("Connection","Opening WebChannel transport."),d.open(),p=!0),U("Connection","WebChannel sending:",E),d.send(E))},Ti:function(){return d.close()}}),S=function(E,x,L){E.listen(x,function(V){try{L(V)}catch(H){setTimeout(function(){throw H},0)}})};return S(d,Mi.EventType.OPEN,function(){v||U("Connection","WebChannel transport opened.")}),S(d,Mi.EventType.CLOSE,function(){v||(v=!0,U("Connection","WebChannel transport closed"),w.Vi())}),S(d,Mi.EventType.ERROR,function(E){v||(v=!0,Oi("Connection","WebChannel transport errored:",E),w.Vi(new N(A.UNAVAILABLE,"The operation could not be completed")))}),S(d,Mi.EventType.MESSAGE,function(E){var x;if(!v){var L=E.data[0];X(!!L);var H=L.error||(null===(x=L[0])||void 0===x?void 0:x.error);if(H){U("Connection","WebChannel received error:",H);var Q=H.status,tt=function(at){var Bt=At[at];if(void 0!==Bt)return fc(Bt)}(Q),rt=H.message;void 0===tt&&(tt=A.INTERNAL,rt="Unknown error status: "+Q+" with message "+H.message),v=!0,w.Vi(new N(tt,rt)),d.close()}else U("Connection","WebChannel received:",L),w.Si(L)}}),S(u,Du.STAT_EVENT,function(E){E.stat===Bs_PROXY?U("Connection","Detected buffering proxy"):E.stat===Bs_NOPROXY&&U("Connection","Detected no buffering proxy")}),setTimeout(function(){w.Pi()},0),w},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,i,o,s){var a=this.xi(t,i);U("RestConnection","Sending: ",a,o);var u={};return this.ki(u,s),this.Fi(t,a,u,o).then(function(c){return U("RestConnection","Received: ",c),c},function(c){throw Oi("RestConnection",t+" failed with error: ",c,"url: ",a,"request:",o),c})},e.prototype.$i=function(t,i,o,s){return this.Ni(t,i,o,s)},e.prototype.ki=function(t,i){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i)for(var o in i.authHeaders)i.authHeaders.hasOwnProperty(o)&&(t[o]=i.authHeaders[o])},e.prototype.xi=function(t,i){return this.Di+"/v1/"+i+":"+pd[t]},e}());function ml(){return"undefined"!=typeof window?window:null}function as(){return"undefined"!=typeof document?document:null}function Yi(e){return new wf(e,!0)}var _a=function(){function e(t,i,o,s,a){void 0===o&&(o=1e3),void 0===s&&(s=1.5),void 0===a&&(a=6e4),this.Se=t,this.timerId=i,this.Mi=o,this.Li=s,this.Bi=a,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var i=this;this.cancel();var o=Math.floor(this.qi+this.Wi()),s=Math.max(0,Date.now()-this.Ki),a=Math.max(0,o-s);a>0&&U("ExponentialBackoff","Backing off for "+a+" ms (base delay: "+this.qi+" ms, delay with jitter: "+o+" ms, last attempt: "+s+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,a,function(){return i.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),vl=function(){function e(t,i,o,s,a,u){this.Se=t,this.zi=o,this.Hi=s,this.Ji=a,this.listener=u,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new _a(t,i)}return e.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},e.prototype.er=function(){return 2===this.state},e.prototype.start=function(){3!==this.state?this.auth():this.nr()},e.prototype.stop=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,i){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(o){switch(o.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():i&&i.code===A.RESOURCE_EXHAUSTED?(St(i.toString()),St("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):i&&i.code===A.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(i)];case 1:return o.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var i=this.hr(this.Yi),o=this.Yi;this.Ji.getToken().then(function(s){t.Yi===o&&t.lr(s)},function(s){i(function(){var a=new N(A.UNKNOWN,"Fetching auth token failed: "+s.message);return t.dr(a)})})},e.prototype.lr=function(t){var i=this,o=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){o(function(){return i.state=2,i.listener.Ii()})}),this.stream.Ri(function(s){o(function(){return i.dr(s)})}),this.stream.onMessage(function(s){o(function(){return i.onMessage(s)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,g.mG)(t,void 0,void 0,function(){return(0,g.Jh)(this,function(i){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return U("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var i=this;return function(o){i.Se.enqueueAndForget(function(){return i.Yi===t?o():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),vd=function(e){function t(i,o,s,a,u){var c=this;return(c=e.call(this,i,"listen_stream_connection_backoff","listen_stream_idle",o,s,u)||this).R=a,c}return(0,g.ZT)(t,e),t.prototype.wr=function(i){return this.Hi.Oi("Listen",i)},t.prototype.onMessage=function(i){this.Zi.reset();var o=function(a,u){var c,L;if("targetChange"in u){var l="NO_CHANGE"===(L=u.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===L?1:"REMOVE"===L?2:"CURRENT"===L?3:"RESET"===L?4:K(),d=u.targetChange.targetIds||[],p=function(L,V){return L.I?(X(void 0===V||"string"==typeof V),Zt.fromBase64String(V||"")):(X(void 0===V||V instanceof Uint8Array),Zt.fromUint8Array(V||new Uint8Array))}(a,u.targetChange.resumeToken),v=(w=u.targetChange.cause)&&function(L){var V=void 0===L.code?A.UNKNOWN:fc(L.code);return new N(V,L.message||"")}(w);c=new mc(l,d,p,v||null)}else if("documentChange"in u){d=De(a,(l=u.documentChange).document.name),p=Mt(l.document.updateTime);var w=new ae({mapValue:{fields:l.document.fields}}),S=(v=qt.newFoundDocument(d,p,w),l.targetIds||[]);c=new Yo(S,l.removedTargetIds||[],v.key,v)}else if("documentDelete"in u)d=De(a,(l=u.documentDelete).document),p=l.readTime?Mt(l.readTime):$.min(),w=qt.newNoDocument(d,p),c=new Yo([],v=l.removedTargetIds||[],w.key,w);else if("documentRemove"in u)d=De(a,(l=u.documentRemove).document),c=new Yo([],p=l.removedTargetIds||[],d,null);else{if(!("filter"in u))return K();var x=u.filter;d=new ff(l=x.count||0),c=new gc(p=x.targetId,d)}return c}(this.R,i),s=function(a){if(!("targetChange"in a))return $.min();var u=a.targetChange;return u.targetIds&&u.targetIds.length?$.min():u.readTime?Mt(u.readTime):$.min()}(i);return this.listener._r(o,s)},t.prototype.mr=function(i){var a,u,c,l,o={};o.database=Ji(this.R),o.addTarget=(a=this.R,(c=Go(l=(u=i).target)?{documents:Ac(a,l)}:{query:xc(a,l)}).targetId=u.targetId,u.resumeToken.approximateByteSize()>0?c.resumeToken=_c(a,u.resumeToken):u.snapshotVersion.compareTo($.min())>0&&(c.readTime=Hi(a,u.snapshotVersion.toTimestamp())),c);var s=function(a,u){var c=function(l,d){switch(d){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return K()}}(0,u.purpose);return null==c?null:{"goog-listen-tags":c}}(0,i);s&&(o.labels=s),this.cr(o)},t.prototype.yr=function(i){var o={};o.database=Ji(this.R),o.removeTarget=i,this.cr(o)},t}(vl),yd=function(e){function t(i,o,s,a,u){var c=this;return(c=e.call(this,i,"write_stream_connection_backoff","write_stream_idle",o,s,u)||this).R=a,c.gr=!1,c}return(0,g.ZT)(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(i){return this.Hi.Oi("Write",i)},t.prototype.onMessage=function(i){if(X(!!i.streamToken),this.lastStreamToken=i.streamToken,this.gr){this.Zi.reset();var o=(u=i.commitTime,(a=i.writeResults)&&a.length>0?(X(void 0!==u),a.map(function(c){return d=u,(p=Mt((l=c).updateTime?l.updateTime:d)).isEqual($.min())&&(p=Mt(d)),new cf(p,l.transformResults||[]);var l,d,p})):[]),s=Mt(i.commitTime);return this.listener.Tr(s,o)}var a,u;return X(!i.writeResults||0===i.writeResults.length),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var i={};i.database=Ji(this.R),this.cr(i)},t.prototype.Er=function(i){var o=this,s={streamToken:this.lastStreamToken,writes:i.map(function(a){return $o(o.R,a)})};this.cr(s)},t}(vl),bd=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).credentials=i,a.Hi=o,a.R=s,a.Rr=!1,a}return(0,g.ZT)(t,e),t.prototype.br=function(){if(this.Rr)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(i,o,s){var a=this;return this.br(),this.credentials.getToken().then(function(u){return a.Hi.Ni(i,o,s,u)}).catch(function(u){throw"FirebaseError"===u.name?(u.code===A.UNAUTHENTICATED&&a.credentials.invalidateToken(),u):new N(A.UNKNOWN,u.toString())})},t.prototype.$i=function(i,o,s){var a=this;return this.br(),this.credentials.getToken().then(function(u){return a.Hi.$i(i,o,s,u)}).catch(function(u){throw"FirebaseError"===u.name?(u.code===A.UNAUTHENTICATED&&a.credentials.invalidateToken(),u):new N(A.UNKNOWN,u.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),_d=function(){function e(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var i="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(St(i),this.Vr=!1):U("OnlineStateTracker",i)},e.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},e}(),wd=function(e,t,i,o,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=s,this.Lr.di(function(u){i.enqueueAndForget(function(){return(0,g.mG)(a,void 0,void 0,function(){return(0,g.Jh)(this,function(c){switch(c.label){case 0:return bn(this)?(U("RemoteStore","Restarting streams for network reachability change."),[4,function(l){return(0,g.mG)(this,void 0,void 0,function(){var d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:return(d=j(l)).Or.add(4),[4,ei(d)];case 1:return p.sent(),d.Br.set("Unknown"),d.Or.delete(4),[4,$i(d)];case 2:return p.sent(),[2]}})})}(this)]):[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})})}),this.Br=new _d(i,o)};function $i(e){return(0,g.mG)(this,void 0,void 0,function(){var t,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:if(!bn(e))return[3,4];t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!0)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function ei(e){return(0,g.mG)(this,void 0,void 0,function(){var t,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!1)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function us(e,t){var i=j(e);i.$r.has(t.targetId)||(i.$r.set(t.targetId,t),Ia(i)?Ta(i):ri(i).er()&&wa(i,t))}function to(e,t){var i=j(e),o=ri(i);i.$r.delete(t),o.er()&&yl(i,t),0===i.$r.size&&(o.er()?o.ir():bn(i)&&i.Br.set("Unknown"))}function wa(e,t){e.qr.U(t.targetId),ri(e).mr(t)}function yl(e,t){e.qr.U(t),ri(e).yr(t)}function Ta(e){e.qr=new yf({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),ri(e).start(),e.Br.Sr()}function Ia(e){return bn(e)&&!ri(e).tr()&&e.$r.size>0}function bn(e){return 0===j(e).Or.size}function bl(e){e.qr=void 0}function Td(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return e.$r.forEach(function(i,o){wa(e,i)}),[2]})})}function Id(e,t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(i){return bl(e),Ia(e)?(e.Br.Nr(t),Ta(e)):e.Br.set("Unknown"),[2]})})}function Ed(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:if(e.Br.set("Online"),!(t instanceof mc&&2===t.state&&t.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(c,l){return(0,g.mG)(this,void 0,void 0,function(){var d,p,v,w;return(0,g.Jh)(this,function(S){switch(S.label){case 0:d=l.cause,p=0,v=l.targetIds,S.label=1;case 1:return p<v.length?c.$r.has(w=v[p])?[4,c.remoteSyncer.rejectListen(w,d)]:[3,3]:[3,5];case 2:S.sent(),c.$r.delete(w),c.qr.removeTarget(w),S.label=3;case 3:S.label=4;case 4:return p++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),U("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),o),[4,cs(e,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Yo?e.qr.X(t):t instanceof gc?e.qr.rt(t):e.qr.et(t),i.isEqual($.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,sl(e.localStore)];case 8:return s=u.sent(),i.compareTo(s)>=0?[4,(c=e,l=i,d=c.qr.ut(l),d.targetChanges.forEach(function(p,v){if(p.resumeToken.approximateByteSize()>0){var w=c.$r.get(v);w&&c.$r.set(v,w.withResumeToken(p.resumeToken,l))}}),d.targetMismatches.forEach(function(p){var v=c.$r.get(p);if(v){c.$r.set(p,v.withResumeToken(Zt.EMPTY_BYTE_STRING,v.snapshotVersion)),yl(c,p);var w=new ts(v.target,p,1,v.sequenceNumber);wa(c,w)}}),c.remoteSyncer.applyRemoteEvent(d))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return U("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,cs(e,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,l,d})})}function cs(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:if(!Wn(t))throw t;return e.Or.add(1),[4,ei(e)];case 1:return s.sent(),e.Br.set("Offline"),i||(i=function(){return sl(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return(0,g.mG)(o,void 0,void 0,function(){return(0,g.Jh)(this,function(a){switch(a.label){case 0:return U("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return a.sent(),e.Or.delete(1),[4,$i(e)];case 2:return a.sent(),[2]}})})}),[2]}})})}function _l(e,t){return t().catch(function(i){return cs(e,i,t)})}function ni(e){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:t=j(e),i=_n(t),o=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,u.label=1;case 1:if(!(bn(c=t)&&c.Fr.length<10))return[3,7];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,td(t.localStore,o)];case 3:return null===(s=u.sent())?(0===t.Fr.length&&i.ir(),[3,7]):(o=s.batchId,function(c,l){c.Fr.push(l);var d=_n(c);d.er()&&d.pr&&d.Er(l.mutations)}(t,s),[3,6]);case 4:return a=u.sent(),[4,cs(t,a)];case 5:return u.sent(),[3,6];case 6:return[3,1];case 7:return wl(t)&&Tl(t),[2]}var c})})}function wl(e){return bn(e)&&!_n(e).tr()&&e.Fr.length>0}function Tl(e){_n(e).start()}function Sd(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return _n(e).Ar(),[2]})})}function Cd(e){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o;return(0,g.Jh)(this,function(a){for(t=_n(e),i=0,o=e.Fr;i<o.length;i++)t.Er(o[i].mutations);return[2]})})}function Ad(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return o=e.Fr.shift(),s=Of.from(o,t,i),[4,_l(e,function(){return e.remoteSyncer.applySuccessfulWrite(s)})];case 1:return a.sent(),[4,ni(e)];case 2:return a.sent(),[2]}})})}function xd(e,t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(i){switch(i.label){case 0:return t&&_n(e).pr?[4,function(o,s){return(0,g.mG)(this,void 0,void 0,function(){var a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return hc(u=s.code)&&u!==A.ABORTED?(a=o.Fr.shift(),_n(o).sr(),[4,_l(o,function(){return o.remoteSyncer.rejectFailedWrite(a.batchId,s)})]):[3,3];case 1:return c.sent(),[4,ni(o)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return wl(e)&&Tl(e),[2]}})})}function Ea(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return i=j(e),t?(i.Or.delete(2),[4,$i(i)]):[3,2];case 1:return o.sent(),[3,5];case 2:return t?[3,4]:(i.Or.add(2),[4,ei(i)]);case 3:o.sent(),i.Br.set("Unknown"),o.label=4;case 4:o.label=5;case 5:return[2]}})})}function ri(e){var i,o,s,a,t=this;return e.Ur||(e.Ur=(i=e.datastore,o=e.asyncQueue,s={Ii:Td.bind(null,e),Ri:Id.bind(null,e),_r:Ed.bind(null,e)},(a=j(i)).br(),new vd(o,a.Hi,a.credentials,a.R,s)),e.Mr.push(function(i){return(0,g.mG)(t,void 0,void 0,function(){return(0,g.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Ur.sr(),Ia(e)?Ta(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:o.sent(),bl(e),o.label=3;case 3:return[2]}})})})),e.Ur}function _n(e){var i,o,s,a,t=this;return e.Kr||(e.Kr=(i=e.datastore,o=e.asyncQueue,s={Ii:Sd.bind(null,e),Ri:xd.bind(null,e),Ir:Cd.bind(null,e),Tr:Ad.bind(null,e)},(a=j(i)).br(),new yd(o,a.Hi,a.credentials,a.R,s)),e.Mr.push(function(i){return(0,g.mG)(t,void 0,void 0,function(){return(0,g.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Kr.sr(),[4,ni(e)]):[3,2];case 1:return o.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:o.sent(),e.Fr.length>0&&(U("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),o.label=4;case 4:return[2]}})})})),e.Kr}var Rd=function(){function e(t,i,o,s,a){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=o,this.op=s,this.removalCallback=a,this.deferred=new Jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(u){})}return e.createAndSchedule=function(t,i,o,s,a){var u=new e(t,i,Date.now()+o,s,a);return u.start(o),u},e.prototype.start=function(t){var i=this;this.timerHandle=setTimeout(function(){return i.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(A.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(i){return t.deferred.resolve(i)})):Promise.resolve()})},e.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function ii(e,t){if(St("AsyncQueue",t+": "+e),Wn(e))return new N(A.UNAVAILABLE,t+": "+e);throw e}var Il=function(){function e(t){this.comparator=t?function(i,o){return t(i,o)||z.comparator(i.key,o.key)}:function(i,o){return z.comparator(i.key,o.key)},this.keyedMap=na(),this.sortedSet=new Ht(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return null!=this.keyedMap.get(t)},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.add=function(t){var i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))},e.prototype.delete=function(t){var i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.sortedSet.getIterator(),o=t.sortedSet.getIterator();i.hasNext();){var s=i.getNext().key,a=o.getNext().key;if(!s.isEqual(a))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(i){t.push(i.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},e.prototype.copy=function(t,i){var o=new e;return o.comparator=this.comparator,o.keyedMap=t,o.sortedSet=i,o},e}(),El=function(){function e(){this.Qr=new Ht(z.comparator)}return e.prototype.track=function(t){var i=t.doc.key,o=this.Qr.get(i);o?0!==t.type&&3===o.type?this.Qr=this.Qr.insert(i,t):3===t.type&&1!==o.type?this.Qr=this.Qr.insert(i,{type:o.type,doc:t.doc}):2===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):2===t.type&&0===o.type?this.Qr=this.Qr.insert(i,{type:0,doc:t.doc}):1===t.type&&0===o.type?this.Qr=this.Qr.remove(i):1===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:1,doc:o.doc}):0===t.type&&1===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):K():this.Qr=this.Qr.insert(i,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(i,o){t.push(o)}),t},e}(),ls=function(){function e(t,i,o,s,a,u,c,l){this.query=t,this.docs=i,this.oldDocs=o,this.docChanges=s,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=c,this.excludesMetadataChanges=l}return e.fromInitialDocuments=function(t,i,o,s){var a=[];return i.forEach(function(u){a.push({type:0,doc:u})}),new e(t,i,Il.emptySet(i),a,o,s,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ji(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var i=this.docChanges,o=t.docChanges;if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++)if(i[s].type!==o[s].type||!i[s].doc.isEqual(o[s].doc))return!1;return!0},e}(),Dd=function(){this.Wr=void 0,this.listeners=[]},kd=function(){this.queries=new Yr(function(e){return Wu(e)},ji),this.onlineState="Unknown",this.Gr=new Set};function Sa(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c,l;return(0,g.Jh)(this,function(d){switch(d.label){case 0:if(i=j(e),s=!1,(a=i.queries.get(o=t.query))||(s=!0,a=new Dd),!s)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),u=a,[4,i.onListen(o)];case 2:return u.Wr=d.sent(),[3,4];case 3:return c=d.sent(),l=ii(c,"Initialization of query '"+$s(t.query)+"' failed"),[2,void t.onError(l)];case 4:return i.queries.set(o,a),a.listeners.push(t),t.zr(i.onlineState),a.Wr&&t.Hr(a.Wr)&&Aa(i),[2]}})})}function Ca(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,g.Jh)(this,function(c){return i=j(e),s=!1,(a=i.queries.get(o=t.query))&&(u=a.listeners.indexOf(t))>=0&&(a.listeners.splice(u,1),s=0===a.listeners.length),s?[2,(i.queries.delete(o),i.onUnlisten(o))]:[2]})})}function Pd(e,t){for(var i=j(e),o=!1,s=0,a=t;s<a.length;s++){var u=a[s],l=i.queries.get(u.query);if(l){for(var d=0,p=l.listeners;d<p.length;d++)p[d].Hr(u)&&(o=!0);l.Wr=u}}o&&Aa(i)}function Nd(e,t,i){var o=j(e),s=o.queries.get(t);if(s)for(var a=0,u=s.listeners;a<u.length;a++)u[a].onError(i);o.queries.delete(t)}function Aa(e){e.Gr.forEach(function(t){t.next()})}var xa=function(){function e(t,i,o){this.query=t,this.Jr=i,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=o||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var i=[],o=0,s=t.docChanges;o<s.length;o++){var a=s[o];3!==a.type&&i.push(a)}t=new ls(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var u=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),u=!0):this.eo(t,this.onlineState)&&(this.no(t),u=!0),this.Xr=t,u},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var i=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),i=!0),i},e.prototype.eo=function(t,i){return!t.fromCache||!(this.options.so&&"Offline"!==i||t.docs.isEmpty()&&"Offline"!==i)},e.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},e.prototype.no=function(t){t=ls.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),Md=function(){function e(t,i){this.payload=t,this.byteLength=i}return e.prototype.io=function(){return"metadata"in this.payload},e}(),Sl=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return De(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?Sc(this.R,t.document,!1):qt.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return Mt(t)},e}();!function(){function e(t,i,o){this.ro=t,this.localStore=i,this.R=o,this.queries=[],this.documents=[],this.progress=function Cl(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(t)}e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var i=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++i):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++i),i!==this.progress.documentsLoaded?(this.progress.documentsLoaded=i,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var i=new Map,o=new Sl(this.R),s=0,a=t;s<a.length;s++){var u=a[s];if(u.metadata.queries)for(var c=o.qn(u.metadata.name),l=0,d=u.metadata.queries;l<d.length;l++){var p=d[l],v=(i.get(p)||st()).add(c);i.set(p,v)}}return i},e.prototype.complete=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return[4,nd(this.localStore,new Sl(this.R),this.documents,this.ro.id)];case 1:t=u.sent(),i=this.co(this.documents),o=0,s=this.queries,u.label=2;case 2:return o<s.length?[4,rd(this.localStore,a=s[o],i.get(a.name))]:[3,5];case 3:u.sent(),u.label=4;case 4:return o++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Zf(Object.assign({},this.progress),t))]}})})}}();var Al=function(e){this.key=e},xl=function(e){this.key=e},Rl=function(){function e(t,i){this.query=t,this.uo=i,this.ao=null,this.current=!1,this.ho=st(),this.mutatedKeys=st(),this.lo=Xu(t),this.fo=new Il(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,i){var o=this,s=i?i.mo:new El,a=i?i.fo:this.fo,u=i?i.mutatedKeys:this.mutatedKeys,c=a,l=!1,d=zo(this.query)&&a.size===this.query.limit?a.last():null,p=Ho(this.query)&&a.size===this.query.limit?a.first():null;if(t.inorderTraversal(function(w,S){var E=a.get(w),x=Bi(o.query,S)?S:null,L=!!E&&o.mutatedKeys.has(E.key),V=!!x&&(x.hasLocalMutations||o.mutatedKeys.has(x.key)&&x.hasCommittedMutations),H=!1;E&&x?E.data.isEqual(x.data)?L!==V&&(s.track({type:3,doc:x}),H=!0):o.yo(E,x)||(s.track({type:2,doc:x}),H=!0,(d&&o.lo(x,d)>0||p&&o.lo(x,p)<0)&&(l=!0)):!E&&x?(s.track({type:0,doc:x}),H=!0):E&&!x&&(s.track({type:1,doc:E}),H=!0,(d||p)&&(l=!0)),H&&(x?(c=c.add(x),u=V?u.add(w):u.delete(w)):(c=c.delete(w),u=u.delete(w)))}),zo(this.query)||Ho(this.query))for(;c.size>this.query.limit;){var v=zo(this.query)?c.last():c.first();c=c.delete(v.key),u=u.delete(v.key),s.track({type:1,doc:v})}return{fo:c,mo:s,Nn:l,mutatedKeys:u}},e.prototype.yo=function(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations},e.prototype.applyChanges=function(t,i,o){var s=this,a=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var u=t.mo.jr();u.sort(function(p,v){return S=v.type,(E=function(x){switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K()}})(p.type)-E(S)||s.lo(p.doc,v.doc);var S,E}),this.po(o);var c=i?this.Eo():[],l=0===this.ho.size&&this.current?1:0,d=l!==this.ao;return this.ao=l,0!==u.length||d?{snapshot:new ls(this.query,t.fo,a,u,t.mutatedKeys,0===l,d,!1),To:c}:{To:c}},e.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new El,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var i=this;t&&(t.addedDocuments.forEach(function(o){return i.uo=i.uo.add(o)}),t.modifiedDocuments.forEach(function(o){}),t.removedDocuments.forEach(function(o){return i.uo=i.uo.delete(o)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var i=this.ho;this.ho=st(),this.fo.forEach(function(s){t.Io(s.key)&&(t.ho=t.ho.add(s.key))});var o=[];return i.forEach(function(s){t.ho.has(s)||o.push(new xl(s))}),this.ho.forEach(function(s){i.has(s)||o.push(new Al(s))}),o},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=st();var i=this._o(t.documents);return this.applyChanges(i,!0)},e.prototype.Ro=function(){return ls.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},e}(),Ld=function(e,t,i){this.query=e,this.targetId=t,this.view=i},Fd=function(e){this.key=e,this.bo=!1},Ud=function(){function e(t,i,o,s,a,u){this.localStore=t,this.remoteStore=i,this.eventManager=o,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.vo={},this.Po=new Yr(function(c){return Wu(c)},ji),this.Vo=new Map,this.So=new Set,this.Do=new Ht(z.comparator),this.Co=new Map,this.No=new ga,this.xo={},this.ko=new Map,this.Fo=ns.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),e}();function qd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,s,a,u,c;return(0,g.Jh)(this,function(l){switch(l.label){case 0:return i=Ma(e),(a=i.Po.get(t))?(i.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.Ro(),[3,4]):[3,1];case 1:return[4,$r(i.localStore,ve(t))];case 2:return u=l.sent(),c=i.sharedClientState.addLocalQueryTarget(u.targetId),[4,Ra(i,t,u.targetId,"current"===c)];case 3:s=l.sent(),i.isPrimaryClient&&us(i.remoteStore,u),l.label=4;case 4:return[2,s]}})})}function Ra(e,t,i,o){return(0,g.mG)(this,void 0,void 0,function(){var s,a,u,c,l,d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:return e.Oo=function(v,w,S){return function(E,x,L,V){return(0,g.mG)(this,void 0,void 0,function(){var H,Q,tt;return(0,g.Jh)(this,function(rt){switch(rt.label){case 0:return(H=x.view._o(L)).Nn?[4,ss(E.localStore,x.query,!1).then(function(at){return x.view._o(at.documents,H)})]:[3,2];case 1:H=rt.sent(),rt.label=2;case 2:return Q=V&&V.targetChanges.get(x.targetId),tt=x.view.applyChanges(H,E.isPrimaryClient,Q),[2,(Pa(E,x.targetId,tt.To),tt.snapshot)]}})})}(e,v,w,S)},[4,ss(e.localStore,t,!0)];case 1:return s=p.sent(),a=new Rl(t,s.Bn),u=a._o(s.documents),c=ia.createSynthesizedTargetChangeForCurrentChange(i,o&&"Offline"!==e.onlineState),l=a.applyChanges(u,e.isPrimaryClient,c),Pa(e,i,l.To),d=new Ld(t,i,a),[2,(e.Po.set(t,d),e.Vo.has(i)?e.Vo.get(i).push(t):e.Vo.set(i,[t]),l.snapshot)]}})})}function Vd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return i=j(e),o=i.Po.get(t),(s=i.Vo.get(o.targetId)).length>1?[2,(i.Vo.set(o.targetId,s.filter(function(u){return!ji(u,t)})),void i.Po.delete(t))]:i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)?[3,2]:[4,ti(i.localStore,o.targetId,!1).then(function(){i.sharedClientState.clearQueryState(o.targetId),to(i.remoteStore,o.targetId),oi(i,o.targetId)}).catch(Yn)]):[3,3];case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return oi(i,o.targetId),[4,ti(i.localStore,o.targetId,!0)];case 4:a.sent(),a.label=5;case 5:return[2]}})})}function jd(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:o=Oa(e),c.label=1;case 1:return c.trys.push([1,5,,6]),[4,(l=o.localStore,d=t,v=j(l),w=ee.now(),S=d.reduce(function(E,x){return E.add(x.key)},st()),v.persistence.runTransaction("Locally write mutations","readwrite",function(E){return v.Mn.pn(E,S).next(function(x){p=x;for(var L=[],V=0,H=d;V<H.length;V++){var Q=H[V],tt=hf(Q,p.get(Q.key));null!=tt&&L.push(new dn(Q.key,tt,Gu(tt.value.mapValue),zt.exists(!0)))}return v._n.addMutationBatch(E,w,L,d)})}).then(function(E){return E.applyToLocalDocumentSet(p),{batchId:E.batchId,changes:p}}))];case 2:return s=c.sent(),o.sharedClientState.addPendingMutation(s.batchId),function(l,d,p){var v=l.xo[l.currentUser.toKey()];v||(v=new Ht(et)),v=v.insert(d,p),l.xo[l.currentUser.toKey()]=v}(o,s.batchId,i),[4,ze(o,s.changes)];case 3:return c.sent(),[4,ni(o.remoteStore)];case 4:return c.sent(),[3,6];case 5:return a=c.sent(),u=ii(a,"Failed to persist write"),i.reject(u),[3,6];case 6:return[2]}var l,d,p,v,w,S})})}function Dl(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:i=j(e),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,$f(i.localStore,t)];case 2:return o=s.sent(),t.targetChanges.forEach(function(a,u){var c=i.Co.get(u);c&&(X(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?c.bo=!0:a.modifiedDocuments.size>0?X(c.bo):a.removedDocuments.size>0&&(X(c.bo),c.bo=!1))}),[4,ze(i,o,t)];case 3:return s.sent(),[3,6];case 4:return[4,Yn(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}})})}function kl(e,t,i){var o=j(e);if(o.isPrimaryClient&&0===i||!o.isPrimaryClient&&1===i){var s=[];o.Po.forEach(function(a,u){var c=u.view.zr(t);c.snapshot&&s.push(c.snapshot)}),function(a,u){var c=j(a);c.onlineState=u;var l=!1;c.queries.forEach(function(d,p){for(var v=0,w=p.listeners;v<w.length;v++)w[v].zr(u)&&(l=!0)}),l&&Aa(c)}(o.eventManager,t),s.length&&o.vo._r(s),o.onlineState=t,o.isPrimaryClient&&o.sharedClientState.setOnlineState(t)}}function Bd(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return(o=j(e)).sharedClientState.updateQueryState(t,"rejected",i),s=o.Co.get(t),(a=s&&s.key)?(u=(u=new Ht(z.comparator)).insert(a,qt.newNoDocument(a,$.min())),c=st().add(a),l=new ra($.min(),new Map,new Rt(et),u,c),[4,Dl(o,l)]):[3,2];case 1:return d.sent(),o.Do=o.Do.remove(a),o.Co.delete(t),Na(o),[3,4];case 2:return[4,ti(o.localStore,t,!1).then(function(){return oi(o,t,i)}).catch(Yn)];case 3:d.sent(),d.label=4;case 4:return[2]}})})}function Gd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:i=j(e),o=t.batch.batchId,a.label=1;case 1:return a.trys.push([1,4,,6]),[4,Yf(i.localStore,t)];case 2:return s=a.sent(),ka(i,o,null),Da(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),[4,ze(i,s)];case 3:return a.sent(),[3,6];case 4:return[4,Yn(a.sent())];case 5:return a.sent(),[3,6];case 6:return[2]}})})}function Kd(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:o=j(e),a.label=1;case 1:return a.trys.push([1,4,,6]),[4,(u=o.localStore,c=t,l=j(u),l.persistence.runTransaction("Reject batch","readwrite-primary",function(d){var p;return l._n.lookupMutationBatch(d,c).next(function(v){return X(null!==v),p=v.keys(),l._n.removeMutationBatch(d,v)}).next(function(){return l._n.performConsistencyCheck(d)}).next(function(){return l.Mn.pn(d,p)})}))];case 2:return s=a.sent(),ka(o,t,i),Da(o,t),o.sharedClientState.updateMutationState(t,"rejected",i),[4,ze(o,s)];case 3:return a.sent(),[3,6];case 4:return[4,Yn(a.sent())];case 5:return a.sent(),[3,6];case 6:return[2]}var u,c,l})})}function zd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:bn((i=j(e)).remoteStore)||U("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(l=i.localStore,d=j(l),d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(p){return d._n.getHighestUnacknowledgedBatchId(p)}))];case 2:return-1===(o=c.sent())?[2,void t.resolve()]:((s=i.ko.get(o)||[]).push(t),i.ko.set(o,s),[3,4]);case 3:return a=c.sent(),u=ii(a,"Initialization of waitForPendingWrites() operation failed"),t.reject(u),[3,4];case 4:return[2]}var l,d})})}function Da(e,t){(e.ko.get(t)||[]).forEach(function(i){i.resolve()}),e.ko.delete(t)}function ka(e,t,i){var o=j(e),s=o.xo[o.currentUser.toKey()];if(s){var a=s.get(t);a&&(i?a.reject(i):a.resolve(),s=s.remove(t)),o.xo[o.currentUser.toKey()]=s}}function oi(e,t,i){void 0===i&&(i=null),e.sharedClientState.removeLocalQueryTarget(t);for(var o=0,s=e.Vo.get(t);o<s.length;o++){var a=s[o];e.Po.delete(a),i&&e.vo.Mo(a,i)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(u){e.No.containsKey(u)||Pl(e,u)})}function Pl(e,t){e.So.delete(t.path.canonicalString());var i=e.Do.get(t);null!==i&&(to(e.remoteStore,i),e.Do=e.Do.remove(t),e.Co.delete(i),Na(e))}function Pa(e,t,i){for(var o=0,s=i;o<s.length;o++){var a=s[o];a instanceof Al?(e.No.addReference(a.key,t),Hd(e,a)):a instanceof xl?(U("SyncEngine","Document no longer in limbo: "+a.key),e.No.removeReference(a.key,t),e.No.containsKey(a.key)||Pl(e,a.key)):K()}}function Hd(e,t){var i=t.key,o=i.path.canonicalString();e.Do.get(i)||e.So.has(o)||(U("SyncEngine","New document in limbo: "+i),e.So.add(o),Na(e))}function Na(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var i=new z(it.fromString(t)),o=e.Fo.next();e.Co.set(o,new Fd(i)),e.Do=e.Do.insert(i,o),us(e.remoteStore,new ts(ve(Ur(i.path)),o,2,se.o))}}function ze(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return o=j(e),s=[],a=[],u=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach(function(l,d){u.push(o.Oo(d,t,i).then(function(p){if(p){o.isPrimaryClient&&o.sharedClientState.updateQueryState(d.targetId,p.fromCache?"not-current":"current"),s.push(p);var v=Wf.Pn(d.targetId,p);a.push(v)}}))}),[4,Promise.all(u)]);case 1:return c.sent(),o.vo._r(s),[4,function(l,d){return(0,g.mG)(this,void 0,void 0,function(){var p,v,w,S,E,x,L,H;return(0,g.Jh)(this,function(Q){switch(Q.label){case 0:p=j(l),Q.label=1;case 1:return Q.trys.push([1,3,,4]),[4,p.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(tt){return O.forEach(d,function(rt){return O.forEach(rt.bn,function(at){return p.persistence.referenceDelegate.addReference(tt,rt.targetId,at)}).next(function(){return O.forEach(rt.vn,function(at){return p.persistence.referenceDelegate.removeReference(tt,rt.targetId,at)})})})})];case 2:return Q.sent(),[3,4];case 3:if(!Wn(v=Q.sent()))throw v;return U("LocalStore","Failed to update sequence numbers: "+v),[3,4];case 4:for(w=0,S=d;w<S.length;w++)x=(E=S[w]).targetId,E.fromCache||(L=p.kn.get(x),H=L.withLastLimboFreeSnapshotVersion(L.snapshotVersion),p.kn=p.kn.insert(x,H));return[2]}})})}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}function Qd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return(i=j(e)).currentUser.isEqual(t)?[3,3]:(U("SyncEngine","User change. New user:",t.toKey()),[4,ol(i.localStore,t)]);case 1:return o=s.sent(),i.currentUser=t,(a=i).ko.forEach(function(c){c.forEach(function(l){l.reject(new N(A.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),a.ko.clear(),i.sharedClientState.handleUserChange(t,o.removedBatchIds,o.addedBatchIds),[4,ze(i,o.Ln)];case 2:s.sent(),s.label=3;case 3:return[2]}var a})})}function Jd(e,t){var i=j(e),o=i.Co.get(t);if(o&&o.bo)return st().add(o.key);var s=st(),a=i.Vo.get(t);if(!a)return s;for(var u=0,c=a;u<c.length;u++){var d=i.Po.get(c[u]);s=s.unionWith(d.view.wo)}return s}function Zd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,ss((i=j(e)).localStore,t.query,!0)];case 1:return o=a.sent(),s=t.view.Ao(o),[2,(i.isPrimaryClient&&Pa(i,t.targetId,s.To),s)]}})})}function Wd(e){return(0,g.mG)(this,void 0,void 0,function(){var t;return(0,g.Jh)(this,function(i){return[2,cl((t=j(e)).localStore).then(function(o){return ze(t,o)})]})})}function Xd(e,t,i,o){return(0,g.mG)(this,void 0,void 0,function(){var s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return[4,(c=(s=j(e)).localStore,l=t,d=j(c),p=j(d._n),d.persistence.runTransaction("Lookup mutation documents","readonly",function(v){return p.jt(v,l).next(function(w){return w?d.Mn.pn(v,w):O.resolve(null)})}))];case 1:return null===(a=u.sent())?[3,6]:"pending"!==i?[3,3]:[4,ni(s.remoteStore)];case 2:return u.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(ka(s,t,o||null),Da(s,t),function(c,l){j(j(c)._n).Gt(l)}(s.localStore,t)):K(),u.label=4;case 4:return[4,ze(s,a)];case 5:return u.sent(),[3,7];case 6:U("SyncEngine","Cannot apply mutation batch with id: "+t),u.label=7;case 7:return[2]}var c,l,d,p})})}function Yd(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u,l,d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:return Ma(i=j(e)),Oa(i),!0!==t||!0===i.$o?[3,3]:(o=i.sharedClientState.getAllActiveQueryTargets(),[4,Nl(i,o.toArray())]);case 1:return s=p.sent(),i.$o=!0,[4,Ea(i.remoteStore,!0)];case 2:for(p.sent(),a=0,u=s;a<u.length;a++)us(i.remoteStore,u[a]);return[3,7];case 3:return!1!==t||!1===i.$o?[3,7]:(l=[],d=Promise.resolve(),i.Vo.forEach(function(v,w){i.sharedClientState.isLocalQueryTarget(w)?l.push(w):d=d.then(function(){return oi(i,w),ti(i.localStore,w,!0)}),to(i.remoteStore,w)}),[4,d]);case 4:return p.sent(),[4,Nl(i,l)];case 5:return p.sent(),(w=j(i)).Co.forEach(function(S,E){to(w.remoteStore,E)}),w.No.ts(),w.Co=new Map,w.Do=new Ht(z.comparator),i.$o=!1,[4,Ea(i.remoteStore,!1)];case 6:p.sent(),p.label=7;case 7:return[2]}var w})})}function Nl(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l,d,p,v,w,E,x,L;return(0,g.Jh)(this,function(V){switch(V.label){case 0:o=j(e),s=[],a=[],u=0,c=t,V.label=1;case 1:return u<c.length?(d=void 0,(p=o.Vo.get(l=c[u]))&&0!==p.length?[4,$r(o.localStore,ve(p[0]))]:[3,7]):[3,13];case 2:d=V.sent(),v=0,w=p,V.label=3;case 3:return v<w.length?(E=o.Po.get(w[v]),[4,Zd(o,E)]):[3,6];case 4:(x=V.sent()).snapshot&&a.push(x.snapshot),V.label=5;case 5:return v++,[3,3];case 6:return[3,11];case 7:return[4,ul(o.localStore,l)];case 8:return L=V.sent(),[4,$r(o.localStore,L)];case 9:return d=V.sent(),[4,Ra(o,Ml(L),l,!1)];case 10:V.sent(),V.label=11;case 11:s.push(d),V.label=12;case 12:return u++,[3,1];case 13:return[2,(o.vo._r(a),s)]}})})}function Ml(e){return Ju(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $d(e){var t=j(e);return j(j(t.localStore).persistence).fn()}function tp(e,t,i,o){return(0,g.mG)(this,void 0,void 0,function(){var s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return(s=j(e)).$o?(U("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!s.Vo.has(t))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,cl(s.localStore)];case 3:return a=c.sent(),u=ra.createSynthesizedRemoteEventForCurrentChange(t,"current"===i),[4,ze(s,a,u)];case 4:return c.sent(),[3,8];case 5:return[4,ti(s.localStore,t,!0)];case 6:return c.sent(),oi(s,t,o),[3,8];case 7:K(),c.label=8;case 8:return[2]}})})}function ep(e,t,i){return(0,g.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l,d,p,v;return(0,g.Jh)(this,function(S){switch(S.label){case 0:if(!(o=Ma(e)).$o)return[3,10];s=0,a=t,S.label=1;case 1:return s<a.length?o.Vo.has(u=a[s])?(U("SyncEngine","Adding an already active target "+u),[3,5]):[4,ul(o.localStore,u)]:[3,6];case 2:return c=S.sent(),[4,$r(o.localStore,c)];case 3:return l=S.sent(),[4,Ra(o,Ml(c),l.targetId,!1)];case 4:S.sent(),us(o.remoteStore,l),S.label=5;case 5:return s++,[3,1];case 6:d=function(E){return(0,g.Jh)(this,function(x){switch(x.label){case 0:return o.Vo.has(E)?[4,ti(o.localStore,E,!1).then(function(){to(o.remoteStore,E),oi(o,E)}).catch(Yn)]:[3,2];case 1:x.sent(),x.label=2;case 2:return[2]}})},p=0,v=i,S.label=7;case 7:return p<v.length?[5,d(v[p])]:[3,10];case 8:S.sent(),S.label=9;case 9:return p++,[3,7];case 10:return[2]}})})}function Ma(e){var t=j(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Dl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Jd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bd.bind(null,t),t.vo._r=Pd.bind(null,t.eventManager),t.vo.Mo=Nd.bind(null,t.eventManager),t}function Oa(e){var t=j(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Gd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Kd.bind(null,t),t}var Ol=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(i){switch(i.label){case 0:return this.R=Yi(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return i.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return il(this.persistence,new rl,t.initialUser,this.R)},e.prototype.qo=function(t){return new cd(hd.bs,this.R)},e.prototype.Bo=function(t){return new pl},e.prototype.terminate=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),Ll=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).Qo=i,a.cacheSizeBytes=o,a.forceOwnership=s,a.synchronizeTabs=!1,a}return(0,g.ZT)(t,e),t.prototype.initialize=function(i){return(0,g.mG)(this,void 0,void 0,function(){var o=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return s.sent(),[4,ed(this.localStore)];case 2:return s.sent(),[4,this.Qo.initialize(this,i)];case 3:return s.sent(),[4,Oa(this.Qo.syncEngine)];case 4:return s.sent(),[4,ni(this.Qo.remoteStore)];case 5:return s.sent(),[4,this.persistence.He(function(){return o.gcScheduler&&!o.gcScheduler.started&&o.gcScheduler.start(o.localStore),Promise.resolve()})];case 6:return s.sent(),[2]}})})},t.prototype.Ko=function(i){return il(this.persistence,new rl,i.initialUser,this.R)},t.prototype.Uo=function(i){return new Bf(this.persistence.referenceDelegate.garbageCollector,i.asyncQueue)},t.prototype.qo=function(i){var o=pa(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey),s=void 0!==this.cacheSizeBytes?Pe.withCacheSize(this.cacheSizeBytes):Pe.DEFAULT;return new Jf(this.synchronizeTabs,o,i.clientId,s,i.asyncQueue,ml(),as(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(i){return new pl},t}(Ol),rp=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o,!1)||this).Qo=i,s.cacheSizeBytes=o,s.synchronizeTabs=!0,s}return(0,g.ZT)(t,e),t.prototype.initialize=function(i){return(0,g.mG)(this,void 0,void 0,function(){var o,s=this;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return a.sent(),o=this.Qo.syncEngine,this.sharedClientState instanceof ba?(this.sharedClientState.syncEngine={ui:Xd.bind(null,o),ai:tp.bind(null,o),hi:ep.bind(null,o),fn:$d.bind(null,o),ci:Wd.bind(null,o)},[4,this.sharedClientState.start()]):[3,3];case 2:a.sent(),a.label=3;case 3:return[4,this.persistence.He(function(u){return(0,g.mG)(s,void 0,void 0,function(){return(0,g.Jh)(this,function(c){switch(c.label){case 0:return[4,Yd(this.Qo.syncEngine,u)];case 1:return c.sent(),this.gcScheduler&&(u&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):u||this.gcScheduler.stop()),[2]}})})})];case 4:return a.sent(),[2]}})})},t.prototype.Bo=function(i){var o=ml();if(!ba.yt(o))throw new N(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var s=pa(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey);return new ba(o,i.asyncQueue,s,i.clientId,i.initialUser)},t}(Ll),La=function(){function e(){}return e.prototype.initialize=function(t,i){return(0,g.mG)(this,void 0,void 0,function(){var o=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(a){return kl(o.syncEngine,a,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Qd.bind(null,this.syncEngine),[4,Ea(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:s.sent(),s.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new kd},e.prototype.createDatastore=function(t){var o=Yi(t.databaseInfo.databaseId),s=new md(t.databaseInfo);return new bd(t.credentials,s,o)},e.prototype.createRemoteStore=function(t){var i,o,s,a,u,c=this;return i=this.localStore,o=this.datastore,s=t.asyncQueue,a=function(l){return kl(c.syncEngine,l,0)},u=gl.yt()?new gl:new dd,new wd(i,o,s,a,u)},e.prototype.createSyncEngine=function(t,i){return d=i,p=new Ud(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions),d&&(p.$o=!0),p;var d,p},e.prototype.terminate=function(){return function(t){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return i=j(t),U("RemoteStore","RemoteStore shutting down."),i.Or.add(5),[4,ei(i)];case 1:return o.sent(),i.Lr.shutdown(),i.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}(),hs=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,i){var o=this;this.muted||setTimeout(function(){o.muted||t(i)},0)},e}(),op=(function(){function e(t,i){var o=this;this.Go=t,this.R=i,this.metadata=new Jt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(s){s&&s.io()?o.metadata.resolve(s.payload.metadata):o.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==s?void 0:s.payload)))},function(s){return o.metadata.reject(s)})}e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,this.Jo()];case 1:return null===(t=a.sent())?[2,null]:(i=this.zo.decode(t),o=Number(i),isNaN(o)&&this.Yo("length string ("+i+") is not valid number"),[4,this.Xo(o)]);case 2:return s=a.sent(),[2,new Md(JSON.parse(s),t.length+o)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(o.sent())return[3,3];o.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),i=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),i)])}})})},e.prototype.Xo=function(t){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:o.sent()&&this.Yo("Reached the end of bundle when more is expected."),o.label=2;case 2:return[3,0];case 3:return i=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),i)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return[4,this.Go.read()];case 1:return(t=o.sent()).done||((i=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),i.set(t.value,this.buffer.length),this.buffer=i),[2,t.done]}})})}}(),function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return(0,g.mG)(this,void 0,void 0,function(){var i,o=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new N(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(a,u){return(0,g.mG)(this,void 0,void 0,function(){var c,l,d,p,v,w;return(0,g.Jh)(this,function(S){switch(S.label){case 0:return c=j(a),l=Ji(c.R)+"/documents",d={documents:u.map(function(E){return Qi(c.R,E)})},[4,c.$i("BatchGetDocuments",l,d)];case 1:return p=S.sent(),v=new Map,p.forEach(function(E){var L,V,x=(L=c.R,"found"in(V=E)?function(H,Q){X(!!Q.found);var tt=De(H,Q.found.name),rt=Mt(Q.found.updateTime),at=new ae({mapValue:{fields:Q.found.fields}});return qt.newFoundDocument(tt,rt,at)}(L,V):"missing"in V?function(H,Q){X(!!Q.missing),X(!!Q.readTime);var tt=De(H,Q.missing),rt=Mt(Q.readTime);return qt.newNoDocument(tt,rt)}(L,V):K());v.set(x.key.toString(),x)}),w=[],[2,(u.forEach(function(E){var x=v.get(E.toString());X(!!x),w.push(x)}),w)]}})})}(this.datastore,t)];case 1:return[2,((i=s.sent()).forEach(function(a){return o.recordVersion(a)}),i)]}})})},e.prototype.set=function(t,i){this.write(i.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,i){try{this.write(i.toMutation(t,this.preconditionForUpdate(t)))}catch(o){this.lastWriteError=o}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new zi(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i=this;return(0,g.Jh)(this,function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(s){t.delete(s.key.toString())}),t.forEach(function(s,a){var u=z.fromPath(a);i.mutations.push(new ea(u,i.precondition(u)))}),[4,function(s,a){return(0,g.mG)(this,void 0,void 0,function(){var u,c,l;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return u=j(s),c=Ji(u.R)+"/documents",l={writes:a.map(function(p){return $o(u.R,p)})},[4,u.Ni("Commit",c,l)];case 1:return d.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return o.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var i;if(t.isFoundDocument())i=t.version;else{if(!t.isNoDocument())throw K();i=$.min()}var o=this.readVersions.get(t.key.toString());if(o){if(!i.isEqual(o))throw new N(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),i)},e.prototype.precondition=function(t){var i=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&i?zt.updateTime(i):zt.none()},e.prototype.preconditionForUpdate=function(t){var i=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&i){if(i.isEqual($.min()))throw new N(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return zt.updateTime(i)}return zt.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}()),sp=function(){function e(t,i,o,s){this.asyncQueue=t,this.datastore=i,this.updateFunction=o,this.deferred=s,this.ec=5,this.Zi=new _a(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,g.mG)(t,void 0,void 0,function(){var i,o,s=this;return(0,g.Jh)(this,function(a){return i=new op(this.datastore),(o=this.sc(i))&&o.then(function(u){s.asyncQueue.enqueueAndForget(function(){return i.commit().then(function(){s.deferred.resolve(u)}).catch(function(c){s.ic(c)})})}).catch(function(u){s.ic(u)}),[2]})})})},e.prototype.sc=function(t){try{var i=this.updateFunction(t);return!zn(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(o){return this.deferred.reject(o),null}},e.prototype.ic=function(t){var i=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return i.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if("FirebaseError"===t.name){var i=t.code;return"aborted"===i||"failed-precondition"===i||!hc(i)}return!1},e}(),ap=function(){function e(t,i,o){var s=this;this.credentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=jt.UNAUTHENTICATED,this.clientId=Nu.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(i,function(a){return(0,g.mG)(s,void 0,void 0,function(){return(0,g.Jh)(this,function(u){switch(u.label){case 0:return U("FirestoreClient","Received user=",a.uid),[4,this.credentialListener(a)];case 1:return u.sent(),this.user=a,[2]}})})})}return e.prototype.getConfiguration=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var i=new Jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,g.mG)(t,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:a.sent(),a.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:a.sent(),a.label=4;case 4:return this.credentials.removeChangeListener(),i.resolve(),[3,6];case 5:return o=a.sent(),s=ii(o,"Failed to shutdown persistence"),i.reject(s),[3,6];case 6:return[2]}})})}),i.promise},e}();function Ul(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s=this;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return e.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return i=a.sent(),[4,t.initialize(i)];case 2:return a.sent(),o=i.initialUser,e.setCredentialChangeListener(function(u){return(0,g.mG)(s,void 0,void 0,function(){return(0,g.Jh)(this,function(c){switch(c.label){case 0:return o.isEqual(u)?[3,2]:[4,ol(t.localStore,u)];case 1:c.sent(),o=u,c.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function ql(e,t){return(0,g.mG)(this,void 0,void 0,function(){var i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,Fa(e)];case 1:return i=s.sent(),U("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return o=s.sent(),[4,t.initialize(i,o)];case 3:return s.sent(),e.setCredentialChangeListener(function(a){return function(u,c){return(0,g.mG)(this,void 0,void 0,function(){var l,d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:return(l=j(u)).asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials"),d=bn(l),l.Or.add(3),[4,ei(l)];case 1:return p.sent(),d&&l.Br.set("Unknown"),[4,l.remoteSyncer.handleCredentialChange(c)];case 2:return p.sent(),l.Or.delete(3),[4,$i(l)];case 3:return p.sent(),[2]}})})}(t.remoteStore,a)}),e.onlineComponents=t,[2]}})})}function Fa(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(U("FirestoreClient","Using default OfflineComponentProvider"),[4,Ul(e,new Ol)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function fs(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(U("FirestoreClient","Using default OnlineComponentProvider"),[4,ql(e,new La)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Vl(e){return Fa(e).then(function(t){return t.persistence})}function Ua(e){return Fa(e).then(function(t){return t.localStore})}function jl(e){return fs(e).then(function(t){return t.remoteStore})}function qa(e){return fs(e).then(function(t){return t.syncEngine})}function si(e){return(0,g.mG)(this,void 0,void 0,function(){var t,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return[4,fs(e)];case 1:return t=o.sent(),[2,((i=t.eventManager).onListen=qd.bind(null,t.syncEngine),i.onUnlisten=Vd.bind(null,t.syncEngine),i)]}})})}function Bl(e,t,i){var o=this;void 0===i&&(i={});var s=new Jt;return e.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(o,void 0,void 0,function(){var a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return a=function(c,l,d,p,v){var w=new hs({next:function(E){l.enqueueAndForget(function(){return Ca(c,S)});var x=E.docs.has(d);!x&&E.fromCache?v.reject(new N(A.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&E.fromCache&&p&&"server"===p.source?v.reject(new N(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):v.resolve(E)},error:function(E){return v.reject(E)}}),S=new xa(Ur(d.path),w,{includeMetadataChanges:!0,so:!0});return Sa(c,S)},[4,si(e)];case 1:return[2,a.apply(void 0,[u.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}function Gl(e,t,i){var o=this;void 0===i&&(i={});var s=new Jt;return e.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(o,void 0,void 0,function(){var a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return a=function(c,l,d,p,v){var w=new hs({next:function(E){l.enqueueAndForget(function(){return Ca(c,S)}),E.fromCache&&"server"===p.source?v.reject(new N(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):v.resolve(E)},error:function(E){return v.reject(E)}}),S=new xa(d,w,{includeMetadataChanges:!0,so:!0});return Sa(c,S)},[4,si(e)];case 1:return[2,a.apply(void 0,[u.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}var up=function(e,t,i,o,s,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.useFetchStreams=c},ds=function(){function e(t,i){this.projectId=t,this.database=i||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Kl=new Map,zl=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Hl=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){this.changeListener=i,t.enqueueRetryable(function(){return i(jt.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),cp=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){var o=this;this.changeListener=i,t.enqueueRetryable(function(){return i(o.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),lp=function(){function e(t){var i=this;this.currentUser=jt.UNAUTHENTICATED,this.oc=new Jt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){i.cc++,i.currentUser=i.ac(),i.oc.resolve(),i.changeListener&&i.asyncQueue.enqueueRetryable(function(){return i.changeListener(i.currentUser)})};var o=function(s){U("FirebaseCredentialsProvider","Auth detected"),i.auth=s,i.auth.addAuthTokenListener(i.uc)};t.onInit(function(s){return o(s)}),setTimeout(function(){if(!i.auth){var s=t.getImmediate({optional:!0});s?o(s):(U("FirebaseCredentialsProvider","Auth not yet detected"),i.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,i=this.cc,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(function(s){return t.cc!==i?(U("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):s?(X("string"==typeof s.accessToken),new zl(s.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,i){var o=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,g.mG)(o,void 0,void 0,function(){return(0,g.Jh)(this,function(s){switch(s.label){case 0:return[4,this.oc.promise];case 1:return s.sent(),[4,i(this.currentUser)];case 2:return s.sent(),this.changeListener=i,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return X(null===t||"string"==typeof t),new jt(t)},e}(),hp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o,this.type="FirstParty",this.user=jt.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},i=this.hc.auth.getAuthHeaderValueForFirstParty([]);return i&&(t.Authorization=i),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),fp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o}return e.prototype.getToken=function(){return Promise.resolve(new hp(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,i){t.enqueueRetryable(function(){return i(jt.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();function Va(e,t,i){if(!i)throw new N(A.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function ja(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new N(A.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Ql(e,t,i,o){if(!0===t&&!0===o)throw new N(A.INVALID_ARGUMENT,e+" and "+i+" cannot be used together.")}function Jl(e){if(!z.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Zl(e){if(z.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function ps(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(i){if(i.constructor){var o=/function\s+([^\s(]+)\s*\(/.exec(i.constructor.toString());if(o&&o.length>1)return o[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return"function"==typeof e?"a function":K()}function ot(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new N(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var i=ps(e);throw new N(A.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+i)}return e}function Wl(e,t){if(t<=0)throw new N(A.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var Xl=function(){function e(t){var i;if(void 0===t.host){if(void 0!==t.ssl)throw new N(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(i=t.ssl)||void 0===i||i;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new N(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ql("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),eo=function(){function e(t,i){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xl({}),this._settingsFrozen=!1,t instanceof ds?(this._databaseId=t,this._credentials=new Hl):(this._app=t,this._databaseId=function(o){if(!Object.prototype.hasOwnProperty.apply(o.options,["projectId"]))throw new N(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ds(o.options.projectId)}(t),this._credentials=new lp(i))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new N(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xl(t),void 0!==t.credentials&&(this._credentials=function(i){if(!i)return new Hl;switch(i.type){case"gapi":var o=i.client;return X(!("object"!=typeof o||null===o||!o.auth||!o.auth.getAuthHeaderValueForFirstParty)),new fp(o,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new N(A.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return(i=Kl.get(this))&&(U("ComponentProvider","Removing Datastore"),Kl.delete(this),i.terminate()),Promise.resolve();var i},e}(),gt=function(){function e(t,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new wn(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),ie=function(){function e(t,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),wn=function(e){function t(i,o,s){var a=this;return(a=e.call(this,i,o,Ur(s))||this)._path=s,a.type="collection",a}return(0,g.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._path.popLast();return i.isEmpty()?null:new gt(this.firestore,null,new z(i))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(i){return new t(this.firestore,i,this._path)},t}(ie);function Yl(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,_.m9)(e),Va("collection","path",t),e instanceof eo)return Zl(i=it.fromString.apply(it,(0,g.ev)([t],o))),new wn(e,null,i);if(!(e instanceof gt||e instanceof wn))throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zl(i=it.fromString.apply(it,(0,g.ev)([e.path],o)).child(it.fromString(t))),new wn(e.firestore,null,i)}function gs(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,_.m9)(e),1===arguments.length&&(t=Nu.u()),Va("doc","path",t),e instanceof eo)return Jl(i=it.fromString.apply(it,(0,g.ev)([t],o))),new gt(e,null,new z(i));if(!(e instanceof gt||e instanceof wn))throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Jl(i=e._path.child(it.fromString.apply(it,(0,g.ev)([t],o)))),new gt(e.firestore,e instanceof wn?e.converter:null,new z(i))}function $l(e,t){return e=(0,_.m9)(e),t=(0,_.m9)(t),(e instanceof gt||e instanceof wn)&&(t instanceof gt||t instanceof wn)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function th(e,t){return e=(0,_.m9)(e),t=(0,_.m9)(t),e instanceof ie&&t instanceof ie&&e.firestore===t.firestore&&ji(e._query,t._query)&&e.converter===t.converter}var dp=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new _a(this,"async_queue_retry"),this.Ic=function(){var o=as();o&&U("AsyncQueue","Visibility state changed to "+o.visibilityState),t.Zi.Gi()};var i=as();i&&"function"==typeof i.addEventListener&&i.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var i=as();i&&"function"==typeof i.removeEventListener&&i.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var i=this;if(this.Ac(),this._c)return new Promise(function(){});var o=new Jt;return this.Rc(function(){return i._c&&i.Ec?Promise.resolve():(t().then(o.resolve,o.reject),o.promise)}).then(function(){return o.promise})},e.prototype.enqueueRetryable=function(t){var i=this;this.enqueueAndForget(function(){return i.wc.push(t),i.bc()})},e.prototype.bc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,i=this;return(0,g.Jh)(this,function(o){switch(o.label){case 0:if(0===this.wc.length)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return o.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Wn(t=o.sent()))throw t;return U("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return i.bc()}),o.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var i=this,o=this.dc.then(function(){return i.gc=!0,t().catch(function(s){throw i.yc=s,i.gc=!1,St("INTERNAL UNHANDLED ERROR: ",(u=(a=s).message||"",a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u)),s;var a,u}).then(function(s){return i.gc=!1,s})});return this.dc=o,o},e.prototype.enqueueAfterDelay=function(t,i,o){var s=this;this.Ac(),this.Tc.indexOf(t)>-1&&(i=0);var a=Rd.createAndSchedule(this,t,i,o,function(u){return s.vc(u)});return this.mc.push(a),a},e.prototype.Ac=function(){this.yc&&K()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return[4,t=this.dc];case 1:i.sent(),i.label=2;case 2:if(t!==this.dc)return[3,0];i.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var i=0,o=this.mc;i<o.length;i++)if(o[i].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var i=this;return this.Pc().then(function(){i.mc.sort(function(u,c){return u.targetTimeMs-c.targetTimeMs});for(var o=0,s=i.mc;o<s.length;o++){var a=s[o];if(a.skipDelay(),"all"!==t&&a.timerId===t)break}return i.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var i=this.mc.indexOf(t);this.mc.splice(i,1)},e}();function ai(e){return function(t,i){if("object"!=typeof t||null===t)return!1;for(var o=t,s=0,a=["next","error","complete"];s<a.length;s++){var u=a[s];if(u in o&&"function"==typeof o[u])return!0}return!1}(e)}!function(){function e(){this._progressObserver={},this._taskCompletionResolver=new Jt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}e.prototype.onProgress=function(t,i,o){this._progressObserver={next:t,error:i,complete:o}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,i){return this._taskCompletionResolver.promise.then(t,i)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var _t=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).type="firestore",s._queue=new dp,s._persistenceKey="name"in i?i.name:"[DEFAULT]",s}return(0,g.ZT)(t,e),t.prototype._terminate=function(){return this._firestoreClient||eh(this),this._firestoreClient.terminate()},t}(eo);function Lt(e){return e._firestoreClient||eh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function eh(e){var t,a,c,i=e._freezeSettings(),o=(a=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new up(e._databaseId,a,e._persistenceKey,(c=i).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,c.useFetchStreams));e._firestoreClient=new ap(e._credentials,e._queue,o)}function nh(e,t,i){var o=this,s=new Jt;return e.asyncQueue.enqueue(function(){return(0,g.mG)(o,void 0,void 0,function(){var a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),[4,Ul(e,i)];case 1:return u.sent(),[4,ql(e,t)];case 2:return u.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(c=a=u.sent()).name?c.code===A.FAILED_PRECONDITION||c.code===A.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&c instanceof DOMException)||22===c.code||20===c.code||11===c.code))throw a;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),s.reject(a),[3,4];case 4:return[2]}var c})})}).then(function(){return s.promise})}function rh(e){if(e._initialized||e._terminated)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ne=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var o=0;o<t.length;++o)if(0===t[o].length)throw new N(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new we(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),$n=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(Zt.fromBase64String(t))}catch(i){throw new N(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}},e.fromUint8Array=function(t){return new e(Zt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),tr=function(e){this._methodName=e},ms=function(){function e(t,i){if(!isFinite(t)||t<-90||t>90)throw new N(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new N(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return et(this._lat,t._lat)||et(this._long,t._long)},e}(),mp=/^__.*__$/,vp=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return null!==this.fieldMask?new dn(t,this.data,this.fieldMask,i,this.fieldTransforms):new Ki(t,this.data,i,this.fieldTransforms)},e}(),ih=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return new dn(t,this.data,this.fieldMask,i,this.fieldTransforms)},e}();function oh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K()}}var sh=function(){function e(t,i,o,s,a,u){this.settings=t,this.databaseId=i,this.R=o,this.ignoreUndefinedProperties=s,void 0===a&&this.Cc(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.$c(t),s},e.prototype.Oc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.Cc(),s},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return ys(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(i){return t.isPrefixOf(i)})||void 0!==this.fieldTransforms.find(function(i){return t.isPrefixOf(i.field)})},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(oh(this.Nc)&&mp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),yp=function(){function e(t,i,o){this.databaseId=t,this.ignoreUndefinedProperties=i,this.R=o||Yi(t)}return e.prototype.Uc=function(t,i,o,s){return void 0===s&&(s=!1),new sh({Nc:t,methodName:i,qc:o,path:we.emptyPath(),Fc:!1,Bc:s},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function er(e){var t=e._freezeSettings(),i=Yi(e._databaseId);return new yp(e._databaseId,!!t.ignoreUndefinedProperties,i)}function vs(e,t,i,o,s,a){void 0===a&&(a={});var u=e.Uc(a.merge||a.mergeFields?2:0,t,i,s);za("Data must be an object, but it was:",u,o);var c,l,d=ch(o,u);if(a.merge)c=new Mr(u.fieldMask),l=u.fieldTransforms;else if(a.mergeFields){for(var p=[],v=0,w=a.mergeFields;v<w.length;v++){var S=Ha(t,w[v],i);if(!u.contains(S))throw new N(A.INVALID_ARGUMENT,"Field '"+S+"' is specified in your field mask but missing from your input data.");hh(p,S)||p.push(S)}c=new Mr(p),l=u.fieldTransforms.filter(function(E){return c.covers(E.field)})}else c=null,l=u.fieldTransforms;return new vp(new ae(d),c,l)}var Ba=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype._toFieldTransform=function(i){if(2!==i.Nc)throw i.Lc(1===i.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return i.fieldMask.push(i.path),null},t.prototype.isEqual=function(i){return i instanceof t},t}(tr);function ah(e,t,i){return new sh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:i},t.databaseId,t.R,t.ignoreUndefinedProperties)}var bp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype._toFieldTransform=function(i){return new Gi(i.path,new Vr)},t.prototype.isEqual=function(i){return i instanceof t},t}(tr),_p=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,g.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=ah(this,i,!0),s=this.Kc.map(function(u){return nr(u,o)}),a=new Qn(s);return new Gi(i.path,a)},t.prototype.isEqual=function(i){return this===i},t}(tr),wp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,g.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=ah(this,i,!0),s=this.Kc.map(function(u){return nr(u,o)}),a=new Jn(s);return new Gi(i.path,a)},t.prototype.isEqual=function(i){return this===i},t}(tr),Tp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Qc=o,s}return(0,g.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=new jr(i.R,tc(i.R,this.Qc));return new Gi(i.path,o)},t.prototype.isEqual=function(i){return this===i},t}(tr);function Ga(e,t,i,o){var s=e.Uc(1,t,i);za("Data must be an object, but it was:",s,o);var a=[],u=ae.empty();Kn(o,function(l,d){var p=Qa(t,l,i);d=(0,_.m9)(d);var v=s.Oc(p);if(d instanceof Ba)a.push(p);else{var w=nr(d,v);null!=w&&(a.push(p),u.set(p,w))}});var c=new Mr(a);return new ih(u,c,s.fieldTransforms)}function Ka(e,t,i,o,s,a){var u=e.Uc(1,t,i),c=[Ha(t,o,i)],l=[s];if(a.length%2!=0)throw new N(A.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var d=0;d<a.length;d+=2)c.push(Ha(t,a[d])),l.push(a[d+1]);for(var p=[],v=ae.empty(),w=c.length-1;w>=0;--w)if(!hh(p,c[w])){var S=c[w],E=l[w];E=(0,_.m9)(E);var x=u.Oc(S);if(E instanceof Ba)p.push(S);else{var L=nr(E,x);null!=L&&(p.push(S),v.set(S,L))}}var V=new Mr(p);return new ih(v,V,u.fieldTransforms)}function uh(e,t,i,o){return void 0===o&&(o=!1),nr(i,e.Uc(o?4:3,t))}function nr(e,t){if(lh(e=(0,_.m9)(e)))return za("Unsupported field value:",t,e),ch(e,t);if(e instanceof tr)return function(i,o){if(!oh(o.Nc))throw o.Lc(i._methodName+"() can only be used with update() and set()");if(!o.path)throw o.Lc(i._methodName+"() is not currently supported inside arrays");var s=i._toFieldTransform(o);s&&o.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(i,o){for(var s=[],a=0,u=0,c=i;u<c.length;u++){var l=nr(c[u],o.Mc(a));null==l&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(e,t)}return function(i,o){if(null===(i=(0,_.m9)(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof i)return tc(o.R,i);if("boolean"==typeof i)return{booleanValue:i};if("string"==typeof i)return{stringValue:i};if(i instanceof Date){var s=ee.fromDate(i);return{timestampValue:Hi(o.R,s)}}if(i instanceof ee)return s=new ee(i.seconds,1e3*Math.floor(i.nanoseconds/1e3)),{timestampValue:Hi(o.R,s)};if(i instanceof ms)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof $n)return{bytesValue:_c(o.R,i._byteString)};if(i instanceof gt){var a=i.firestore._databaseId;if(!a.isEqual(s=o.databaseId))throw o.Lc("Document reference is for database "+a.projectId+"/"+a.database+" but should be for database "+s.projectId+"/"+s.database);return{referenceValue:oa(i.firestore._databaseId||o.databaseId,i._key.path)}}throw o.Lc("Unsupported field value: "+ps(i))}(e,t)}function ch(e,t){var i={};return Lu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Kn(e,function(o,s){var a=nr(s,t.kc(o));null!=a&&(i[o]=a)}),{mapValue:{fields:i}}}function lh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ee||e instanceof ms||e instanceof $n||e instanceof gt||e instanceof tr)}function za(e,t,i){if(!lh(i)||"object"!=typeof(s=i)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){var o=ps(i);throw t.Lc("an object"===o?e+" a custom object":e+" "+o)}var s}function Ha(e,t,i){if((t=(0,_.m9)(t))instanceof Ne)return t._internalPath;if("string"==typeof t)return Qa(e,t);throw ys("Field path arguments must be of type string or FieldPath.",e,!1,void 0,i)}var Ip=new RegExp("[~\\*/\\[\\]]");function Qa(e,t,i){if(t.search(Ip)>=0)throw ys("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,i);try{return(new(Ne.bind.apply(Ne,(0,g.ev)([void 0],t.split(".")))))._internalPath}catch(o){throw ys("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,i)}}function ys(e,t,i,o,s){var a=o&&!o.isEmpty(),u=void 0!==s,c="Function "+t+"() called with invalid data";i&&(c+=" (via `toFirestore()`)");var l="";return(a||u)&&(l+=" (found",a&&(l+=" in field "+o),u&&(l+=" in document "+s),l+=")"),new N(A.INVALID_ARGUMENT,(c+=". ")+e+l)}function hh(e,t){return e.some(function(i){return i.isEqual(t)})}var no=function(){function e(t,i,o,s,a){this._firestore=t,this._userDataWriter=i,this._key=o,this._document=s,this._converter=a}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new gt(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return null!==this._document},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Ep(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var i=this._document.data.field(bs("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i)}},e}(),Ep=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(no);function bs(e,t){return"string"==typeof t?Qa(e,t):t instanceof Ne?t._internalPath:t._delegate._internalPath}var rr=function(){function e(t,i){this.hasPendingWrites=t,this.fromCache=i}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),He=function(e){function t(i,o,s,a,u,c){var l=this;return(l=e.call(this,i,o,s,a,c)||this)._firestore=i,l._firestoreImpl=i,l.metadata=u,l}return(0,g.ZT)(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(i){if(void 0===i&&(i={}),this._document){if(this._converter){var o=new ro(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,i)}return this._userDataWriter.convertValue(this._document.data.value,i.serverTimestamps)}},t.prototype.get=function(i,o){if(void 0===o&&(o={}),this._document){var s=this._document.data.field(bs("DocumentSnapshot.get",i));if(null!==s)return this._userDataWriter.convertValue(s,o.serverTimestamps)}},t}(no),ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype.data=function(i){return void 0===i&&(i={}),e.prototype.data.call(this,i)},t}(He),Tn=function(){function e(t,i,o,s){this._firestore=t,this._userDataWriter=i,this._snapshot=s,this.metadata=new rr(s.hasPendingWrites,s.fromCache),this.query=o}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(i){return t.push(i)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,i){var o=this;this._snapshot.docs.forEach(function(s){t.call(i,new ro(o._firestore,o._userDataWriter,s.key,s,new rr(o._snapshot.mutatedKeys.has(s.key),o._snapshot.fromCache),o.query.converter))})},e.prototype.docChanges=function(t){void 0===t&&(t={});var i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new N(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(o,s){if(o._snapshot.oldDocs.isEmpty()){var a=0;return o._snapshot.docChanges.map(function(c){return{type:"added",doc:new ro(o._firestore,o._userDataWriter,c.doc.key,c.doc,new rr(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),oldIndex:-1,newIndex:a++}})}var u=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(function(c){return s||3!==c.type}).map(function(c){var l=new ro(o._firestore,o._userDataWriter,c.doc.key,c.doc,new rr(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),d=-1,p=-1;return 0!==c.type&&(d=u.indexOf(c.doc.key),u=u.delete(c.doc.key)),1!==c.type&&(p=(u=u.add(c.doc)).indexOf(c.doc.key)),{type:Sp(c.type),doc:l,oldIndex:d,newIndex:p}})}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges},e}();function Sp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K()}}function fh(e,t){return e instanceof He&&t instanceof He?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Tn&&t instanceof Tn&&e._firestore===t._firestore&&th(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function dh(e){if(Ho(e)&&0===e.explicitOrderBy.length)throw new N(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var io=function(){};function In(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var o=0,s=t;o<s.length;o++){var a=s[o];e=a._apply(e)}return e}var Cp=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).jc=i,a.Wc=o,a.Gc=s,a.type="where",a}return(0,g.ZT)(t,e),t.prototype._apply=function(i){var a,c,o=er(i.firestore),s=function(a,u,c,l,d,p,v){var w;if(d.isKeyField()){if("array-contains"===p||"array-contains-any"===p)throw new N(A.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+p+"' queries on FieldPath.documentId().");if("in"===p||"not-in"===p){bh(v,p);for(var S=[],E=0,x=v;E<x.length;E++)S.push(yh(l,a,x[E]));w={arrayValue:{values:S}}}else w=yh(l,a,v)}else"in"!==p&&"not-in"!==p&&"array-contains-any"!==p||bh(v,p),w=uh(c,"where",v,"in"===p||"not-in"===p);var V=ue.create(d,p,w);return function(H,Q){if(Q.g()){var tt=Xs(H);if(null!==tt&&!tt.isEqual(Q.field))throw new N(A.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+tt.toString()+"' and '"+Q.field.toString()+"'");var rt=Ws(H);null!==rt&&_h(0,Q.field,rt)}var at=function(Bt,Xa){for(var co=0,Ph=Bt.filters;co<Ph.length;co++){var Nh=Ph[co];if(Xa.indexOf(Nh.op)>=0)return Nh.op}return null}(H,function(Bt){switch(Bt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(Q.op));if(null!==at)throw new N(A.INVALID_ARGUMENT,at===Q.op?"Invalid query. You cannot use more than one '"+Q.op.toString()+"' filter.":"Invalid query. You cannot use '"+Q.op.toString()+"' filters with '"+at.toString()+"' filters.")}(a,V),V}(i._query,0,o,i.firestore._databaseId,this.jc,this.Wc,this.Gc);return new ie(i.firestore,i.converter,(c=(a=i._query).filters.concat([s]),new Be(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)))},t}(io),Ap=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).jc=i,s.zc=o,s.type="orderBy",s}return(0,g.ZT)(t,e),t.prototype._apply=function(i){var s,u,o=function(s,a,u){if(null!==s.startAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==s.endAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var c=new Fr(a,u);return function(l,d){if(null===Ws(l)){var p=Xs(l);null!==p&&_h(0,p,d.field)}}(s,c),c}(i._query,this.jc,this.zc);return new ie(i.firestore,i.converter,(u=(s=i._query).explicitOrderBy.concat([o]),new Be(s.path,s.collectionGroup,u,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)))},t}(io),ph=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Hc=o,a.Jc=s,a}return(0,g.ZT)(t,e),t.prototype._apply=function(i){return new ie(i.firestore,i.converter,Zu(i._query,this.Hc,this.Jc))},t}(io),gh=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Yc=o,a.Xc=s,a}return(0,g.ZT)(t,e),t.prototype._apply=function(i){var s,a,o=vh(i,this.type,this.Yc,this.Xc);return new ie(i.firestore,i.converter,(a=o,new Be((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,a,s.endAt)))},t}(io),mh=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Yc=o,a.Xc=s,a}return(0,g.ZT)(t,e),t.prototype._apply=function(i){var s,a,o=vh(i,this.type,this.Yc,this.Xc);return new ie(i.firestore,i.converter,(a=o,new Be((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,a)))},t}(io);function vh(e,t,i,o){if(i[0]=(0,_.m9)(i[0]),i[0]instanceof no)return function(a,u,c,l,d){if(!l)throw new N(A.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var p=[],v=0,w=qr(a);v<w.length;v++){var S=w[v];if(S.field.isKeyField())p.push(Vo(u,l.key));else{var E=l.data.field(S.field);if(zs(E))throw new N(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+S.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===E){var x=S.field.canonicalString();throw new N(A.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+x+"' (used as the orderBy) does not exist.")}p.push(E)}}return new Vi(p,d)}(e._query,e.firestore._databaseId,t,i[0]._document,o);var s=er(e.firestore);return function(a,u,c,l,d,p){var v=a.explicitOrderBy;if(d.length>v.length)throw new N(A.INVALID_ARGUMENT,"Too many arguments provided to "+l+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var w=[],S=0;S<d.length;S++){var E=d[S];if(v[S].field.isKeyField()){if("string"!=typeof E)throw new N(A.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+l+"(), but got a "+typeof E);if(!Ys(a)&&-1!==E.indexOf("/"))throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+l+"() must be a plain document ID, but '"+E+"' contains a slash.");var x=a.path.child(it.fromString(E));if(!z.isDocumentKey(x))throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+l+"() must result in a valid document path, but '"+x+"' is not because it contains an odd number of segments.");var L=new z(x);w.push(Vo(u,L))}else{var V=uh(c,l,E);w.push(V)}}return new Vi(w,p)}(e._query,e.firestore._databaseId,s,t,i,o)}function yh(e,t,i){if("string"==typeof(i=(0,_.m9)(i))){if(""===i)throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ys(t)&&-1!==i.indexOf("/"))throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+i+"' contains a '/' character.");var o=t.path.child(it.fromString(i));if(!z.isDocumentKey(o))throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+o+"' is not because it has an odd number of segments ("+o.length+").");return Vo(e,new z(o))}if(i instanceof gt)return Vo(e,i._key);throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ps(i)+".")}function bh(e,t){if(!Array.isArray(e)||0===e.length)throw new N(A.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new N(A.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function _h(e,t,i){if(!i.isEqual(t))throw new N(A.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+i.toString()+"' instead.")}var Ja=function(){function e(){}return e.prototype.convertValue=function(t,i){switch(void 0===i&&(i="none"),Hn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(Or(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 10:return this.convertObject(t.mapValue,i);default:throw K()}},e.prototype.convertObject=function(t,i){var o=this,s={};return Kn(t.fields,function(a,u){s[a]=o.convertValue(u,i)}),s},e.prototype.convertGeoPoint=function(t){return new ms(Ct(t.latitude),Ct(t.longitude))},e.prototype.convertArray=function(t,i){var o=this;return(t.values||[]).map(function(s){return o.convertValue(s,i)})},e.prototype.convertServerTimestamp=function(t,i){switch(i){case"previous":var o=Uu(t);return null==o?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(Li(t));default:return null}},e.prototype.convertTimestamp=function(t){var i=fn(t);return new ee(i.seconds,i.nanos)},e.prototype.convertDocumentKey=function(t,i){var o=it.fromString(t);X(Nc(o));var s=new ds(o.get(1),o.get(3)),a=new z(o.popFirst(5));return s.isEqual(i)||St("Document "+a+" contains a document reference within a different database ("+s.projectId+"/"+s.database+") which is not supported. It will be treated as a reference in the current database ("+i.projectId+"/"+i.database+") instead."),a},e}();function _s(e,t,i){return e?i&&(i.merge||i.mergeFields)?e.toFirestore(t,i):e.toFirestore(t):t}var xp=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,g.ZT)(t,e),t.prototype.convertBytes=function(i){return new $n(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new gt(this.firestore,null,o)},t}(Ja),Rp=function(){function e(t,i){this._firestore=t,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=er(t)}return e.prototype.set=function(t,i,o){this._verifyNotCommitted();var s=En(t,this._firestore),a=_s(s.converter,i,o),u=vs(this._dataReader,"WriteBatch.set",s._key,a,null!==s.converter,o);return this._mutations.push(u.toMutation(s._key,zt.none())),this},e.prototype.update=function(t,i,o){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];this._verifyNotCommitted();var u,c=En(t,this._firestore);return u="string"==typeof(i=(0,_.m9)(i))||i instanceof Ne?Ka(this._dataReader,"WriteBatch.update",c._key,i,o,s):Ga(this._dataReader,"WriteBatch.update",c._key,i),this._mutations.push(u.toMutation(c._key,zt.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var i=En(t,this._firestore);return this._mutations=this._mutations.concat(new zi(i._key,zt.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new N(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();function En(e,t){if((e=(0,_.m9)(e)).firestore!==t)throw new N(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var ir=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,g.ZT)(t,e),t.prototype.convertBytes=function(i){return new $n(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new gt(this.firestore,null,o)},t}(Ja);function wh(e,t,i){e=ot(e,gt);var o=ot(e.firestore,_t),s=_s(e.converter,t,i);return oo(o,[vs(er(o),"setDoc",e._key,s,null!==e.converter,i).toMutation(e._key,zt.none())])}function Th(e,t,i){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];e=ot(e,gt);var a=ot(e.firestore,_t),u=er(a);return oo(a,[("string"==typeof(t=(0,_.m9)(t))||t instanceof Ne?Ka(u,"updateDoc",e._key,t,i,o):Ga(u,"updateDoc",e._key,t)).toMutation(e._key,zt.exists(!0))])}function Ih(e){for(var t,i,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];e=(0,_.m9)(e);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||ai(s[c])||(u=s[c],c++);var l,d,p,v={includeMetadataChanges:u.includeMetadataChanges};if(ai(s[c])){var w=s[c];s[c]=null===(t=w.next)||void 0===t?void 0:t.bind(w),s[c+1]=null===(i=w.error)||void 0===i?void 0:i.bind(w),s[c+2]=null===(o=w.complete)||void 0===o?void 0:o.bind(w)}if(e instanceof gt)d=ot(e.firestore,_t),p=Ur(e._key.path),l={next:function(x){s[c]&&s[c](Za(d,e,x))},error:s[c+1],complete:s[c+2]};else{var S=ot(e,ie);d=ot(S.firestore,_t),p=S._query;var E=new ir(d);l={next:function(x){s[c]&&s[c](new Tn(d,E,S,x))},error:s[c+1],complete:s[c+2]},dh(e._query)}return function(x,L,V,H){var Q=this,tt=new hs(H),rt=new xa(L,tt,V);return x.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(Q,void 0,void 0,function(){var at;return(0,g.Jh)(this,function(Bt){switch(Bt.label){case 0:return at=Sa,[4,si(x)];case 1:return[2,at.apply(void 0,[Bt.sent(),rt])]}})})}),function(){tt.Wo(),x.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(Q,void 0,void 0,function(){var at;return(0,g.Jh)(this,function(Bt){switch(Bt.label){case 0:return at=Ca,[4,si(x)];case 1:return[2,at.apply(void 0,[Bt.sent(),rt])]}})})})}}(Lt(d),p,v,l)}function oo(e,t){return function(i,o){var s=this,a=new Jt;return i.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(s,void 0,void 0,function(){var u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return u=jd,[4,qa(i)];case 1:return[2,u.apply(void 0,[c.sent(),o,a])]}})})}),a.promise}(Lt(e),t)}function Za(e,t,i){var o=i.docs.get(t._key),s=new ir(e);return new He(e,s,t._key,o,new rr(i.hasPendingWrites,i.fromCache),t.converter)}var Dp=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this)._firestore=i,s}return(0,g.ZT)(t,e),t.prototype.get=function(i){var o=this,s=En(i,this._firestore),a=new ir(this._firestore);return e.prototype.get.call(this,i).then(function(u){return new He(o._firestore,a,s._key,u._document,new rr(!1,!1),s.converter)})},t}(function(){function e(t,i){this._firestore=t,this._transaction=i,this._dataReader=er(t)}return e.prototype.get=function(t){var i=this,o=En(t,this._firestore),s=new xp(this._firestore);return this._transaction.lookup([o._key]).then(function(a){if(!a||1!==a.length)return K();var u=a[0];if(u.isFoundDocument())return new no(i._firestore,s,u.key,u,o.converter);if(u.isNoDocument())return new no(i._firestore,s,o._key,null,o.converter);throw K()})},e.prototype.set=function(t,i,o){var s=En(t,this._firestore),a=_s(s.converter,i,o),u=vs(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,o);return this._transaction.set(s._key,u),this},e.prototype.update=function(t,i,o){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];var u,c=En(t,this._firestore);return u="string"==typeof(i=(0,_.m9)(i))||i instanceof Ne?Ka(this._dataReader,"Transaction.update",c._key,i,o,s):Ga(this._dataReader,"Transaction.update",c._key,i),this._transaction.update(c._key,u),this},e.prototype.delete=function(t){var i=En(t,this._firestore);return this._transaction.delete(i._key),this},e}());function Eh(){if("undefined"==typeof Uint8Array)throw new N(A.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Sh(){if("undefined"==typeof atob)throw new N(A.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ch=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return Sh(),new e($n.fromBase64String(t))},e.fromUint8Array=function(t){return Eh(),new e($n.fromUint8Array(t))},e.prototype.toBase64=function(){return Sh(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return Eh(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),kp=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,i){return function(o,s){rh(o=ot(o,_t));var a=Lt(o),u=o._freezeSettings(),c=new La;return nh(a,c,new Ll(c,u.cacheSizeBytes,null==s?void 0:s.forceOwnership))}(t._delegate,{forceOwnership:i})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(i){rh(i=ot(i,_t));var o=Lt(i),s=i._freezeSettings(),a=new La;return nh(o,a,new rp(a,s.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(i){var o=this;if(i._initialized&&!i._terminated)throw new N(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var s=new Jt;return i._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,g.mG)(o,void 0,void 0,function(){var a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,function(c){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(d){switch(d.label){case 0:return Hr.yt()?[4,Hr.delete(c+"main")]:[2,Promise.resolve()];case 1:return d.sent(),[2]}})})}(pa(i._databaseId,i._persistenceKey))];case 1:return u.sent(),s.resolve(),[3,3];case 2:return a=u.sent(),s.reject(a),[3,3];case 3:return[2]}})})}),s.promise}(t._delegate)},e}(),Ah=function(){function e(t,i,o){var s=this;this._delegate=i,this.Zc=o,this.INTERNAL={delete:function(){return s.terminate()}},t instanceof ds||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var i=this._delegate._getSettings();t.merge||i.host===t.host||Oi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},i),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,i,o){void 0===o&&(o={}),function(s,a,u,c){var l;void 0===c&&(c={});var d=(s=ot(s,eo))._getSettings();if("firestore.googleapis.com"!==d.host&&d.host!==a&&Oi("Host has been set in both settings() and useEmulator(), emulator host will be used"),s._setSettings(Object.assign(Object.assign({},d),{host:a+":"+u,ssl:!1})),c.mockUserToken){var p,v;if("string"==typeof c.mockUserToken)p=c.mockUserToken,v=jt.MOCK_USER;else{p=(0,_.Sg)(c.mockUserToken,null===(l=s._app)||void 0===l?void 0:l.options.projectId);var w=c.mockUserToken.sub||c.mockUserToken.user_id;if(!w)throw new N(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new jt(w)}s._credentials=new cp(new zl(p,v))}}(this._delegate,t,i,o)},e.prototype.enableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,g.mG)(i,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,Vl(t)];case 1:return o=a.sent(),[4,jl(t)];case 2:return s=a.sent(),[2,(o.setNetworkEnabled(!0),u=s,c=j(u),c.Or.delete(0),$i(c))]}var u,c})})})}(Lt(ot(this._delegate,_t)))},e.prototype.disableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,g.mG)(i,void 0,void 0,function(){var o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,Vl(t)];case 1:return o=a.sent(),[4,jl(t)];case 2:return s=a.sent(),[2,(o.setNetworkEnabled(!1),function(u){return(0,g.mG)(this,void 0,void 0,function(){var c;return(0,g.Jh)(this,function(l){switch(l.label){case 0:return(c=j(u)).Or.add(0),[4,ei(c)];case 1:return l.sent(),c.Br.set("Offline"),[2]}})})}(s))]}})})})}(Lt(ot(this._delegate,_t)))},e.prototype.enablePersistence=function(t){var i=!1,o=!1;return t&&Ql("synchronizeTabs",i=!!t.synchronizeTabs,"experimentalForceOwningTab",o=!!t.experimentalForceOwningTab),i?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,o)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var i=this,o=new Jt;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(i,void 0,void 0,function(){var s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return s=zd,[4,qa(t)];case 1:return[2,s.apply(void 0,[a.sent(),o])]}})})}),o.promise}(Lt(ot(this._delegate,_t)))},e.prototype.onSnapshotsInSync=function(t){return o=t,function(s,a){var u=this,c=new hs(a);return s.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(u,void 0,void 0,function(){var l;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return l=function(p,v){j(p).Gr.add(v),v.next()},[4,si(s)];case 1:return[2,l.apply(void 0,[d.sent(),c])]}})})}),function(){c.Wo(),s.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(u,void 0,void 0,function(){var l;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return l=function(p,v){j(p).Gr.delete(v)},[4,si(s)];case 1:return[2,l.apply(void 0,[d.sent(),c])]}})})})}}(Lt(ot(this._delegate,_t)),ai(o)?o:{next:o});var o},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new N(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Is(this,Yl(this._delegate,t))}catch(i){throw Wt(i,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new or(this,gs(this._delegate,t))}catch(i){throw Wt(i,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new uo(this,function(i,o){if(i=ot(i,eo),Va("collectionGroup","collection id",o),o.indexOf("/")>=0)throw new N(A.INVALID_ARGUMENT,"Invalid collection ID '"+o+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ie(i,null,(s=o,new Be(it.emptyPath(),s)));var s}(this._delegate,t))}catch(i){throw Wt(i,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var o,i=this;return function(a,u){var c=this,l=new Jt;return a.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(c,void 0,void 0,function(){var d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:return[4,(v=a,fs(v).then(function(w){return w.datastore}))];case 1:return d=p.sent(),new sp(a.asyncQueue,d,u,l).run(),[2]}var v})})}),l.promise}(Lt(o=this._delegate),function(a){return function(o){return t(new xh(i,o))}(new Dp(o,a))})},e.prototype.batch=function(){var t=this;return Lt(this._delegate),new Rh(new Rp(this._delegate,function(i){return oo(t._delegate,i)}))},e.prototype.loadBundle=function(t){throw new N(A.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new N(A.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),ws=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,g.ZT)(t,e),t.prototype.convertBytes=function(i){return new Ch(new $n(i))},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return or.eu(o,this.firestore,null)},t}(Ja),xh=function(){function e(t,i){this._firestore=t,this._delegate=i,this._userDataWriter=new ws(t)}return e.prototype.get=function(t){var i=this,o=sr(t);return this._delegate.get(o).then(function(s){return new so(i._firestore,new He(i._firestore._delegate,i._userDataWriter,s._key,s._document,s.metadata,o.converter))})},e.prototype.set=function(t,i,o){var s=sr(t);return o?(ja("Transaction.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,a=[],u=3;u<arguments.length;u++)a[u-3]=arguments[u];var c=sr(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,g.ev)([c,i,o],a)),this},e.prototype.delete=function(t){var i=sr(t);return this._delegate.delete(i),this},e}(),Rh=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,i,o){var s=sr(t);return o?(ja("WriteBatch.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,a=[],u=3;u<arguments.length;u++)a[u-3]=arguments[u];var c=sr(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,g.ev)([c,i,o],a)),this},e.prototype.delete=function(t){var i=sr(t);return this._delegate.delete(i),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),Ts=function(){function e(t,i,o){this._firestore=t,this._userDataWriter=i,this._delegate=o}return e.prototype.fromFirestore=function(t,i){var o=new ro(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new ao(this._firestore,o),null!=i?i:{})},e.prototype.toFirestore=function(t,i){return i?this._delegate.toFirestore(t,i):this._delegate.toFirestore(t)},e.nu=function(t,i){var o=e.su,s=o.get(t);s||o.set(t,s=new WeakMap);var a=s.get(i);return a||(a=new e(t,new ws(t),i),s.set(i,a)),a},e}();Ts.su=new WeakMap;var or=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new ws(t)}return e.iu=function(t,i,o){if(t.length%2!=0)throw new N(A.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(i,new gt(i._delegate,o,new z(t)))},e.eu=function(t,i,o){return new e(i,new gt(i._delegate,o,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Is(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Is(this.firestore,Yl(this._delegate,t))}catch(i){throw Wt(i,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=(0,_.m9)(t))instanceof gt&&$l(this._delegate,t)},e.prototype.set=function(t,i){i=ja("DocumentReference.set",i);try{return i?wh(this._delegate,t,i):wh(this._delegate,t)}catch(o){throw Wt(o,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,i){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];try{return 1===arguments.length?Th(this._delegate,t):Th.apply(void 0,(0,g.ev)([this._delegate,t,i],o))}catch(a){throw Wt(a,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return oo(ot((t=this._delegate).firestore,_t),[new zi(t._key,zt.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=Dh(i),a=kh(i,function(u){return new so(t.firestore,new He(t.firestore._delegate,t._userDataWriter,u._key,u._document,u.metadata,t._delegate.converter))});return Ih(this._delegate,s,a)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=ot(o,gt);var s=ot(o.firestore,_t),a=Lt(s),u=new ir(s);return function(c,l){var d=this,p=new Jt;return c.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(d,void 0,void 0,function(){var v;return(0,g.Jh)(this,function(w){switch(w.label){case 0:return v=function(S,E,x){return(0,g.mG)(this,void 0,void 0,function(){var L,V;return(0,g.Jh)(this,function(H){switch(H.label){case 0:return H.trys.push([0,2,,3]),[4,(Q=S,tt=E,rt=j(Q),rt.persistence.runTransaction("read document","readonly",function(at){return rt.Mn.mn(at,tt)}))];case 1:return(V=H.sent()).isFoundDocument()?x.resolve(V):V.isNoDocument()?x.resolve(null):x.reject(new N(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return L=H.sent(),V=ii(L,"Failed to get document '"+E+" from cache"),x.reject(V),[3,3];case 3:return[2]}var Q,tt,rt})})},[4,Ua(c)];case 1:return[2,v.apply(void 0,[w.sent(),l,p])]}})})}),p.promise}(a,o._key).then(function(c){return new He(s,u,o._key,c,new rr(null!==c&&c.hasLocalMutations,!0),o.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=ot(o,gt);var s=ot(o.firestore,_t);return Bl(Lt(s),o._key,{source:"server"}).then(function(a){return Za(s,o,a)})}(this._delegate):function(o){o=ot(o,gt);var s=ot(o.firestore,_t);return Bl(Lt(s),o._key).then(function(a){return Za(s,o,a)})}(this._delegate)).then(function(o){return new so(i.firestore,new He(i.firestore._delegate,i._userDataWriter,o._key,o._document,o.metadata,i._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Ts.nu(this.firestore,t):null))},e}();function Wt(e,t,i){return e.message=e.message.replace(t,i),e}function Dh(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];if("object"==typeof o&&!ai(o))return o}return{}}function kh(e,t){var i,o,s;return{next:function(a){s.next&&s.next(t(a))},error:null===(i=(s=ai(e[0])?e[0]:ai(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===i?void 0:i.bind(s),complete:null===(o=s.complete)||void 0===o?void 0:o.bind(s)}}var so=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"ref",{get:function(){return new or(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,i){return this._delegate.get(t,i)},e.prototype.isEqual=function(t){return fh(this._delegate,t._delegate)},e}(),ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,g.ZT)(t,e),t.prototype.data=function(i){return this._delegate.data(i)},t}(so),uo=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new ws(t)}return e.prototype.where=function(t,i,o){try{return new e(this.firestore,In(this._delegate,(u=o,c=i,l=bs("where",s=t),new Cp(l,c,u))))}catch(s){throw Wt(s,/(orderBy|where)\(\)/,"Query.$1()")}var s,u,c,l},e.prototype.orderBy=function(t,i){try{return new e(this.firestore,In(this._delegate,function(o,s){void 0===s&&(s="asc");var a=s,u=bs("orderBy",o);return new Ap(u,a)}(t,i)))}catch(o){throw Wt(o,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,In(this._delegate,(Wl("limit",i=t),new ph("limit",i,"F"))))}catch(i){throw Wt(i,"limit()","Query.limit()")}var i},e.prototype.limitToLast=function(t){try{return new e(this.firestore,In(this._delegate,(Wl("limitToLast",i=t),new ph("limitToLast",i,"L"))))}catch(i){throw Wt(i,"limitToLast()","Query.limitToLast()")}var i},e.prototype.startAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,In(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new gh("startAt",o,!0)}.apply(void 0,t)))}catch(o){throw Wt(o,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,In(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new gh("startAfter",o,!1)}.apply(void 0,t)))}catch(o){throw Wt(o,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,In(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new mh("endBefore",o,!0)}.apply(void 0,t)))}catch(o){throw Wt(o,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,In(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new mh("endAt",o,!1)}.apply(void 0,t)))}catch(o){throw Wt(o,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return th(this._delegate,t._delegate)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=ot(o,ie);var s=ot(o.firestore,_t),a=Lt(s),u=new ir(s);return function(c,l){var d=this,p=new Jt;return c.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(d,void 0,void 0,function(){var v;return(0,g.Jh)(this,function(w){switch(w.label){case 0:return v=function(S,E,x){return(0,g.mG)(this,void 0,void 0,function(){var L,V,H,Q,tt;return(0,g.Jh)(this,function(rt){switch(rt.label){case 0:return rt.trys.push([0,2,,3]),[4,ss(S,E,!0)];case 1:return tt=rt.sent(),L=new Rl(E,tt.Bn),V=L._o(tt.documents),H=L.applyChanges(V,!1),x.resolve(H.snapshot),[3,3];case 2:return Q=rt.sent(),tt=ii(Q,"Failed to execute query '"+E+" against cache"),x.reject(tt),[3,3];case 3:return[2]}})})},[4,Ua(c)];case 1:return[2,v.apply(void 0,[w.sent(),l,p])]}})})}),p.promise}(a,o._query).then(function(c){return new Tn(s,u,o,c)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=ot(o,ie);var s=ot(o.firestore,_t),a=Lt(s),u=new ir(s);return Gl(a,o._query,{source:"server"}).then(function(c){return new Tn(s,u,o,c)})}(this._delegate):function(o){o=ot(o,ie);var s=ot(o.firestore,_t),a=Lt(s),u=new ir(s);return dh(o._query),Gl(a,o._query).then(function(c){return new Tn(s,u,o,c)})}(this._delegate)).then(function(o){return new Wa(i.firestore,new Tn(i.firestore._delegate,i._userDataWriter,i._delegate,o._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=Dh(i),a=kh(i,function(u){return new Wa(t.firestore,new Tn(t.firestore._delegate,t._userDataWriter,t._delegate,u._snapshot))});return Ih(this._delegate,s,a)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Ts.nu(this.firestore,t):null))},e}(),Np=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new ao(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),Wa=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"query",{get:function(){return new uo(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(i){return new ao(t._firestore,i)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var i=this;return this._delegate.docChanges(t).map(function(o){return new Np(i._firestore,o)})},e.prototype.forEach=function(t,i){var o=this;this._delegate.forEach(function(s){t.call(i,new ao(o._firestore,s))})},e.prototype.isEqual=function(t){return fh(this._delegate,t._delegate)},e}(),Is=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).firestore=i,s._delegate=o,s}return(0,g.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._delegate.parent;return i?new or(this.firestore,i):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(i){try{return new or(this.firestore,void 0===i?gs(this._delegate):gs(this._delegate,i))}catch(o){throw Wt(o,"doc()","CollectionReference.doc()")}},t.prototype.add=function(i){var s,a,u,c,l,o=this;return(s=this._delegate,a=i,u=ot(s.firestore,_t),c=gs(s),l=_s(s.converter,a),oo(u,[vs(er(s.firestore),"addDoc",c._key,l,null!==s.converter,{}).toMutation(c._key,zt.exists(!1))]).then(function(){return c})).then(function(s){return new or(o.firestore,s)})},t.prototype.isEqual=function(i){return $l(this._delegate,i._delegate)},t.prototype.withConverter=function(i){return new t(this.firestore,this._delegate.withConverter(i?Ts.nu(this.firestore,i):null))},t}(uo);function sr(e){return ot(e,gt)}var Mp=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._delegate=new(Ne.bind.apply(Ne,(0,g.ev)([void 0],t)))}return e.documentId=function(){return new e(we.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=(0,_.m9)(t))instanceof Ne&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),Op=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new bp("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Ba("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new _p("arrayUnion",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayUnion",new e(o)},e.arrayRemove=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new wp("arrayRemove",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayRemove",new e(o)},e.increment=function(t){var i=new Tp("increment",t);return i._methodName="FieldValue.increment",new e(i)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}(),Lp=ut(2461),Fp={Firestore:Ah,GeoPoint:ms,Timestamp:ee,Blob:Ch,Transaction:xh,WriteBatch:Rh,DocumentReference:or,DocumentSnapshot:so,Query:uo,QueryDocumentSnapshot:ao,QuerySnapshot:Wa,CollectionReference:Is,FieldPath:Mp,FieldValue:Op,setLogLevel:function Pp(e){_e.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};!function Up(e){e.INTERNAL.registerComponent(new Lp.wA("firestore",function(o){return t=o.getProvider("app").getImmediate(),i=o.getProvider("auth-internal"),new Ah(t,new _t(t,i),new kp);var t,i},"PUBLIC").setServiceProps(Object.assign({},Fp))),e.registerVersion("@firebase/firestore","2.4.1")}(Me.Z)},1589:(Ya,ar,ut)=>{ut.r(ar);var Me=ut(8367),g=ut(655),_=ut(492),Xt=ut(2461),Ft="firebasestorage.googleapis.com",Oe="storageBucket",F=function(f){function h(m,b){var I=f.call(this,Le(m),"Firebase Storage: "+b+" ("+Le(m)+")")||this;return I.customData={serverResponse:null},I._baseMessage=I.message,Object.setPrototypeOf(I,h.prototype),I}return(0,g.ZT)(h,f),h.prototype._codeEquals=function(m){return Le(m)===this.code},Object.defineProperty(h.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(m){this.customData.serverResponse=m,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),h}(_.ZR);function Le(f){return"storage/"+f}function J(){return new F("unknown","An unknown error occurred, please check the error payload for server response.")}function ur(){return new F("canceled","User canceled the upload/download.")}function ft(){return new F("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Ue(f){return new F("invalid-argument",f)}function An(){return new F("app-deleted","The Firebase app was deleted.")}function lr(f){return new F("invalid-root-operation","The operation '"+f+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qe(f,h){return new F("invalid-format","String does not match format '"+f+"': "+h)}function Je(f){throw new F("internal-error","Internal error: "+f)}var Dt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Ee=function f(h,m){this.data=h,this.contentType=m||null};function mt(f,h){switch(f){case Dt.RAW:return new Ee(xn(h));case Dt.BASE64:case Dt.BASE64URL:return new Ee(Ze(f,h));case Dt.DATA_URL:return new Ee(function Se(f){var h=new We(f);return h.base64?Ze(Dt.BASE64,h.rest):function xt(f){var h;try{h=decodeURIComponent(f)}catch(m){throw Qe(Dt.DATA_URL,"Malformed data URL.")}return xn(h)}(h.rest)}(h),function Rn(f){return new We(f).contentType}(h))}throw J()}function xn(f){for(var h=[],m=0;m<f.length;m++){var b=f.charCodeAt(m);if(b<=127)h.push(b);else if(b<=2047)h.push(192|b>>6,128|63&b);else if(55296==(64512&b))if(m<f.length-1&&56320==(64512&f.charCodeAt(m+1))){var C=b,P=f.charCodeAt(++m);h.push(240|(b=65536|(1023&C)<<10|1023&P)>>18,128|b>>12&63,128|b>>6&63,128|63&b)}else h.push(239,191,189);else 56320==(64512&b)?h.push(239,191,189):h.push(224|b>>12,128|b>>6&63,128|63&b)}return new Uint8Array(h)}function Ze(f,h){switch(f){case Dt.BASE64:var m=-1!==h.indexOf("-"),b=-1!==h.indexOf("_");if(m||b)throw Qe(f,"Invalid character '"+(m?"-":"_")+"' found: is it base64url encoded?");break;case Dt.BASE64URL:var C=-1!==h.indexOf("+"),P=-1!==h.indexOf("/");if(C||P)throw Qe(f,"Invalid character '"+(C?"+":"/")+"' found: is it base64 encoded?");h=h.replace(/-/g,"+").replace(/_/g,"/")}var B;try{B=function hr(f){return atob(f)}(h)}catch(Z){throw Qe(f,"Invalid character found")}for(var q=new Uint8Array(B.length),G=0;G<B.length;G++)q[G]=B.charCodeAt(G);return q}var We=function f(h){this.base64=!1,this.contentType=null;var m=h.match(/^data:([^,]+)?,/);if(null===m)throw Qe(Dt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var b=m[1]||null;null!=b&&(this.base64=function fr(f,h){return f.length>=h.length&&f.substring(f.length-h.length)===h}(b,";base64"),this.contentType=this.base64?b.substring(0,b.length-";base64".length):b),this.rest=h.substring(h.indexOf(",")+1)},Xe={STATE_CHANGED:"state_changed"},yt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Dn(f){switch(f){case"running":case"pausing":case"canceling":return yt.RUNNING;case"paused":return yt.PAUSED;case"success":return yt.SUCCESS;case"canceled":return yt.CANCELED;default:return yt.ERROR}}var de=(()=>{return(f=de||(de={}))[f.NO_ERROR=0]="NO_ERROR",f[f.NETWORK_ERROR=1]="NETWORK_ERROR",f[f.ABORT=2]="ABORT",de;var f})(),Ce=function(){function f(){var h=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=de.NO_ERROR,this.sendPromise_=new Promise(function(m){h.xhr_.addEventListener("abort",function(){h.errorCode_=de.ABORT,m()}),h.xhr_.addEventListener("error",function(){h.errorCode_=de.NETWORK_ERROR,m()}),h.xhr_.addEventListener("load",function(){m()})})}return f.prototype.send=function(h,m,b,I){if(this.sent_)throw Je("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(m,h,!0),void 0!==I)for(var C in I)I.hasOwnProperty(C)&&this.xhr_.setRequestHeader(C,I[C].toString());return void 0!==b?this.xhr_.send(b):this.xhr_.send(),this.sendPromise_},f.prototype.getErrorCode=function(){if(!this.sent_)throw Je("cannot .getErrorCode() before sending");return this.errorCode_},f.prototype.getStatus=function(){if(!this.sent_)throw Je("cannot .getStatus() before sending");try{return this.xhr_.status}catch(h){return-1}},f.prototype.getResponseText=function(){if(!this.sent_)throw Je("cannot .getResponseText() before sending");return this.xhr_.responseText},f.prototype.abort=function(){this.xhr_.abort()},f.prototype.getResponseHeader=function(h){return this.xhr_.getResponseHeader(h)},f.prototype.addUploadProgressListener=function(h){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",h)},f.prototype.removeUploadProgressListener=function(h){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",h)},f}(),kn=function(){function f(){}return f.prototype.createConnection=function(){return function dr(){return new Ce}()},f}(),Gt=function(){function f(h,m){this.bucket=h,this.path_=m}return Object.defineProperty(f.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),f.prototype.fullServerUrl=function(){var h=encodeURIComponent;return"/b/"+h(this.bucket)+"/o/"+h(this.path)},f.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},f.makeFromBucketSpec=function(h,m){var b;try{b=f.makeFromUrl(h,m)}catch(I){return new f(h,"")}if(""===b.path)return b;throw function wt(f){return new F("invalid-default-bucket","Invalid default bucket '"+f+"'.")}(h)},f.makeFromUrl=function(h,m){var b=null,I="([A-Za-z0-9.\\-_]+)",B=new RegExp("^gs://"+I+"(/(.*))?$","i");function G(te){te.path_=decodeURIComponent(te.path)}for(var W=m.replace(/[.]/g,"\\."),Yt=[{regex:B,indices:{bucket:1,path:3},postModify:function C(te){"/"===te.path.charAt(te.path.length-1)&&(te.path_=te.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+W+"/v[A-Za-z0-9_]+/b/"+I+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:G},{regex:new RegExp("^https?://"+(m===Ft?"(?:storage.googleapis.com|storage.cloud.google.com)":m)+"/"+I+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:G}],be=0;be<Yt.length;be++){var ln=Yt[be],hn=ln.regex.exec(h);if(hn){var $t=hn[ln.indices.path];$t||($t=""),b=new f(hn[ln.indices.bucket],$t),ln.postModify(b);break}}if(null==b)throw function ho(f){return new F("invalid-url","Invalid URL '"+f+"'.")}(h);return b},f}(),hi=function(){function f(h){this.promise_=Promise.reject(h)}return f.prototype.getPromise=function(){return this.promise_},f.prototype.cancel=function(h){},f}();function R(f){return"string"==typeof f||f instanceof String}function M(f){return k()&&f instanceof Blob}function k(){return"undefined"!=typeof Blob}function Y(f,h,m,b){if(b<h)throw Ue("Invalid value for '"+f+"'. Expected "+h+" or greater.");if(b>m)throw Ue("Invalid value for '"+f+"'. Expected "+m+" or less.")}function lt(f,h){var m=h.match(/^(\w+):\/\/.+/),I=h;return null==(null==m?void 0:m[1])&&(I="https://"+h),I+"/v0"+f}function gr(f){var h=encodeURIComponent,m="?";for(var b in f)f.hasOwnProperty(b)&&(m=m+(h(b)+"=")+h(f[b])+"&");return m.slice(0,-1)}var kt=function(){function f(h,m,b,I,C,P,B,q,G,Z,W){var dt=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=h,this.method_=m,this.headers_=b,this.body_=I,this.successCodes_=C.slice(),this.additionalRetryCodes_=P.slice(),this.callback_=B,this.errorCallback_=q,this.progressCallback_=Z,this.timeout_=G,this.pool_=W,this.promise_=new Promise(function(Nt,ct){dt.resolve_=Nt,dt.reject_=ct,dt.start_()})}return f.prototype.start_=function(){var h=this;function b(I,C){var P=h.resolve_,B=h.reject_,q=C.connection;if(C.wasSuccessCode)try{var G=h.callback_(q,q.getResponseText());!function D(f){return void 0!==f}(G)?P():P(G)}catch(W){B(W)}else if(null!==q)(Z=J()).serverResponse=q.getResponseText(),B(h.errorCallback_?h.errorCallback_(q,Z):Z);else if(C.canceled)B(Z=h.appDelete_?An():ur());else{var Z;B(Z=function li(){return new F("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}())}}this.canceled_?b(0,new Ae(!1,null,!0)):this.backoffId_=function pr(f,h,m){var b=1,I=null,C=!1,P=0;function B(){return 2===P}var q=!1;function G(){for(var ct=[],pt=0;pt<arguments.length;pt++)ct[pt]=arguments[pt];q||(q=!0,h.apply(null,ct))}function Z(ct){I=setTimeout(function(){I=null,f(W,B())},ct)}function W(ct){for(var pt=[],It=1;It<arguments.length;It++)pt[It-1]=arguments[It];if(!q){if(ct)return void G.call.apply(G,(0,g.ev)([null,ct],pt));var Kt;if(B()||C)return void G.call.apply(G,(0,g.ev)([null,ct],pt));b<64&&(b*=2),1===P?(P=2,Kt=0):Kt=1e3*(b+Math.random()),Z(Kt)}}var dt=!1;function Nt(ct){dt||(dt=!0,!q&&(null!==I?(ct||(P=2),clearTimeout(I),Z(0)):ct||(P=1)))}return Z(0),setTimeout(function(){C=!0,Nt(!0)},m),Nt}(function m(I,C){if(C)I(!1,new Ae(!1,null,!0));else{var P=h.pool_.createConnection();h.pendingConnection_=P,null!==h.progressCallback_&&P.addUploadProgressListener(B),P.send(h.url_,h.method_,h.body_,h.headers_).then(function(){null!==h.progressCallback_&&P.removeUploadProgressListener(B),h.pendingConnection_=null;var q=P.getErrorCode()===de.NO_ERROR,G=P.getStatus();if(q&&!h.isRetryStatusCode_(G)){var W=-1!==h.successCodes_.indexOf(G);I(!0,new Ae(W,P))}else{var Z=P.getErrorCode()===de.ABORT;I(!1,new Ae(!1,null,Z))}})}function B(q){null!==h.progressCallback_&&h.progressCallback_(q.loaded,q.lengthComputable?q.total:-1)}},b,this.timeout_)},f.prototype.getPromise=function(){return this.promise_},f.prototype.cancel=function(h){this.canceled_=!0,this.appDelete_=h||!1,null!==this.backoffId_&&function Ye(f){f(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()},f.prototype.isRetryStatusCode_=function(h){var m=h>=500&&h<600,I=-1!==[408,429].indexOf(h),C=-1!==this.additionalRetryCodes_.indexOf(h);return m||I||C},f}(),Ae=function f(h,m,b){this.wasSuccessCode=h,this.connection=m,this.canceled=!!b};function vr(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function fi(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];var m=vr();if(void 0!==m){for(var b=new m,I=0;I<f.length;I++)b.append(f[I]);return b.getBlob()}if(k())return new Blob(f);throw new F("unsupported-environment","This browser doesn't seem to support creating Blobs")}var Nn=function(){function f(h,m){var b=0,I="";M(h)?(this.data_=h,b=h.size,I=h.type):h instanceof ArrayBuffer?(m?this.data_=new Uint8Array(h):(this.data_=new Uint8Array(h.byteLength),this.data_.set(new Uint8Array(h))),b=this.data_.length):h instanceof Uint8Array&&(m?this.data_=h:(this.data_=new Uint8Array(h.length),this.data_.set(h)),b=h.length),this.size_=b,this.type_=I}return f.prototype.size=function(){return this.size_},f.prototype.type=function(){return this.type_},f.prototype.slice=function(h,m){if(M(this.data_)){var I=function di(f,h,m){return f.webkitSlice?f.webkitSlice(h,m):f.mozSlice?f.mozSlice(h,m):f.slice?f.slice(h,m):null}(this.data_,h,m);return null===I?null:new f(I)}return new f(new Uint8Array(this.data_.buffer,h,m-h),!0)},f.getBlob=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];if(k()){var b=h.map(function(q){return q instanceof f?q.data_:q});return new f(fi.apply(null,b))}var I=h.map(function(q){return R(q)?mt(Dt.RAW,q).data:q.data_}),C=0;I.forEach(function(q){C+=q.byteLength});var P=new Uint8Array(C),B=0;return I.forEach(function(q){for(var G=0;G<q.length;G++)P[B++]=q[G]}),new f(P,!0)},f.prototype.uploadData=function(){return this.data_},f}();function Mn(f){var h;try{h=JSON.parse(f)}catch(m){return null}return function T(f){return"object"==typeof f&&!Array.isArray(f)}(h)?h:null}function go(f){var h=f.lastIndexOf("/",f.length-2);return-1===h?f:f.slice(h+1)}function mo(f,h){return h}var Pt=function f(h,m,b,I){this.server=h,this.local=m||h,this.writable=!!b,this.xform=I||mo},$e=null;function yr(){if($e)return $e;var f=[];f.push(new Pt("bucket")),f.push(new Pt("generation")),f.push(new Pt("metageneration")),f.push(new Pt("name","fullPath",!0));var m=new Pt("name");m.xform=function h(C,P){return function vo(f){return!R(f)||f.length<2?f:go(f)}(P)},f.push(m);var I=new Pt("size");return I.xform=function b(C,P){return void 0!==P?Number(P):P},f.push(I),f.push(new Pt("timeCreated")),f.push(new Pt("updated")),f.push(new Pt("md5Hash",null,!0)),f.push(new Pt("cacheControl",null,!0)),f.push(new Pt("contentDisposition",null,!0)),f.push(new Pt("contentEncoding",null,!0)),f.push(new Pt("contentLanguage",null,!0)),f.push(new Pt("contentType",null,!0)),f.push(new Pt("metadata","customMetadata",!0)),$e=f}function br(f,h,m){var b=Mn(h);return null===b?null:function gi(f,h,m){for(var b={type:"file"},I=m.length,C=0;C<I;C++){var P=m[C];b[P.local]=P.xform(b,h[P.server])}return function pi(f,h){Object.defineProperty(f,"ref",{get:function m(){var C=new Gt(f.bucket,f.fullPath);return h._makeStorageReference(C)}})}(b,f),b}(f,b,m)}function bt(f,h){for(var m={},b=h.length,I=0;I<b;I++){var C=h[I];C.writable&&(m[C.server]=f[C.local])}return JSON.stringify(m)}var On="prefixes";var pe=function f(h,m,b,I){this.url=h,this.method=m,this.handler=b,this.timeout=I,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function ge(f){if(!f)throw J()}function wr(f,h){return function m(b,I){var C=br(f,I,h);return ge(null!==C),C}}function tn(f){return function h(m,b){var I;return I=401===m.getStatus()?m.getResponseText().includes("Firebase App Check token is invalid")?function ci(){return new F("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}():function Ie(){return new F("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===m.getStatus()?function Sn(f){return new F("quota-exceeded","Quota for bucket '"+f+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(f.bucket):403===m.getStatus()?function Cn(f){return new F("unauthorized","User does not have permission to access '"+f+"'.")}(f.path):b,I.serverResponse=b.serverResponse,I}}function en(f){var h=tn(f);return function m(b,I){var C=h(b,I);return 404===b.getStatus()&&(C=function he(f){return new F("object-not-found","Object '"+f+"' does not exist.")}(f.path)),C.serverResponse=I.serverResponse,C}}function yi(f,h,m){var I=lt(h.fullServerUrl(),f.host),P=f.maxOperationRetryTime,B=new pe(I,"GET",wr(f,m),P);return B.errorHandler=en(h),B}function Rs(f,h,m,b,I){var C={};C.prefix=h.isRoot?"":h.path+"/",m&&m.length>0&&(C.delimiter=m),b&&(C.pageToken=b),I&&(C.maxResults=I);var B=lt(h.bucketOnlyServerUrl(),f.host),G=f.maxOperationRetryTime,Z=new pe(B,"GET",function mi(f,h){return function m(b,I){var C=function xs(f,h,m){var b=Mn(m);return null===b?null:function As(f,h,m){var b={prefixes:[],items:[],nextPageToken:m.nextPageToken};if(m[On])for(var I=0,C=m[On];I<C.length;I++){var B=C[I].replace(/\/$/,""),q=f._makeStorageReference(new Gt(h,B));b.prefixes.push(q)}if(m.items)for(var G=0,Z=m.items;G<Z.length;G++)q=f._makeStorageReference(new Gt(h,Z[G].name)),b.items.push(q);return b}(f,h,b)}(f,h,I);return ge(null!==C),C}}(f,h.bucket),G);return Z.urlParams=C,Z.errorHandler=tn(h),Z}function bo(f,h,m){var b=Object.assign({},m);return b.fullPath=f.path,b.size=h.size(),b.contentType||(b.contentType=function yo(f,h){return f&&f.contentType||h&&h.type()||"application/octet-stream"}(null,h)),b}var Fn=function f(h,m,b,I){this.current=h,this.total=m,this.finalized=!!b,this.metadata=I||null};function Ir(f,h){var m=null;try{m=f.getResponseHeader("X-Goog-Upload-Status")}catch(I){ge(!1)}return ge(!!m&&-1!==(h||["active"]).indexOf(m)),m}var nn=function f(h,m,b){var I=function y(f){return"function"==typeof f}(h)||null!=m||null!=b;if(I)this.next=h,this.error=m,this.complete=b;else{var C=h;this.next=C.next,this.error=C.error,this.complete=C.complete}};function rn(f){return function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];Promise.resolve().then(function(){return f.apply(void 0,h)})}}var To=function(){function f(h,m,b){var I=this;void 0===b&&(b=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=h,this._blob=m,this._metadata=b,this._mappings=yr(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(C){I._request=void 0,I._chunkMultiplier=1,C._codeEquals("canceled")?(I._needToFetchStatus=!0,I.completeTransitions_()):(I._error=C,I._transition("error"))},this._metadataErrorHandler=function(C){I._request=void 0,C._codeEquals("canceled")?I.completeTransitions_():(I._error=C,I._transition("error"))},this._promise=new Promise(function(C,P){I._resolve=C,I._reject=P,I._start()}),this._promise.then(null,function(){})}return f.prototype._makeProgressCallback=function(){var h=this,m=this._transferred;return function(b){return h._updateProgress(m+b)}},f.prototype._shouldDoResumable=function(h){return h.size()>262144},f.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},f.prototype._resolveToken=function(h){var m=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(b){var I=b[0],C=b[1];switch(m._state){case"running":h(I,C);break;case"canceling":m._transition("canceled");break;case"pausing":m._transition("paused")}})},f.prototype._createResumable=function(){var h=this;this._resolveToken(function(m,b){var I=function _o(f,h,m,b,I){var C=h.bucketOnlyServerUrl(),P=bo(h,b,I),B={name:P.fullPath},q=lt(C,f.host),Z={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+b.size(),"X-Goog-Upload-Header-Content-Type":P.contentType,"Content-Type":"application/json; charset=utf-8"},W=bt(P,m),ct=new pe(q,"POST",function Nt(pt){var It;Ir(pt);try{It=pt.getResponseHeader("X-Goog-Upload-URL")}catch(xe){ge(!1)}return ge(R(It)),It},f.maxUploadRetryTime);return ct.urlParams=B,ct.headers=Z,ct.body=W,ct.errorHandler=tn(h),ct}(h._ref.storage,h._ref._location,h._mappings,h._blob,h._metadata),C=h._ref.storage._makeRequest(I,m,b);h._request=C,C.getPromise().then(function(P){h._request=void 0,h._uploadUrl=P,h._needToFetchStatus=!1,h.completeTransitions_()},h._errorHandler)})},f.prototype._fetchStatus=function(){var h=this,m=this._uploadUrl;this._resolveToken(function(b,I){var C=function Er(f,h,m,b){var q=new pe(m,"POST",function C(G){var Z=Ir(G,["active","final"]),W=null;try{W=G.getResponseHeader("X-Goog-Upload-Size-Received")}catch(Nt){ge(!1)}W||ge(!1);var dt=Number(W);return ge(!isNaN(dt)),new Fn(dt,b.size(),"final"===Z)},f.maxUploadRetryTime);return q.headers={"X-Goog-Upload-Command":"query"},q.errorHandler=tn(h),q}(h._ref.storage,h._ref._location,m,h._blob),P=h._ref.storage._makeRequest(C,b,I);h._request=P,P.getPromise().then(function(B){B=B,h._request=void 0,h._updateProgress(B.current),h._needToFetchStatus=!1,B.finalized&&(h._needToFetchMetadata=!0),h.completeTransitions_()},h._errorHandler)})},f.prototype._continueUpload=function(){var h=this,m=262144*this._chunkMultiplier,b=new Fn(this._transferred,this._blob.size()),I=this._uploadUrl;this._resolveToken(function(C,P){var B;try{B=function Ds(f,h,m,b,I,C,P,B){var q=new Fn(0,0);if(P?(q.current=P.current,q.total=P.total):(q.current=0,q.total=b.size()),b.size()!==q.total)throw function fe(){return new F("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}();var G=q.total-q.current,Z=G;I>0&&(Z=Math.min(Z,I));var W=q.current,ct={"X-Goog-Upload-Command":Z===G?"upload, finalize":"upload","X-Goog-Upload-Offset":""+q.current},pt=b.slice(W,W+Z);if(null===pt)throw ft();var Yt=new pe(m,"POST",function It(be,ln){var te,hn=Ir(be,["active","final"]),Ve=q.current+Z,$t=b.size();return te="final"===hn?wr(h,C)(be,ln):null,new Fn(Ve,$t,"final"===hn,te)},h.maxUploadRetryTime);return Yt.headers=ct,Yt.body=pt.uploadData(),Yt.progressCallback=B||null,Yt.errorHandler=tn(f),Yt}(h._ref._location,h._ref.storage,I,h._blob,m,h._mappings,b,h._makeProgressCallback())}catch(G){return h._error=G,void h._transition("error")}var q=h._ref.storage._makeRequest(B,C,P);h._request=q,q.getPromise().then(function(G){h._increaseMultiplier(),h._request=void 0,h._updateProgress(G.current),G.finalized?(h._metadata=G.metadata,h._transition("success")):h.completeTransitions_()},h._errorHandler)})},f.prototype._increaseMultiplier=function(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},f.prototype._fetchMetadata=function(){var h=this;this._resolveToken(function(m,b){var I=yi(h._ref.storage,h._ref._location,h._mappings),C=h._ref.storage._makeRequest(I,m,b);h._request=C,C.getPromise().then(function(P){h._request=void 0,h._metadata=P,h._transition("success")},h._metadataErrorHandler)})},f.prototype._oneShotUpload=function(){var h=this;this._resolveToken(function(m,b){var I=function Ln(f,h,m,b,I){var C=h.bucketOnlyServerUrl(),P={"X-Goog-Upload-Protocol":"multipart"},q=function B(){for(var Yt="",be=0;be<2;be++)Yt+=Math.random().toString().slice(2);return Yt}();P["Content-Type"]="multipart/related; boundary="+q;var G=bo(h,b,I),Z=bt(G,m),Nt=Nn.getBlob("--"+q+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Z+"\r\n--"+q+"\r\nContent-Type: "+G.contentType+"\r\n\r\n",b,"\r\n--"+q+"--");if(null===Nt)throw ft();var ct={name:G.fullPath},pt=lt(C,f.host),xe=f.maxUploadRetryTime,Kt=new pe(pt,"POST",wr(f,m),xe);return Kt.urlParams=ct,Kt.headers=P,Kt.body=Nt.uploadData(),Kt.errorHandler=tn(h),Kt}(h._ref.storage,h._ref._location,h._mappings,h._blob,h._metadata),C=h._ref.storage._makeRequest(I,m,b);h._request=C,C.getPromise().then(function(P){h._request=void 0,h._metadata=P,h._updateProgress(h._blob.size()),h._transition("success")},h._errorHandler)})},f.prototype._updateProgress=function(h){var m=this._transferred;this._transferred=h,this._transferred!==m&&this._notifyObservers()},f.prototype._transition=function(h){if(this._state!==h)switch(h){case"canceling":case"pausing":this._state=h,void 0!==this._request&&this._request.cancel();break;case"running":var m="paused"===this._state;this._state=h,m&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=h,this._notifyObservers();break;case"canceled":this._error=ur(),this._state=h,this._notifyObservers()}},f.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(f.prototype,"snapshot",{get:function(){var h=Dn(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:h,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),f.prototype.on=function(h,m,b,I){var C=this,P=new nn(m,b,I);return this._addObserver(P),function(){C._removeObserver(P)}},f.prototype.then=function(h,m){return this._promise.then(h,m)},f.prototype.catch=function(h){return this.then(null,h)},f.prototype._addObserver=function(h){this._observers.push(h),this._notifyObserver(h)},f.prototype._removeObserver=function(h){var m=this._observers.indexOf(h);-1!==m&&this._observers.splice(m,1)},f.prototype._notifyObservers=function(){var h=this;this._finishPromise(),this._observers.slice().forEach(function(b){h._notifyObserver(b)})},f.prototype._finishPromise=function(){if(void 0!==this._resolve){var h=!0;switch(Dn(this._state)){case yt.SUCCESS:rn(this._resolve.bind(null,this.snapshot))();break;case yt.CANCELED:case yt.ERROR:rn(this._reject.bind(null,this._error))();break;default:h=!1}h&&(this._resolve=void 0,this._reject=void 0)}},f.prototype._notifyObserver=function(h){switch(Dn(this._state)){case yt.RUNNING:case yt.PAUSED:h.next&&rn(h.next.bind(h,this.snapshot))();break;case yt.SUCCESS:h.complete&&rn(h.complete.bind(h))();break;default:h.error&&rn(h.error.bind(h,this._error))()}},f.prototype.resume=function(){var h="paused"===this._state||"pausing"===this._state;return h&&this._transition("running"),h},f.prototype.pause=function(){var h="running"===this._state;return h&&this._transition("pausing"),h},f.prototype.cancel=function(){var h="running"===this._state||"pausing"===this._state;return h&&this._transition("canceling"),h},f}(),me=function(){function f(h,m){this._service=h,this._location=m instanceof Gt?m:Gt.makeFromUrl(m,h.host)}return f.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},f.prototype._newRef=function(h,m){return new f(h,m)},Object.defineProperty(f.prototype,"root",{get:function(){var h=new Gt(this._location.bucket,"");return this._newRef(this._service,h)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"name",{get:function(){return go(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){var h=function fo(f){if(0===f.length)return null;var h=f.lastIndexOf("/");return-1===h?"":f.slice(0,h)}(this._location.path);if(null===h)return null;var m=new Gt(this._location.bucket,h);return new f(this._service,m)},enumerable:!1,configurable:!0}),f.prototype._throwIfRoot=function(h){if(""===this._location.path)throw lr(h)},f}();function Sr(f){var h={prefixes:[],items:[]};return wi(f,h).then(function(){return h})}function wi(f,h,m){return(0,g.mG)(this,void 0,void 0,function(){var I,C,P;return(0,g.Jh)(this,function(B){switch(B.label){case 0:return[4,on(f,{pageToken:m})];case 1:return I=B.sent(),(C=h.prefixes).push.apply(C,I.prefixes),(P=h.items).push.apply(P,I.items),null==I.nextPageToken?[3,3]:[4,wi(f,h,I.nextPageToken)];case 2:B.sent(),B.label=3;case 3:return[2]}})})}function on(f,h){return(0,g.mG)(this,void 0,void 0,function(){var m,b;return(0,g.Jh)(this,function(I){switch(I.label){case 0:return null!=h&&"number"==typeof h.maxResults&&Y("options.maxResults",1,1e3,h.maxResults),b=Rs(f.storage,f._location,"/",(m=h||{}).pageToken,m.maxResults),[4,f.storage.makeRequestWithTokens(b)];case 1:return[2,I.sent().getPromise()]}})})}function So(f){return(0,g.mG)(this,void 0,void 0,function(){var h;return(0,g.Jh)(this,function(m){switch(m.label){case 0:return f._throwIfRoot("getDownloadURL"),h=function Tr(f,h,m){var I=lt(h.fullServerUrl(),f.host),P=f.maxOperationRetryTime,B=new pe(I,"GET",function vi(f,h){return function m(b,I){var C=br(f,I,h);return ge(null!==C),function Tt(f,h,m){var b=Mn(h);if(null===b||!R(b.downloadTokens))return null;var I=b.downloadTokens;if(0===I.length)return null;var C=encodeURIComponent;return I.split(",").map(function(q){var Z=f.fullPath;return lt("/b/"+C(f.bucket)+"/o/"+C(Z),m)+gr({alt:"media",token:q})})[0]}(C,I,f.host)}}(f,m),P);return B.errorHandler=en(h),B}(f.storage,f._location,yr()),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,m.sent().getPromise().then(function(b){if(null===b)throw function cr(){return new F("no-download-url","The given file does not have any download URLs.")}();return b})]}})})}function qn(f,h){var m=function po(f,h){var m=h.split("/").filter(function(b){return b.length>0}).join("/");return 0===f.length?m:f+"/"+m}(f._location.path,h),b=new Gt(f._location.bucket,m);return new me(f.storage,b)}function Cr(f){return/^[A-Za-z]+:\/\//.test(f)}function Ii(f,h){if(f instanceof an){var m=f;if(null==m._bucket)throw function Fe(){return new F("no-default-bucket","No default bucket found. Did you set the '"+Oe+"' property when initializing the app?")}();var b=new me(m,m._bucket);return null!=h?Ii(b,h):b}return void 0!==h?qn(f,h):f}function Co(f,h){if(h&&Cr(h)){if(f instanceof an)return function Ti(f,h){return new me(f,h)}(f,h);throw Ue("To use ref(service, url), the first argument must be a Storage instance.")}return Ii(f,h)}function sn(f,h){var m=null==h?void 0:h[Oe];return null==m?null:Gt.makeFromBucketSpec(m,f)}var an=function(){function f(h,m,b,I,C,P){this.app=h,this._authProvider=m,this._appCheckProvider=b,this._pool=I,this._url=C,this._firebaseVersion=P,this._bucket=null,this._host=Ft,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=C?Gt.makeFromBucketSpec(C,this._host):sn(this._host,this.app.options)}return Object.defineProperty(f.prototype,"host",{get:function(){return this._host},set:function(h){this._host=h,this._bucket=null!=this._url?Gt.makeFromBucketSpec(this._url,h):sn(h,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(h){Y("time",0,Number.POSITIVE_INFINITY,h),this._maxUploadRetryTime=h},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(h){Y("time",0,Number.POSITIVE_INFINITY,h),this._maxOperationRetryTime=h},enumerable:!1,configurable:!0}),f.prototype._getAuthToken=function(){return(0,g.mG)(this,void 0,void 0,function(){var h,m;return(0,g.Jh)(this,function(b){switch(b.label){case 0:return this._overrideAuthToken?[2,this._overrideAuthToken]:(h=this._authProvider.getImmediate({optional:!0}))?[4,h.getToken()]:[3,2];case 1:if(null!==(m=b.sent()))return[2,m.accessToken];b.label=2;case 2:return[2,null]}})})},f.prototype._getAppCheckToken=function(){return(0,g.mG)(this,void 0,void 0,function(){var h;return(0,g.Jh)(this,function(b){switch(b.label){case 0:return(h=this._appCheckProvider.getImmediate({optional:!0}))?[4,h.getToken()]:[3,2];case 1:return[2,b.sent().token];case 2:return[2,null]}})})},f.prototype._delete=function(){return this._deleted||(this._deleted=!0,this._requests.forEach(function(h){return h.cancel()}),this._requests.clear()),Promise.resolve()},f.prototype._makeStorageReference=function(h){return new me(this,h)},f.prototype._makeRequest=function(h,m,b){var I=this;if(this._deleted)return new hi(An());var C=function mr(f,h,m,b,I,C){var P=gr(f.urlParams),B=f.url+P,q=Object.assign({},f.headers);return function Ss(f,h){h&&(f["X-Firebase-GMPID"]=h)}(q,h),function Es(f,h){null!==h&&h.length>0&&(f.Authorization="Firebase "+h)}(q,m),function Pn(f,h){f["X-Firebase-Storage-Version"]="webjs/"+(null!=h?h:"AppManager")}(q,C),function Cs(f,h){null!==h&&(f["X-Firebase-AppCheck"]=h)}(q,b),new kt(B,f.method,q,f.body,f.successCodes,f.additionalRetryCodes,f.handler,f.errorHandler,f.timeout,f.progressCallback,I)}(h,this._appId,m,b,this._pool,this._firebaseVersion);return this._requests.add(C),C.getPromise().then(function(){return I._requests.delete(C)},function(){return I._requests.delete(C)}),C},f.prototype.makeRequestWithTokens=function(h){return(0,g.mG)(this,void 0,void 0,function(){var m;return(0,g.Jh)(this,function(C){switch(C.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return m=C.sent(),[2,this._makeRequest(h,m[0],m[1])]}})})},f}();function Rr(f,h){return Co(f=(0,_.m9)(f),h)}var jn=function(){function f(h,m,b){this._delegate=h,this.task=m,this.ref=b}return Object.defineProperty(f.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),f}(),Do=function(){function f(h,m){this._delegate=h,this._ref=m,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(f.prototype,"snapshot",{get:function(){return new jn(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),f.prototype.then=function(h,m){var b=this;return this._delegate.then(function(I){if(h)return h(new jn(I,b,b._ref))},m)},f.prototype.on=function(h,m,b,I){var C=this,P=void 0;return m&&(P="function"==typeof m?function(B){return m(new jn(B,C,C._ref))}:{next:m.next?function(B){return m.next(new jn(B,C,C._ref))}:void 0,complete:m.complete||void 0,error:m.error||void 0}),this._delegate.on(h,P,b||void 0,I||void 0)},f}(),un=function(){function f(h,m){this._delegate=h,this._service=m}return Object.defineProperty(f.prototype,"prefixes",{get:function(){var h=this;return this._delegate.prefixes.map(function(m){return new cn(m,h._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"items",{get:function(){var h=this;return this._delegate.items.map(function(m){return new cn(m,h._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),f}(),cn=function(){function f(h,m){this._delegate=h,this.storage=m}return Object.defineProperty(f.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),f.prototype.toString=function(){return this._delegate.toString()},f.prototype.child=function(h){var m=function xo(f,h){return qn(f,h)}(this._delegate,h);return new f(m,this.storage)},Object.defineProperty(f.prototype,"root",{get:function(){return new f(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){var h=this._delegate.parent;return null==h?null:new f(h,this.storage)},enumerable:!1,configurable:!0}),f.prototype.put=function(h,m){return this._throwIfRoot("put"),new Do(function Si(f,h,m){return function Io(f,h,m){return f._throwIfRoot("uploadBytesResumable"),new To(f,new Nn(h),m)}(f=(0,_.m9)(f),h,m)}(this._delegate,h,m),this)},f.prototype.putString=function(h,m,b){void 0===m&&(m=Dt.RAW),this._throwIfRoot("putString");var I=mt(m,h),C=(0,g.pi)({},b);return null==C.contentType&&null!=I.contentType&&(C.contentType=I.contentType),new Do(new To(this._delegate,new Nn(I.data,!0),C),this)},f.prototype.listAll=function(){var h=this;return function ks(f){return Sr(f=(0,_.m9)(f))}(this._delegate).then(function(m){return new un(m,h.storage)})},f.prototype.list=function(h){var m=this;return function Ao(f,h){return on(f=(0,_.m9)(f),h)}(this._delegate,h||void 0).then(function(b){return new un(b,m.storage)})},f.prototype.getMetadata=function(){return function Ar(f){return function Eo(f){return(0,g.mG)(this,void 0,void 0,function(){var h;return(0,g.Jh)(this,function(m){switch(m.label){case 0:return f._throwIfRoot("getMetadata"),h=yi(f.storage,f._location,yr()),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,m.sent().getPromise()]}})})}(f=(0,_.m9)(f))}(this._delegate)},f.prototype.updateMetadata=function(h){return function Vn(f,h){return function Ut(f,h){return(0,g.mG)(this,void 0,void 0,function(){var m;return(0,g.Jh)(this,function(b){switch(b.label){case 0:return f._throwIfRoot("updateMetadata"),m=function bi(f,h,m,b){var C=lt(h.fullServerUrl(),f.host),B=bt(m,b),G=f.maxOperationRetryTime,Z=new pe(C,"PATCH",wr(f,b),G);return Z.headers={"Content-Type":"application/json; charset=utf-8"},Z.body=B,Z.errorHandler=en(h),Z}(f.storage,f._location,h,yr()),[4,f.storage.makeRequestWithTokens(m)];case 1:return[2,b.sent().getPromise()]}})})}(f=(0,_.m9)(f),h)}(this._delegate,h)},f.prototype.getDownloadURL=function(){return function Ci(f){return So(f=(0,_.m9)(f))}(this._delegate)},f.prototype.delete=function(){return this._throwIfRoot("delete"),function xr(f){return function Un(f){return(0,g.mG)(this,void 0,void 0,function(){var h;return(0,g.Jh)(this,function(m){switch(m.label){case 0:return f._throwIfRoot("deleteObject"),h=function _i(f,h){var b=lt(h.fullServerUrl(),f.host),B=new pe(b,"DELETE",function P(q,G){},f.maxOperationRetryTime);return B.successCodes=[200,204],B.errorHandler=en(h),B}(f.storage,f._location),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,m.sent().getPromise()]}})})}(f=(0,_.m9)(f))}(this._delegate)},f.prototype._throwIfRoot=function(h){if(""===this._delegate._location.path)throw lr(h)},f}(),Dr=function(){function f(h,m){this.app=h,this._delegate=m}return Object.defineProperty(f.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),f.prototype.ref=function(h){if(Cr(h))throw Ue("ref() expected a child path but got a URL, use refFromURL instead.");return new cn(Rr(this._delegate,h),this)},f.prototype.refFromURL=function(h){if(!Cr(h))throw Ue("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Gt.makeFromUrl(h,this._delegate.host)}catch(m){throw Ue("refFromUrl() expected a valid full URL but got an invalid one.")}return new cn(Rr(this._delegate,h),this)},f.prototype.setMaxUploadRetryTime=function(h){this._delegate.maxUploadRetryTime=h},f.prototype.setMaxOperationRetryTime=function(h){this._delegate.maxOperationRetryTime=h},f.prototype.useEmulator=function(h,m,b){void 0===b&&(b={}),function Ro(f,h,m,b){void 0===b&&(b={}),function Ei(f,h,m,b){void 0===b&&(b={}),f.host="http://"+h+":"+m;var I=b.mockUserToken;I&&(f._overrideAuthToken="string"==typeof I?I:(0,_.Sg)(I,f.app.options.projectId))}(f,h,m,b)}(this._delegate,h,m,b)},f}();function Ps(f,h){var m=h.instanceIdentifier,b=f.getProvider("app").getImmediate(),I=f.getProvider("auth-internal"),C=f.getProvider("app-check-internal");return new Dr(b,new an(b,I,C,new kn,m,Me.Z.SDK_VERSION))}!function xi(f){var h={TaskState:yt,TaskEvent:Xe,StringFormat:Dt,Storage:an,Reference:cn};f.INTERNAL.registerComponent(new Xt.wA("storage",Ps,"PUBLIC").setServiceProps(h).setMultipleInstances(!0)),f.registerVersion("@firebase/storage","0.7.1")}(Me.Z)}}]);