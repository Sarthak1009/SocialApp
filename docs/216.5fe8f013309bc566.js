"use strict";(self.webpackChunkApnaSocial=self.webpackChunkApnaSocial||[]).push([[216],{7216:(Ya,cr,ut)=>{ut.r(cr),ut.d(cr,{UserModule:()=>$e});var ye=ut(9808),m=ut(843),v=ut(5e3),Wt=ut(4559),Rt=ut(8472);ut(9361);class Ee{constructor(){this.listeners=new Map}appendArray(b){return Rt.t._getFirestore().FieldValue.arrayUnion(b)}increment(b){return Rt.t._getFirestore().FieldValue.increment(b)}genDocId(){return Rt.t.getFirestore().collection("TEMP").doc().id}all(b){const T=Rt.t.getFirestore().batch();for(let A of b.operations)A.getOperation(T);return new Promise((A,M)=>{T.commit().then(()=>{try{b.onComplete()}catch(D){}A()}).catch(D=>{try{b.onFail(D)}catch(Q){}M(D)})})}create(b){return new Promise((T,A)=>{if(null==b.data||null==b.data)throw new Error("Error creating data. Data is null or undefined.");if(this.isCollectionPath(b.path)){let M=this.genCollectionReference(b.path).doc();M.set(b.data).then(()=>{try{b.onComplete(M.id)}catch(D){}T(M.id)}).catch(D=>{try{b.onFail(D)}catch(Q){}A(D)})}else if(this.isDocumentPath(b.path)){let M=this.genDocumentReference(b.path);M.set(b.data).then(()=>{try{b.onComplete(M.id)}catch(D){}T(M.id)}).catch(D=>{try{b.onFail(D)}catch(Q){}A(D)})}})}delete(b){return new Promise((T,A)=>{this.checkDocumentPathValidity(b.path),this.genDocumentReference(b.path).delete().then(()=>{try{b.onComplete()}catch(M){}T()}).catch(M=>{try{b.onFail(M)}catch(D){}A(M)})})}update(b){return new Promise((T,A)=>{this.checkDocumentPathValidity(b.path);const M=this.genDocumentReference(b.path);M.update(b.data).then(()=>{try{b.onComplete(M)}catch(D){}T(M)}).catch(D=>{try{b.onFail(D)}catch(Q){}A(D)})})}getCollection(b){let T=this.genCollectionReference(b.path);return new Promise((null!=b.where||null!=b.where)&&b.where.length>0?(A,M)=>{let D;const Q=Array(b.where)[0];for(let xt=0;xt<Q.length;xt++)D=null==D?Q[xt].getQuery(T):Q[xt].concatQuery(D);D.get().then(xt=>{try{b.onComplete(xt)}catch(qe){}A(xt)}).catch(xt=>{try{b.onFail(xt)}catch(qe){}M(xt)})}:(A,M)=>{T.get().then(D=>{try{b.onComplete(D)}catch(Q){}A(D)}).catch(D=>{try{b.onFail(D)}catch(Q){}M(D)})})}getDocument(b){return new Promise((T,A)=>{this.genDocumentReference(b.path).get().then(M=>{try{b.onComplete(M)}catch(D){}T(M)}).catch(M=>{try{b.onFail(M)}catch(D){}A(M)})})}listenToDocument(b){this.validateListenerName(b.name),this.addListener(b.name,this.genDocumentReference(b.path).onSnapshot(T=>{try{b.onUpdate(T)}catch(A){}}))}listenToCollection(b){this.validateListenerName(b.name);let T=this.genCollectionReference(b.path);if((null!=b.where||null!=b.where)&&b.where.length>0){let A;const M=Array(b.where)[0];for(let D=0;D<M.length;D++)A=null==A?M[D].getQuery(T):M[D].concatQuery(A);this.addListener(b.name,A.onSnapshot(D=>{try{b.onUpdate(D)}catch(Q){}}))}else this.addListener(b.name,T.onSnapshot(A=>{try{b.onUpdate(A)}catch(M){}}))}genCollectionReference(b){this.checkCollectionPathValidity(b);const T=Array(b)[0];let A,M;for(let D=0;D<T.length;D++)D%2==0?A=null==A?Rt.t.getFirestore().collection(T[D]):M.collection(T[D]):M=A.doc(T[D]);return A}genDocumentReference(b){this.checkDocumentPathValidity(b);const T=Array(b)[0];let A,M;for(let D=0;D<T.length;D++)D%2==0?A=null==A?Rt.t.getFirestore().collection(T[D]):M.collection(T[D]):M=A.doc(T[D]);return M}addListener(b,T){return this.listeners.set(b,T),T}stopListeningTo(b){try{this.listeners.get(b)(),this.listeners.delete(b)}catch(T){}}stopListeningToAll(){this.listeners.forEach((b,T,A)=>{this.stopListeningTo(T)})}validateListenerName(b){if(null==b||null==b||"string"!=typeof b||b.trim().length<=0)throw"Listener name cannot be empty.";if(null!=this.listeners.get(b))throw`Listener name: ${b} is already taken.`}checkCollectionPathValidity(b){if(null==b||null==b||b.length<=0||!this.isCollectionPath(b))throw"Not a valid path to a collection."}isCollectionPath(b){return Array(b)[0].length%2==1}checkDocumentPathValidity(b){if(null==b||null==b||b.length<=0||!this.isDocumentPath(b))throw"Not a valid path to a document."}isDocumentPath(b){return Array(b)[0].length%2==0}}class F{constructor(b,T){this.field=b,this.direction=T}getQuery(b){return b.orderBy(this.field,this.direction)}concatQuery(b){return b.orderBy(this.field,this.direction)}}class Me{constructor(b){this.limit=b}getQuery(b){return b.limit(this.limit)}concatQuery(b){return b.limit(this.limit)}}var ie=ut(8966),Sn=ut(6360),Ce=ut(508);const li=["*",[["mat-card-footer"]]],An=["*","mat-card-footer"],hi=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],lr=["[mat-card-avatar], [matCardAvatar]","mat-card-title, mat-card-subtitle,\n      [mat-card-title], [mat-card-subtitle],\n      [matCardTitle], [matCardSubtitle]","*"];let Oe=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275dir=v.lG2({type:k,selectors:[["mat-card-content"],["","mat-card-content",""],["","matCardContent",""]],hostAttrs:[1,"mat-card-content"]}),k})(),ht=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275dir=v.lG2({type:k,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-card-title"]}),k})(),he=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275dir=v.lG2({type:k,selectors:[["mat-card-subtitle"],["","mat-card-subtitle",""],["","matCardSubtitle",""]],hostAttrs:[1,"mat-card-subtitle"]}),k})(),hr=(()=>{class k{constructor(){this.align="start"}}return k.\u0275fac=function(T){return new(T||k)},k.\u0275dir=v.lG2({type:k,selectors:[["mat-card-actions"]],hostAttrs:[1,"mat-card-actions"],hostVars:2,hostBindings:function(T,A){2&T&&v.ekj("mat-card-actions-align-end","end"===A.align)},inputs:{align:"align"},exportAs:["matCardActions"]}),k})(),xn=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275dir=v.lG2({type:k,selectors:[["","mat-card-image",""],["","matCardImage",""]],hostAttrs:[1,"mat-card-image"]}),k})(),Se=(()=>{class k{constructor(T){this._animationMode=T}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(Sn.Qb,8))},k.\u0275cmp=v.Xpm({type:k,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(T,A){2&T&&v.ekj("_mat-animation-noopable","NoopAnimations"===A._animationMode)},exportAs:["matCard"],ngContentSelectors:An,decls:2,vars:0,template:function(T,A){1&T&&(v.F$t(li),v.Hsn(0),v.Hsn(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}._mat-animation-noopable.mat-card{transition:none;animation:none}.mat-card .mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card .mat-divider-horizontal{left:auto;right:0}.mat-card .mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card .mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}\n"],encapsulation:2,changeDetection:0}),k})(),mt=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275cmp=v.Xpm({type:k,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-card-header"],ngContentSelectors:lr,decls:4,vars:0,consts:[[1,"mat-card-header-text"]],template:function(T,A){1&T&&(v.F$t(hi),v.Hsn(0),v.TgZ(1,"div",0),v.Hsn(2,1),v.qZA(),v.Hsn(3,2))},encapsulation:2,changeDetection:0}),k})(),At=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275mod=v.oAB({type:k}),k.\u0275inj=v.cJS({imports:[[Ce.BQ],Ce.BQ]}),k})(),We=(()=>{class k{constructor(T,A){this.router=T,this.dialog=A,this.profileClose=new v.vpe,this.firestore=new Ee,this.firebaseAuth=new Wt.l}onContinueClick(T,A){this.dialog.close();let M=T.value,D=A.value;this.firestore.create({path:["Users",this.firebaseAuth.getAuth().currentUser.uid],data:{publicName:M,description:D},onComplete:Q=>{T.value="",A.value="",this.router.navigate(["/user/home"]),this.profileClose.emit(!1),window.location.reload()},onFail:Q=>{alert(Q.message)}})}ngOnInit(){}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(m.F0),v.Y36(ie.so))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-profile"]],outputs:{profileClose:"profileClose"},decls:16,vars:0,consts:[[1,"container"],["id","contact"],["placeholder","Name","type","text","tabindex","1","required","","autofocus",""],["nameInput",""],["placeholder","Description","type","text","tabindex","2","required","","autofocus",""],["descInput",""],[1,"submit",3,"click"]],template:function(T,A){if(1&T){const M=v.EpF();v.TgZ(0,"div",0),v.TgZ(1,"div",1),v.TgZ(2,"mat-card"),v.TgZ(3,"mat-card-header"),v.TgZ(4,"mat-card-title"),v._uU(5," Hey, Tell us about Yourself! "),v.qZA(),v.qZA(),v.TgZ(6,"mat-card-content"),v.TgZ(7,"fieldset"),v._UZ(8,"input",2,3),v.qZA(),v.TgZ(10,"fieldset"),v._UZ(11,"textarea",4,5),v.qZA(),v.TgZ(13,"fieldset"),v.TgZ(14,"button",6),v.NdJ("click",function(){v.CHM(M);const Q=v.MAs(9),xt=v.MAs(12);return A.onContinueClick(Q,xt)}),v._uU(15,"Update"),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.qZA()}},directives:[Se,mt,ht,Oe],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-font-smoothing:antialiased;-o-font-smoothing:antialiased;text-rendering:optimizeLegibility}p[_ngcontent-%COMP%]{margin-bottom:15px}body[_ngcontent-%COMP%]{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:100;font-size:12px;line-height:30px;color:#777;background:#4CAF50}.container[_ngcontent-%COMP%]{max-width:400px;width:80%;margin:0 auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:100}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{font:400 12px/16px Roboto,Helvetica,Arial,sans-serif}#contact[_ngcontent-%COMP%]{background:#F9F9F9;padding:0;margin:150px 0;box-shadow:0 0 20px #0003,0 5px 5px #0000003d}#contact[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:block;font-size:30px;font-weight:300;margin-bottom:10px}#contact[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:5px 0 15px;display:block;font-size:13px;font-weight:400}fieldset[_ngcontent-%COMP%]{border:medium none!important;margin:0 0 10px;min-width:100%;padding:0;width:100%}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%], #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #ccc;background:#FFF;margin:0 0 5px;padding:10px}#contact[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   input[type=url][_ngcontent-%COMP%]:hover, #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:hover{transition:border-color .3s ease-in-out;border:1px solid #aaa}#contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px;max-width:100%;resize:none}#contact[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{cursor:pointer;width:100%;border:none;border-radius:8px;background:#4CAF50;color:#fff;margin:0 0 5px;padding:10px;font-size:15px}#contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:#43A047;transition:background-color .3s ease-in-out}#contact[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:active{box-shadow:inset 0 1px 3px #00000080}.copyright[_ngcontent-%COMP%]{text-align:center}#contact[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, #contact[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:0;border:1px solid #aaa}[_ngcontent-%COMP%]::-webkit-input-placeholder{color:#888}[_ngcontent-%COMP%]:-moz-placeholder{color:#888}[_ngcontent-%COMP%]::-moz-placeholder{color:#888}[_ngcontent-%COMP%]:-ms-input-placeholder{color:#888}#contact[_ngcontent-%COMP%]{border-radius:8px}mat-card[_ngcontent-%COMP%]{margin:0;box-shadow:none!important}mat-header[_ngcontent-%COMP%]{margin:10px}mat-card-content[_ngcontent-%COMP%]{margin:10px}"]}),k})();var Xe=ut(7556),be=ut(7423);let Rn=(()=>{class k{constructor(T,A,M){this.router=T,this.auth=A,this.dialog=M,this.profilleClickListner=new v.vpe,this.profileValue=!1,this.firebaseAuth=new Wt.l}LogOut(){this.auth.logOut()}onProfileClick(T){this.profileValue=!this.profileValue,this.dialog.open(We)}ngOnInit(){}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(m.F0),v.Y36(Xe.e),v.Y36(ie.uw))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-header"]],outputs:{profilleClickListner:"profilleClickListner"},decls:5,vars:0,consts:[[1,"container"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",2,"margin-left","15px",3,"click"]],template:function(T,A){1&T&&(v.TgZ(0,"div",0),v.TgZ(1,"button",1),v.NdJ("click",function(){return A.LogOut()}),v._uU(2,"Log out"),v.qZA(),v.TgZ(3,"button",2),v.NdJ("click",function(){return A.onProfileClick(!0)}),v._uU(4,"Profile"),v.qZA(),v.qZA())},directives:[be.lW],styles:[".container[_ngcontent-%COMP%]{position:fixed;top:3px;right:5px;z-index:10;background:white}"]}),k})();ut(1589);class pr{constructor(){this.listeners=new Map}downloadToLocalStorage(b){return new Promise((T,A)=>{if(b instanceof Array)this.getDownloadUrl({path:b,onComplete:M=>{T(M),window.open(M,"Download")},onFail:M=>{A(M)}});else try{window.open(b,"Download"),T()}catch(M){A(M)}})}upload(b){return new Promise((T,A)=>{let M=null,D=this.genStorageRef(b.path);M=null==b.data.metadata||null==b.data.metadata?D.put(b.data.data):D.put(b.data.data,b.data.metadata),M.on("state_changed",Q=>{try{b.onUpload(Q)}catch(xt){}},Q=>{A(Q);try{b.onFail(Q)}catch(xt){}},()=>{D.getDownloadURL().then(Q=>{T(Q);try{b.onComplete(Q)}catch(xt){}})}),this.listeners.set(b.uploadName,M)})}deleteWithUrl(b){return new Promise((T,A)=>{Rt.t.getStorage().refFromURL(b.url).delete().then(()=>{T();try{b.onComplete()}catch(D){}}).catch(D=>{A(D);try{b.onFail(D)}catch(Q){}})})}delete(b){return new Promise((T,A)=>{this.genStorageRef(b.path).delete().then(()=>{T();try{b.onComplete()}catch(D){}}).catch(D=>{A(D);try{b.onFail(D)}catch(Q){}})})}getDownloadUrl(b){return new Promise((T,A)=>{const M=this.genStorageRef(b.path);try{M.getDownloadURL().then(D=>{T(D);try{b.onComplete(D)}catch(Q){}})}catch(D){A(D);try{b.onFail(D)}catch(Q){}}})}genStorageRef(b){let T=Rt.t.getStorage().ref();for(let A=0;A<b.length;A++)T=T.child(b[A]);return T}}var Fe=ut(9095);function vt(k,b){1&k&&(v.TgZ(0,"div",9),v._UZ(1,"img",10),v.qZA())}let Dn=(()=>{class k{constructor(T){this.dialog=T,this.firebaseAuth=new Wt.l,this.firestore=new Ee,this.storage=new pr,this.name="",this.description=""}ngOnInit(){}onPhotoSelected(T){if(this.selectedImagefile=T.files[0],!this.selectedImagefile)return;let A=new FileReader;A.readAsDataURL(this.selectedImagefile),A.addEventListener("loadend",M=>{let D=A.result.toString();document.getElementById("post-preview-img").src=D})}uploadImagePost(T){let A=this.firestore.genDocId();this.storage.upload({uploadName:"upload image Post",path:["Posts",A,"image"],data:{data:this.selectedImagefile},onComplete:M=>{this.firestore.create({path:["Posts",A],data:{comment:T,creatorId:this.firebaseAuth.getAuth().currentUser.uid,imageUrl:M,timestamp:Rt.t.getFirestoreTimestamp(),name:this.name,desc:this.description},onComplete:D=>{this.dialog.close(),window.location.reload()},onFail:D=>{alert(D.message)}})}})}uploadPost(T){this.firestore.create({path:["Posts"],data:{comment:T,creatorId:this.firebaseAuth.getAuth().currentUser.uid,timestamp:Rt.t.getFirestoreTimestamp(),name:this.name,desc:this.description},onComplete:A=>{this.dialog.close(),window.location.reload()},onFail:A=>{alert(A.message)}})}onPostClick(T){this.dialog.close();let A=T.value;this.selectedImagefile&&0===A.length&&(A=" "),!(A.length<=0)&&(this.selectedImagefile?this.uploadImagePost(A):this.uploadPost(A))}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(ie.so))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-create-post"]],decls:17,vars:1,consts:[["placeholder","Type Message..."],["commentInput",""],["class","post-preview","align","end",4,"ngIf"],["align","end"],["mat-button","","color","warn"],["for","photo-upload"],["id","photo-upload","type","file","accept","images/*",3,"change"],["photoselector",""],["mat-flat-button","","color","warn",3,"click"],["align","end",1,"post-preview"],["id","post-preview-img"]],template:function(T,A){if(1&T){const M=v.EpF();v.TgZ(0,"mat-card"),v.TgZ(1,"mat-card-header"),v.TgZ(2,"mat-card-title"),v._uU(3,"Create Post"),v.qZA(),v.qZA(),v.TgZ(4,"div"),v._UZ(5,"textarea",0,1),v.qZA(),v.YNc(7,vt,2,0,"div",2),v.TgZ(8,"mat-card-actions",3),v.TgZ(9,"button",4),v.TgZ(10,"label",5),v.TgZ(11,"input",6,7),v.NdJ("change",function(){v.CHM(M);const Q=v.MAs(12);return A.onPhotoSelected(Q)}),v.qZA(),v.TgZ(13,"mat-icon"),v._uU(14,"insert_photo"),v.qZA(),v.qZA(),v.qZA(),v.TgZ(15,"button",8),v.NdJ("click",function(){v.CHM(M);const Q=v.MAs(6);return A.onPostClick(Q)}),v._uU(16," Post "),v.qZA(),v.qZA(),v.qZA()}2&T&&(v.xp6(7),v.Q6J("ngIf",A.selectedImagefile))},directives:[Se,mt,ht,ye.O5,hr,be.lW,Fe.Hw],styles:["#photo-upload[_ngcontent-%COMP%]{display:none}textarea[_ngcontent-%COMP%]{font-size:1.5em;padding:1em;resize:none;width:250px;min-height:200px;border:none;outline:none}#post-preview[_ngcontent-%COMP%]{text-align:right;margin-top:1em}#post-preview-img[_ngcontent-%COMP%]{object-fit:cover;object-position:center;width:150px;height:100px;border-radius:1em;border:1px dashed gray}"]}),k})();function fe(k,b){if(1&k&&(v.TgZ(0,"div",4),v._uU(1),v.qZA()),2&k){const T=v.oxw();v.xp6(1),v.hij("Hey, ",T.getUsername(),"")}}function Ae(k,b){if(1&k){const T=v.EpF();v.TgZ(0,"app-profile",5),v.NdJ("profileClose",function(M){return v.CHM(T),v.oxw().onUpdateProfile(M)}),v.qZA()}}let Ue=(()=>{class k{constructor(T){this.auth=T,this.fs=new Ee,this.firebaseAuth=new Wt.l,this.profileShow=!1,this.userhasProfile=!1}ngOnInit(){this.getProfile()}ngOnChanges(T){}onProfile(T){this.profileShow=T}onUpdateProfile(T){this.profileShow=T}static getUserDocument(){return k.userdocument}getUsername(){return k.userdocument.publicName}getProfile(){this.firebaseAuth.listenToSignInStateChanges(A=>{this.fs.listenToDocument({name:"Getting Documnet",path:["Users",this.firebaseAuth.getAuth().currentUser.uid],onUpdate:M=>{this.userhasProfile=M.exists,M.exists&&(k.userdocument=M.data(),k.userdocument.userId=this.firebaseAuth.getAuth().currentUser.uid)}})})}}return k.userdocument={publicName:"",description:"",userId:""},k.\u0275fac=function(T){return new(T||k)(v.Y36(Xe.e))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-user-dashboard"]],features:[v.TTD],decls:5,vars:2,consts:[[1,"container"],[3,"profilleClickListner"],["class","fr",4,"ngIf"],[3,"profileClose",4,"ngIf"],[1,"fr"],[3,"profileClose"]],template:function(T,A){1&T&&(v._UZ(0,"div",0),v.TgZ(1,"app-header",1),v.NdJ("profilleClickListner",function(D){return A.onProfile(D)}),v.qZA(),v.YNc(2,fe,2,1,"div",2),v.YNc(3,Ae,1,0,"app-profile",3),v._UZ(4,"router-outlet")),2&T&&(v.xp6(2),v.Q6J("ngIf",A.userhasProfile),v.xp6(1),v.Q6J("ngIf",A.profileShow))},directives:[Rn,ye.O5,We,m.lC],styles:[".fr[_ngcontent-%COMP%]{position:fixed;left:15px;top:3px;z-index:11}.container[_ngcontent-%COMP%]{width:100vw;background-color:#fff;height:40px;z-index:10;position:fixed;top:0}"]}),k})();const Pn=function(k){return{"comment-container":!0,"creator-comment-container":k}},Ft=function(k){return{comment:!0,"creator-comment":k}};function fi(k,b){if(1&k&&(v.TgZ(0,"div",6),v.TgZ(1,"div"),v.TgZ(2,"p",7),v._uU(3),v.qZA(),v.TgZ(4,"p",6),v._uU(5),v.qZA(),v.qZA(),v.qZA()),2&k){const T=b.$implicit,A=v.oxw();v.Q6J("ngClass",v.VKq(4,Pn,A.isCommentCreator(T))),v.xp6(3),v.Oqu(null==T?null:T.creatorName),v.xp6(1),v.Q6J("ngClass",v.VKq(6,Ft,A.isCommentCreator(T))),v.xp6(1),v.Oqu(null==T?null:T.comment)}}let mr=(()=>{class k{constructor(T){this.posts=T,this.firestore=new Ee,this.comments=[]}ngOnInit(){this.getComments()}isCommentCreator(T){return T.creatorId===Ue.getUserDocument().userId}getComments(){this.firestore.listenToCollection({name:"Post Comments",path:["Posts",this.posts,"PostComments"],where:[new F("timestamp","asc")],onUpdate:T=>{T.docChanges().forEach(A=>{"added"===A.type&&this.comments.unshift(A.doc.data())})}})}onSendClick(T){T.value.length<=0||this.firestore.create({path:["Posts",this.posts,"PostComments"],data:{comment:T.value,creatorId:Ue.getUserDocument().userId,creatorName:Ue.getUserDocument().publicName,timestamp:Rt.t.getFirestoreTimestamp()},onComplete:A=>{T.value=""}})}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(ie.WI))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-comment"]],decls:10,vars:1,consts:[["id","comment-box"],[3,"ngClass",4,"ngFor","ngForOf"],["id","comment-reply-bar"],["mat-flat-button","","color","warn",3,"click"],["placeholder","Comment...."],["commentInput",""],[3,"ngClass"],[1,"comment-name"]],template:function(T,A){if(1&T){const M=v.EpF();v.TgZ(0,"p"),v._uU(1,"Comment"),v.qZA(),v.TgZ(2,"div",0),v.YNc(3,fi,6,8,"div",1),v.qZA(),v.TgZ(4,"div",2),v.TgZ(5,"button",3),v.NdJ("click",function(){v.CHM(M);const Q=v.MAs(9);return A.onSendClick(Q)}),v.TgZ(6,"mat-icon"),v._uU(7,"send"),v.qZA(),v.qZA(),v._UZ(8,"input",4,5),v.qZA()}2&T&&(v.xp6(3),v.Q6J("ngForOf",A.comments))},directives:[ye.sg,ye.mk,be.lW,Fe.Hw],styles:["#comment-box[_ngcontent-%COMP%]{width:100%;height:300px;overflow:auto;min-width:400px;max-width:600px;padding:0 1em;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}#comment-reply-bar[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:3em 1fr;margin-top:1em;direction:rtl}input[_ngcontent-%COMP%]{padding:1em 2em 1em 1em;border:1px solid gray;outline:none;width:100%;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;direction:ltr}.comment-container[_ngcontent-%COMP%]{display:flex}.comment-name[_ngcontent-%COMP%]{font-size:.9em}.comment[_ngcontent-%COMP%]{border-radius:1em;background-color:#dcdcdc;padding:1em}.creator-comment-container[_ngcontent-%COMP%]{justify-content:end;text-align:end}.creator-comment[_ngcontent-%COMP%]{background-color:tomato;color:#fff}"]}),k})();function Ye(k,b){if(1&k){const T=v.EpF();v.TgZ(0,"div",2),v.TgZ(1,"div",3),v.TgZ(2,"mat-card"),v.TgZ(3,"mat-card-header"),v.TgZ(4,"mat-card-title"),v._uU(5),v.qZA(),v.TgZ(6,"mat-card-subtitle"),v._uU(7),v.qZA(),v.qZA(),v._UZ(8,"img",4),v.TgZ(9,"mat-card-content"),v._uU(10),v.qZA(),v.TgZ(11,"mat-card-actions"),v.TgZ(12,"mat-icon",5),v.NdJ("click",function(){const D=v.CHM(T).index;return v.oxw().onCommentClick(D)}),v._uU(13,"chat_bubble_outline"),v.qZA(),v.TgZ(14,"mat-icon",6),v._uU(15,"favorite_border"),v.qZA(),v.TgZ(16,"mat-icon",6),v._uU(17,"save"),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.qZA()}if(2&k){const T=b.$implicit;v.uIk("data-index",b.index),v.xp6(5),v.Oqu(T.name),v.xp6(2),v.Oqu(T.desc),v.xp6(1),v.s9C("src",null==T?null:T.imageUrl,v.LSH),v.xp6(2),v.hij(" ",null==T?null:T.comment," ")}}const Nn=[{path:"",component:Ue,children:[{path:"home",component:(()=>{class k{constructor(T){this.dialog=T,this.firestore=new Ee,this.posts=[],this.PostData=[],this.creatorName=[],this.creatorDesc=[]}postCreatorArray(){this.posts.forEach(T=>{this.PostData.push(T.creatorId)})}onCommentClick(T){console.log(this.posts[T].postId),this.dialog.open(mr,{data:this.posts[T].postId})}ngOnInit(){this.getPosts()}ngOnChanges(T){}onCreatePostClick(){this.dialog.open(Dn)}getCreatorInfo(){this.postCreatorArray();for(let T=0;T<this.PostData.length;T++)this.firestore.getDocument({path:["Users",this.PostData[T]],onComplete:A=>{let M=this.PostData[T],D=A.data();this.posts.forEach(Q=>{Q.creatorId===M&&(Q.name=null==D?void 0:D.publicName,Q.desc=null==D?void 0:D.description)})}})}getPosts(){this.firestore.getCollection({path:["Posts"],where:[new F("timestamp","desc"),new Me(100)],onComplete:T=>{T.docs.forEach(A=>{let M=A.data();this.postCId=M.creatorId,M.postId=A.id,this.posts.push(M),this.getCreatorInfo()})},onFail:T=>{}})}}return k.\u0275fac=function(T){return new(T||k)(v.Y36(ie.uw))},k.\u0275cmp=v.Xpm({type:k,selectors:[["app-post"]],features:[v.TTD],decls:4,vars:1,consts:[["mat-fab","","color","warn","id","post-feed",3,"click"],["class","post_container",4,"ngFor","ngForOf"],[1,"post_container"],[1,"container"],["mat-card-image","","alt","",3,"src"],["color","warn",1,"action-item",3,"click"],["color","warn",1,"action-item"]],template:function(T,A){1&T&&(v.TgZ(0,"button",0),v.NdJ("click",function(){return A.onCreatePostClick()}),v.TgZ(1,"mat-icon"),v._uU(2,"add"),v.qZA(),v.qZA(),v.YNc(3,Ye,18,5,"div",1)),2&T&&(v.xp6(3),v.Q6J("ngForOf",A.posts))},directives:[be.lW,Fe.Hw,ye.sg,Se,mt,ht,he,xn,Oe,hr],styles:["#post-feed[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;z-index:11}.action-item[_ngcontent-%COMP%]{margin-left:.5em;cursor:pointer}.post_container[_ngcontent-%COMP%]{display:block;margin-top:40px}.container[_ngcontent-%COMP%]{max-width:500px;max-height:600px;margin-top:.5em;margin-left:auto;margin-right:auto;z-index:-1}img[_ngcontent-%COMP%]{max-width:500px;max-height:600px}"]}),k})()},{path:"about",component:Rn},{path:"",redirectTo:"/user/home",pathMatch:"full"}]}];let Mn=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275mod=v.oAB({type:k}),k.\u0275inj=v.cJS({imports:[[m.Bz.forChild(Nn)],m.Bz]}),k})(),$e=(()=>{class k{}return k.\u0275fac=function(T){return new(T||k)},k.\u0275mod=v.oAB({type:k}),k.\u0275inj=v.cJS({imports:[[ye.ez,Mn,ie.Is,Fe.Ps,be.ot,At]]}),k})()},9361:(Ya,cr,ut)=>{ut.r(cr);var ye=ut(8367),m=ut(655),v=ut(492),Wt=ut(4003),Rt=function(e,t){return(Rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])})(e,t)};function ci(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],o=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var F,ho="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Me=Me||{},Z=ho||self;function ie(){}function Sn(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Ce(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var An="closure_uid_"+(1e9*Math.random()>>>0),hi=0;function lr(e,t,i){return e.call.apply(e.bind,arguments)}function fo(e,t,i){if(!e)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,o),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function _t(e,t,i){return(_t=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?lr:fo).apply(null,arguments)}function Oe(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var o=i.slice();return o.push.apply(o,arguments),e.apply(this,o)}}function ht(e,t){function i(){}i.prototype=t.prototype,e.Z=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.Vb=function(o,s,a){for(var u=Array(arguments.length-2),c=2;c<arguments.length;c++)u[c-2]=arguments[c];return t.prototype[s].apply(o,u)}}function he(){this.s=this.s,this.o=this.o}var Le={};he.prototype.s=!1,he.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function li(e){return Object.prototype.hasOwnProperty.call(e,An)&&e[An]||(e[An]=++hi)}(this);delete Le[e]}},he.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var xn=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var i=0;i<e.length;i++)if(i in e&&e[i]===t)return i;return-1},fr=Array.prototype.forEach?function(e,t,i){Array.prototype.forEach.call(e,t,i)}:function(e,t,i){for(var o=e.length,s="string"==typeof e?e.split(""):e,a=0;a<o;a++)a in s&&t.call(i,s[a],a,e)};function Ze(e){return Array.prototype.concat.apply([],arguments)}function dr(e){var t=e.length;if(0<t){for(var i=Array(t),o=0;o<t;o++)i[o]=e[o];return i}return[]}function Dt(e){return/^[\s\xa0]*$/.test(e)}var At,Se=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function mt(e,t){return-1!=e.indexOf(t)}function kn(e,t){return e<t?-1:e>t?1:0}t:{var We=Z.navigator;if(We){var Xe=We.userAgent;if(Xe){At=Xe;break t}}At=""}function be(e,t,i){for(var o in e)t.call(i,e[o],o,e)}function Rn(e){var t={};for(var i in e)t[i]=e[i];return t}var pr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fe(e,t){for(var i,o,s=1;s<arguments.length;s++){for(i in o=arguments[s])e[i]=o[i];for(var a=0;a<pr.length;a++)i=pr[a],Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}}function vt(e){return vt[" "](e),e}vt[" "]=ie;var Ye,e,fe=mt(At,"Opera"),Ae=mt(At,"Trident")||mt(At,"MSIE"),Ue=mt(At,"Edge"),Pn=Ue||Ae,Ft=mt(At,"Gecko")&&!(mt(At.toLowerCase(),"webkit")&&!mt(At,"Edge"))&&!(mt(At,"Trident")||mt(At,"MSIE"))&&!mt(At,"Edge"),fi=mt(At.toLowerCase(),"webkit")&&!mt(At,"Edge");function mr(){var e=Z.document;return e?e.documentMode:void 0}t:{var gr="",Nn=(e=At,Ft?/rv:([^\);]+)(\)|;)/.exec(e):Ue?/Edge\/([\d\.]+)/.exec(e):Ae?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):fi?/WebKit\/(\S+)/.exec(e):fe?/(?:Version)[ \/]?(\S+)/.exec(e):void 0);if(Nn&&(gr=Nn?Nn[1]:""),Ae){var Mn=mr();if(null!=Mn&&Mn>parseFloat(gr)){Ye=String(Mn);break t}}Ye=gr}var $e={};var A=Z.document&&Ae&&(mr()||parseInt(Ye,10))||void 0,M=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Z.addEventListener("test",ie,t),Z.removeEventListener("test",ie,t)}catch(i){}return e}();function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Q(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var i=this.type=e.type,o=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ft){t:{try{vt(t.nodeName);var s=!0;break t}catch(a){}s=!1}s||(t=null)}}else"mouseover"==i?t=e.fromElement:"mouseout"==i&&(t=e.toElement);this.relatedTarget=t,o?(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:xt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Q.Z.h.call(this)}}D.prototype.h=function(){this.defaultPrevented=!0},ht(Q,D);var xt={2:"touch",3:"pen",4:"mouse"};Q.prototype.h=function(){Q.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var qe="closure_listenable_"+(1e6*Math.random()|0),Cs=0;function Ss(e,t,i,o,s){this.listener=e,this.proxy=null,this.src=t,this.type=i,this.capture=!!o,this.ia=s,this.key=++Cs,this.ca=this.fa=!1}function vr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function yr(e){this.src=e,this.g={},this.h=0}function di(e,t){var i=t.type;if(i in e.g){var a,o=e.g[i],s=xn(o,t);(a=0<=s)&&Array.prototype.splice.call(o,s,1),a&&(vr(t),0==e.g[i].length&&(delete e.g[i],e.h--))}}function pi(e,t,i,o){for(var s=0;s<e.length;++s){var a=e[s];if(!a.ca&&a.listener==t&&a.capture==!!i&&a.ia==o)return s}return-1}yr.prototype.add=function(e,t,i,o,s){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var u=pi(e,t,o,s);return-1<u?(t=e[u],i||(t.fa=!1)):((t=new Ss(t,this.src,a,!!o,s)).fa=i,e.push(t)),t};var On="closure_lm_"+(1e6*Math.random()|0),Ln={};function po(e,t,i,o,s){if(o&&o.once)return vo(e,t,i,o,s);if(Array.isArray(t)){for(var a=0;a<t.length;a++)po(e,t[a],i,o,s);return null}return i=_r(i),e&&e[qe]?e.N(t,i,Ce(o)?!!o.capture:!!o,s):mo(e,t,i,!1,o,s)}function mo(e,t,i,o,s,a){if(!t)throw Error("Invalid event type");var u=Ce(s)?!!s.capture:!!s,c=mi(e);if(c||(e[On]=c=new yr(e)),(i=c.add(t,i,o,u,a)).proxy)return i;if(o=function go(){var t=br;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=o,o.src=e,o.listener=i,e.addEventListener)M||(s=u),void 0===s&&(s=!1),e.addEventListener(t.toString(),o,s);else if(e.attachEvent)e.attachEvent(yo(t.toString()),o);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(o)}return i}function vo(e,t,i,o,s){if(Array.isArray(t)){for(var a=0;a<t.length;a++)vo(e,t[a],i,o,s);return null}return i=_r(i),e&&e[qe]?e.O(t,i,Ce(o)?!!o.capture:!!o,s):mo(e,t,i,!0,o,s)}function Pt(e,t,i,o,s){if(Array.isArray(t))for(var a=0;a<t.length;a++)Pt(e,t[a],i,o,s);else o=Ce(o)?!!o.capture:!!o,i=_r(i),e&&e[qe]?(e=e.i,(t=String(t).toString())in e.g&&-1<(i=pi(a=e.g[t],i,o,s))&&(vr(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete e.g[t],e.h--))):e&&(e=mi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=pi(t,i,o,s)),(i=-1<e?t[e]:null)&&tn(i))}function tn(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[qe])di(t.i,e);else{var i=e.type,o=e.proxy;t.removeEventListener?t.removeEventListener(i,o,e.capture):t.detachEvent?t.detachEvent(yo(i),o):t.addListener&&t.removeListener&&t.removeListener(o),(i=mi(t))?(di(i,e),0==i.h&&(i.src=null,t[On]=null)):vr(e)}}}function yo(e){return e in Ln?Ln[e]:Ln[e]="on"+e}function br(e,t){if(e.ca)e=!0;else{t=new Q(t,this);var i=e.listener,o=e.ia||e.src;e.fa&&tn(e),e=i.call(o,t)}return e}function mi(e){return(e=e[On])instanceof yr?e:null}var gi="__closure_events_fn_"+(1e9*Math.random()>>>0);function _r(e){return"function"==typeof e?e:(e[gi]||(e[gi]=function(t){return e.handleEvent(t)}),e[gi])}function wt(){he.call(this),this.i=new yr(this),this.P=this,this.I=null}function yt(e,t){var i,o=e.I;if(o)for(i=[];o;o=o.I)i.push(o);if(e=e.P,o=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var s=t;Fe(t=new D(o,e),s)}if(s=!0,i)for(var a=i.length-1;0<=a;a--){var u=t.g=i[a];s=Fn(u,o,!0,t)&&s}if(s=Fn(u=t.g=e,o,!0,t)&&s,s=Fn(u,o,!1,t)&&s,i)for(a=0;a<i.length;a++)s=Fn(u=t.g=i[a],o,!1,t)&&s}function Fn(e,t,i,o){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,a=0;a<t.length;++a){var u=t[a];if(u&&!u.ca&&u.capture==i){var c=u.listener,l=u.ia||u.src;u.fa&&di(e.i,u),s=!1!==c.call(l,o)&&s}}return s&&!o.defaultPrevented}ht(wt,he),wt.prototype[qe]=!0,wt.prototype.removeEventListener=function(e,t,i,o){Pt(this,e,t,i,o)},wt.prototype.M=function(){if(wt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],o=0;o<i.length;o++)vr(i[o]);delete e.g[t],e.h--}}this.I=null},wt.prototype.N=function(e,t,i,o){return this.i.add(String(e),t,!1,i,o)},wt.prototype.O=function(e,t,i,o){return this.i.add(String(e),t,!0,i,o)};var wr=Z.JSON.stringify;function As(){var e=bi,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var yi,xs=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,i){var o=de.get();o.set(t,i),this.h?this.h.next=o:this.g=o,this.h=o},e}(),de=new(function(){function e(t,i){this.i=t,this.j=i,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},e}())(function(){return new pe},function(e){return e.reset()}),pe=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,i){this.h=t,this.g=i,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function Tr(e){Z.setTimeout(function(){throw e},0)}function vi(e,t){yi||function en(){var e=Z.Promise.resolve(void 0);yi=function(){e.then(ks)}}(),nn||(yi(),nn=!0),bi.add(e,t)}var nn=!1,bi=new xs;function ks(){for(var e;e=As();){try{e.h.call(e.g)}catch(i){Tr(i)}var t=de;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}nn=!1}function Ir(e,t){wt.call(this),this.h=e||1,this.g=t||Z,this.j=_t(this.kb,this),this.l=Date.now()}function _i(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function wi(e,t,i){if("function"==typeof e)i&&(e=_t(e,i));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=_t(e.handleEvent,e)}return 2147483647<Number(t)?-1:Z.setTimeout(e,t||0)}function bo(e){e.g=wi(function(){e.g=null,e.i&&(e.i=!1,bo(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}ht(Ir,wt),(F=Ir.prototype).da=!1,F.S=null,F.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),yt(this,"tick"),this.da&&(_i(this),this.start()))}},F.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},F.M=function(){Ir.Z.M.call(this),_i(this),delete this.g};var _o=function(e){function t(i,o){var s=e.call(this)||this;return s.m=i,s.j=o,s.h=null,s.i=!1,s.g=null,s}return function Ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Rt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t.prototype.l=function(i){this.h=arguments,this.g?this.i=!0:bo(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(he);function Un(e){he.call(this),this.h=e,this.g={}}ht(Un,he);var qn=[];function Er(e,t,i,o){Array.isArray(i)||(i&&(qn[0]=i.toString()),i=qn);for(var s=0;s<i.length;s++){var a=po(t,i[s],o||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function wo(e){be(e.g,function(t,i){this.g.hasOwnProperty(i)&&tn(t)},e),e.g={}}function Cr(){this.g=!0}function rn(e,t,i,o){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function Io(e,t){if(!e.g)return t;if(!t)return null;try{var i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var o=i[e];if(!(2>o.length)){var s=o[1];if(Array.isArray(s)&&!(1>s.length)){var a=s[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var u=1;u<s.length;u++)s[u]=""}}}return wr(i)}catch(c){return t}}(e,i)+(o?" "+o:"")})}Un.prototype.M=function(){Un.Z.M.call(this),wo(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Cr.prototype.Aa=function(){this.g=!1},Cr.prototype.info=function(){};var me={},Eo=null;function Sr(){return Eo=Eo||new wt}function Ti(e){D.call(this,me.Ma,e)}function sn(e){var t=Sr();yt(t,new Ti(t,e))}function Co(e,t){D.call(this,me.STAT_EVENT,e),this.stat=t}function Ut(e){var t=Sr();yt(t,new Co(t,e))}function So(e,t){D.call(this,me.Na,e),this.size=t}function Vn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){e()},t)}me.Ma="serverreachability",ht(Ti,D),me.STAT_EVENT="statevent",ht(Co,D),me.Na="timingevent",ht(So,D);var jn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ar={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ii(){}function Ao(){}Ii.prototype.h=null;var Si,an={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ci(){D.call(this,"d")}function un(){D.call(this,"c")}function xr(){}function Bn(e,t,i,o){this.l=e,this.j=t,this.m=i,this.X=o||1,this.V=new Un(this),this.P=Ds,this.W=new Ir(e=Pn?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new xo}function xo(){this.i=null,this.g="",this.h=!1}ht(Ci,D),ht(un,D),ht(xr,Ii),xr.prototype.g=function(){return new XMLHttpRequest},xr.prototype.i=function(){return{}},Si=new xr;var Ds=45e3,Ai={},kr={};function Rr(e,t,i){e.K=1,e.v=ft(P(t)),e.s=i,e.U=!0,ko(e,null)}function ko(e,t){e.F=Date.now(),cn(e),e.A=P(e.v);var i=e.A,o=e.X;Array.isArray(o)||(o=[String(o)]),tu(i.h,"t",o),e.C=0,i=e.l.H,e.h=new xo,e.g=Iu(e.l,i?t:null,!e.s),0<e.O&&(e.L=new _o(_t(e.Ia,e,e.g),e.O)),Er(e.V,e.g,"readystatechange",e.gb),t=e.H?Rn(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),sn(1),function To(e,t,i,o,s,a){e.info(function(){if(e.g)if(a)for(var u="",c=a.split("&"),l=0;l<c.length;l++){var d=c[l].split("=");if(1<d.length){var p=d[0];d=d[1];var y=p.split("_");u=2<=y.length&&"type"==y[1]?u+(p+"=")+d+"&":u+(p+"=redacted&")}}else u=null;else u=a;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+t+"\n"+i+"\n"+u})}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ro(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Gn(e,t,i){for(var s,o=!0;!e.I&&e.C<i.length;){if((s=Do(e,i))==kr){4==t&&(e.o=4,Ut(14),o=!1),rn(e.j,e.m,null,"[Incomplete Response]");break}if(s==Ai){e.o=4,Ut(15),rn(e.j,e.m,i,"[Invalid Chunk]"),o=!1;break}rn(e.j,e.m,s,null),xi(e,s)}Ro(e)&&s!=kr&&s!=Ai&&(e.h.g="",e.C=0),4!=t||0!=i.length||e.h.h||(e.o=1,Ut(16),o=!1),e.i=e.i&&o,o?0<i.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),js(t),t.L=!0,Ut(11))):(rn(e.j,e.m,i,"[Invalid Chunked Response]"),Ve(e),zn(e))}function Do(e,t){var i=e.C,o=t.indexOf("\n",i);return-1==o?kr:(i=Number(t.substring(i,o)),isNaN(i)?Ai:(o+=1)+i>t.length?kr:(t=t.substr(o,i),e.C=o+i,t))}function cn(e){e.Y=Date.now()+e.P,ln(e,e.P)}function ln(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Vn(_t(e.eb,e),t)}function Dr(e){e.B&&(Z.clearTimeout(e.B),e.B=null)}function zn(e){0==e.l.G||e.I||bu(e.l,e)}function Ve(e){Dr(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,_i(e.W),wo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function xi(e,t){try{var i=e.l;if(0!=i.G&&(i.g==e||Ns(i.i,e)))if(i.I=e.N,!e.J&&Ns(i.i,e)&&3==i.G){try{var o=i.Ca.g.parse(t)}catch(L){o=null}if(Array.isArray(o)&&3==o.length){var s=o;if(0==s[0])t:if(i.u)i.ta=s[1],0<i.ta-i.U&&37500>s[2]&&i.N&&0==i.A&&!i.v&&(i.v=Vn(_t(i.ab,i),6e3));else{if(i.g){if(!(i.g.F+3e3<e.F))break t;Fo(i),Oo(i)}Vs(i),Ut(18)}if(1>=ru(i.i)&&i.ka){try{i.ka()}catch(L){}i.ka=void 0}}else Kn(i,11)}else if((e.J||i.g==e)&&Fo(i),!Dt(t))for(s=i.Ca.g.parse(t),t=0;t<s.length;t++){var a=s[t];if(i.U=a[0],a=a[1],2==i.G)if("c"==a[0]){i.J=a[1],i.la=a[2];var u=a[3];null!=u&&(i.ma=u,i.h.info("VER="+i.ma));var c=a[4];null!=c&&(i.za=c,i.h.info("SVER="+i.za));var l=a[5];null!=l&&"number"==typeof l&&0<l&&(i.K=o=1.5*l,i.h.info("backChannelRequestTimeoutMs_="+o)),o=i;var d=e.g;if(d){var p=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var y=o.i;!y.g&&(mt(p,"spdy")||mt(p,"quic")||mt(p,"h2"))&&(y.j=y.l,y.g=new Set,y.h&&(Ms(y,y.h),y.h=null))}if(o.D){var w=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(o.sa=w,X(o.F,o.D,w))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-e.F,i.h.info("Handshake RTT: "+i.O+"ms"));var C=e;if((o=i).oa=Tu(o,o.H?o.la:null,o.W),C.J){iu(o.i,C);var E=C,R=o.K;R&&E.setTimeout(R),E.B&&(Dr(E),cn(E)),o.g=C}else vu(o);0<i.l.length&&Lo(i)}else"stop"!=a[0]&&"close"!=a[0]||Kn(i,7);else 3==i.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Kn(i,7):Us(i):"noop"!=a[0]&&i.j&&i.j.wa(a),i.A=0)}sn(4)}catch(L){}}function ki(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Sn(e)||"string"==typeof e)fr(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var i=e.T();else if(e.R&&"function"==typeof e.R)i=void 0;else if(Sn(e)||"string"==typeof e){i=[];for(var o=e.length,s=0;s<o;s++)i.push(s)}else for(s in i=[],o=0,e)i[o++]=s;o=function Ps(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Sn(e)){for(var t=[],i=e.length,o=0;o<i;o++)t.push(e[o]);return t}for(o in t=[],i=0,e)t[i++]=e[o];return t}(e),s=o.length;for(var a=0;a<s;a++)t.call(void 0,o[a],i&&i[a],e)}}function f(e,t){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var o=0;o<i;o+=2)this.set(arguments[o],arguments[o+1])}else if(e)if(e instanceof f)for(i=e.T(),o=0;o<i.length;o++)this.set(i[o],e.get(i[o]));else for(o in e)this.set(o,e[o])}function h(e){if(e.i!=e.g.length){for(var t=0,i=0;t<e.g.length;){var o=e.g[t];g(e.h,o)&&(e.g[i++]=o),t++}e.g.length=i}if(e.i!=e.g.length){var s={};for(i=t=0;t<e.g.length;)g(s,o=e.g[t])||(e.g[i++]=o,s[o]=1),t++;e.g.length=i}}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(F=Bn.prototype).setTimeout=function(e){this.P=e},F.gb=function(e){e=e.target;var t=this.L;t&&3==Be(e)?t.l():this.Ia(e)},F.Ia=function(e){try{if(e==this.g)t:{var t=Be(this.g),i=this.g.Da(),o=this.g.ba();if(!(3>t)&&(3!=t||Pn||this.g&&(this.h.h||this.g.ga()||fu(this.g)))){this.I||4!=t||7==i||sn(8==i||0>=o?3:2),Dr(this);var s=this.g.ba();this.N=s;e:if(Ro(this)){var a=fu(this.g);e="";var u=a.length,c=4==Be(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ve(this),zn(this);var l="";break e}this.h.i=new Z.TextDecoder}for(i=0;i<u;i++)this.h.h=!0,e+=this.h.i.decode(a[i],{stream:c&&i==u-1});a.splice(0,u),this.h.g+=e,this.C=0,l=this.h.g}else l=this.g.ga();if(this.i=200==s,function Rs(e,t,i,o,s,a,u){e.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+s+"]: "+t+"\n"+i+"\n"+a+" "+u})}(this.j,this.u,this.A,this.m,this.X,t,s),this.i){if(this.$&&!this.J){e:{if(this.g){var d,p=this.g;if((d=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Dt(d)){var y=d;break e}}y=null}if(!(s=y)){this.i=!1,this.o=3,Ut(12),Ve(this),zn(this);break t}rn(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,xi(this,s)}this.U?(Gn(this,t,l),Pn&&this.i&&3==t&&(Er(this.V,this.W,"tick",this.fb),this.W.start())):(rn(this.j,this.m,l,null),xi(this,l)),4==t&&Ve(this),this.i&&!this.I&&(4==t?bu(this.l,this):(this.i=!1,cn(this)))}else 400==s&&0<l.indexOf("Unknown SID")?(this.o=3,Ut(12)):(this.o=0,Ut(13)),Ve(this),zn(this)}}}catch(w){}},F.fb=function(){if(this.g){var e=Be(this.g),t=this.g.ga();this.C<t.length&&(Dr(this),Gn(this,e,t),this.i&&4!=e&&cn(this))}},F.cancel=function(){this.I=!0,Ve(this)},F.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function on(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(sn(3),Ut(17)),Ve(this),this.o=2,zn(this)):ln(this,this.Y-e)},(F=f.prototype).R=function(){h(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},F.T=function(){return h(this),this.g.concat()},F.get=function(e,t){return g(this.h,e)?this.h[e]:t},F.set=function(e,t){g(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},F.forEach=function(e,t){for(var i=this.T(),o=0;o<i.length;o++){var s=i[o],a=this.get(s);e.call(t,a,s,this)}};var _=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function S(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof S){this.g=void 0!==t?t:e.g,B(this,e.j),this.s=e.s,q(this,e.i),G(this,e.m),this.l=e.l,t=e.h;var i=new je;i.i=t.i,t.g&&(i.g=new f(t.g),i.h=t.h),W(this,i),this.o=e.o}else e&&(i=String(e).match(_))?(this.g=!!t,B(this,i[1]||"",!0),this.s=dt(i[2]||""),q(this,i[3]||"",!0),G(this,i[4]),this.l=dt(i[5]||"",!0),W(this,i[6]||"",!0),this.o=dt(i[7]||"")):(this.g=!!t,this.h=new je(null,this.g))}function P(e){return new S(e)}function B(e,t,i){e.j=i?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function q(e,t,i){e.i=i?dt(t,!0):t}function G(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function W(e,t,i){t instanceof je?(e.h=t,function Mh(e,t){t&&!e.j&&(Yt(e),e.i=null,e.g.forEach(function(i,o){var s=o.toLowerCase();o!=s&&($t(this,o),tu(this,s,i))},e)),e.j=t}(e.h,e.g)):(i||(t=Tt(t,hn)),e.h=new je(t,e.g))}function X(e,t,i){e.h.set(t,i)}function ft(e){return X(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Tt(e,t,i){return"string"==typeof e?(e=encodeURI(e).replace(t,xe),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function xe(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}S.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Tt(t,Gt,!0),":");var i=this.i;return(i||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Tt(t,Gt,!0),"@"),e.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&e.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&e.push("/"),e.push(Tt(i,"/"==i.charAt(0)?_e:Xt,!0))),(i=this.h.toString())&&e.push("?",i),(i=this.o)&&e.push("#",Tt(i,fn)),e.join("")};var Gt=/[#\/\?@]/g,Xt=/[#\?:]/g,_e=/[#\?]/g,hn=/[#\?@]/g,fn=/#/g;function je(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Yt(e){e.g||(e.g=new f,e.h=0,e.i&&function I(e,t){if(e){e=e.split("&");for(var i=0;i<e.length;i++){var o=e[i].indexOf("="),s=null;if(0<=o){var a=e[i].substring(0,o);s=e[i].substring(o+1)}else a=e[i];t(a,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,i){e.add(decodeURIComponent(t.replace(/\+/g," ")),i)}))}function $t(e,t){Yt(e),t=Pr(e,t),g(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,g((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&h(e)))}function $a(e,t){return Yt(e),t=Pr(e,t),g(e.g.h,t)}function tu(e,t,i){$t(e,t),0<i.length&&(e.i=null,e.g.set(Pr(e,t),dr(i)),e.h+=i.length)}function Pr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(F=je.prototype).add=function(e,t){Yt(this),this.i=null,e=Pr(this,e);var i=this.g.get(e);return i||this.g.set(e,i=[]),i.push(t),this.h+=1,this},F.forEach=function(e,t){Yt(this),this.g.forEach(function(i,o){fr(i,function(s){e.call(t,s,o,this)},this)},this)},F.T=function(){Yt(this);for(var e=this.g.R(),t=this.g.T(),i=[],o=0;o<t.length;o++)for(var s=e[o],a=0;a<s.length;a++)i.push(t[o]);return i},F.R=function(e){Yt(this);var t=[];if("string"==typeof e)$a(this,e)&&(t=Ze(t,this.g.get(Pr(this,e))));else{e=this.g.R();for(var i=0;i<e.length;i++)t=Ze(t,e[i])}return t},F.set=function(e,t){return Yt(this),this.i=null,$a(this,e=Pr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},F.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},F.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),i=0;i<t.length;i++){var o=t[i],s=encodeURIComponent(String(o));o=this.R(o);for(var a=0;a<o.length;a++){var u=s;""!==o[a]&&(u+="="+encodeURIComponent(String(o[a]))),e.push(u)}}return this.i=e.join("&")};var Oh=function e(t,i){this.h=t,this.g=i};function eu(e){this.l=e||Lh,e=Z.PerformanceNavigationTiming?0<(e=Z.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Z.g&&Z.g.Ea&&Z.g.Ea()&&Z.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Lh=10;function nu(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ru(e){return e.h?1:e.g?e.g.size:0}function Ns(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ms(e,t){e.g?e.g.add(t):e.h=t}function iu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ou(e){var t,i;if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var o=e.i;try{for(var s=ci(e.g.values()),a=s.next();!a.done;a=s.next())o=o.concat(a.value.D)}catch(c){t={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return o}return dr(e.i)}function Os(){}function Fh(){this.g=new Os}function Uh(e,t,i){var o=i||"";try{ki(e,function(s,a){var u=s;Ce(s)&&(u=wr(s)),t.push(o+a+"="+encodeURIComponent(u))})}catch(s){throw t.push(o+"type="+encodeURIComponent("_badmap")),s}}function Po(e,t,i,o,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(o)}catch(a){}}function Ri(e){this.l=e.$b||null,this.j=e.ib||!1}function No(e,t){wt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ls,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}eu.prototype.cancel=function(){var e,t;if(this.i=ou(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var i=ci(this.g.values()),o=i.next();!o.done;o=i.next())o.value.cancel()}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.g.clear()}},Os.prototype.stringify=function(e){return Z.JSON.stringify(e,void 0)},Os.prototype.parse=function(e){return Z.JSON.parse(e,void 0)},ht(Ri,Ii),Ri.prototype.g=function(){return new No(this.l,this.j)},Ri.prototype.i=function(e){return function(){return e}}({}),ht(No,wt);var Ls=0;function su(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Di(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Pi(e)}function Pi(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(F=No.prototype).open=function(e,t){if(this.readyState!=Ls)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Pi(this)},F.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Z).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Di(this)),this.readyState=Ls},F.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pi(this)),this.g&&(this.readyState=3,Pi(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Z.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;su(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},F.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Di(this):Pi(this),3==this.readyState&&su(this)}},F.Ua=function(e){this.g&&(this.response=this.responseText=e,Di(this))},F.Ta=function(e){this.g&&(this.response=e,Di(this))},F.ha=function(){this.g&&Di(this)},F.setRequestHeader=function(e,t){this.v.append(e,t)},F.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},F.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),i=t.next();!i.done;)e.push((i=i.value)[0]+": "+i[1]),i=t.next();return e.join("\r\n")},Object.defineProperty(No.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Vh=Z.JSON.parse;function It(e){wt.call(this),this.headers=new f,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=au,this.K=this.L=!1}ht(It,wt);var au="",jh=/^https?$/i,Bh=["POST","PUT"];function zh(e){return"content-type"==e.toLowerCase()}function uu(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,cu(e),Mo(e)}function cu(e){e.D||(e.D=!0,yt(e,"complete"),yt(e,"error"))}function lu(e){if(e.h&&void 0!==Me&&(!e.C[1]||4!=Be(e)||2!=e.ba()))if(e.v&&4==Be(e))wi(e.Fa,0,e);else if(yt(e,"readystatechange"),4==Be(e)){e.h=!1;try{var o,t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(o=i)){var s;if(s=0===t){var a=String(e.H).match(_)[1]||null;if(!a&&Z.self&&Z.self.location){var u=Z.self.location.protocol;a=u.substr(0,u.length-1)}s=!jh.test(a?a.toLowerCase():"")}o=s}if(o)yt(e,"complete"),yt(e,"success");else{e.m=6;try{var c=2<Be(e)?e.g.statusText:""}catch(l){c=""}e.j=c+" ["+e.ba()+"]",cu(e)}}finally{Mo(e)}}}function Mo(e,t){if(e.g){hu(e);var i=e.g,o=e.C[0]?ie:null;e.g=null,e.C=null,t||yt(e,"ready");try{i.onreadystatechange=o}catch(s){}}}function hu(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Z.clearTimeout(e.A),e.A=null)}function Be(e){return e.g?e.g.readyState:0}function fu(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case au:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fs(e,t,i){t:{for(o in i){var o=!1;break t}o=!0}o||(i=function Kh(e){var t="";return be(e,function(i,o){t+=o,t+=":",t+=i,t+="\r\n"}),t}(i),"string"==typeof e?null!=i&&encodeURIComponent(String(i)):X(e,t,i))}function Ni(e,t,i){return i&&i.internalChannelParams&&i.internalChannelParams[e]||t}function du(e){this.za=0,this.l=[],this.h=new Cr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Ni("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Ni("baseRetryDelayMs",5e3,e),this.$a=Ni("retryDelaySeedMs",1e4,e),this.Ya=Ni("forwardChannelMaxRetries",2,e),this.ra=Ni("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new eu(e&&e.concurrentRequestLimit),this.Ca=new Fh,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Us(e){if(pu(e),3==e.G){var t=e.V++,i=P(e.F);X(i,"SID",e.J),X(i,"RID",t),X(i,"TYPE","terminate"),Mi(e,i),(t=new Bn(e,e.h,t,void 0)).K=2,t.v=ft(P(i)),i=!1,Z.navigator&&Z.navigator.sendBeacon&&(i=Z.navigator.sendBeacon(t.v.toString(),"")),!i&&Z.Image&&((new Image).src=t.v,i=!0),i||(t.g=Iu(t.l,null),t.g.ea(t.v)),t.F=Date.now(),cn(t)}wu(e)}function Oo(e){e.g&&(js(e),e.g.cancel(),e.g=null)}function pu(e){Oo(e),e.u&&(Z.clearTimeout(e.u),e.u=null),Fo(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Z.clearTimeout(e.m),e.m=null)}function qs(e,t){e.l.push(new Oh(e.Za++,t)),3==e.G&&Lo(e)}function Lo(e){nu(e.i)||e.m||(e.m=!0,vi(e.Ha,e),e.C=0)}function mu(e,t){var i;i=t?t.m:e.V++;var o=P(e.F);X(o,"SID",e.J),X(o,"RID",i),X(o,"AID",e.U),Mi(e,o),e.o&&e.s&&Fs(o,e.o,e.s),i=new Bn(e,e.h,i,e.C+1),null===e.o&&(i.H=e.s),t&&(e.l=t.D.concat(e.l)),t=gu(e,i,1e3),i.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Ms(e.i,i),Rr(i,o,t)}function Mi(e,t){e.j&&ki({},function(i,o){X(t,o,i)})}function gu(e,t,i){i=Math.min(e.l.length,i);var o=e.j?_t(e.j.Oa,e.j,e):null;t:for(var s=e.l,a=-1;;){var u=["count="+i];-1==a?0<i?u.push("ofs="+(a=s[0].h)):a=0:u.push("ofs="+a);for(var c=!0,l=0;l<i;l++){var d=s[l].h,p=s[l].g;if(0>(d-=a))a=Math.max(0,s[l].h-100),c=!1;else try{Uh(p,u,"req"+d+"_")}catch(y){o&&o(p)}}if(c){o=u.join("&");break t}}return e=e.l.splice(0,i),t.D=e,o}function vu(e){e.g||e.u||(e.Y=1,vi(e.Ga,e),e.A=0)}function Vs(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=Vn(_t(e.Ga,e),_u(e,e.A)),e.A++,0))}function js(e){null!=e.B&&(Z.clearTimeout(e.B),e.B=null)}function yu(e){e.g=new Bn(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=P(e.oa);X(t,"RID","rpc"),X(t,"SID",e.J),X(t,"CI",e.N?"0":"1"),X(t,"AID",e.U),Mi(e,t),X(t,"TYPE","xmlhttp"),e.o&&e.s&&Fs(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var i=e.g;e=e.la,i.K=1,i.v=ft(P(t)),i.s=null,i.U=!0,ko(i,e)}function Fo(e){null!=e.v&&(Z.clearTimeout(e.v),e.v=null)}function bu(e,t){var i=null;if(e.g==t){Fo(e),js(e),e.g=null;var o=2}else{if(!Ns(e.i,t))return;i=t.D,iu(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==o){i=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;yt(o=Sr(),new So(o,i,t,s)),Lo(e)}else vu(e);else if(3==(s=t.o)||0==s&&0<e.I||!(1==o&&function Hh(e,t){return!(ru(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Vn(_t(e.Ha,e,t),_u(e,e.C)),e.C++,0)))}(e,t)||2==o&&Vs(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),s){case 1:Kn(e,5);break;case 4:Kn(e,10);break;case 3:Kn(e,6);break;default:Kn(e,2)}}function _u(e,t){var i=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(i*=2),i*t}function Kn(e,t){if(e.h.info("Error code "+t),2==t){var i=null;e.j&&(i=null);var o=_t(e.jb,e);i||(i=new S("//www.google.com/images/cleardot.gif"),Z.location&&"http"==Z.location.protocol||B(i,"https"),ft(i)),function qh(e,t){var i=new Cr;if(Z.Image){var o=new Image;o.onload=Oe(Po,i,o,"TestLoadImage: loaded",!0,t),o.onerror=Oe(Po,i,o,"TestLoadImage: error",!1,t),o.onabort=Oe(Po,i,o,"TestLoadImage: abort",!1,t),o.ontimeout=Oe(Po,i,o,"TestLoadImage: timeout",!1,t),Z.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=e}else t(!1)}(i.toString(),o)}else Ut(2);e.G=0,e.j&&e.j.va(t),wu(e),pu(e)}function wu(e){e.G=0,e.I=-1,e.j&&((0!=ou(e.i).length||0!=e.l.length)&&(e.i.i.length=0,dr(e.l),e.l.length=0),e.j.ua())}function Tu(e,t,i){var o=function Nt(e){return e instanceof S?P(e):new S(e,void 0)}(i);if(""!=o.i)t&&q(o,t+"."+o.i),G(o,o.m);else{var s=Z.location;o=function ct(e,t,i,o){var s=new S(null,void 0);return e&&B(s,e),t&&q(s,t),i&&G(s,i),o&&(s.l=o),s}(s.protocol,t?t+"."+s.hostname:s.hostname,+s.port,i)}return e.aa&&be(e.aa,function(a,u){X(o,u,a)}),i=e.sa,(t=e.D)&&i&&X(o,t,i),X(o,"VER",e.ma),Mi(e,o),o}function Iu(e,t,i){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new It(i&&e.Ba&&!e.qa?new Ri({ib:!0}):e.qa)).L=e.H,t}function Eu(){}function Uo(){if(Ae&&!(10<=Number(A)))throw Error("Environmental error: no available transport.")}function oe(e,t){wt.call(this),this.g=new du(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Dt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Dt(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Nr(this)}function Cu(e){Ci.call(this);var t=e.__sm__;if(t){t:{for(var i in t){e=i;break t}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Su(){un.call(this),this.status=1}function Nr(e){this.g=e}(F=It.prototype).ea=function(e,t,i,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Si.g(),this.C=function Ei(e){return e.h||(e.h=e.i())}(this.u?this.u:Si),this.g.onreadystatechange=_t(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void uu(this,a)}e=i||"";var s=new f(this.headers);o&&ki(o,function(a,u){s.set(u,a)}),o=function Qe(e){t:{for(var t=zh,i=e.length,o="string"==typeof e?e.split(""):e,s=0;s<i;s++)if(s in o&&t.call(void 0,o[s],s,e)){t=s;break t}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),i=Z.FormData&&e instanceof Z.FormData,!(0<=xn(Bh,t))||o||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(a,u){this.g.setRequestHeader(u,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{hu(this),0<this.B&&((this.K=function Gh(e){return Ae&&function k(){return function Dn(e){var t=$e;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}(function(){for(var e=0,t=Se(String(Ye)).split("."),i=Se("9").split("."),o=Math.max(t.length,i.length),s=0;0==e&&s<o;s++){var a=t[s]||"",u=i[s]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==a[0].length&&0==u[0].length)break;e=kn(0==a[1].length?0:parseInt(a[1],10),0==u[1].length?0:parseInt(u[1],10))||kn(0==a[2].length,0==u[2].length)||kn(a[2],u[2]),a=a[3],u=u[3]}while(0==e)}return 0<=e})}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_t(this.pa,this)):this.A=wi(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){uu(this,a)}},F.pa=function(){void 0!==Me&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yt(this,"timeout"),this.abort(8))},F.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,yt(this,"complete"),yt(this,"abort"),Mo(this))},F.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mo(this,!0)),It.Z.M.call(this)},F.Fa=function(){this.s||(this.F||this.v||this.l?lu(this):this.cb())},F.cb=function(){lu(this)},F.ba=function(){try{return 2<Be(this)?this.g.status:-1}catch(e){return-1}},F.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},F.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Vh(t)}},F.Da=function(){return this.m},F.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(F=du.prototype).ma=8,F.G=1,F.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},F.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Bn(this,this.h,e,void 0),i=this.s;if(this.P&&(i?Fe(i=Rn(i),this.P):i=this.P),null===this.o&&(t.H=i),this.ja)t:{for(var o=0,s=0;s<this.l.length;s++){var a=this.l[s];if(void 0===(a="__data__"in a.g&&"string"==typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(o+=a)){o=s;break t}if(4096===o||s===this.l.length-1){o=s+1;break t}}o=1e3}else o=1e3;o=gu(this,t,o),X(s=P(this.F),"RID",e),X(s,"CVER",22),this.D&&X(s,"X-HTTP-Session-Id",this.D),Mi(this,s),this.o&&i&&Fs(s,this.o,i),Ms(this.i,t),this.Ra&&X(s,"TYPE","init"),this.ja?(X(s,"$req",o),X(s,"SID","null"),t.$=!0,Rr(t,s,null)):Rr(t,s,o),this.G=2}}else 3==this.G&&(e?mu(this,e):0==this.l.length||nu(this.i)||mu(this))},F.Ga=function(){if(this.u=null,yu(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Vn(_t(this.bb,this),e)}},F.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ut(10),Oo(this),yu(this))},F.ab=function(){null!=this.v&&(this.v=null,Oo(this),Vs(this),Ut(19))},F.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Ut(2)):(this.h.info("Failed to ping google.com"),Ut(1))},(F=Eu.prototype).xa=function(){},F.wa=function(){},F.va=function(){},F.ua=function(){},F.Oa=function(){},Uo.prototype.g=function(e,t){return new oe(e,t)},ht(oe,wt),oe.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,i=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),vi(_t(e.hb,e,t))),Ut(0),e.W=t,e.aa=i||{},e.N=e.X,e.F=Tu(e,null,e.W),Lo(e)},oe.prototype.close=function(){Us(this.g)},oe.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,qs(this.g,t)}else this.v?((t={}).__data__=wr(e),qs(this.g,t)):qs(this.g,e)},oe.prototype.M=function(){this.g.j=null,delete this.j,Us(this.g),delete this.g,oe.Z.M.call(this)},ht(Cu,Ci),ht(Su,un),ht(Nr,Eu),Nr.prototype.xa=function(){yt(this.g,"a")},Nr.prototype.wa=function(e){yt(this.g,new Cu(e))},Nr.prototype.va=function(e){yt(this.g,new Su(e))},Nr.prototype.ua=function(){yt(this.g,"b")},Uo.prototype.createWebChannel=Uo.prototype.g,oe.prototype.send=oe.prototype.u,oe.prototype.open=oe.prototype.m,oe.prototype.close=oe.prototype.close,jn.NO_ERROR=0,jn.TIMEOUT=8,jn.HTTP_ERROR=6,Ar.COMPLETE="complete",Ao.EventType=an,an.OPEN="a",an.CLOSE="b",an.ERROR="c",an.MESSAGE="d",wt.prototype.listen=wt.prototype.N,It.prototype.listenOnce=It.prototype.O,It.prototype.getLastError=It.prototype.La,It.prototype.getLastErrorCode=It.prototype.Da,It.prototype.getStatus=It.prototype.ba,It.prototype.getResponseJson=It.prototype.Qa,It.prototype.getResponseText=It.prototype.ga,It.prototype.send=It.prototype.ea;var qo=jn,ku=Ar,Ru=me,Bs_PROXY=10,Bs_NOPROXY=11,Du=Ri,Oi=Ao,Pu=It,se=function(){function e(t,i){var o=this;this.previousValue=t,i&&(i.sequenceNumberHandler=function(s){return o.t(s)},this.i=function(s){return i.writeSequenceNumber(s)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();se.o=-1;var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=function(e){function t(i,o){var s=this;return(s=e.call(this,o)||this).code=i,s.message=o,s.name="FirebaseError",s.toString=function(){return s.name+": [code="+s.code+"]: "+s.message},s}return(0,m.ZT)(t,e),t}(Error),we=new Wt.Yd("@firebase/firestore");function Gs(){return we.logLevel}function U(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(we.logLevel<=Wt.in.DEBUG){var o=t.map(zs);we.debug.apply(we,(0,m.ev)(["Firestore (8.10.1): "+e],o))}}function Et(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(we.logLevel<=Wt.in.ERROR){var o=t.map(zs);we.error.apply(we,(0,m.ev)(["Firestore (8.10.1): "+e],o))}}function Li(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(we.logLevel<=Wt.in.WARN){var o=t.map(zs);we.warn.apply(we,(0,m.ev)(["Firestore (8.10.1): "+e],o))}}function zs(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(i){return e}}function z(e){void 0===e&&(e="Unexpected state");var t="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+e;throw Et(t),new Error(t)}function Y(e,t){e||z()}function j(e,t){return e}function Jh(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(i);else for(var o=0;o<e;o++)i[o]=Math.floor(256*Math.random());return i}var Nu=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/t.length)*t.length,o="";o.length<20;)for(var s=Jh(40),a=0;a<s.length;++a)o.length<20&&s[a]<i&&(o+=t.charAt(s[a]%t.length));return o},e}();function et(e,t){return e<t?-1:e>t?1:0}function Mr(e,t,i){return e.length===t.length&&e.every(function(o,s){return i(o,t[s])})}function Mu(e){return e+"\0"}var te=function(){function e(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new N(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new N(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<-62135596800)throw new N(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var i=Math.floor(t/1e3);return new e(i,Math.floor(1e6*(t-1e3*i)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?et(this.nanoseconds,t.nanoseconds):et(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),$=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new te(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();function Ou(e){var t=0;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t}function Hn(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t(i,e[i])}function Lu(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Fu=function(){function e(t,i,o){void 0===i?i=0:i>t.length&&z(),void 0===o?o=t.length-i:o>t.length-i&&z(),this.segments=t,this.offset=i,this.len=o}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return 0===e.comparator(this,t)},e.prototype.child=function(t){var i=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(o){i.push(o)}):i.push(t),this.construct(i)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.forEach=function(t){for(var i=this.offset,o=this.limit();i<o;i++)t(this.segments[i])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,i){for(var o=Math.min(t.length,i.length),s=0;s<o;s++){var a=t.get(s),u=i.get(s);if(a<u)return-1;if(a>u)return 1}return t.length<i.length?-1:t.length>i.length?1:0},e}(),it=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=[],a=0,u=i;a<u.length;a++){var c=u[a];if(c.indexOf("//")>=0)throw new N(x.INVALID_ARGUMENT,"Invalid segment ("+c+"). Paths must not contain // in them.");s.push.apply(s,c.split("/").filter(function(l){return l.length>0}))}return new t(s)},t.emptyPath=function(){return new t([])},t}(Fu),Qh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.isValidIdentifier=function(i){return Qh.test(i)},t.prototype.canonicalString=function(){return this.toArray().map(function(i){return i=i.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(i)||(i="`"+i+"`"),i}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(i){for(var o=[],s="",a=0,u=function(){if(0===s.length)throw new N(x.INVALID_ARGUMENT,"Invalid field path ("+i+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");o.push(s),s=""},c=!1;a<i.length;){var l=i[a];if("\\"===l){if(a+1===i.length)throw new N(x.INVALID_ARGUMENT,"Path has trailing escape character: "+i);var d=i[a+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new N(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+i);s+=d,a+=2}else"`"===l?(c=!c,a++):"."!==l||c?(s+=l,a++):(u(),a++)}if(u(),c)throw new N(x.INVALID_ARGUMENT,"Unterminated ` in path: "+i);return new t(o)},t.emptyPath=function(){return new t([])},t}(Fu),Or=function(){function e(t){this.fields=t,t.sort(Te.comparator)}return e.prototype.covers=function(t){for(var i=0,o=this.fields;i<o.length;i++)if(o[i].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return Mr(this.fields,t.fields,function(i,o){return i.isEqual(o)})},e}(),Qt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(i){for(var o="",s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(t))},e.prototype.toBase64=function(){return btoa(this.binaryString)},e.prototype.toUint8Array=function(){return function(t){for(var i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return et(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();Qt.EMPTY_BYTE_STRING=new Qt("");var Zh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dn(e){if(Y(!!e),"string"==typeof e){var t=0,i=Zh.exec(e);if(Y(!!i),i[1]){var o=i[1];o=(o+"000000000").substr(0,9),t=Number(o)}var s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Ct(e.seconds),nanos:Ct(e.nanos)}}function Ct(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Lr(e){return"string"==typeof e?Qt.fromBase64String(e):Qt.fromUint8Array(e)}function Ks(e){var t,i;return"server_timestamp"===(null===(i=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function Uu(e){var t=e.mapValue.fields.__previous_value__;return Ks(t)?Uu(t):t}function Fi(e){var t=dn(e.mapValue.fields.__local_write_time__.timestampValue);return new te(t.seconds,t.nanos)}function Jn(e){return null==e}function Vo(e){return 0===e&&1/e==-1/0}function qu(e){return"number"==typeof e&&Number.isInteger(e)&&!Vo(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var K=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(it.fromString(t))},e.fromName=function(t){return new e(it.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===it.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,i){return it.comparator(t.path,i.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new it(t.slice()))},e}();function Qn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ks(e)?4:10:z()}function ke(e,t){var s,i=Qn(e);if(i!==Qn(t))return!1;switch(i){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fi(e).isEqual(Fi(t));case 3:return function(o,s){if("string"==typeof o.timestampValue&&"string"==typeof s.timestampValue&&o.timestampValue.length===s.timestampValue.length)return o.timestampValue===s.timestampValue;var a=dn(o.timestampValue),u=dn(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,Lr(e.bytesValue).isEqual(Lr(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(o,s){return Ct(o.geoPointValue.latitude)===Ct(s.geoPointValue.latitude)&&Ct(o.geoPointValue.longitude)===Ct(s.geoPointValue.longitude)}(e,t);case 2:return function(o,s){if("integerValue"in o&&"integerValue"in s)return Ct(o.integerValue)===Ct(s.integerValue);if("doubleValue"in o&&"doubleValue"in s){var a=Ct(o.doubleValue),u=Ct(s.doubleValue);return a===u?Vo(a)===Vo(u):isNaN(a)&&isNaN(u)}return!1}(e,t);case 9:return Mr(e.arrayValue.values||[],t.arrayValue.values||[],ke);case 10:return function(o,s){var a=o.mapValue.fields||{},u=s.mapValue.fields||{};if(Ou(a)!==Ou(u))return!1;for(var c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!ke(a[c],u[c])))return!1;return!0}(e,t);default:return z()}}function Ui(e,t){return void 0!==(e.values||[]).find(function(i){return ke(i,t)})}function Fr(e,t){var s,a,u,c,i=Qn(e),o=Qn(t);if(i!==o)return et(i,o);switch(i){case 0:return 0;case 1:return et(e.booleanValue,t.booleanValue);case 2:return a=t,(u=Ct((s=e).integerValue||s.doubleValue))<(c=Ct(a.integerValue||a.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return Vu(e.timestampValue,t.timestampValue);case 4:return Vu(Fi(e),Fi(t));case 5:return et(e.stringValue,t.stringValue);case 6:return function(s,a){var u=Lr(s),c=Lr(a);return u.compareTo(c)}(e.bytesValue,t.bytesValue);case 7:return function(s,a){for(var u=s.split("/"),c=a.split("/"),l=0;l<u.length&&l<c.length;l++){var d=et(u[l],c[l]);if(0!==d)return d}return et(u.length,c.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,a){var u=et(Ct(s.latitude),Ct(a.latitude));return 0!==u?u:et(Ct(s.longitude),Ct(a.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(s,a){for(var u=s.values||[],c=a.values||[],l=0;l<u.length&&l<c.length;++l){var d=Fr(u[l],c[l]);if(d)return d}return et(u.length,c.length)}(e.arrayValue,t.arrayValue);case 10:return function(s,a){var u=s.fields||{},c=Object.keys(u),l=a.fields||{},d=Object.keys(l);c.sort(),d.sort();for(var p=0;p<c.length&&p<d.length;++p){var y=et(c[p],d[p]);if(0!==y)return y;var w=Fr(u[c[p]],l[d[p]]);if(0!==w)return w}return et(c.length,d.length)}(e.mapValue,t.mapValue);default:throw z()}}function Vu(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return et(e,t);var i=dn(e),o=dn(t),s=et(i.seconds,o.seconds);return 0!==s?s:et(i.nanos,o.nanos)}function Hs(e){return Js(e)}function Js(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?"time("+(s=dn(e.timestampValue)).seconds+","+s.nanos+")":"stringValue"in e?e.stringValue:"bytesValue"in e?Lr(e.bytesValue).toBase64():"referenceValue"in e?K.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(o){for(var s="[",a=!0,u=0,c=o.values||[];u<c.length;u++)a?a=!1:s+=",",s+=Js(c[u]);return s+"]"}(e.arrayValue):"mapValue"in e?function(o){for(var s="{",a=!0,u=0,c=Object.keys(o.fields||{}).sort();u<c.length;u++){var l=c[u];a?a=!1:s+=",",s+=l+":"+Js(o.fields[l])}return s+"}"}(e.mapValue):z();var s,t}function jo(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Qs(e){return!!e&&"integerValue"in e}function Zs(e){return!!e&&"arrayValue"in e}function ju(e){return!!e&&"nullValue"in e}function Bu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Bo(e){return!!e&&"mapValue"in e}function qi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Hn(e.mapValue.fields,function(s,a){return t.mapValue.fields[s]=qi(a)}),t}if(e.arrayValue){for(var i={arrayValue:{values:[]}},o=0;o<(e.arrayValue.values||[]).length;++o)i.arrayValue.values[o]=qi(e.arrayValue.values[o]);return i}return Object.assign({},e)}var ae=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var i=this.value,o=0;o<t.length-1;++o)if(!Bo(i=(i.mapValue.fields||{})[t.get(o)]))return null;return(i=(i.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=qi(i)},e.prototype.setAll=function(t){var i=this,o=Te.emptyPath(),s={},a=[];t.forEach(function(c,l){if(!o.isImmediateParentOf(l)){var d=i.getFieldsMap(o);i.applyChanges(d,s,a),s={},a=[],o=l.popLast()}c?s[l.lastSegment()]=qi(c):a.push(l.lastSegment())});var u=this.getFieldsMap(o);this.applyChanges(u,s,a)},e.prototype.delete=function(t){var i=this.field(t.popLast());Bo(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return ke(this.value,t.value)},e.prototype.getFieldsMap=function(t){var i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(var o=0;o<t.length;++o){var s=i.mapValue.fields[t.get(o)];Bo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},i.mapValue.fields[t.get(o)]=s),i=s}return i.mapValue.fields},e.prototype.applyChanges=function(t,i,o){Hn(i,function(c,l){return t[c]=l});for(var s=0,a=o;s<a.length;s++)delete t[a[s]]},e.prototype.clone=function(){return new e(qi(this.value))},e}();function Gu(e){var t=[];return Hn(e.fields,function(i,o){var s=new Te([i]);if(Bo(o)){var a=Gu(o.mapValue).fields;if(0===a.length)t.push(s);else for(var u=0,c=a;u<c.length;u++)t.push(s.child(c[u]))}else t.push(s)}),new Or(t)}var qt=function(){function e(t,i,o,s,a){this.key=t,this.documentType=i,this.version=o,this.data=s,this.documentState=a}return e.newInvalidDocument=function(t){return new e(t,0,$.min(),ae.empty(),0)},e.newFoundDocument=function(t,i,o){return new e(t,1,i,o,0)},e.newNoDocument=function(t,i){return new e(t,2,i,ae.empty(),0)},e.newUnknownDocument=function(t,i){return new e(t,3,i,ae.empty(),2)},e.prototype.convertToFoundDocument=function(t,i){return this.version=t,this.documentType=1,this.data=i,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ae.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ae.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return 0!==this.documentType},e.prototype.isFoundDocument=function(){return 1===this.documentType},e.prototype.isNoDocument=function(){return 2===this.documentType},e.prototype.isUnknownDocument=function(){return 3===this.documentType},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Wh=function(e,t,i,o,s,a,u){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=s,this.startAt=a,this.endAt=u,this.h=null};function zu(e,t,i,o,s,a,u){return void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),new Wh(e,t,i,o,s,a,u)}function Vi(e){var t=j(e);if(null===t.h){var i=t.path.canonicalString();null!==t.collectionGroup&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(function(o){return(s=o).field.canonicalString()+s.op.toString()+Hs(s.value);var s}).join(","),i+="|ob:",i+=t.orderBy.map(function(o){return(s=o).field.canonicalString()+s.dir;var s}).join(","),Jn(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=Ko(t.startAt)),t.endAt&&(i+="|ub:",i+=Ko(t.endAt)),t.h=i}return t.h}function Go(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var i=0;i<e.orderBy.length;i++)if(!of(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o=0;o<e.filters.length;o++)if((s=e.filters[o]).op!==(a=t.filters[o]).op||!s.field.isEqual(a.field)||!ke(s.value,a.value))return!1;var s,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ju(e.startAt,t.startAt)&&Ju(e.endAt,t.endAt)}function zo(e){return K.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ue=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).field=i,a.op=o,a.value=s,a}return(0,m.ZT)(t,e),t.create=function(i,o,s){return i.isKeyField()?"in"===o||"not-in"===o?this.l(i,o,s):new Xh(i,o,s):"array-contains"===o?new tf(i,s):"in"===o?new ef(i,s):"not-in"===o?new nf(i,s):"array-contains-any"===o?new rf(i,s):new t(i,o,s)},t.l=function(i,o,s){return"in"===o?new Yh(i,s):new $h(i,s)},t.prototype.matches=function(i){var o=i.data.field(this.field);return"!="===this.op?null!==o&&this.m(Fr(o,this.value)):null!==o&&Qn(this.value)===Qn(o)&&this.m(Fr(o,this.value))},t.prototype.m=function(i){switch(this.op){case"<":return i<0;case"<=":return i<=0;case"==":return 0===i;case"!=":return 0!==i;case">":return i>0;case">=":return i>=0;default:return z()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),Xh=function(e){function t(i,o,s){var a=this;return(a=e.call(this,i,o,s)||this).key=K.fromName(s.referenceValue),a}return(0,m.ZT)(t,e),t.prototype.matches=function(i){var o=K.comparator(i.key,this.key);return this.m(o)},t}(ue),Yh=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"in",o)||this).keys=Ku(0,o),s}return(0,m.ZT)(t,e),t.prototype.matches=function(i){return this.keys.some(function(o){return o.isEqual(i.key)})},t}(ue),$h=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"not-in",o)||this).keys=Ku(0,o),s}return(0,m.ZT)(t,e),t.prototype.matches=function(i){return!this.keys.some(function(o){return o.isEqual(i.key)})},t}(ue);function Ku(e,t){var i;return((null===(i=t.arrayValue)||void 0===i?void 0:i.values)||[]).map(function(o){return K.fromName(o.referenceValue)})}var tf=function(e){function t(i,o){return e.call(this,i,"array-contains",o)||this}return(0,m.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return Zs(o)&&Ui(o.arrayValue,this.value)},t}(ue),ef=function(e){function t(i,o){return e.call(this,i,"in",o)||this}return(0,m.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return null!==o&&Ui(this.value.arrayValue,o)},t}(ue),nf=function(e){function t(i,o){return e.call(this,i,"not-in",o)||this}return(0,m.ZT)(t,e),t.prototype.matches=function(i){if(Ui(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var o=i.data.field(this.field);return null!==o&&!Ui(this.value.arrayValue,o)},t}(ue),rf=function(e){function t(i,o){return e.call(this,i,"array-contains-any",o)||this}return(0,m.ZT)(t,e),t.prototype.matches=function(i){var o=this,s=i.data.field(this.field);return!(!Zs(s)||!s.arrayValue.values)&&s.arrayValue.values.some(function(a){return Ui(o.value.arrayValue,a)})},t}(ue),ji=function(e,t){this.position=e,this.before=t};function Ko(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return Hs(t)}).join(",")}var Ur=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t};function of(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Hu(e,t,i){for(var o=0,s=0;s<e.position.length;s++){var a=t[s],u=e.position[s];if(o=a.field.isKeyField()?K.comparator(K.fromName(u.referenceValue),i.key):Fr(u,i.data.field(a.field)),"desc"===a.dir&&(o*=-1),0!==o)break}return e.before?o<=0:o<0}function Ju(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var i=0;i<e.position.length;i++)if(!ke(e.position[i],t.position[i]))return!1;return!0}var Ge=function(e,t,i,o,s,a,u,c){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===a&&(a="F"),void 0===u&&(u=null),void 0===c&&(c=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.p=null,this.T=null};function Qu(e,t,i,o,s,a,u,c){return new Ge(e,t,i,o,s,a,u,c)}function qr(e){return new Ge(e)}function Ho(e){return!Jn(e.limit)&&"F"===e.limitType}function Jo(e){return!Jn(e.limit)&&"L"===e.limitType}function Ws(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Xs(e){for(var t=0,i=e.filters;t<i.length;t++){var o=i[t];if(o.g())return o.field}return null}function Ys(e){return null!==e.collectionGroup}function Vr(e){var t=j(e);if(null===t.p){t.p=[];var i=Xs(t),o=Ws(t);if(null!==i&&null===o)i.isKeyField()||t.p.push(new Ur(i)),t.p.push(new Ur(Te.keyField(),"asc"));else{for(var s=!1,a=0,u=t.explicitOrderBy;a<u.length;a++){var c=u[a];t.p.push(c),c.field.isKeyField()&&(s=!0)}if(!s){var l=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new Ur(Te.keyField(),l))}}}return t.p}function ge(e){var t=j(e);if(!t.T)if("F"===t.limitType)t.T=zu(t.path,t.collectionGroup,Vr(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var i=[],o=0,s=Vr(t);o<s.length;o++){var a=s[o];i.push(new Ur(a.field,"desc"===a.dir?"asc":"desc"))}var c=t.endAt?new ji(t.endAt.position,!t.endAt.before):null,l=t.startAt?new ji(t.startAt.position,!t.startAt.before):null;t.T=zu(t.path,t.collectionGroup,i,t.filters,t.limit,c,l)}return t.T}function Zu(e,t,i){return new Ge(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,i,e.startAt,e.endAt)}function Bi(e,t){return Go(ge(e),ge(t))&&e.limitType===t.limitType}function Wu(e){return Vi(ge(e))+"|lt:"+e.limitType}function $s(e){return"Query(target="+(i=(t=ge(e)).path.canonicalString(),null!==t.collectionGroup&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=", filters: ["+t.filters.map(function(o){return(s=o).field.canonicalString()+" "+s.op+" "+Hs(s.value);var s}).join(", ")+"]"),Jn(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=", orderBy: ["+t.orderBy.map(function(o){return(s=o).field.canonicalString()+" ("+s.dir+")";var s}).join(", ")+"]"),t.startAt&&(i+=", startAt: "+Ko(t.startAt)),t.endAt&&(i+=", endAt: "+Ko(t.endAt)),"Target("+i+"); limitType=")+e.limitType+")";var t,i}function Gi(e,t){return t.isFoundDocument()&&(s=(o=t).key.path,null!==(i=e).collectionGroup?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):K.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s))&&function(i,o){for(var s=0,a=i.explicitOrderBy;s<a.length;s++){var u=a[s];if(!u.field.isKeyField()&&null===o.data.field(u.field))return!1}return!0}(e,t)&&function(i,o){for(var s=0,a=i.filters;s<a.length;s++)if(!a[s].matches(o))return!1;return!0}(e,t)&&function(i,o){return!(i.startAt&&!Hu(i.startAt,Vr(i),o)||i.endAt&&Hu(i.endAt,Vr(i),o))}(e,t);var i,o,s}function Xu(e){return function(t,i){for(var o=!1,s=0,a=Vr(e);s<a.length;s++){var u=a[s],c=sf(u,t,i);if(0!==c)return c;o=o||u.field.isKeyField()}return 0}}function sf(e,t,i){var s,u,c,l,o=e.field.isKeyField()?K.comparator(t.key,i.key):(u=i,c=t.data.field(s=e.field),l=u.data.field(s),null!==c&&null!==l?Fr(c,l):z());switch(e.dir){case"asc":return o;case"desc":return-1*o;default:return z()}}function Yu(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vo(t)?"-0":t}}function $u(e){return{integerValue:""+e}}function tc(e,t){return qu(t)?$u(t):Yu(e,t)}var Qo=function(){this._=void 0};function af(e,t,i){return e instanceof jr?(a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(o=i).seconds,nanos:o.nanoseconds}}}},(s=t)&&(a.fields.__previous_value__=s),{mapValue:a}):e instanceof Zn?nc(e,t):e instanceof Wn?rc(e,t):function(o,s){var a=ec(o,s),u=ic(a)+ic(o.A);return Qs(a)&&Qs(o.A)?$u(u):Yu(o.R,u)}(e,t);var o,s,a}function uf(e,t,i){return e instanceof Zn?nc(e,t):e instanceof Wn?rc(e,t):i}function ec(e,t){return e instanceof Br?Qs(i=t)||(o=i)&&"doubleValue"in o?t:{integerValue:0}:null;var o,i}var jr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t}(Qo),Zn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,m.ZT)(t,e),t}(Qo);function nc(e,t){for(var i=oc(t),o=function(u){i.some(function(c){return ke(c,u)})||i.push(u)},s=0,a=e.elements;s<a.length;s++)o(a[s]);return{arrayValue:{values:i}}}var Wn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,m.ZT)(t,e),t}(Qo);function rc(e,t){for(var i=oc(t),o=function(u){i=i.filter(function(c){return!ke(c,u)})},s=0,a=e.elements;s<a.length;s++)o(a[s]);return{arrayValue:{values:i}}}var Br=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).R=i,s.A=o,s}return(0,m.ZT)(t,e),t}(Qo);function ic(e){return Ct(e.integerValue||e.doubleValue)}function oc(e){return Zs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var zi=function(e,t){this.field=e,this.transform=t},cf=function(e,t){this.version=e,this.transformResults=t},zt=function(){function e(t,i){this.updateTime=t,this.exists=i}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function Zo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Wo=function(){};function lf(e,t,i){var o,s,a,u,c;e instanceof Ki?(s=t,a=i,u=(o=e).value.clone(),c=cc(o.fieldTransforms,s,a.transformResults),u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()):e instanceof pn?function(o,s,a){if(Zo(o.precondition,s)){var u=cc(o.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(uc(o)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}else s.convertToUnknownDocument(a.version)}(e,t,i):function(o,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,i)}function ta(e,t,i){var s;e instanceof Ki?function(o,s,a){if(Zo(o.precondition,s)){var u=o.value.clone(),c=lc(o.fieldTransforms,a,s);u.setAll(c),s.convertToFoundDocument(ac(s),u).setHasLocalMutations()}}(e,t,i):e instanceof pn?function(o,s,a){if(Zo(o.precondition,s)){var u=lc(o.fieldTransforms,a,s),c=s.data;c.setAll(uc(o)),c.setAll(u),s.convertToFoundDocument(ac(s),c).setHasLocalMutations()}}(e,t,i):Zo(e.precondition,s=t)&&s.convertToNoDocument($.min())}function hf(e,t){for(var i=null,o=0,s=e.fieldTransforms;o<s.length;o++){var a=s[o],u=t.data.field(a.field),c=ec(a.transform,u||null);null!=c&&(null==i&&(i=ae.empty()),i.set(a.field,c))}return i||null}function sc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(o=t.fieldTransforms,!!(void 0===(i=e.fieldTransforms)&&void 0===o||i&&o&&Mr(i,o,function(s,a){return(u=s).field.isEqual((c=a).field)&&(d=c.transform,(l=u.transform)instanceof Zn&&d instanceof Zn||l instanceof Wn&&d instanceof Wn?Mr(l.elements,d.elements,ke):l instanceof Br&&d instanceof Br?ke(l.A,d.A):l instanceof jr&&d instanceof jr);var u,c,l,d})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var i,o}function ac(e){return e.isFoundDocument()?e.version:$.min()}var Ki=function(e){function t(i,o,s,a){void 0===a&&(a=[]);var u=this;return(u=e.call(this)||this).key=i,u.value=o,u.precondition=s,u.fieldTransforms=a,u.type=0,u}return(0,m.ZT)(t,e),t}(Wo),pn=function(e){function t(i,o,s,a,u){void 0===u&&(u=[]);var c=this;return(c=e.call(this)||this).key=i,c.data=o,c.fieldMask=s,c.precondition=a,c.fieldTransforms=u,c.type=1,c}return(0,m.ZT)(t,e),t}(Wo);function uc(e){var t=new Map;return e.fieldMask.fields.forEach(function(i){if(!i.isEmpty()){var o=e.data.field(i);t.set(i,o)}}),t}function cc(e,t,i){var o=new Map;Y(e.length===i.length);for(var s=0;s<i.length;s++){var a=e[s],u=a.transform,c=t.data.field(a.field);o.set(a.field,uf(u,c,i[s]))}return o}function lc(e,t,i){for(var o=new Map,s=0,a=e;s<a.length;s++){var u=a[s],c=u.transform,l=i.data.field(u.field);o.set(u.field,af(c,l,t))}return o}var St,nt,Hi=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=2,s.fieldTransforms=[],s}return(0,m.ZT)(t,e),t}(Wo),ea=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=3,s.fieldTransforms=[],s}return(0,m.ZT)(t,e),t}(Wo),ff=function(e){this.count=e};function hc(e){switch(e){case x.OK:return z();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return z()}}function fc(e){if(void 0===e)return Et("GRPC error has no .code"),x.UNKNOWN;switch(e){case St.OK:return x.OK;case St.CANCELLED:return x.CANCELLED;case St.UNKNOWN:return x.UNKNOWN;case St.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case St.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case St.INTERNAL:return x.INTERNAL;case St.UNAVAILABLE:return x.UNAVAILABLE;case St.UNAUTHENTICATED:return x.UNAUTHENTICATED;case St.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case St.NOT_FOUND:return x.NOT_FOUND;case St.ALREADY_EXISTS:return x.ALREADY_EXISTS;case St.PERMISSION_DENIED:return x.PERMISSION_DENIED;case St.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case St.ABORTED:return x.ABORTED;case St.OUT_OF_RANGE:return x.OUT_OF_RANGE;case St.UNIMPLEMENTED:return x.UNIMPLEMENTED;case St.DATA_LOSS:return x.DATA_LOSS;default:return z()}}(nt=St||(St={}))[nt.OK=0]="OK",nt[nt.CANCELLED=1]="CANCELLED",nt[nt.UNKNOWN=2]="UNKNOWN",nt[nt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nt[nt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nt[nt.NOT_FOUND=5]="NOT_FOUND",nt[nt.ALREADY_EXISTS=6]="ALREADY_EXISTS",nt[nt.PERMISSION_DENIED=7]="PERMISSION_DENIED",nt[nt.UNAUTHENTICATED=16]="UNAUTHENTICATED",nt[nt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nt[nt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nt[nt.ABORTED=10]="ABORTED",nt[nt.OUT_OF_RANGE=11]="OUT_OF_RANGE",nt[nt.UNIMPLEMENTED=12]="UNIMPLEMENTED",nt[nt.INTERNAL=13]="INTERNAL",nt[nt.UNAVAILABLE=14]="UNAVAILABLE",nt[nt.DATA_LOSS=15]="DATA_LOSS";var Kt=function(){function e(t,i){this.comparator=t,this.root=i||mn.EMPTY}return e.prototype.insert=function(t,i){return new e(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,mn.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,mn.BLACK,null,null))},e.prototype.get=function(t){for(var i=this.root;!i.isEmpty();){var o=this.comparator(t,i.key);if(0===o)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null},e.prototype.indexOf=function(t){for(var i=0,o=this.root;!o.isEmpty();){var s=this.comparator(t,o.key);if(0===s)return i+o.left.size;s<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(i,o){return t(i,o),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(i,o){return t.push(i+":"+o),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new Xo(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new Xo(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!0)},e}(),Xo=function(){function e(t,i,o,s){this.isReverse=s,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=i?o(t.key,i):1,s&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),mn=function(){function e(t,i,o,s,a){this.key=t,this.value=i,this.color=null!=o?o:e.RED,this.left=null!=s?s:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,i,o,s,a){return new e(null!=t?t:this.key,null!=i?i:this.value,null!=o?o:this.color,null!=s?s:this.left,null!=a?a:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,i,o){var s=this,a=o(t,s.key);return(s=a<0?s.copy(null,null,null,s.left.insert(t,i,o),null):0===a?s.copy(null,i,null,null,null):s.copy(null,null,null,null,s.right.insert(t,i,o))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,i){var o,s=this;if(i(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===i(t,s.key)){if(s.right.isEmpty())return e.EMPTY;o=s.right.min(),s=s.copy(o.key,o.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();var t=this.left.check();if(t!==this.right.check())throw z();return t+(this.isRed()?0:1)},e}();mn.EMPTY=null,mn.RED=!0,mn.BLACK=!1,mn.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw z()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw z()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw z()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw z()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw z()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,i,o,s,a){return this},e.prototype.insert=function(t,i,o){return new mn(t,i)},e.prototype.remove=function(t,i){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());var kt=function(){function e(t){this.comparator=t,this.data=new Kt(this.comparator)}return e.prototype.has=function(t){return null!==this.data.get(t)},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.forEachInRange=function(t,i){for(var o=this.data.getIteratorFrom(t[0]);o.hasNext();){var s=o.getNext();if(this.comparator(s.key,t[1])>=0)return;i(s.key)}},e.prototype.forEachWhile=function(t,i){var o;for(o=void 0!==i?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!t(o.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null},e.prototype.getIterator=function(){return new dc(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new dc(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var i=this;return i.size<t.size&&(i=t,t=this),t.forEach(function(o){i=i.add(o)}),i},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.data.getIterator(),o=t.data.getIterator();i.hasNext();){var s=i.getNext().key,a=o.getNext().key;if(0!==this.comparator(s,a))return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(i){t.push(i)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(i){return t.push(i)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var i=new e(this.comparator);return i.data=t,i},e}(),dc=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),df=new Kt(K.comparator);function ve(){return df}var pf=new Kt(K.comparator);function na(){return pf}var mf=new Kt(K.comparator);function pc(){return mf}var gf=new kt(K.comparator);function st(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=gf,o=0,s=e;o<s.length;o++){var a=s[o];i=i.add(a)}return i}var vf=new kt(et);function Yo(){return vf}var ra=function(){function e(t,i,o,s,a){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=s,this.resolvedLimboDocuments=a}return e.createSynthesizedRemoteEventForCurrentChange=function(t,i){var o=new Map;return o.set(t,ia.createSynthesizedTargetChangeForCurrentChange(t,i)),new e($.min(),o,Yo(),ve(),st())},e}(),ia=function(){function e(t,i,o,s,a){this.resumeToken=t,this.current=i,this.addedDocuments=o,this.modifiedDocuments=s,this.removedDocuments=a}return e.createSynthesizedTargetChangeForCurrentChange=function(t,i){return new e(Qt.EMPTY_BYTE_STRING,i,st(),st(),st())},e}(),$o=function(e,t,i,o){this.v=e,this.removedTargetIds=t,this.key=i,this.P=o},mc=function(e,t){this.targetId=e,this.V=t},gc=function(e,t,i,o){void 0===i&&(i=Qt.EMPTY_BYTE_STRING),void 0===o&&(o=null),this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o},vc=function(){function e(){this.S=0,this.D=bc(),this.C=Qt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=st(),i=st(),o=st();return this.D.forEach(function(s,a){switch(a){case 0:t=t.add(s);break;case 2:i=i.add(s);break;case 1:o=o.add(s);break;default:z()}}),new ia(this.C,this.N,t,i,o)},e.prototype.L=function(){this.k=!1,this.D=bc()},e.prototype.B=function(t,i){this.k=!0,this.D=this.D.insert(t,i)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),yf=function(){function e(t){this.W=t,this.G=new Map,this.H=ve(),this.J=yc(),this.Y=new kt(et)}return e.prototype.X=function(t){for(var i=0,o=t.v;i<o.length;i++){var s=o[i];t.P&&t.P.isFoundDocument()?this.Z(s,t.P):this.tt(s,t.key,t.P)}for(var a=0,u=t.removedTargetIds;a<u.length;a++)this.tt(s=u[a],t.key,t.P)},e.prototype.et=function(t){var i=this;this.forEachTarget(t,function(o){var s=i.nt(o);switch(t.state){case 0:i.st(o)&&s.O(t.resumeToken);break;case 1:s.K(),s.F||s.L(),s.O(t.resumeToken);break;case 2:s.K(),s.F||i.removeTarget(o);break;case 3:i.st(o)&&(s.j(),s.O(t.resumeToken));break;case 4:i.st(o)&&(i.it(o),s.O(t.resumeToken));break;default:z()}})},e.prototype.forEachTarget=function(t,i){var o=this;t.targetIds.length>0?t.targetIds.forEach(i):this.G.forEach(function(s,a){o.st(a)&&i(a)})},e.prototype.rt=function(t){var i=t.targetId,o=t.V.count,s=this.ot(i);if(s){var a=s.target;if(zo(a))if(0===o){var u=new K(a.path);this.tt(i,u,qt.newNoDocument(u,$.min()))}else Y(1===o);else this.ct(i)!==o&&(this.it(i),this.Y=this.Y.add(i))}},e.prototype.ut=function(t){var i=this,o=new Map;this.G.forEach(function(u,c){var l=i.ot(c);if(l){if(u.current&&zo(l.target)){var d=new K(l.target.path);null!==i.H.get(d)||i.at(c,d)||i.tt(c,d,qt.newNoDocument(d,t))}u.$&&(o.set(c,u.M()),u.L())}});var s=st();this.J.forEach(function(u,c){var l=!0;c.forEachWhile(function(d){var p=i.ot(d);return!p||2===p.purpose||(l=!1,!1)}),l&&(s=s.add(u))});var a=new ra(t,o,this.Y,this.H,s);return this.H=ve(),this.J=yc(),this.Y=new kt(et),a},e.prototype.Z=function(t,i){if(this.st(t)){var o=this.at(t,i.key)?2:0;this.nt(t).B(i.key,o),this.H=this.H.insert(i.key,i),this.J=this.J.insert(i.key,this.ht(i.key).add(t))}},e.prototype.tt=function(t,i,o){if(this.st(t)){var s=this.nt(t);this.at(t,i)?s.B(i,1):s.q(i),this.J=this.J.insert(i,this.ht(i).delete(t)),o&&(this.H=this.H.insert(i,o))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var i=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var i=this.G.get(t);return i||(i=new vc,this.G.set(t,i)),i},e.prototype.ht=function(t){var i=this.J.get(t);return i||(i=new kt(et),this.J=this.J.insert(t,i)),i},e.prototype.st=function(t){var i=null!==this.ot(t);return i||U("WatchChangeAggregator","Detected inactive target",t),i},e.prototype.ot=function(t){var i=this.G.get(t);return i&&i.F?null:this.W.lt(t)},e.prototype.it=function(t){var i=this;this.G.set(t,new vc),this.W.getRemoteKeysForTarget(t).forEach(function(o){i.tt(t,o,null)})},e.prototype.at=function(t,i){return this.W.getRemoteKeysForTarget(t).has(i)},e}();function yc(){return new Kt(K.comparator)}function bc(){return new Kt(K.comparator)}var bf={asc:"ASCENDING",desc:"DESCENDING"},_f={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wf=function(e,t){this.databaseId=e,this.I=t};function Ji(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function _c(e,t){return e.I?t.toBase64():t.toUint8Array()}function Tf(e,t){return Ji(e,t.toTimestamp())}function Mt(e){return Y(!!e),$.fromTimestamp((i=dn(e),new te(i.seconds,i.nanos)));var i}function oa(e,t){return(i=e,new it(["projects",i.projectId,"databases",i.database])).child("documents").child(t).canonicalString();var i}function wc(e){var t=it.fromString(e);return Y(Nc(t)),t}function Qi(e,t){return oa(e.databaseId,t.path)}function Re(e,t){var i=wc(t);if(i.get(1)!==e.databaseId.projectId)throw new N(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+e.databaseId.projectId);if(i.get(3)!==e.databaseId.database)throw new N(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+e.databaseId.database);return new K(Ic(i))}function sa(e,t){return oa(e.databaseId,t)}function Tc(e){var t=wc(e);return 4===t.length?it.emptyPath():Ic(t)}function Zi(e){return new it(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ic(e){return Y(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ec(e,t,i){return{name:Qi(e,t),fields:i.value.mapValue.fields}}function Cc(e,t,i){var o=Re(e,t.name),s=Mt(t.updateTime),a=new ae({mapValue:{fields:t.fields}}),u=qt.newFoundDocument(o,s,a);return i&&u.setHasCommittedMutations(),i?u.setHasCommittedMutations():u}function ts(e,t){var i,s;if(t instanceof Ki)i={update:Ec(e,t.key,t.value)};else if(t instanceof Hi)i={delete:Qi(e,t.key)};else if(t instanceof pn)i={update:Ec(e,t.key,t.data),updateMask:Af(t.fieldMask)};else{if(!(t instanceof ea))return z();i={verify:Qi(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(function(o){return function(s,a){var u=a.transform;if(u instanceof jr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Zn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Wn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Br)return{fieldPath:a.field.canonicalString(),increment:u.A};throw z()}(0,o)})),t.precondition.isNone||(i.currentDocument=void 0!==(s=t.precondition).updateTime?{updateTime:Tf(e,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:z()),i}function Sc(e,t){var d,i=t.currentDocument?void 0!==(d=t.currentDocument).updateTime?zt.updateTime(Mt(d.updateTime)):void 0!==d.exists?zt.exists(d.exists):zt.none():zt.none(),o=t.updateTransforms?t.updateTransforms.map(function(d){return function(p,y){var w=null;"setToServerValue"in y?(Y("REQUEST_TIME"===y.setToServerValue),w=new jr):"appendMissingElements"in y?w=new Zn(y.appendMissingElements.values||[]):"removeAllFromArray"in y?w=new Wn(y.removeAllFromArray.values||[]):"increment"in y?w=new Br(p,y.increment):z();var R=Te.fromServerFormat(y.fieldPath);return new zi(R,w)}(e,d)}):[];if(t.update){var s=Re(e,t.update.name),a=new ae({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(d){return new Or((d.fieldPaths||[]).map(function(y){return Te.fromServerFormat(y)}))}(t.updateMask);return new pn(s,a,u,i,o)}return new Ki(s,a,i,o)}if(t.delete){var c=Re(e,t.delete);return new Hi(c,i)}if(t.verify){var l=Re(e,t.verify);return new ea(l,i)}return z()}function Ac(e,t){return{documents:[sa(e,t.path)]}}function xc(e,t){var i={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(i.parent=sa(e,o),i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i.parent=sa(e,o.popLast()),i.structuredQuery.from=[{collectionId:o.lastSegment()}]);var s=function(c){if(0!==c.length){var l=c.map(function(d){return function(p){if("=="===p.op){if(Bu(p.value))return{unaryFilter:{field:Gr(p.field),op:"IS_NAN"}};if(ju(p.value))return{unaryFilter:{field:Gr(p.field),op:"IS_NULL"}}}else if("!="===p.op){if(Bu(p.value))return{unaryFilter:{field:Gr(p.field),op:"IS_NOT_NAN"}};if(ju(p.value))return{unaryFilter:{field:Gr(p.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gr(p.field),op:Ef(p.op),value:p.value}}}(d)});return 1===l.length?l[0]:{compositeFilter:{op:"AND",filters:l}}}}(t.filters);s&&(i.structuredQuery.where=s);var a=function(c){if(0!==c.length)return c.map(function(l){return{field:Gr((d=l).field),direction:If(d.dir)};var d})}(t.orderBy);a&&(i.structuredQuery.orderBy=a);var l,u=(l=t.limit,e.I||Jn(l)?l:{value:l});return null!==u&&(i.structuredQuery.limit=u),t.startAt&&(i.structuredQuery.startAt=Dc(t.startAt)),t.endAt&&(i.structuredQuery.endAt=Dc(t.endAt)),i}function kc(e){var t=Tc(e.parent),i=e.structuredQuery,o=i.from?i.from.length:0,s=null;if(o>0){Y(1===o);var a=i.from[0];a.allDescendants?s=a.collectionId:t=t.child(a.collectionId)}var u=[];i.where&&(u=Rc(i.where));var c=[];i.orderBy&&(c=i.orderBy.map(function(y){return new Ur(zr((w=y).field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction));var w}));var y,w,l=null;i.limit&&(l=Jn(w="object"==typeof(y=i.limit)?y.value:y)?null:w);var d=null;i.startAt&&(d=Pc(i.startAt));var p=null;return i.endAt&&(p=Pc(i.endAt)),Qu(t,s,c,u,l,"F",d,p)}function Rc(e){return e?void 0!==e.unaryFilter?[Sf(e)]:void 0!==e.fieldFilter?[Cf(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(t){return Rc(t)}).reduce(function(t,i){return t.concat(i)}):z():[]}function Dc(e){return{before:e.before,values:e.position}}function Pc(e){return new ji(e.values||[],!!e.before)}function If(e){return bf[e]}function Ef(e){return _f[e]}function Gr(e){return{fieldPath:e.canonicalString()}}function zr(e){return Te.fromServerFormat(e.fieldPath)}function Cf(e){return ue.create(zr(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(e.fieldFilter.op),e.fieldFilter.value)}function Sf(e){switch(e.unaryFilter.op){case"IS_NAN":var t=zr(e.unaryFilter.field);return ue.create(t,"==",{doubleValue:NaN});case"IS_NULL":var i=zr(e.unaryFilter.field);return ue.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var o=zr(e.unaryFilter.field);return ue.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var s=zr(e.unaryFilter.field);return ue.create(s,"!=",{nullValue:"NULL_VALUE"});default:return z()}}function Af(e){var t=[];return e.fields.forEach(function(i){return t.push(i.canonicalString())}),{fieldPaths:t}}function Nc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ie(e){for(var t="",i=0;i<e.length;i++)t.length>0&&(t=Mc(t)),t=xf(e.get(i),t);return Mc(t)}function xf(e,t){for(var i=t,o=e.length,s=0;s<o;s++){var a=e.charAt(s);switch(a){case"\0":i+="\x01\x10";break;case"\x01":i+="\x01\x11";break;default:i+=a}}return i}function Mc(e){return e+"\x01\x01"}function ze(e){var t=e.length;if(Y(t>=2),2===t)return Y("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),it.emptyPath();for(var i=t-2,o=[],s="",a=0;a<t;){var u=e.indexOf("\x01",a);switch((u<0||u>i)&&z(),e.charAt(u+1)){case"\x01":var c=e.substring(a,u),l=void 0;0===s.length?l=c:(l=s+=c,s=""),o.push(l);break;case"\x10":s+=e.substring(a,u),s+="\0";break;case"\x11":s+=e.substring(a,u+1);break;default:z()}a=u+2}return new it(o)}var kf=function(e,t){this.seconds=e,this.nanoseconds=t},ce=function(e,t,i){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=i};ce.store="owner",ce.key="owner";var gn=function(e,t,i){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=i};gn.store="mutationQueues",gn.keyPath="userId";var lt=function(e,t,i,o,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=i,this.baseMutations=o,this.mutations=s};lt.store="mutations",lt.keyPath="batchId",lt.userMutationsIndex="userMutationsIndex",lt.userMutationsKeyPath=["userId","batchId"];var Ht=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,i){return[t,Ie(i)]},e.key=function(t,i,o){return[t,Ie(i),o]},e}();Ht.store="documentMutations",Ht.PLACEHOLDER=new Ht;var Rf=function(e,t){this.path=e,this.readTime=t},Df=function(e,t){this.path=e,this.version=t},gt=function(e,t,i,o,s,a){this.unknownDocument=e,this.noDocument=t,this.document=i,this.hasCommittedMutations=o,this.readTime=s,this.parentPath=a};gt.store="remoteDocuments",gt.readTimeIndex="readTimeIndex",gt.readTimeIndexPath="readTime",gt.collectionReadTimeIndex="collectionReadTimeIndex",gt.collectionReadTimeIndexPath=["parentPath","readTime"];var De=function(e){this.byteSize=e};De.store="remoteDocumentGlobal",De.key="remoteDocumentGlobalKey";var ee=function(e,t,i,o,s,a,u){this.targetId=e,this.canonicalId=t,this.readTime=i,this.resumeToken=o,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=a,this.query=u};ee.store="targets",ee.keyPath="targetId",ee.queryTargetsIndexName="queryTargetsIndex",ee.queryTargetsKeyPath=["canonicalId","targetId"];var Vt=function(e,t,i){this.targetId=e,this.path=t,this.sequenceNumber=i};Vt.store="targetDocuments",Vt.keyPath=["targetId","path"],Vt.documentTargetsIndex="documentTargetsIndex",Vt.documentTargetsKeyPath=["path","targetId"];var le=function(e,t,i,o){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=i,this.targetCount=o};le.key="targetGlobalKey",le.store="targetGlobal";var Xn=function(e,t){this.collectionId=e,this.parent=t};Xn.store="collectionParents",Xn.keyPath=["collectionId","parent"];var Ke=function(e,t,i,o){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=i,this.inForeground=o};Ke.store="clientMetadata",Ke.keyPath="clientId";var Kr=function(e,t,i){this.bundleId=e,this.createTime=t,this.version=i};Kr.store="bundles",Kr.keyPath="bundleId";var Hr=function(e,t,i){this.name=e,this.readTime=t,this.bundledQuery=i};Hr.store="namedQueries",Hr.keyPath="name";var Pf=(0,m.ev)((0,m.ev)([],(0,m.ev)((0,m.ev)([],(0,m.ev)((0,m.ev)([],(0,m.ev)((0,m.ev)([],[gn.store,lt.store,Ht.store,gt.store,ee.store,ce.store,le.store,Vt.store]),[Ke.store])),[De.store])),[Xn.store])),[Kr.store,Hr.store]),Oc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lc=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),Jt=function(){var e=this;this.promise=new Promise(function(t,i){e.resolve=t,e.reject=i})},O=function(){function e(t){var i=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(o){i.isDone=!0,i.result=o,i.nextCallback&&i.nextCallback(o)},function(o){i.isDone=!0,i.error=o,i.catchCallback&&i.catchCallback(o)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,i){var o=this;return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new e(function(s,a){o.nextCallback=function(u){o.wrapSuccess(t,u).next(s,a)},o.catchCallback=function(u){o.wrapFailure(i,u).next(s,a)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(i,o){t.next(i,o)})},e.prototype.wrapUserFunction=function(t){try{var i=t();return i instanceof e?i:e.resolve(i)}catch(o){return e.reject(o)}},e.prototype.wrapSuccess=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.resolve(i)},e.prototype.wrapFailure=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.reject(i)},e.resolve=function(t){return new e(function(i,o){i(t)})},e.reject=function(t){return new e(function(i,o){o(t)})},e.waitFor=function(t){return new e(function(i,o){var s=0,a=0,u=!1;t.forEach(function(c){++s,c.next(function(){++a,u&&a===s&&i()},function(l){return o(l)})}),u=!0,a===s&&i()})},e.or=function(t){for(var i=e.resolve(!1),o=function(u){i=i.next(function(c){return c?e.resolve(c):u()})},s=0,a=t;s<a.length;s++)o(a[s]);return i},e.forEach=function(t,i){var o=this,s=[];return t.forEach(function(a,u){s.push(i.call(o,a,u))}),this.waitFor(s)},e}(),Fc=function(){function e(t,i){var o=this;this.action=t,this.transaction=i,this.aborted=!1,this.ft=new Jt,this.transaction.oncomplete=function(){o.ft.resolve()},this.transaction.onabort=function(){i.error?o.ft.reject(new Wi(t,i.error)):o.ft.resolve()},this.transaction.onerror=function(s){var a=aa(s.target.error);o.ft.reject(new Wi(t,a))}}return e.open=function(t,i,o,s){try{return new e(i,t.transaction(s,o))}catch(a){throw new Wi(i,a)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(U("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var i=this.transaction.objectStore(t);return new Mf(i)},e}(),Jr=function(){function e(t,i,o){this.name=t,this.version=i,this.wt=o,12.2===e._t((0,v.z$)())&&Et("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return U("SimpleDb","Removing database:",t),$n(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if("undefined"==typeof indexedDB)return!1;if(e.gt())return!0;var t=(0,v.z$)(),i=e._t(t),o=0<i&&i<10,s=e.Et(t),a=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||o||a)},e.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},e.It=function(t,i){return t.store(i)},e._t=function(t){var i=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),o=i?i[1].split("_").slice(0,2).join("."):"-1";return Number(o)},e.Et=function(t){var i=t.match(/Android ([\d.]+)/i),o=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(o)},e.prototype.At=function(t){return(0,m.mG)(this,void 0,void 0,function(){var i,o=this;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return this.db?[3,2]:(U("SimpleDb","Opening database:",this.name),i=this,[4,new Promise(function(a,u){var c=indexedDB.open(o.name,o.version);c.onsuccess=function(l){a(l.target.result)},c.onblocked=function(){u(new Wi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},c.onerror=function(l){var d=l.target.error;u("VersionError"===d.name?new N(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Wi(t,d))},c.onupgradeneeded=function(l){U("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',l.oldVersion),o.wt.Rt(l.target.result,c.transaction,l.oldVersion,o.version).next(function(){U("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:i.db=s.sent(),s.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(a){return o.bt(a)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(i){return t(i)})},e.prototype.runTransaction=function(t,i,o,s){return(0,m.mG)(this,void 0,void 0,function(){var a,u,c,l,d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:a="readonly"===i,u=0,c=function(){var y,w,C,E,R;return(0,m.Jh)(this,function(L){switch(L.label){case 0:++u,L.label=1;case 1:return L.trys.push([1,4,,5]),[4,l.At(t)];case 2:return l.db=L.sent(),y=Fc.open(l.db,t,a?"readonly":"readwrite",o),w=s(y).catch(function(V){return y.abort(V),O.reject(V)}).toPromise(),C={},w.catch(function(){}),[4,y.dt];case 3:return[2,(C.value=(L.sent(),w),C)];case 4:return U("SimpleDb","Transaction failed with error:",(E=L.sent()).message,"Retrying:",R="FirebaseError"!==E.name&&u<3),l.close(),R?[3,5]:[2,{value:Promise.reject(E)}];case 5:return[2]}})},l=this,p.label=1;case 1:return[5,c()];case 2:if("object"==typeof(d=p.sent()))return[2,d.value];p.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Nf=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return $n(this.Pt.delete())},e}(),Wi=function(e){function t(i,o){var s=this;return(s=e.call(this,x.UNAVAILABLE,"IndexedDB transaction '"+i+"' failed: "+o)||this).name="IndexedDbTransactionError",s}return(0,m.ZT)(t,e),t}(N);function Yn(e){return"IndexedDbTransactionError"===e.name}var Mf=function(){function e(t){this.store=t}return e.prototype.put=function(t,i){var o;return void 0!==i?(U("SimpleDb","PUT",this.store.name,t,i),o=this.store.put(i,t)):(U("SimpleDb","PUT",this.store.name,"<auto-key>",t),o=this.store.put(t)),$n(o)},e.prototype.add=function(t){return U("SimpleDb","ADD",this.store.name,t,t),$n(this.store.add(t))},e.prototype.get=function(t){var i=this;return $n(this.store.get(t)).next(function(o){return void 0===o&&(o=null),U("SimpleDb","GET",i.store.name,t,o),o})},e.prototype.delete=function(t){return U("SimpleDb","DELETE",this.store.name,t),$n(this.store.delete(t))},e.prototype.count=function(){return U("SimpleDb","COUNT",this.store.name),$n(this.store.count())},e.prototype.Nt=function(t,i){var o=this.cursor(this.options(t,i)),s=[];return this.xt(o,function(a,u){s.push(u)}).next(function(){return s})},e.prototype.kt=function(t,i){U("SimpleDb","DELETE ALL",this.store.name);var o=this.options(t,i);o.Ft=!1;var s=this.cursor(o);return this.xt(s,function(a,u,c){return c.delete()})},e.prototype.$t=function(t,i){var o;i?o=t:(o={},i=t);var s=this.cursor(o);return this.xt(s,i)},e.prototype.Ot=function(t){var i=this.cursor({});return new O(function(o,s){i.onerror=function(a){var u=aa(a.target.error);s(u)},i.onsuccess=function(a){var u=a.target.result;u?t(u.primaryKey,u.value).next(function(c){c?u.continue():o()}):o()}})},e.prototype.xt=function(t,i){var o=[];return new O(function(s,a){t.onerror=function(u){a(u.target.error)},t.onsuccess=function(u){var c=u.target.result;if(c){var l=new Nf(c),d=i(c.primaryKey,c.value,l);if(d instanceof O){var p=d.catch(function(y){return l.done(),O.reject(y)});o.push(p)}l.isDone?s():null===l.Dt?c.continue():c.continue(l.Dt)}else s()}}).next(function(){return O.waitFor(o)})},e.prototype.options=function(t,i){var o;return void 0!==t&&("string"==typeof t?o=t:i=t),{index:o,range:i}},e.prototype.cursor=function(t){var i="next";if(t.reverse&&(i="prev"),t.index){var o=this.store.index(t.index);return t.Ft?o.openKeyCursor(t.range,i):o.openCursor(t.range,i)}return this.store.openCursor(t.range,i)},e}();function $n(e){return new O(function(t,i){e.onsuccess=function(o){t(o.target.result)},e.onerror=function(o){var s=aa(o.target.error);i(s)}})}var Uc=!1;function aa(e){var t=Jr._t((0,v.z$)());if(t>=12.2&&t<13){var i="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(i)>=0){var o=new N("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+i+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Uc||(Uc=!0,setTimeout(function(){throw o},0)),o}}return e}var qc=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Mt=i,s.currentSequenceNumber=o,s}return(0,m.ZT)(t,e),t}(Lc);function ne(e,t){var i=j(e);return Jr.It(i.Mt,t)}var ua=function(){function e(t,i,o,s){this.batchId=t,this.localWriteTime=i,this.baseMutations=o,this.mutations=s}return e.prototype.applyToRemoteDocument=function(t,i){for(var o=i.mutationResults,s=0;s<this.mutations.length;s++){var a=this.mutations[s];a.key.isEqual(t.key)&&lf(a,t,o[s])}},e.prototype.applyToLocalView=function(t){for(var i=0,o=this.baseMutations;i<o.length;i++)(u=o[i]).key.isEqual(t.key)&&ta(u,t,this.localWriteTime);for(var s=0,a=this.mutations;s<a.length;s++){var u;(u=a[s]).key.isEqual(t.key)&&ta(u,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var i=this;this.mutations.forEach(function(o){var s=t.get(o.key),a=s;i.applyToLocalView(a),s.isValidDocument()||a.convertToNoDocument($.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,i){return t.add(i.key)},st())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&Mr(this.mutations,t.mutations,function(i,o){return sc(i,o)})&&Mr(this.baseMutations,t.baseMutations,function(i,o){return sc(i,o)})},e}(),Of=function(){function e(t,i,o,s){this.batch=t,this.commitVersion=i,this.mutationResults=o,this.docVersions=s}return e.from=function(t,i,o){Y(t.mutations.length===o.length);for(var s=pc(),a=t.mutations,u=0;u<a.length;u++)s=s.insert(a[u].key,o[u].version);return new e(t,i,o,s)},e}(),es=function(){function e(t,i,o,s,a,u,c){void 0===a&&(a=$.min()),void 0===u&&(u=$.min()),void 0===c&&(c=Qt.EMPTY_BYTE_STRING),this.target=t,this.targetId=i,this.purpose=o,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=c}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,i){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),Vc=function(e){this.Lt=e};function ca(e,t){if(t.document)return Cc(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var i=K.fromSegments(t.noDocument.path),o=Zr(t.noDocument.readTime),s=qt.newNoDocument(i,o);return t.hasCommittedMutations?s.setHasCommittedMutations():s}if(t.unknownDocument){var a=K.fromSegments(t.unknownDocument.path);return o=Zr(t.unknownDocument.version),qt.newUnknownDocument(a,o)}return z()}function jc(e,t,i){var y,w,o=la(i),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a={name:Qi(y=e.Lt,(w=t).key),fields:w.data.value.mapValue.fields,updateTime:Ji(y,w.version.toTimestamp())},u=t.hasCommittedMutations;return new gt(null,null,a,u,o,s)}if(t.isNoDocument()){var c=t.key.path.toArray(),l=Qr(t.version);return u=t.hasCommittedMutations,new gt(null,new Rf(c,l),null,u,o,s)}if(t.isUnknownDocument()){var d=t.key.path.toArray(),p=Qr(t.version);return new gt(new Df(d,p),null,null,!0,o,s)}return z()}function la(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Bc(e){var t=new te(e[0],e[1]);return $.fromTimestamp(t)}function Qr(e){var t=e.toTimestamp();return new kf(t.seconds,t.nanoseconds)}function Zr(e){var t=new te(e.seconds,e.nanoseconds);return $.fromTimestamp(t)}function Wr(e,t){for(var i=(t.baseMutations||[]).map(function(l){return Sc(e.Lt,l)}),o=0;o<t.mutations.length-1;++o)o+1<t.mutations.length&&void 0!==t.mutations[o+1].transform&&(t.mutations[o].updateTransforms=t.mutations[o+1].transform.fieldTransforms,t.mutations.splice(o+1,1),++o);var u=t.mutations.map(function(l){return Sc(e.Lt,l)}),c=te.fromMillis(t.localWriteTimeMs);return new ua(t.batchId,c,i,u)}function Xi(e){var t,i,o=Zr(e.readTime),s=void 0!==e.lastLimboFreeSnapshotVersion?Zr(e.lastLimboFreeSnapshotVersion):$.min();return void 0!==e.query.documents?(Y(1===(i=e.query).documents.length),t=ge(qr(Tc(i.documents[0])))):t=ge(kc(e.query)),new es(t,e.targetId,0,e.lastListenSequenceNumber,o,s,Qt.fromBase64String(e.resumeToken))}function Gc(e,t){var i,o=Qr(t.snapshotVersion),s=Qr(t.lastLimboFreeSnapshotVersion);i=zo(t.target)?Ac(e.Lt,t.target):xc(e.Lt,t.target);var a=t.resumeToken.toBase64();return new ee(t.targetId,Vi(t.target),o,a,t.sequenceNumber,s,i)}function ha(e){var t=kc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Zu(t,t.limit,"L"):t}var Lf=function(){function e(){}return e.prototype.getBundleMetadata=function(t,i){return zc(t).get(i).next(function(o){if(o)return{id:(s=o).bundleId,createTime:Zr(s.createTime),version:s.version};var s})},e.prototype.saveBundleMetadata=function(t,i){return zc(t).put({bundleId:(o=i).id,createTime:Qr(Mt(o.createTime)),version:o.version});var o},e.prototype.getNamedQuery=function(t,i){return Kc(t).get(i).next(function(o){if(o)return{name:(s=o).name,query:ha(s.bundledQuery),readTime:Zr(s.readTime)};var s})},e.prototype.saveNamedQuery=function(t,i){return Kc(t).put({name:(o=i).name,readTime:Qr(Mt(o.readTime)),bundledQuery:o.bundledQuery});var o},e}();function zc(e){return ne(e,Kr.store)}function Kc(e){return ne(e,Hr.store)}var Ff=function(){function e(){this.Bt=new fa}return e.prototype.addToCollectionParentIndex=function(t,i){return this.Bt.add(i),O.resolve()},e.prototype.getCollectionParents=function(t,i){return O.resolve(this.Bt.getEntries(i))},e}(),fa=function(){function e(){this.index={}}return e.prototype.add=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i]||new kt(it.comparator),a=!s.has(o);return this.index[i]=s.add(o),a},e.prototype.has=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i];return s&&s.has(o)},e.prototype.getEntries=function(t){return(this.index[t]||new kt(it.comparator)).toArray()},e}(),Uf=function(){function e(){this.qt=new fa}return e.prototype.addToCollectionParentIndex=function(t,i){var o=this;if(!this.qt.has(i)){var s=i.lastSegment(),a=i.popLast();t.addOnCommittedListener(function(){o.qt.add(i)});var u={collectionId:s,parent:Ie(a)};return Hc(t).put(u)}return O.resolve()},e.prototype.getCollectionParents=function(t,i){var o=[],s=IDBKeyRange.bound([i,""],[Mu(i),""],!1,!0);return Hc(t).Nt(s).next(function(a){for(var u=0,c=a;u<c.length;u++){var l=c[u];if(l.collectionId!==i)break;o.push(ze(l.parent))}return o})},e}();function Hc(e){return ne(e,Xn.store)}var Jc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pe=function(){function e(t,i,o){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();function Qc(e,t,i){var o=e.store(lt.store),s=e.store(Ht.store),a=[],u=IDBKeyRange.only(i.batchId),c=0,l=o.$t({range:u},function(E,R,L){return c++,L.delete()});a.push(l.next(function(){Y(1===c)}));for(var d=[],p=0,y=i.mutations;p<y.length;p++){var w=y[p],C=Ht.key(t,w.key.path,i.batchId);a.push(s.delete(C)),d.push(w.key)}return O.waitFor(a).next(function(){return d})}function ns(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw z();t=e.noDocument}return JSON.stringify(t).length}Pe.DEFAULT_COLLECTION_PERCENTILE=10,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pe.DEFAULT=new Pe(41943040,Pe.DEFAULT_COLLECTION_PERCENTILE,Pe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pe.DISABLED=new Pe(-1,0,0);var qf=function(){function e(t,i,o,s){this.userId=t,this.R=i,this.Ut=o,this.referenceDelegate=s,this.Kt={}}return e.Qt=function(t,i,o,s){return Y(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",i,o,s)},e.prototype.checkEmpty=function(t){var i=!0,o=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vn(t).$t({index:lt.userMutationsIndex,range:o},function(s,a,u){i=!1,u.done()}).next(function(){return i})},e.prototype.addMutationBatch=function(t,i,o,s){var a=this,u=Xr(t),c=vn(t);return c.add({}).next(function(l){Y("number"==typeof l);for(var d=new ua(l,i,o,s),p=function(V,H,J){var tt=J.baseMutations.map(function(at){return ts(V.Lt,at)}),rt=J.mutations.map(function(at){return ts(V.Lt,at)});return new lt(H,J.batchId,J.localWriteTime.toMillis(),tt,rt)}(a.R,a.userId,d),y=[],w=new kt(function(V,H){return et(V.canonicalString(),H.canonicalString())}),C=0,E=s;C<E.length;C++){var R=E[C],L=Ht.key(a.userId,R.key.path,l);w=w.add(R.key.path.popLast()),y.push(c.put(p)),y.push(u.put(L,Ht.PLACEHOLDER))}return w.forEach(function(V){y.push(a.Ut.addToCollectionParentIndex(t,V))}),t.addOnCommittedListener(function(){a.Kt[l]=d.keys()}),O.waitFor(y).next(function(){return d})})},e.prototype.lookupMutationBatch=function(t,i){var o=this;return vn(t).get(i).next(function(s){return s?(Y(s.userId===o.userId),Wr(o.R,s)):null})},e.prototype.jt=function(t,i){var o=this;return this.Kt[i]?O.resolve(this.Kt[i]):this.lookupMutationBatch(t,i).next(function(s){if(s){var a=s.keys();return o.Kt[i]=a,a}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var o=this,s=i+1,a=IDBKeyRange.lowerBound([this.userId,s]),u=null;return vn(t).$t({index:lt.userMutationsIndex,range:a},function(c,l,d){l.userId===o.userId&&(Y(l.batchId>=s),u=Wr(o.R,l)),d.done()}).next(function(){return u})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var i=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),o=-1;return vn(t).$t({index:lt.userMutationsIndex,range:i,reverse:!0},function(s,a,u){o=a.batchId,u.done()}).next(function(){return o})},e.prototype.getAllMutationBatches=function(t){var i=this,o=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vn(t).Nt(lt.userMutationsIndex,o).next(function(s){return s.map(function(a){return Wr(i.R,a)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=Ht.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(s),u=[];return Xr(t).$t({range:a},function(c,l,d){var p=c[0],w=c[2],C=ze(c[1]);if(p===o.userId&&i.path.isEqual(C))return vn(t).get(w).next(function(E){if(!E)throw z();Y(E.userId===o.userId),u.push(Wr(o.R,E))});d.done()}).next(function(){return u})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new kt(et),a=[];return i.forEach(function(u){var c=Ht.prefixForPath(o.userId,u.path),l=IDBKeyRange.lowerBound(c),d=Xr(t).$t({range:l},function(p,y,w){var C=p[0],R=p[2],L=ze(p[1]);C===o.userId&&u.path.isEqual(L)?s=s.add(R):w.done()});a.push(d)}),O.waitFor(a).next(function(){return o.Wt(t,s)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=this,s=i.path,a=s.length+1,u=Ht.prefixForPath(this.userId,s),c=IDBKeyRange.lowerBound(u),l=new kt(et);return Xr(t).$t({range:c},function(d,p,y){var w=d[0],E=d[2],R=ze(d[1]);w===o.userId&&s.isPrefixOf(R)?R.length===a&&(l=l.add(E)):y.done()}).next(function(){return o.Wt(t,l)})},e.prototype.Wt=function(t,i){var o=this,s=[],a=[];return i.forEach(function(u){a.push(vn(t).get(u).next(function(c){if(null===c)throw z();Y(c.userId===o.userId),s.push(Wr(o.R,c))}))}),O.waitFor(a).next(function(){return s})},e.prototype.removeMutationBatch=function(t,i){var o=this;return Qc(t.Mt,this.userId,i).next(function(s){return t.addOnCommittedListener(function(){o.Gt(i.batchId)}),O.forEach(s,function(a){return o.referenceDelegate.markPotentiallyOrphaned(t,a)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var i=this;return this.checkEmpty(t).next(function(o){if(!o)return O.resolve();var s=IDBKeyRange.lowerBound(Ht.prefixForUser(i.userId)),a=[];return Xr(t).$t({range:s},function(u,c,l){if(u[0]===i.userId){var d=ze(u[1]);a.push(d)}else l.done()}).next(function(){Y(0===a.length)})})},e.prototype.containsKey=function(t,i){return Zc(t,this.userId,i)},e.prototype.zt=function(t){var i=this;return Wc(t).get(this.userId).next(function(o){return o||new gn(i.userId,-1,"")})},e}();function Zc(e,t,i){var o=Ht.prefixForPath(t,i.path),s=o[1],a=IDBKeyRange.lowerBound(o),u=!1;return Xr(e).$t({range:a,Ft:!0},function(c,l,d){c[0]===t&&c[1]===s&&(u=!0),d.done()}).next(function(){return u})}function vn(e){return ne(e,lt.store)}function Xr(e){return ne(e,Ht.store)}function Wc(e){return ne(e,gn.store)}var rs=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),Vf=function(){function e(t,i){this.referenceDelegate=t,this.R=i}return e.prototype.allocateTargetId=function(t){var i=this;return this.Xt(t).next(function(o){var s=new rs(o.highestTargetId);return o.highestTargetId=s.next(),i.Zt(t,o).next(function(){return o.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(i){return $.fromTimestamp(new te(i.lastRemoteSnapshotVersion.seconds,i.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(i){return i.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,i,o){var s=this;return this.Xt(t).next(function(a){return a.highestListenSequenceNumber=i,o&&(a.lastRemoteSnapshotVersion=o.toTimestamp()),i>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=i),s.Zt(t,a)})},e.prototype.addTargetData=function(t,i){var o=this;return this.te(t,i).next(function(){return o.Xt(t).next(function(s){return s.targetCount+=1,o.ee(i,s),o.Zt(t,s)})})},e.prototype.updateTargetData=function(t,i){return this.te(t,i)},e.prototype.removeTargetData=function(t,i){var o=this;return this.removeMatchingKeysForTargetId(t,i.targetId).next(function(){return Yr(t).delete(i.targetId)}).next(function(){return o.Xt(t)}).next(function(s){return Y(s.targetCount>0),s.targetCount-=1,o.Zt(t,s)})},e.prototype.removeTargets=function(t,i,o){var s=this,a=0,u=[];return Yr(t).$t(function(c,l){var d=Xi(l);d.sequenceNumber<=i&&null===o.get(d.targetId)&&(a++,u.push(s.removeTargetData(t,d)))}).next(function(){return O.waitFor(u)}).next(function(){return a})},e.prototype.forEachTarget=function(t,i){return Yr(t).$t(function(o,s){var a=Xi(s);i(a)})},e.prototype.Xt=function(t){return Xc(t).get(le.key).next(function(i){return Y(null!==i),i})},e.prototype.Zt=function(t,i){return Xc(t).put(le.key,i)},e.prototype.te=function(t,i){return Yr(t).put(Gc(this.R,i))},e.prototype.ee=function(t,i){var o=!1;return t.targetId>i.highestTargetId&&(i.highestTargetId=t.targetId,o=!0),t.sequenceNumber>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t.sequenceNumber,o=!0),o},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(i){return i.targetCount})},e.prototype.getTargetData=function(t,i){var o=Vi(i),s=IDBKeyRange.bound([o,Number.NEGATIVE_INFINITY],[o,Number.POSITIVE_INFINITY]),a=null;return Yr(t).$t({range:s,index:ee.queryTargetsIndexName},function(u,c,l){var d=Xi(c);Go(i,d.target)&&(a=d,l.done())}).next(function(){return a})},e.prototype.addMatchingKeys=function(t,i,o){var s=this,a=[],u=yn(t);return i.forEach(function(c){var l=Ie(c.path);a.push(u.put(new Vt(o,l))),a.push(s.referenceDelegate.addReference(t,o,c))}),O.waitFor(a)},e.prototype.removeMatchingKeys=function(t,i,o){var s=this,a=yn(t);return O.forEach(i,function(u){var c=Ie(u.path);return O.waitFor([a.delete([o,c]),s.referenceDelegate.removeReference(t,o,u)])})},e.prototype.removeMatchingKeysForTargetId=function(t,i){var o=yn(t),s=IDBKeyRange.bound([i],[i+1],!1,!0);return o.delete(s)},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=IDBKeyRange.bound([i],[i+1],!1,!0),s=yn(t),a=st();return s.$t({range:o,Ft:!0},function(u,c,l){var d=ze(u[1]),p=new K(d);a=a.add(p)}).next(function(){return a})},e.prototype.containsKey=function(t,i){var o=Ie(i.path),s=IDBKeyRange.bound([o],[Mu(o)],!1,!0),a=0;return yn(t).$t({index:Vt.documentTargetsIndex,Ft:!0,range:s},function(u,c,l){0!==u[0]&&(a++,l.done())}).next(function(){return a>0})},e.prototype.lt=function(t,i){return Yr(t).get(i).next(function(o){return o?Xi(o):null})},e}();function Yr(e){return ne(e,ee.store)}function Xc(e){return ne(e,le.store)}function yn(e){return ne(e,Vt.store)}function tr(e){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){if(e.code!==x.FAILED_PRECONDITION||e.message!==Oc)throw e;return U("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Yc(e,t){var o=e[1],a=t[1],u=et(e[0],t[0]);return 0===u?et(o,a):u}var jf=function(){function e(t){this.ne=t,this.buffer=new kt(Yc),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var i=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(i);else{var o=this.buffer.last();Yc(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),Bf=function(){function e(t,i){this.garbageCollector=t,this.asyncQueue=i,this.oe=!1,this.ce=null}return e.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var i=this,o=this.oe?3e5:6e4;U("LruGarbageCollector","Garbage collection scheduled in "+o+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",o,function(){return(0,m.mG)(i,void 0,void 0,function(){var s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:this.ce=null,this.oe=!0,a.label=1;case 1:return a.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return a.sent(),[3,7];case 3:return Yn(s=a.sent())?(U("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s),[3,6]):[3,4];case 4:return[4,tr(s)];case 5:a.sent(),a.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return a.sent(),[2]}})})})},e}(),Gf=function(){function e(t,i){this.ae=t,this.params=i}return e.prototype.calculateTargetCount=function(t,i){return this.ae.he(t).next(function(o){return Math.floor(i/100*o)})},e.prototype.nthSequenceNumber=function(t,i){var o=this;if(0===i)return O.resolve(se.o);var s=new jf(i);return this.ae.forEachTarget(t,function(a){return s.re(a.sequenceNumber)}).next(function(){return o.ae.le(t,function(a){return s.re(a)})}).next(function(){return s.maxValue})},e.prototype.removeTargets=function(t,i,o){return this.ae.removeTargets(t,i,o)},e.prototype.removeOrphanedDocuments=function(t,i){return this.ae.removeOrphanedDocuments(t,i)},e.prototype.collect=function(t,i){var o=this;return-1===this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Jc)):this.getCacheSize(t).next(function(s){return s<o.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector","Garbage collection skipped; Cache size "+s+" is lower than threshold "+o.params.cacheSizeCollectionThreshold),Jc):o.fe(t,i)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,i){var o,s,a,u,c,l,d,p=this,y=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(w){return w>p.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+p.params.maximumSequenceNumbersToCollect+" from "+w),s=p.params.maximumSequenceNumbersToCollect):s=w,u=Date.now(),p.nthSequenceNumber(t,s)}).next(function(w){return o=w,c=Date.now(),p.removeTargets(t,o,i)}).next(function(w){return a=w,l=Date.now(),p.removeOrphanedDocuments(t,o)}).next(function(w){return d=Date.now(),Gs()<=Wt.in.DEBUG&&U("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(u-y)+"ms\n\tDetermined least recently used "+s+" in "+(c-u)+"ms\n\tRemoved "+a+" targets in "+(l-c)+"ms\n\tRemoved "+w+" documents in "+(d-l)+"ms\nTotal Duration: "+(d-y)+"ms"),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:a,documentsRemoved:w})})},e}(),zf=function(){function e(t,i){this.db=t,this.garbageCollector=new Gf(this,i)}return e.prototype.he=function(t){var i=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(o){return i.next(function(s){return o+s})})},e.prototype.de=function(t){var i=0;return this.le(t,function(o){i++}).next(function(){return i})},e.prototype.forEachTarget=function(t,i){return this.db.getTargetCache().forEachTarget(t,i)},e.prototype.le=function(t,i){return this.we(t,function(o,s){return i(s)})},e.prototype.addReference=function(t,i,o){return is(t,o)},e.prototype.removeReference=function(t,i,o){return is(t,o)},e.prototype.removeTargets=function(t,i,o){return this.db.getTargetCache().removeTargets(t,i,o)},e.prototype.markPotentiallyOrphaned=function(t,i){return is(t,i)},e.prototype._e=function(t,i){return s=i,a=!1,Wc(o=t).Ot(function(u){return Zc(o,u,s).next(function(c){return c&&(a=!0),O.resolve(!c)})}).next(function(){return a});var o,s,a},e.prototype.removeOrphanedDocuments=function(t,i){var o=this,s=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[],u=0;return this.we(t,function(c,l){if(l<=i){var d=o._e(t,c).next(function(p){if(!p)return u++,s.getEntry(t,c).next(function(){return s.removeEntry(c),yn(t).delete([0,Ie(c.path)])})});a.push(d)}}).next(function(){return O.waitFor(a)}).next(function(){return s.apply(t)}).next(function(){return u})},e.prototype.removeTarget=function(t,i){var o=i.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,o)},e.prototype.updateLimboDocument=function(t,i){return is(t,i)},e.prototype.we=function(t,i){var o,s=yn(t),a=se.o;return s.$t({index:Vt.documentTargetsIndex},function(u,c){var d=c.path,p=c.sequenceNumber;0===u[0]?(a!==se.o&&i(new K(ze(o)),a),a=p,o=d):a=se.o}).next(function(){a!==se.o&&i(new K(ze(o)),a)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function is(e,t){return yn(e).put((o=e.currentSequenceNumber,new Vt(0,Ie(t.path),o)));var o}var $r=function(){function e(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={}}return e.prototype.get=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0!==o)for(var s=0,a=o;s<a.length;s++){var u=a[s],l=u[1];if(this.equalsFn(u[0],t))return l}},e.prototype.has=function(t){return void 0!==this.get(t)},e.prototype.set=function(t,i){var o=this.mapKeyFn(t),s=this.inner[o];if(void 0!==s){for(var a=0;a<s.length;a++)if(this.equalsFn(s[a][0],t))return void(s[a]=[t,i]);s.push([t,i])}else this.inner[o]=[[t,i]]},e.prototype.delete=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0===o)return!1;for(var s=0;s<o.length;s++)if(this.equalsFn(o[s][0],t))return 1===o.length?delete this.inner[i]:o.splice(s,1),!0;return!1},e.prototype.forEach=function(t){Hn(this.inner,function(i,o){for(var s=0,a=o;s<a.length;s++){var u=a[s];t(u[0],u[1])}})},e.prototype.isEmpty=function(){return Lu(this.inner)},e}(),$c=function(){function e(){this.changes=new $r(function(t){return t.toString()},function(t,i){return t.isEqual(i)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var i=this.changes.get(t);return i?i.readTime:$.min()},e.prototype.addEntry=function(t,i){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:i})},e.prototype.removeEntry=function(t,i){void 0===i&&(i=null),this.assertNotApplied(),this.changes.set(t,{document:qt.newInvalidDocument(t),readTime:i})},e.prototype.getEntry=function(t,i){this.assertNotApplied();var o=this.changes.get(i);return void 0!==o?O.resolve(o.document):this.getFromCache(t,i)},e.prototype.getEntries=function(t,i){return this.getAllFromCache(t,i)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),Kf=function(){function e(t,i){this.R=t,this.Ut=i}return e.prototype.addEntry=function(t,i,o){return bn(t).put(os(i),o)},e.prototype.removeEntry=function(t,i){var o=bn(t),s=os(i);return o.delete(s)},e.prototype.updateMetadata=function(t,i){var o=this;return this.getMetadata(t).next(function(s){return s.byteSize+=i,o.me(t,s)})},e.prototype.getEntry=function(t,i){var o=this;return bn(t).get(os(i)).next(function(s){return o.ye(i,s)})},e.prototype.ge=function(t,i){var o=this;return bn(t).get(os(i)).next(function(s){return{document:o.ye(i,s),size:ns(s)}})},e.prototype.getEntries=function(t,i){var o=this,s=ve();return this.pe(t,i,function(a,u){var c=o.ye(a,u);s=s.insert(a,c)}).next(function(){return s})},e.prototype.Ee=function(t,i){var o=this,s=ve(),a=new Kt(K.comparator);return this.pe(t,i,function(u,c){var l=o.ye(u,c);s=s.insert(u,l),a=a.insert(u,ns(c))}).next(function(){return{documents:s,Te:a}})},e.prototype.pe=function(t,i,o){if(i.isEmpty())return O.resolve();var s=IDBKeyRange.bound(i.first().path.toArray(),i.last().path.toArray()),a=i.getIterator(),u=a.getNext();return bn(t).$t({range:s},function(c,l,d){for(var p=K.fromSegments(c);u&&K.comparator(u,p)<0;)o(u,null),u=a.getNext();u&&u.isEqual(p)&&(o(u,l),u=a.hasNext()?a.getNext():null),u?d.Ct(u.path.toArray()):d.done()}).next(function(){for(;u;)o(u,null),u=a.hasNext()?a.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){var s=this,a=ve(),u=i.path.length+1,c={};if(o.isEqual($.min())){var l=i.path.toArray();c.range=IDBKeyRange.lowerBound(l)}else{var d=i.path.toArray(),p=la(o);c.range=IDBKeyRange.lowerBound([d,p],!0),c.index=gt.collectionReadTimeIndex}return bn(t).$t(c,function(y,w,C){if(y.length===u){var E=ca(s.R,w);i.path.isPrefixOf(E.key.path)?Gi(i,E)&&(a=a.insert(E.key,E)):C.done()}}).next(function(){return a})},e.prototype.newChangeBuffer=function(t){return new Hf(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(i){return i.byteSize})},e.prototype.getMetadata=function(t){return tl(t).get(De.key).next(function(i){return Y(!!i),i})},e.prototype.me=function(t,i){return tl(t).put(De.key,i)},e.prototype.ye=function(t,i){if(i){var o=ca(this.R,i);if(!o.isNoDocument()||!o.version.isEqual($.min()))return o}return qt.newInvalidDocument(t)},e}(),Hf=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Ie=i,s.trackRemovals=o,s.Ae=new $r(function(a){return a.toString()},function(a,u){return a.isEqual(u)}),s}return(0,m.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new kt(function(c,l){return et(c.canonicalString(),l.canonicalString())});return this.changes.forEach(function(c,l){var d=o.Ae.get(c);if(l.document.isValidDocument()){var p=jc(o.Ie.R,l.document,o.getReadTime(c));u=u.add(c.path.popLast());var y=ns(p);a+=y-d,s.push(o.Ie.addEntry(i,c,p))}else if(a-=d,o.trackRemovals){var w=jc(o.Ie.R,qt.newNoDocument(c,$.min()),o.getReadTime(c));s.push(o.Ie.addEntry(i,c,w))}else s.push(o.Ie.removeEntry(i,c))}),u.forEach(function(c){s.push(o.Ie.Ut.addToCollectionParentIndex(i,c))}),s.push(this.Ie.updateMetadata(i,a)),O.waitFor(s)},t.prototype.getFromCache=function(i,o){var s=this;return this.Ie.ge(i,o).next(function(a){return s.Ae.set(o,a.size),a.document})},t.prototype.getAllFromCache=function(i,o){var s=this;return this.Ie.Ee(i,o).next(function(a){var u=a.documents;return a.Te.forEach(function(c,l){s.Ae.set(c,l)}),u})},t}($c);function tl(e){return ne(e,De.store)}function bn(e){return ne(e,gt.store)}function os(e){return e.path.toArray()}var Jf=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,i,o,s){var a=this;Y(o<s&&o>=0&&s<=11);var l,u=new Fc("createOrUpgrade",i);o<1&&s>=1&&(t.createObjectStore(ce.store),(l=t).createObjectStore(gn.store,{keyPath:gn.keyPath}),l.createObjectStore(lt.store,{keyPath:lt.keyPath,autoIncrement:!0}).createIndex(lt.userMutationsIndex,lt.userMutationsKeyPath,{unique:!0}),l.createObjectStore(Ht.store),el(t),function(l){l.createObjectStore(gt.store)}(t));var c=O.resolve();return o<3&&s>=3&&(0!==o&&(function(l){l.deleteObjectStore(Vt.store),l.deleteObjectStore(ee.store),l.deleteObjectStore(le.store)}(t),el(t)),c=c.next(function(){return function(l){var d=l.store(le.store),p=new le(0,0,$.min().toTimestamp(),0);return d.put(le.key,p)}(u)})),o<4&&s>=4&&(0!==o&&(c=c.next(function(){return function(l,d){return d.store(lt.store).Nt().next(function(p){l.deleteObjectStore(lt.store),l.createObjectStore(lt.store,{keyPath:lt.keyPath,autoIncrement:!0}).createIndex(lt.userMutationsIndex,lt.userMutationsKeyPath,{unique:!0});var y=d.store(lt.store),w=p.map(function(C){return y.put(C)});return O.waitFor(w)})}(t,u)})),c=c.next(function(){!function(l){l.createObjectStore(Ke.store,{keyPath:Ke.keyPath})}(t)})),o<5&&s>=5&&(c=c.next(function(){return a.Re(u)})),o<6&&s>=6&&(c=c.next(function(){return function(l){l.createObjectStore(De.store)}(t),a.be(u)})),o<7&&s>=7&&(c=c.next(function(){return a.ve(u)})),o<8&&s>=8&&(c=c.next(function(){return a.Pe(t,u)})),o<9&&s>=9&&(c=c.next(function(){(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t),function(l){var d=l.objectStore(gt.store);d.createIndex(gt.readTimeIndex,gt.readTimeIndexPath,{unique:!1}),d.createIndex(gt.collectionReadTimeIndex,gt.collectionReadTimeIndexPath,{unique:!1})}(i)})),o<10&&s>=10&&(c=c.next(function(){return a.Ve(u)})),o<11&&s>=11&&(c=c.next(function(){(function(l){l.createObjectStore(Kr.store,{keyPath:Kr.keyPath})})(t),function(l){l.createObjectStore(Hr.store,{keyPath:Hr.keyPath})}(t)})),c},e.prototype.be=function(t){var i=0;return t.store(gt.store).$t(function(o,s){i+=ns(s)}).next(function(){var o=new De(i);return t.store(De.store).put(De.key,o)})},e.prototype.Re=function(t){var i=this,o=t.store(gn.store),s=t.store(lt.store);return o.Nt().next(function(a){return O.forEach(a,function(u){var c=IDBKeyRange.bound([u.userId,-1],[u.userId,u.lastAcknowledgedBatchId]);return s.Nt(lt.userMutationsIndex,c).next(function(l){return O.forEach(l,function(d){Y(d.userId===u.userId);var p=Wr(i.R,d);return Qc(t,u.userId,p).next(function(){})})})})})},e.prototype.ve=function(t){var i=t.store(Vt.store),o=t.store(gt.store);return t.store(le.store).get(le.key).next(function(s){var a=[];return o.$t(function(u,c){var l=new it(u),d=[0,Ie(l)];a.push(i.get(d).next(function(p){return p?O.resolve():i.put(new Vt(0,Ie(l),s.highestListenSequenceNumber))}))}).next(function(){return O.waitFor(a)})})},e.prototype.Pe=function(t,i){t.createObjectStore(Xn.store,{keyPath:Xn.keyPath});var o=i.store(Xn.store),s=new fa,a=function(u){if(s.add(u)){var c=u.lastSegment(),l=u.popLast();return o.put({collectionId:c,parent:Ie(l)})}};return i.store(gt.store).$t({Ft:!0},function(u,c){var l=new it(u);return a(l.popLast())}).next(function(){return i.store(Ht.store).$t({Ft:!0},function(u,c){var d=ze(u[1]);return a(d.popLast())})})},e.prototype.Ve=function(t){var i=this,o=t.store(ee.store);return o.$t(function(s,a){var u=Xi(a),c=Gc(i.R,u);return o.put(c)})},e}();function el(e){e.createObjectStore(Vt.store,{keyPath:Vt.keyPath}).createIndex(Vt.documentTargetsIndex,Vt.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(ee.store,{keyPath:ee.keyPath}).createIndex(ee.queryTargetsIndexName,ee.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(le.store)}var da="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qf=function(){function e(t,i,o,s,a,u,c,l,d,p){if(this.allowTabSynchronization=t,this.persistenceKey=i,this.clientId=o,this.Se=a,this.window=u,this.document=c,this.De=d,this.Ce=p,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(y){return Promise.resolve()},!e.yt())throw new N(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zf(this,s),this.Le=i+"main",this.R=new Vc(l),this.Be=new Jr(this.Le,11,new Jf(this.R)),this.qe=new Vf(this.referenceDelegate,this.R),this.Ut=new Uf,this.Ue=new Kf(this.R,this.Ut),this.Ke=new Lf,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===p&&Et("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new N(x.FAILED_PRECONDITION,da);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(i){return t.qe.getHighestSequenceNumber(i)})}).then(function(i){t.Ne=new se(i,t.De)}).then(function(){t.xe=!0}).catch(function(i){return t.Be&&t.Be.close(),Promise.reject(i)})},e.prototype.He=function(t){var i=this;return this.Me=function(o){return(0,m.mG)(i,void 0,void 0,function(){return(0,m.Jh)(this,function(s){return this.started?[2,t(o)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var i=this;this.Be.vt(function(o){return(0,m.mG)(i,void 0,void 0,function(){return(0,m.Jh)(this,function(s){switch(s.label){case 0:return null===o.newVersion?[4,t()]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var i=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,m.mG)(i,void 0,void 0,function(){return(0,m.Jh)(this,function(o){switch(o.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(i){return ss(i).put(new Ke(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(i).next(function(o){o||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(i)}).next(function(o){return t.isPrimary&&!o?t.Xe(i).next(function(){return!1}):!!o&&t.Ze(i).next(function(){return!0})})}).catch(function(i){if(Yn(i))return U("IndexedDbPersistence","Failed to extend owner lease: ",i),t.isPrimary;if(!t.allowTabSynchronization)throw i;return U("IndexedDbPersistence","Releasing owner lease after error during lease refresh",i),!1}).then(function(i){t.isPrimary!==i&&t.Se.enqueueRetryable(function(){return t.Me(i)}),t.isPrimary=i})},e.prototype.Je=function(t){var i=this;return Yi(t).get(ce.key).next(function(o){return O.resolve(i.tn(o))})},e.prototype.en=function(t){return ss(t).delete(this.clientId)},e.prototype.nn=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o,a=this;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(c){var l=ne(c,Ke.store);return l.Nt().next(function(d){var p=a.rn(d,18e5),y=d.filter(function(w){return-1===p.indexOf(w)});return O.forEach(y,function(w){return l.delete(w.clientId)}).next(function(){return y})})}).catch(function(){return[]})]);case 1:if(t=u.sent(),this.Qe)for(i=0,o=t;i<o.length;i++)this.Qe.removeItem(this.on(o[i].clientId));u.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var i=this;return this.Ce?O.resolve(!0):Yi(t).get(ce.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)){if(i.tn(o)&&i.networkEnabled)return!0;if(!i.tn(o)){if(!o.allowTabSynchronization)throw new N(x.FAILED_PRECONDITION,da);return!1}}return!(!i.networkEnabled||!i.inForeground)||ss(t).Nt().next(function(s){return void 0===i.rn(s,5e3).find(function(a){return!(i.clientId===a.clientId||!(!i.networkEnabled&&a.networkEnabled||!i.inForeground&&a.inForeground&&i.networkEnabled===a.networkEnabled))})})}).next(function(o){return i.isPrimary!==o&&U("IndexedDbPersistence","Client "+(o?"is":"is not")+" eligible for a primary lease."),o})},e.prototype.shutdown=function(){return(0,m.mG)(this,void 0,void 0,function(){var t=this;return(0,m.Jh)(this,function(i){switch(i.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ce.store,Ke.store],function(o){var s=new qc(o,se.o);return t.Xe(s).next(function(){return t.en(s)})})];case 1:return i.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,i){var o=this;return t.filter(function(s){return o.sn(s.updateTimeMs,i)&&!o.cn(s.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(i){return ss(i).Nt().next(function(o){return t.rn(o,18e5).map(function(s){return s.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return qf.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var a,s=this;return U("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===i?"readonly":"readwrite",Pf,function(c){return a=new qc(c,s.Ne?s.Ne.next():se.o),"readwrite-primary"===i?s.Je(a).next(function(l){return!!l||s.Ye(a)}).next(function(l){if(!l)throw Et("Failed to obtain primary lease for action '"+t+"'."),s.isPrimary=!1,s.Se.enqueueRetryable(function(){return s.Me(!1)}),new N(x.FAILED_PRECONDITION,Oc);return o(a)}).next(function(l){return s.Ze(a).next(function(){return l})}):s.dn(a).next(function(){return o(a)})}).then(function(c){return a.raiseOnCommittedEvent(),c})},e.prototype.dn=function(t){var i=this;return Yi(t).get(ce.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)&&!i.tn(o)&&!(i.Ce||i.allowTabSynchronization&&o.allowTabSynchronization))throw new N(x.FAILED_PRECONDITION,da)})},e.prototype.Ze=function(t){var i=new ce(this.clientId,this.allowTabSynchronization,Date.now());return Yi(t).put(ce.key,i)},e.yt=function(){return Jr.yt()},e.prototype.Xe=function(t){var i=this,o=Yi(t);return o.get(ce.key).next(function(s){return i.tn(s)?(U("IndexedDbPersistence","Releasing primary lease."),o.delete(ce.key)):O.resolve()})},e.prototype.sn=function(t,i){var o=Date.now();return!(t<o-i||t>o&&(Et("Detected an update time that is in the future: "+t+" > "+o),1))},e.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,i=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){i.un(),(0,v.G6)()&&navigator.appVersion.match("Version/14")&&i.Se.enterRestrictedMode(!0),i.Se.enqueueAndForget(function(){return i.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var i;try{var o=null!==(null===(i=this.Qe)||void 0===i?void 0:i.getItem(this.on(t)));return U("IndexedDbPersistence","Client '"+t+"' "+(o?"is":"is not")+" zombied in LocalStorage"),o}catch(s){return Et("IndexedDbPersistence","Failed to get zombied client id.",s),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Et("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function Yi(e){return ne(e,ce.store)}function ss(e){return ne(e,Ke.store)}function pa(e,t){var i=e.projectId;return e.isDefaultDatabase||(i+="."+e.database),"firestore/"+t+"/"+i+"/"}var Zf=function(e,t){this.progress=e,this.wn=t},nl=function(){function e(t,i,o){this.Ue=t,this._n=i,this.Ut=o}return e.prototype.mn=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,i).next(function(s){return o.yn(t,i,s)})},e.prototype.yn=function(t,i,o){return this.Ue.getEntry(t,i).next(function(s){for(var a=0,u=o;a<u.length;a++)u[a].applyToLocalView(s);return s})},e.prototype.gn=function(t,i){t.forEach(function(o,s){for(var a=0,u=i;a<u.length;a++)u[a].applyToLocalView(s)})},e.prototype.pn=function(t,i){var o=this;return this.Ue.getEntries(t,i).next(function(s){return o.En(t,s).next(function(){return s})})},e.prototype.En=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,i).next(function(s){return o.gn(i,s)})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){return K.isDocumentKey((s=i).path)&&null===s.collectionGroup&&0===s.filters.length?this.Tn(t,i.path):Ys(i)?this.In(t,i,o):this.An(t,i,o);var s},e.prototype.Tn=function(t,i){return this.mn(t,new K(i)).next(function(o){var s=na();return o.isFoundDocument()&&(s=s.insert(o.key,o)),s})},e.prototype.In=function(t,i,o){var s=this,a=i.collectionGroup,u=na();return this.Ut.getCollectionParents(t,a).next(function(c){return O.forEach(c,function(l){var p,y,d=(p=i,y=l.child(a),new Ge(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));return s.An(t,d,o).next(function(p){p.forEach(function(y,w){u=u.insert(y,w)})})}).next(function(){return u})})},e.prototype.An=function(t,i,o){var s,a,u=this;return this.Ue.getDocumentsMatchingQuery(t,i,o).next(function(c){return s=c,u._n.getAllMutationBatchesAffectingQuery(t,i)}).next(function(c){return u.Rn(t,a=c,s).next(function(l){s=l;for(var d=0,p=a;d<p.length;d++)for(var y=p[d],w=0,C=y.mutations;w<C.length;w++){var E=C[w],R=E.key,L=s.get(R);null==L&&(L=qt.newInvalidDocument(R),s=s.insert(R,L)),ta(E,L,y.localWriteTime),L.isFoundDocument()||(s=s.remove(R))}})}).next(function(){return s.forEach(function(c,l){Gi(i,l)||(s=s.remove(c))}),s})},e.prototype.Rn=function(t,i,o){for(var s=st(),a=0,u=i;a<u.length;a++)for(var c=0,l=u[a].mutations;c<l.length;c++){var d=l[c];d instanceof pn&&null===o.get(d.key)&&(s=s.add(d.key))}var p=o;return this.Ue.getEntries(t,s).next(function(y){return y.forEach(function(w,C){C.isFoundDocument()&&(p=p.insert(w,C))}),p})},e}(),Wf=function(){function e(t,i,o,s){this.targetId=t,this.fromCache=i,this.bn=o,this.vn=s}return e.Pn=function(t,i){for(var o=st(),s=st(),a=0,u=i.docChanges;a<u.length;a++){var c=u[a];switch(c.type){case 0:o=o.add(c.doc.key);break;case 1:s=s.add(c.doc.key)}}return new e(t,i.fromCache,o,s)},e}(),rl=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,i,o,s){var u,a=this;return 0===(u=i).filters.length&&null===u.limit&&null==u.startAt&&null==u.endAt&&(0===u.explicitOrderBy.length||1===u.explicitOrderBy.length&&u.explicitOrderBy[0].field.isKeyField())||o.isEqual($.min())?this.Dn(t,i):this.Sn.pn(t,s).next(function(u){var c=a.Cn(i,u);return(Ho(i)||Jo(i))&&a.Nn(i.limitType,c,s,o)?a.Dn(t,i):(Gs()<=Wt.in.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),$s(i)),a.Sn.getDocumentsMatchingQuery(t,i,o).next(function(l){return c.forEach(function(d){l=l.insert(d.key,d)}),l}))})},e.prototype.Cn=function(t,i){var o=new kt(Xu(t));return i.forEach(function(s,a){Gi(t,a)&&(o=o.add(a))}),o},e.prototype.Nn=function(t,i,o,s){if(o.size!==i.size)return!0;var a="F"===t?i.last():i.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)},e.prototype.Dn=function(t,i){return Gs()<=Wt.in.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",$s(i)),this.Sn.getDocumentsMatchingQuery(t,i,$.min())},e}(),Xf=function(){function e(t,i,o,s){this.persistence=t,this.xn=i,this.R=s,this.kn=new Kt(et),this.Fn=new $r(function(a){return Vi(a)},Go),this.$n=$.min(),this._n=t.getMutationQueue(o),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new nl(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var i=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(o){return t.collect(o,i.kn)})},e}();function il(e,t,i,o){return new Xf(e,t,i,o)}function ol(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s,a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return i=j(e),o=i._n,s=i.Mn,[4,i.persistence.runTransaction("Handle user change","readonly",function(c){var l;return i._n.getAllMutationBatches(c).next(function(d){return l=d,o=i.persistence.getMutationQueue(t),s=new nl(i.On,o,i.persistence.getIndexManager()),o.getAllMutationBatches(c)}).next(function(d){for(var p=[],y=[],w=st(),C=0,E=l;C<E.length;C++){var R=E[C];p.push(R.batchId);for(var L=0,V=R.mutations;L<V.length;L++)w=w.add(V[L].key)}for(var J=0,tt=d;J<tt.length;J++){var rt=tt[J];y.push(rt.batchId);for(var at=0,Bt=rt.mutations;at<Bt.length;at++)w=w.add(Bt[at].key)}return s.pn(c,w).next(function(lo){return{Ln:lo,removedBatchIds:p,addedBatchIds:y}})})})];case 1:return a=u.sent(),[2,(i._n=o,i.Mn=s,i.xn.Vn(i.Mn),a)]}})})}function Yf(e,t){var i=j(e);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(o){var u,c,l,d,p,y,w,s=t.batch.keys(),a=i.On.newChangeBuffer({trackRemovals:!0});return(u=i,c=o,l=t,d=a,p=l.batch,y=p.keys(),w=O.resolve(),y.forEach(function(C){w=w.next(function(){return d.getEntry(c,C)}).next(function(E){var R=l.docVersions.get(C);Y(null!==R),E.version.compareTo(R)<0&&(p.applyToRemoteDocument(E,l),E.isValidDocument()&&d.addEntry(E,l.commitVersion))})}),w.next(function(){return u._n.removeMutationBatch(c,p)})).next(function(){return a.apply(o)}).next(function(){return i._n.performConsistencyCheck(o)}).next(function(){return i.Mn.pn(o,s)})})}function sl(e){var t=j(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(i){return t.qe.getLastRemoteSnapshotVersion(i)})}function $f(e,t){var i=j(e),o=t.snapshotVersion,s=i.kn;return i.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var u=i.On.newChangeBuffer({trackRemovals:!0});s=i.kn;var c=[];t.targetChanges.forEach(function(p,y){var R,L,V,w=s.get(y);if(w){c.push(i.qe.removeMatchingKeys(a,p.removedDocuments,y).next(function(){return i.qe.addMatchingKeys(a,p.addedDocuments,y)}));var C=p.resumeToken;if(C.approximateByteSize()>0){var E=w.withResumeToken(C,o).withSequenceNumber(a.currentSequenceNumber);s=s.insert(y,E),R=w,V=p,Y((L=E).resumeToken.approximateByteSize()>0),(0===R.resumeToken.approximateByteSize()||L.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&c.push(i.qe.updateTargetData(a,E))}}});var l=ve();if(t.documentUpdates.forEach(function(p,y){t.resolvedLimboDocuments.has(p)&&c.push(i.persistence.referenceDelegate.updateLimboDocument(a,p))}),c.push(al(a,u,t.documentUpdates,o,void 0).next(function(p){l=p})),!o.isEqual($.min())){var d=i.qe.getLastRemoteSnapshotVersion(a).next(function(p){return i.qe.setTargetsMetadata(a,a.currentSequenceNumber,o)});c.push(d)}return O.waitFor(c).next(function(){return u.apply(a)}).next(function(){return i.Mn.En(a,l)}).next(function(){return l})}).then(function(a){return i.kn=s,a})}function al(e,t,i,o,s){var a=st();return i.forEach(function(u){return a=a.add(u)}),t.getEntries(e,a).next(function(u){var c=ve();return i.forEach(function(l,d){var p=u.get(l),y=(null==s?void 0:s.get(l))||o;d.isNoDocument()&&d.version.isEqual($.min())?(t.removeEntry(l,y),c=c.insert(l,d)):!p.isValidDocument()||d.version.compareTo(p.version)>0||0===d.version.compareTo(p.version)&&p.hasPendingWrites?(t.addEntry(d,y),c=c.insert(l,d)):U("LocalStore","Ignoring outdated watch update for ",l,". Current version:",p.version," Watch version:",d.version)}),c})}function td(e,t){var i=j(e);return i.persistence.runTransaction("Get next mutation batch","readonly",function(o){return void 0===t&&(t=-1),i._n.getNextMutationBatchAfterBatchId(o,t)})}function ti(e,t){var i=j(e);return i.persistence.runTransaction("Allocate target","readwrite",function(o){var s;return i.qe.getTargetData(o,t).next(function(a){return a?O.resolve(s=a):i.qe.allocateTargetId(o).next(function(u){return s=new es(t,u,0,o.currentSequenceNumber),i.qe.addTargetData(o,s).next(function(){return s})})})}).then(function(o){var s=i.kn.get(o.targetId);return(null===s||o.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(i.kn=i.kn.insert(o.targetId,o),i.Fn.set(t,o.targetId)),o})}function ei(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:o=j(e),s=o.kn.get(t),a=i?"readwrite":"readwrite-primary",c.label=1;case 1:return c.trys.push([1,4,,5]),i?[3,3]:[4,o.persistence.runTransaction("Release target",a,function(l){return o.persistence.referenceDelegate.removeTarget(l,s)})];case 2:c.sent(),c.label=3;case 3:return[3,5];case 4:if(!Yn(u=c.sent()))throw u;return U("LocalStore","Failed to update sequence numbers for target "+t+": "+u),[3,5];case 5:return o.kn=o.kn.remove(t),o.Fn.delete(s.target),[2]}})})}function as(e,t,i){var o=j(e),s=$.min(),a=st();return o.persistence.runTransaction("Execute query","readonly",function(u){return(c=o,l=u,d=ge(t),p=j(c),y=p.Fn.get(d),void 0!==y?O.resolve(p.kn.get(y)):p.qe.getTargetData(l,d)).next(function(c){if(c)return s=c.lastLimboFreeSnapshotVersion,o.qe.getMatchingKeysForTargetId(u,c.targetId).next(function(l){a=l})}).next(function(){return o.xn.getDocumentsMatchingQuery(u,t,i?s:$.min(),i?a:st())}).next(function(c){return{documents:c,Bn:a}});var c,l,d,p,y})}function ul(e,t){var i=j(e),o=j(i.qe),s=i.kn.get(t);return s?Promise.resolve(s.target):i.persistence.runTransaction("Get target data","readonly",function(a){return o.lt(a,t).next(function(u){return u?u.target:null})})}function cl(e){var t=j(e);return t.persistence.runTransaction("Get new document changes","readonly",function(i){return s=i,a=t.$n,u=j(t.On),c=ve(),l=la(a),d=bn(s),p=IDBKeyRange.lowerBound(l,!0),d.$t({index:gt.readTimeIndex,range:p},function(y,w){var C=ca(u.R,w);c=c.insert(C.key,C),l=w.readTime}).next(function(){return{wn:c,readTime:Bc(l)}});var s,a,u,c,l,d,p}).then(function(i){var o=i.wn;return t.$n=i.readTime,o})}function ed(e){return(0,m.mG)(this,void 0,void 0,function(){var t;return(0,m.Jh)(this,function(i){return[2,(t=j(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(o){return a=bn(o),u=$.min(),a.$t({index:gt.readTimeIndex,reverse:!0},function(c,l,d){l.readTime&&(u=Bc(l.readTime)),d.done()}).next(function(){return u});var a,u}).then(function(o){t.$n=o})]})})}function nd(e,t,i,o){return(0,m.mG)(this,void 0,void 0,function(){var s,a,u,c,l,d,p,y,w,C;return(0,m.Jh)(this,function(E){switch(E.label){case 0:for(s=j(e),a=st(),u=ve(),c=pc(),l=0,d=i;l<d.length;l++)y=t.qn((p=d[l]).metadata.name),p.document&&(a=a.add(y)),u=u.insert(y,t.Un(p)),c=c.insert(y,t.Kn(p.metadata.readTime));return w=s.On.newChangeBuffer({trackRemovals:!0}),[4,ti(s,(R=o,ge(qr(it.fromString("__bundle__/docs/"+R)))))];case 1:return C=E.sent(),[2,s.persistence.runTransaction("Apply bundle documents","readwrite",function(R){return al(R,w,u,$.min(),c).next(function(L){return w.apply(R),L}).next(function(L){return s.qe.removeMatchingKeysForTargetId(R,C.targetId).next(function(){return s.qe.addMatchingKeys(R,a,C.targetId)}).next(function(){return s.Mn.En(R,L)}).next(function(){return L})})})]}var R})})}function rd(e,t,i){return void 0===i&&(i=st()),(0,m.mG)(this,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,ti(e,ge(ha(t.bundledQuery)))];case 1:return o=a.sent(),[2,(s=j(e)).persistence.runTransaction("Save named query","readwrite",function(u){var c=Mt(t.readTime);if(o.snapshotVersion.compareTo(c)>=0)return s.Ke.saveNamedQuery(u,t);var l=o.withResumeToken(Qt.EMPTY_BYTE_STRING,c);return s.kn=s.kn.insert(l.targetId,l),s.qe.updateTargetData(u,l).next(function(){return s.qe.removeMatchingKeysForTargetId(u,o.targetId)}).next(function(){return s.qe.addMatchingKeys(u,i,o.targetId)}).next(function(){return s.Ke.saveNamedQuery(u,t)})})]}})})}var id=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,i){return O.resolve(this.Qn.get(i))},e.prototype.saveBundleMetadata=function(t,i){var o;return this.Qn.set(i.id,{id:(o=i).id,version:o.version,createTime:Mt(o.createTime)}),O.resolve()},e.prototype.getNamedQuery=function(t,i){return O.resolve(this.jn.get(i))},e.prototype.saveNamedQuery=function(t,i){return this.jn.set(i.name,{name:(o=i).name,query:ha(o.bundledQuery),readTime:Mt(o.readTime)}),O.resolve();var o},e}(),ma=function(){function e(){this.Wn=new kt(Ot.Gn),this.zn=new kt(Ot.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,i){var o=new Ot(t,i);this.Wn=this.Wn.add(o),this.zn=this.zn.add(o)},e.prototype.Jn=function(t,i){var o=this;t.forEach(function(s){return o.addReference(s,i)})},e.prototype.removeReference=function(t,i){this.Yn(new Ot(t,i))},e.prototype.Xn=function(t,i){var o=this;t.forEach(function(s){return o.removeReference(s,i)})},e.prototype.Zn=function(t){var i=this,o=new K(new it([])),s=new Ot(o,t),a=new Ot(o,t+1),u=[];return this.zn.forEachInRange([s,a],function(c){i.Yn(c),u.push(c.key)}),u},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(i){return t.Yn(i)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var i=new K(new it([])),o=new Ot(i,t),s=new Ot(i,t+1),a=st();return this.zn.forEachInRange([o,s],function(u){a=a.add(u.key)}),a},e.prototype.containsKey=function(t){var i=new Ot(t,0),o=this.Wn.firstAfterOrEqual(i);return null!==o&&t.isEqual(o.key)},e}(),Ot=function(){function e(t,i){this.key=t,this.ns=i}return e.Gn=function(t,i){return K.comparator(t.key,i.key)||et(t.ns,i.ns)},e.Hn=function(t,i){return et(t.ns,i.ns)||K.comparator(t.key,i.key)},e}(),od=function(){function e(t,i){this.Ut=t,this.referenceDelegate=i,this._n=[],this.ss=1,this.rs=new kt(Ot.Gn)}return e.prototype.checkEmpty=function(t){return O.resolve(0===this._n.length)},e.prototype.addMutationBatch=function(t,i,o,s){var a=this.ss;this.ss++;var u=new ua(a,i,o,s);this._n.push(u);for(var c=0,l=s;c<l.length;c++){var d=l[c];this.rs=this.rs.add(new Ot(d.key,a)),this.Ut.addToCollectionParentIndex(t,d.key.path.popLast())}return O.resolve(u)},e.prototype.lookupMutationBatch=function(t,i){return O.resolve(this.os(i))},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var s=this.cs(i+1),a=s<0?0:s;return O.resolve(this._n.length>a?this._n[a]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return O.resolve(0===this._n.length?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return O.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=new Ot(i,0),a=new Ot(i,Number.POSITIVE_INFINITY),u=[];return this.rs.forEachInRange([s,a],function(c){var l=o.os(c.ns);u.push(l)}),O.resolve(u)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new kt(et);return i.forEach(function(a){var u=new Ot(a,0),c=new Ot(a,Number.POSITIVE_INFINITY);o.rs.forEachInRange([u,c],function(l){s=s.add(l.ns)})}),O.resolve(this.us(s))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=i.path,s=o.length+1,a=o;K.isDocumentKey(a)||(a=a.child(""));var u=new Ot(new K(a),0),c=new kt(et);return this.rs.forEachWhile(function(l){var d=l.key.path;return!!o.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.ns)),!0)},u),O.resolve(this.us(c))},e.prototype.us=function(t){var i=this,o=[];return t.forEach(function(s){var a=i.os(s);null!==a&&o.push(a)}),o},e.prototype.removeMutationBatch=function(t,i){var o=this;Y(0===this.hs(i.batchId,"removed")),this._n.shift();var s=this.rs;return O.forEach(i.mutations,function(a){var u=new Ot(a.key,i.batchId);return s=s.delete(u),o.referenceDelegate.markPotentiallyOrphaned(t,a.key)}).next(function(){o.rs=s})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,i){var o=new Ot(i,0),s=this.rs.firstAfterOrEqual(o);return O.resolve(i.isEqual(s&&s.key))},e.prototype.performConsistencyCheck=function(t){return O.resolve()},e.prototype.hs=function(t,i){return this.cs(t)},e.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},e.prototype.os=function(t){var i=this.cs(t);return i<0||i>=this._n.length?null:this._n[i]},e}(),sd=function(){function e(t,i){this.Ut=t,this.ls=i,this.docs=new Kt(K.comparator),this.size=0}return e.prototype.addEntry=function(t,i,o){var s=i.key,a=this.docs.get(s),u=a?a.size:0,c=this.ls(i);return this.docs=this.docs.insert(s,{document:i.clone(),size:c,readTime:o}),this.size+=c-u,this.Ut.addToCollectionParentIndex(t,s.path.popLast())},e.prototype.removeEntry=function(t){var i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)},e.prototype.getEntry=function(t,i){var o=this.docs.get(i);return O.resolve(o?o.document.clone():qt.newInvalidDocument(i))},e.prototype.getEntries=function(t,i){var o=this,s=ve();return i.forEach(function(a){var u=o.docs.get(a);s=s.insert(a,u?u.document.clone():qt.newInvalidDocument(a))}),O.resolve(s)},e.prototype.getDocumentsMatchingQuery=function(t,i,o){for(var s=ve(),a=new K(i.path.child("")),u=this.docs.getIteratorFrom(a);u.hasNext();){var c=u.getNext(),d=c.value,p=d.document,y=d.readTime;if(!i.path.isPrefixOf(c.key.path))break;y.compareTo(o)<=0||Gi(i,p)&&(s=s.insert(p.key,p.clone()))}return O.resolve(s)},e.prototype.fs=function(t,i){return O.forEach(this.docs,function(o){return i(o)})},e.prototype.newChangeBuffer=function(t){return new ad(this)},e.prototype.getSize=function(t){return O.resolve(this.size)},e}(),ad=function(e){function t(i){var o=this;return(o=e.call(this)||this).Ie=i,o}return(0,m.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[];return this.changes.forEach(function(a,u){u.document.isValidDocument()?s.push(o.Ie.addEntry(i,u.document,o.getReadTime(a))):o.Ie.removeEntry(a)}),O.waitFor(s)},t.prototype.getFromCache=function(i,o){return this.Ie.getEntry(i,o)},t.prototype.getAllFromCache=function(i,o){return this.Ie.getEntries(i,o)},t}($c),ud=function(){function e(t){this.persistence=t,this.ds=new $r(function(i){return Vi(i)},Go),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.ws=0,this._s=new ma,this.targetCount=0,this.ys=rs.Jt()}return e.prototype.forEachTarget=function(t,i){return this.ds.forEach(function(o,s){return i(s)}),O.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return O.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return O.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),O.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.ws&&(this.ws=i),O.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var i=t.targetId;i>this.highestTargetId&&(this.ys=new rs(i),this.highestTargetId=i),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,i){return this.te(i),this.targetCount+=1,O.resolve()},e.prototype.updateTargetData=function(t,i){return this.te(i),O.resolve()},e.prototype.removeTargetData=function(t,i){return this.ds.delete(i.target),this._s.Zn(i.targetId),this.targetCount-=1,O.resolve()},e.prototype.removeTargets=function(t,i,o){var s=this,a=0,u=[];return this.ds.forEach(function(c,l){l.sequenceNumber<=i&&null===o.get(l.targetId)&&(s.ds.delete(c),u.push(s.removeMatchingKeysForTargetId(t,l.targetId)),a++)}),O.waitFor(u).next(function(){return a})},e.prototype.getTargetCount=function(t){return O.resolve(this.targetCount)},e.prototype.getTargetData=function(t,i){var o=this.ds.get(i)||null;return O.resolve(o)},e.prototype.addMatchingKeys=function(t,i,o){return this._s.Jn(i,o),O.resolve()},e.prototype.removeMatchingKeys=function(t,i,o){this._s.Xn(i,o);var s=this.persistence.referenceDelegate,a=[];return s&&i.forEach(function(u){a.push(s.markPotentiallyOrphaned(t,u))}),O.waitFor(a)},e.prototype.removeMatchingKeysForTargetId=function(t,i){return this._s.Zn(i),O.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=this._s.es(i);return O.resolve(o)},e.prototype.containsKey=function(t,i){return O.resolve(this._s.containsKey(i))},e}(),cd=function(){function e(t,i){var o=this;this.gs={},this.Ne=new se(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ud(this),this.Ut=new Ff,this.Ue=new sd(this.Ut,function(u){return o.referenceDelegate.ps(u)}),this.R=new Vc(i),this.Ke=new id(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var i=this.gs[t.toKey()];return i||(i=new od(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=i),i},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var s=this;U("MemoryPersistence","Starting transaction:",t);var a=new ld(this.Ne.next());return this.referenceDelegate.Es(),o(a).next(function(u){return s.referenceDelegate.Ts(a).next(function(){return u})}).toPromise().then(function(u){return a.raiseOnCommittedEvent(),u})},e.prototype.Is=function(t,i){return O.or(Object.values(this.gs).map(function(o){return function(){return o.containsKey(t,i)}}))},e}(),ld=function(e){function t(i){var o=this;return(o=e.call(this)||this).currentSequenceNumber=i,o}return(0,m.ZT)(t,e),t}(Lc),hd=function(){function e(t){this.persistence=t,this.As=new ma,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw z()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,i,o){return this.As.addReference(o,i),this.vs.delete(o.toString()),O.resolve()},e.prototype.removeReference=function(t,i,o){return this.As.removeReference(o,i),this.vs.add(o.toString()),O.resolve()},e.prototype.markPotentiallyOrphaned=function(t,i){return this.vs.add(i.toString()),O.resolve()},e.prototype.removeTarget=function(t,i){var o=this;this.As.Zn(i.targetId).forEach(function(a){return o.vs.add(a.toString())});var s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,i.targetId).next(function(a){a.forEach(function(u){return o.vs.add(u.toString())})}).next(function(){return s.removeTargetData(t,i)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var i=this,o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.vs,function(s){var a=K.fromPath(s);return i.Ps(t,a).next(function(u){u||o.removeEntry(a)})}).next(function(){return i.Rs=null,o.apply(t)})},e.prototype.updateLimboDocument=function(t,i){var o=this;return this.Ps(t,i).next(function(s){s?o.vs.delete(i.toString()):o.vs.add(i.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,i){var o=this;return O.or([function(){return O.resolve(o.As.containsKey(i))},function(){return o.persistence.getTargetCache().containsKey(t,i)},function(){return o.persistence.Is(t,i)}])},e}(),jt=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return null!=this.uid},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();function ll(e,t){return"firestore_clients_"+e+"_"+t}function hl(e,t,i){var o="firestore_mutations_"+e+"_"+i;return t.isAuthenticated()&&(o+="_"+t.uid),o}function ga(e,t){return"firestore_targets_"+e+"_"+t}jt.UNAUTHENTICATED=new jt(null),jt.GOOGLE_CREDENTIALS=new jt("google-credentials-uid"),jt.FIRST_PARTY=new jt("first-party-uid"),jt.MOCK_USER=new jt("mock-user");var fl=function(){function e(t,i,o,s){this.user=t,this.batchId=i,this.state=o,this.error=s}return e.Vs=function(t,i,o){var s,a=JSON.parse(o),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&(u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(s=new N(a.error.code,a.error.message)),u?new e(t,i,a.state,s):(Et("SharedClientState","Failed to parse mutation state for ID '"+i+"': "+o),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),va=function(){function e(t,i,o){this.targetId=t,this.state=i,this.error=o}return e.Vs=function(t,i){var o,s=JSON.parse(i),a="object"==typeof s&&-1!==["not-current","current","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return a&&s.error&&(a="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(o=new N(s.error.code,s.error.message)),a?new e(t,s.state,o):(Et("SharedClientState","Failed to parse target state for ID '"+t+"': "+i),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),dl=function(){function e(t,i){this.clientId=t,this.activeTargetIds=i}return e.Vs=function(t,i){for(var o=JSON.parse(i),s="object"==typeof o&&o.activeTargetIds instanceof Array,a=Yo(),u=0;s&&u<o.activeTargetIds.length;++u)s=qu(o.activeTargetIds[u]),a=a.add(o.activeTargetIds[u]);return s?new e(t,a):(Et("SharedClientState","Failed to parse client data for instance '"+t+"': "+i),null)},e}(),fd=function(){function e(t,i){this.clientId=t,this.onlineState=i}return e.Vs=function(t){var i=JSON.parse(t);return"object"==typeof i&&-1!==["Unknown","Online","Offline"].indexOf(i.onlineState)&&"string"==typeof i.clientId?new e(i.clientId,i.onlineState):(Et("SharedClientState","Failed to parse online state: "+t),null)},e}(),ya=function(){function e(){this.activeTargetIds=Yo()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),ba=function(){function e(t,i,o,s,a){this.window=t,this.Se=i,this.persistenceKey=o,this.Ns=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Kt(et),this.started=!1,this.$s=[];var u=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Os=ll(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new ya),this.Ls=new RegExp("^firestore_clients_"+u+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+u+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+u+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks=function(c){return"firestore_bundle_loaded_"+c}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o,s,a,u,c,l,d,p,w=this;return(0,m.Jh)(this,function(C){switch(C.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=C.sent(),i=0,o=t;i<o.length;i++)(s=o[i])!==this.Ns&&(a=this.getItem(ll(this.persistenceKey,s)))&&(u=dl.Vs(s,a))&&(this.Fs=this.Fs.insert(u.clientId,u));for(this.Qs(),(c=this.storage.getItem(this.Us))&&(l=this.js(c))&&this.Ws(l),d=0,p=this.$s;d<p.length;d++)this.ks(p[d]);return this.$s=[],this.window.addEventListener("pagehide",function(){return w.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var i=!1;return this.Fs.forEach(function(o,s){s.activeTargetIds.has(t)&&(i=!0)}),i},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,i,o){this.zs(t,i,o),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var i="not-current";if(this.isActiveQueryTarget(t)){var o=this.storage.getItem(ga(this.persistenceKey,t));if(o){var s=va.Vs(t,o);s&&(i=s.state)}}return this.Js.Ds(t),this.Qs(),i},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(ga(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,i,o){this.Ys(t,i,o)},e.prototype.handleUserChange=function(t,i,o){var s=this;i.forEach(function(a){s.Hs(a)}),this.currentUser=t,o.forEach(function(a){s.addPendingMutation(a)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var i=this.storage.getItem(t);return U("SharedClientState","READ",t,i),i},e.prototype.setItem=function(t,i){U("SharedClientState","SET",t,i),this.storage.setItem(t,i)},e.prototype.removeItem=function(t){U("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var i=this,o=t;if(o.storageArea===this.storage){if(U("SharedClientState","EVENT",o.key,o.newValue),o.key===this.Os)return void Et("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,m.mG)(i,void 0,void 0,function(){var s,a,u,c,l,d;return(0,m.Jh)(this,function(p){if(this.started){if(null!==o.key)if(this.Ls.test(o.key)){if(null==o.newValue)return s=this.ti(o.key),[2,this.ei(s,null)];if(a=this.ni(o.key,o.newValue))return[2,this.ei(a.clientId,a)]}else if(this.Bs.test(o.key)){if(null!==o.newValue&&(u=this.si(o.key,o.newValue)))return[2,this.ii(u)]}else if(this.qs.test(o.key)){if(null!==o.newValue&&(c=this.ri(o.key,o.newValue)))return[2,this.oi(c)]}else if(o.key===this.Us){if(null!==o.newValue&&(l=this.js(o.newValue)))return[2,this.Ws(l)]}else if(o.key===this.Ms)(d=function(y){var w=se.o;if(null!=y)try{var C=JSON.parse(y);Y("number"==typeof C),w=C}catch(E){Et("SharedClientState","Failed to read sequence number from WebStorage",E)}return w}(o.newValue))!==se.o&&this.sequenceNumberHandler(d);else if(o.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(o);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,i,o){var s=new fl(this.currentUser,t,i,o),a=hl(this.persistenceKey,this.currentUser,t);this.setItem(a,s.Ss())},e.prototype.Hs=function(t){var i=hl(this.persistenceKey,this.currentUser,t);this.removeItem(i)},e.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},e.prototype.Ys=function(t,i,o){var s=ga(this.persistenceKey,t),a=new va(t,i,o);this.setItem(s,a.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var i=this.Ls.exec(t);return i?i[1]:null},e.prototype.ni=function(t,i){var o=this.ti(t);return dl.Vs(o,i)},e.prototype.si=function(t,i){var o=this.Bs.exec(t),s=Number(o[1]);return fl.Vs(new jt(void 0!==o[2]?o[2]:null),s,i)},e.prototype.ri=function(t,i){var o=this.qs.exec(t),s=Number(o[1]);return va.Vs(s,i)},e.prototype.js=function(t){return fd.Vs(t)},e.prototype.ii=function(t){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(i){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(U("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,i){var o=this,s=i?this.Fs.insert(t,i):this.Fs.remove(t),a=this.Gs(this.Fs),u=this.Gs(s),c=[],l=[];return u.forEach(function(d){a.has(d)||c.push(d)}),a.forEach(function(d){u.has(d)||l.push(d)}),this.syncEngine.hi(c,l).then(function(){o.Fs=s})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var i=Yo();return t.forEach(function(o,s){i=i.unionWith(s.activeTargetIds)}),i},e}(),pl=function(){function e(){this.li=new ya,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,i,o){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,i,o){this.fi[t]=i},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new ya,Promise.resolve()},e.prototype.handleUserChange=function(t,i,o){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),dd=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),ml=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(0)},e.prototype.yi=function(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(1)},e.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},e}(),pd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},md=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),gd=function(e){function t(i){var o=this;return(o=e.call(this,i)||this).forceLongPolling=i.forceLongPolling,o.autoDetectLongPolling=i.autoDetectLongPolling,o.useFetchStreams=i.useFetchStreams,o}return(0,m.ZT)(t,e),t.prototype.Fi=function(i,o,s,a){return new Promise(function(u,c){var l=new Pu;l.listenOnce(ku.COMPLETE,function(){try{switch(l.getLastErrorCode()){case qo.NO_ERROR:var p=l.getResponseJson();U("Connection","XHR received:",JSON.stringify(p)),u(p);break;case qo.TIMEOUT:U("Connection",'RPC "'+i+'" timed out'),c(new N(x.DEADLINE_EXCEEDED,"Request time out"));break;case qo.HTTP_ERROR:var y=l.getStatus();if(U("Connection",'RPC "'+i+'" failed with status:',y,"response text:",l.getResponseText()),y>0){var w=l.getResponseJson().error;if(w&&w.status&&w.message){var C=(R=w.status.toLowerCase().replace(/_/g,"-"),Object.values(x).indexOf(R)>=0?R:x.UNKNOWN);c(new N(C,w.message))}else c(new N(x.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new N(x.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{U("Connection",'RPC "'+i+'" completed.')}var R});var d=JSON.stringify(a);l.send(o,"POST",d,s,15)})},t.prototype.Oi=function(i,o){var s=[this.Di,"/","google.firestore.v1.Firestore","/",i,"/channel"],a=new Uo,u=Sr(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new Du({})),this.ki(c.initMessageHeaders,o),(0,v.uI)()||(0,v.b$)()||(0,v.d)()||(0,v.w1)()||(0,v.Mn)()||(0,v.ru)()||(c.httpHeadersOverwriteParam="$httpHeaders");var l=s.join("");U("Connection","Creating WebChannel: "+l,c);var d=a.createWebChannel(l,c),p=!1,y=!1,w=new md({Ei:function(E){y?U("Connection","Not sending because WebChannel is closed:",E):(p||(U("Connection","Opening WebChannel transport."),d.open(),p=!0),U("Connection","WebChannel sending:",E),d.send(E))},Ti:function(){return d.close()}}),C=function(E,R,L){E.listen(R,function(V){try{L(V)}catch(H){setTimeout(function(){throw H},0)}})};return C(d,Oi.EventType.OPEN,function(){y||U("Connection","WebChannel transport opened.")}),C(d,Oi.EventType.CLOSE,function(){y||(y=!0,U("Connection","WebChannel transport closed"),w.Vi())}),C(d,Oi.EventType.ERROR,function(E){y||(y=!0,Li("Connection","WebChannel transport errored:",E),w.Vi(new N(x.UNAVAILABLE,"The operation could not be completed")))}),C(d,Oi.EventType.MESSAGE,function(E){var R;if(!y){var L=E.data[0];Y(!!L);var H=L.error||(null===(R=L[0])||void 0===R?void 0:R.error);if(H){U("Connection","WebChannel received error:",H);var J=H.status,tt=function(at){var Bt=St[at];if(void 0!==Bt)return fc(Bt)}(J),rt=H.message;void 0===tt&&(tt=x.INTERNAL,rt="Unknown error status: "+J+" with message "+H.message),y=!0,w.Vi(new N(tt,rt)),d.close()}else U("Connection","WebChannel received:",L),w.Si(L)}}),C(u,Ru.STAT_EVENT,function(E){E.stat===Bs_PROXY?U("Connection","Detected buffering proxy"):E.stat===Bs_NOPROXY&&U("Connection","Detected no buffering proxy")}),setTimeout(function(){w.Pi()},0),w},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,i,o,s){var a=this.xi(t,i);U("RestConnection","Sending: ",a,o);var u={};return this.ki(u,s),this.Fi(t,a,u,o).then(function(c){return U("RestConnection","Received: ",c),c},function(c){throw Li("RestConnection",t+" failed with error: ",c,"url: ",a,"request:",o),c})},e.prototype.$i=function(t,i,o,s){return this.Ni(t,i,o,s)},e.prototype.ki=function(t,i){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i)for(var o in i.authHeaders)i.authHeaders.hasOwnProperty(o)&&(t[o]=i.authHeaders[o])},e.prototype.xi=function(t,i){return this.Di+"/v1/"+i+":"+pd[t]},e}());function gl(){return"undefined"!=typeof window?window:null}function us(){return"undefined"!=typeof document?document:null}function $i(e){return new wf(e,!0)}var _a=function(){function e(t,i,o,s,a){void 0===o&&(o=1e3),void 0===s&&(s=1.5),void 0===a&&(a=6e4),this.Se=t,this.timerId=i,this.Mi=o,this.Li=s,this.Bi=a,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var i=this;this.cancel();var o=Math.floor(this.qi+this.Wi()),s=Math.max(0,Date.now()-this.Ki),a=Math.max(0,o-s);a>0&&U("ExponentialBackoff","Backing off for "+a+" ms (base delay: "+this.qi+" ms, delay with jitter: "+o+" ms, last attempt: "+s+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,a,function(){return i.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),vl=function(){function e(t,i,o,s,a,u){this.Se=t,this.zi=o,this.Hi=s,this.Ji=a,this.listener=u,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new _a(t,i)}return e.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},e.prototype.er=function(){return 2===this.state},e.prototype.start=function(){3!==this.state?this.auth():this.nr()},e.prototype.stop=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,i){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(o){switch(o.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():i&&i.code===x.RESOURCE_EXHAUSTED?(Et(i.toString()),Et("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):i&&i.code===x.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(i)];case 1:return o.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var i=this.hr(this.Yi),o=this.Yi;this.Ji.getToken().then(function(s){t.Yi===o&&t.lr(s)},function(s){i(function(){var a=new N(x.UNKNOWN,"Fetching auth token failed: "+s.message);return t.dr(a)})})},e.prototype.lr=function(t){var i=this,o=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){o(function(){return i.state=2,i.listener.Ii()})}),this.stream.Ri(function(s){o(function(){return i.dr(s)})}),this.stream.onMessage(function(s){o(function(){return i.onMessage(s)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,m.mG)(t,void 0,void 0,function(){return(0,m.Jh)(this,function(i){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return U("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var i=this;return function(o){i.Se.enqueueAndForget(function(){return i.Yi===t?o():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),vd=function(e){function t(i,o,s,a,u){var c=this;return(c=e.call(this,i,"listen_stream_connection_backoff","listen_stream_idle",o,s,u)||this).R=a,c}return(0,m.ZT)(t,e),t.prototype.wr=function(i){return this.Hi.Oi("Listen",i)},t.prototype.onMessage=function(i){this.Zi.reset();var o=function(a,u){var c,L;if("targetChange"in u){var l="NO_CHANGE"===(L=u.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===L?1:"REMOVE"===L?2:"CURRENT"===L?3:"RESET"===L?4:z(),d=u.targetChange.targetIds||[],p=function(L,V){return L.I?(Y(void 0===V||"string"==typeof V),Qt.fromBase64String(V||"")):(Y(void 0===V||V instanceof Uint8Array),Qt.fromUint8Array(V||new Uint8Array))}(a,u.targetChange.resumeToken),y=(w=u.targetChange.cause)&&function(L){var V=void 0===L.code?x.UNKNOWN:fc(L.code);return new N(V,L.message||"")}(w);c=new gc(l,d,p,y||null)}else if("documentChange"in u){d=Re(a,(l=u.documentChange).document.name),p=Mt(l.document.updateTime);var w=new ae({mapValue:{fields:l.document.fields}}),C=(y=qt.newFoundDocument(d,p,w),l.targetIds||[]);c=new $o(C,l.removedTargetIds||[],y.key,y)}else if("documentDelete"in u)d=Re(a,(l=u.documentDelete).document),p=l.readTime?Mt(l.readTime):$.min(),w=qt.newNoDocument(d,p),c=new $o([],y=l.removedTargetIds||[],w.key,w);else if("documentRemove"in u)d=Re(a,(l=u.documentRemove).document),c=new $o([],p=l.removedTargetIds||[],d,null);else{if(!("filter"in u))return z();var R=u.filter;d=new ff(l=R.count||0),c=new mc(p=R.targetId,d)}return c}(this.R,i),s=function(a){if(!("targetChange"in a))return $.min();var u=a.targetChange;return u.targetIds&&u.targetIds.length?$.min():u.readTime?Mt(u.readTime):$.min()}(i);return this.listener._r(o,s)},t.prototype.mr=function(i){var a,u,c,l,o={};o.database=Zi(this.R),o.addTarget=(a=this.R,(c=zo(l=(u=i).target)?{documents:Ac(a,l)}:{query:xc(a,l)}).targetId=u.targetId,u.resumeToken.approximateByteSize()>0?c.resumeToken=_c(a,u.resumeToken):u.snapshotVersion.compareTo($.min())>0&&(c.readTime=Ji(a,u.snapshotVersion.toTimestamp())),c);var s=function(a,u){var c=function(l,d){switch(d){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return z()}}(0,u.purpose);return null==c?null:{"goog-listen-tags":c}}(0,i);s&&(o.labels=s),this.cr(o)},t.prototype.yr=function(i){var o={};o.database=Zi(this.R),o.removeTarget=i,this.cr(o)},t}(vl),yd=function(e){function t(i,o,s,a,u){var c=this;return(c=e.call(this,i,"write_stream_connection_backoff","write_stream_idle",o,s,u)||this).R=a,c.gr=!1,c}return(0,m.ZT)(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(i){return this.Hi.Oi("Write",i)},t.prototype.onMessage=function(i){if(Y(!!i.streamToken),this.lastStreamToken=i.streamToken,this.gr){this.Zi.reset();var o=(u=i.commitTime,(a=i.writeResults)&&a.length>0?(Y(void 0!==u),a.map(function(c){return d=u,(p=Mt((l=c).updateTime?l.updateTime:d)).isEqual($.min())&&(p=Mt(d)),new cf(p,l.transformResults||[]);var l,d,p})):[]),s=Mt(i.commitTime);return this.listener.Tr(s,o)}var a,u;return Y(!i.writeResults||0===i.writeResults.length),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var i={};i.database=Zi(this.R),this.cr(i)},t.prototype.Er=function(i){var o=this,s={streamToken:this.lastStreamToken,writes:i.map(function(a){return ts(o.R,a)})};this.cr(s)},t}(vl),bd=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).credentials=i,a.Hi=o,a.R=s,a.Rr=!1,a}return(0,m.ZT)(t,e),t.prototype.br=function(){if(this.Rr)throw new N(x.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(i,o,s){var a=this;return this.br(),this.credentials.getToken().then(function(u){return a.Hi.Ni(i,o,s,u)}).catch(function(u){throw"FirebaseError"===u.name?(u.code===x.UNAUTHENTICATED&&a.credentials.invalidateToken(),u):new N(x.UNKNOWN,u.toString())})},t.prototype.$i=function(i,o,s){var a=this;return this.br(),this.credentials.getToken().then(function(u){return a.Hi.$i(i,o,s,u)}).catch(function(u){throw"FirebaseError"===u.name?(u.code===x.UNAUTHENTICATED&&a.credentials.invalidateToken(),u):new N(x.UNKNOWN,u.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),_d=function(){function e(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var i="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Et(i),this.Vr=!1):U("OnlineStateTracker",i)},e.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},e}(),wd=function(e,t,i,o,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=s,this.Lr.di(function(u){i.enqueueAndForget(function(){return(0,m.mG)(a,void 0,void 0,function(){return(0,m.Jh)(this,function(c){switch(c.label){case 0:return _n(this)?(U("RemoteStore","Restarting streams for network reachability change."),[4,function(l){return(0,m.mG)(this,void 0,void 0,function(){var d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:return(d=j(l)).Or.add(4),[4,ni(d)];case 1:return p.sent(),d.Br.set("Unknown"),d.Or.delete(4),[4,to(d)];case 2:return p.sent(),[2]}})})}(this)]):[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})})}),this.Br=new _d(i,o)};function to(e){return(0,m.mG)(this,void 0,void 0,function(){var t,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if(!_n(e))return[3,4];t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!0)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function ni(e){return(0,m.mG)(this,void 0,void 0,function(){var t,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!1)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function cs(e,t){var i=j(e);i.$r.has(t.targetId)||(i.$r.set(t.targetId,t),Ia(i)?Ta(i):ii(i).er()&&wa(i,t))}function eo(e,t){var i=j(e),o=ii(i);i.$r.delete(t),o.er()&&yl(i,t),0===i.$r.size&&(o.er()?o.ir():_n(i)&&i.Br.set("Unknown"))}function wa(e,t){e.qr.U(t.targetId),ii(e).mr(t)}function yl(e,t){e.qr.U(t),ii(e).yr(t)}function Ta(e){e.qr=new yf({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),ii(e).start(),e.Br.Sr()}function Ia(e){return _n(e)&&!ii(e).tr()&&e.$r.size>0}function _n(e){return 0===j(e).Or.size}function bl(e){e.qr=void 0}function Td(e){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){return e.$r.forEach(function(i,o){wa(e,i)}),[2]})})}function Id(e,t){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(i){return bl(e),Ia(e)?(e.Br.Nr(t),Ta(e)):e.Br.set("Unknown"),[2]})})}function Ed(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:if(e.Br.set("Online"),!(t instanceof gc&&2===t.state&&t.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(c,l){return(0,m.mG)(this,void 0,void 0,function(){var d,p,y,w;return(0,m.Jh)(this,function(C){switch(C.label){case 0:d=l.cause,p=0,y=l.targetIds,C.label=1;case 1:return p<y.length?c.$r.has(w=y[p])?[4,c.remoteSyncer.rejectListen(w,d)]:[3,3]:[3,5];case 2:C.sent(),c.$r.delete(w),c.qr.removeTarget(w),C.label=3;case 3:C.label=4;case 4:return p++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),U("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),o),[4,ls(e,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof $o?e.qr.X(t):t instanceof mc?e.qr.rt(t):e.qr.et(t),i.isEqual($.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,sl(e.localStore)];case 8:return s=u.sent(),i.compareTo(s)>=0?[4,(c=e,l=i,d=c.qr.ut(l),d.targetChanges.forEach(function(p,y){if(p.resumeToken.approximateByteSize()>0){var w=c.$r.get(y);w&&c.$r.set(y,w.withResumeToken(p.resumeToken,l))}}),d.targetMismatches.forEach(function(p){var y=c.$r.get(p);if(y){c.$r.set(p,y.withResumeToken(Qt.EMPTY_BYTE_STRING,y.snapshotVersion)),yl(c,p);var w=new es(y.target,p,1,y.sequenceNumber);wa(c,w)}}),c.remoteSyncer.applyRemoteEvent(d))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return U("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,ls(e,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,l,d})})}function ls(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o=this;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(!Yn(t))throw t;return e.Or.add(1),[4,ni(e)];case 1:return s.sent(),e.Br.set("Offline"),i||(i=function(){return sl(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return(0,m.mG)(o,void 0,void 0,function(){return(0,m.Jh)(this,function(a){switch(a.label){case 0:return U("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return a.sent(),e.Or.delete(1),[4,to(e)];case 2:return a.sent(),[2]}})})}),[2]}})})}function _l(e,t){return t().catch(function(i){return ls(e,i,t)})}function ri(e){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o,s,a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:t=j(e),i=wn(t),o=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,u.label=1;case 1:if(!(_n(c=t)&&c.Fr.length<10))return[3,7];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,td(t.localStore,o)];case 3:return null===(s=u.sent())?(0===t.Fr.length&&i.ir(),[3,7]):(o=s.batchId,function(c,l){c.Fr.push(l);var d=wn(c);d.er()&&d.pr&&d.Er(l.mutations)}(t,s),[3,6]);case 4:return a=u.sent(),[4,ls(t,a)];case 5:return u.sent(),[3,6];case 6:return[3,1];case 7:return wl(t)&&Tl(t),[2]}var c})})}function wl(e){return _n(e)&&!wn(e).tr()&&e.Fr.length>0}function Tl(e){wn(e).start()}function Cd(e){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){return wn(e).Ar(),[2]})})}function Sd(e){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o;return(0,m.Jh)(this,function(a){for(t=wn(e),i=0,o=e.Fr;i<o.length;i++)t.Er(o[i].mutations);return[2]})})}function Ad(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return o=e.Fr.shift(),s=Of.from(o,t,i),[4,_l(e,function(){return e.remoteSyncer.applySuccessfulWrite(s)})];case 1:return a.sent(),[4,ri(e)];case 2:return a.sent(),[2]}})})}function xd(e,t){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(i){switch(i.label){case 0:return t&&wn(e).pr?[4,function(o,s){return(0,m.mG)(this,void 0,void 0,function(){var a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:return hc(u=s.code)&&u!==x.ABORTED?(a=o.Fr.shift(),wn(o).sr(),[4,_l(o,function(){return o.remoteSyncer.rejectFailedWrite(a.batchId,s)})]):[3,3];case 1:return c.sent(),[4,ri(o)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return wl(e)&&Tl(e),[2]}})})}function Ea(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return i=j(e),t?(i.Or.delete(2),[4,to(i)]):[3,2];case 1:return o.sent(),[3,5];case 2:return t?[3,4]:(i.Or.add(2),[4,ni(i)]);case 3:o.sent(),i.Br.set("Unknown"),o.label=4;case 4:o.label=5;case 5:return[2]}})})}function ii(e){var i,o,s,a,t=this;return e.Ur||(e.Ur=(i=e.datastore,o=e.asyncQueue,s={Ii:Td.bind(null,e),Ri:Id.bind(null,e),_r:Ed.bind(null,e)},(a=j(i)).br(),new vd(o,a.Hi,a.credentials,a.R,s)),e.Mr.push(function(i){return(0,m.mG)(t,void 0,void 0,function(){return(0,m.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Ur.sr(),Ia(e)?Ta(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:o.sent(),bl(e),o.label=3;case 3:return[2]}})})})),e.Ur}function wn(e){var i,o,s,a,t=this;return e.Kr||(e.Kr=(i=e.datastore,o=e.asyncQueue,s={Ii:Cd.bind(null,e),Ri:xd.bind(null,e),Ir:Sd.bind(null,e),Tr:Ad.bind(null,e)},(a=j(i)).br(),new yd(o,a.Hi,a.credentials,a.R,s)),e.Mr.push(function(i){return(0,m.mG)(t,void 0,void 0,function(){return(0,m.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Kr.sr(),[4,ri(e)]):[3,2];case 1:return o.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:o.sent(),e.Fr.length>0&&(U("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),o.label=4;case 4:return[2]}})})})),e.Kr}var kd=function(){function e(t,i,o,s,a){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=o,this.op=s,this.removalCallback=a,this.deferred=new Jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(u){})}return e.createAndSchedule=function(t,i,o,s,a){var u=new e(t,i,Date.now()+o,s,a);return u.start(o),u},e.prototype.start=function(t){var i=this;this.timerHandle=setTimeout(function(){return i.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(x.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(i){return t.deferred.resolve(i)})):Promise.resolve()})},e.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function oi(e,t){if(Et("AsyncQueue",t+": "+e),Yn(e))return new N(x.UNAVAILABLE,t+": "+e);throw e}var Il=function(){function e(t){this.comparator=t?function(i,o){return t(i,o)||K.comparator(i.key,o.key)}:function(i,o){return K.comparator(i.key,o.key)},this.keyedMap=na(),this.sortedSet=new Kt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return null!=this.keyedMap.get(t)},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.add=function(t){var i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))},e.prototype.delete=function(t){var i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.sortedSet.getIterator(),o=t.sortedSet.getIterator();i.hasNext();){var s=i.getNext().key,a=o.getNext().key;if(!s.isEqual(a))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(i){t.push(i.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},e.prototype.copy=function(t,i){var o=new e;return o.comparator=this.comparator,o.keyedMap=t,o.sortedSet=i,o},e}(),El=function(){function e(){this.Qr=new Kt(K.comparator)}return e.prototype.track=function(t){var i=t.doc.key,o=this.Qr.get(i);o?0!==t.type&&3===o.type?this.Qr=this.Qr.insert(i,t):3===t.type&&1!==o.type?this.Qr=this.Qr.insert(i,{type:o.type,doc:t.doc}):2===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):2===t.type&&0===o.type?this.Qr=this.Qr.insert(i,{type:0,doc:t.doc}):1===t.type&&0===o.type?this.Qr=this.Qr.remove(i):1===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:1,doc:o.doc}):0===t.type&&1===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):z():this.Qr=this.Qr.insert(i,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(i,o){t.push(o)}),t},e}(),hs=function(){function e(t,i,o,s,a,u,c,l){this.query=t,this.docs=i,this.oldDocs=o,this.docChanges=s,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=c,this.excludesMetadataChanges=l}return e.fromInitialDocuments=function(t,i,o,s){var a=[];return i.forEach(function(u){a.push({type:0,doc:u})}),new e(t,i,Il.emptySet(i),a,o,s,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Bi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var i=this.docChanges,o=t.docChanges;if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++)if(i[s].type!==o[s].type||!i[s].doc.isEqual(o[s].doc))return!1;return!0},e}(),Rd=function(){this.Wr=void 0,this.listeners=[]},Dd=function(){this.queries=new $r(function(e){return Wu(e)},Bi),this.onlineState="Unknown",this.Gr=new Set};function Ca(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c,l;return(0,m.Jh)(this,function(d){switch(d.label){case 0:if(i=j(e),s=!1,(a=i.queries.get(o=t.query))||(s=!0,a=new Rd),!s)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),u=a,[4,i.onListen(o)];case 2:return u.Wr=d.sent(),[3,4];case 3:return c=d.sent(),l=oi(c,"Initialization of query '"+$s(t.query)+"' failed"),[2,void t.onError(l)];case 4:return i.queries.set(o,a),a.listeners.push(t),t.zr(i.onlineState),a.Wr&&t.Hr(a.Wr)&&Aa(i),[2]}})})}function Sa(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,m.Jh)(this,function(c){return i=j(e),s=!1,(a=i.queries.get(o=t.query))&&(u=a.listeners.indexOf(t))>=0&&(a.listeners.splice(u,1),s=0===a.listeners.length),s?[2,(i.queries.delete(o),i.onUnlisten(o))]:[2]})})}function Pd(e,t){for(var i=j(e),o=!1,s=0,a=t;s<a.length;s++){var u=a[s],l=i.queries.get(u.query);if(l){for(var d=0,p=l.listeners;d<p.length;d++)p[d].Hr(u)&&(o=!0);l.Wr=u}}o&&Aa(i)}function Nd(e,t,i){var o=j(e),s=o.queries.get(t);if(s)for(var a=0,u=s.listeners;a<u.length;a++)u[a].onError(i);o.queries.delete(t)}function Aa(e){e.Gr.forEach(function(t){t.next()})}var xa=function(){function e(t,i,o){this.query=t,this.Jr=i,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=o||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var i=[],o=0,s=t.docChanges;o<s.length;o++){var a=s[o];3!==a.type&&i.push(a)}t=new hs(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var u=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),u=!0):this.eo(t,this.onlineState)&&(this.no(t),u=!0),this.Xr=t,u},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var i=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),i=!0),i},e.prototype.eo=function(t,i){return!t.fromCache||!(this.options.so&&"Offline"!==i||t.docs.isEmpty()&&"Offline"!==i)},e.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},e.prototype.no=function(t){t=hs.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),Md=function(){function e(t,i){this.payload=t,this.byteLength=i}return e.prototype.io=function(){return"metadata"in this.payload},e}(),Cl=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return Re(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?Cc(this.R,t.document,!1):qt.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return Mt(t)},e}();!function(){function e(t,i,o){this.ro=t,this.localStore=i,this.R=o,this.queries=[],this.documents=[],this.progress=function Sl(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(t)}e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var i=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++i):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++i),i!==this.progress.documentsLoaded?(this.progress.documentsLoaded=i,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var i=new Map,o=new Cl(this.R),s=0,a=t;s<a.length;s++){var u=a[s];if(u.metadata.queries)for(var c=o.qn(u.metadata.name),l=0,d=u.metadata.queries;l<d.length;l++){var p=d[l],y=(i.get(p)||st()).add(c);i.set(p,y)}}return i},e.prototype.complete=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o,s,a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return[4,nd(this.localStore,new Cl(this.R),this.documents,this.ro.id)];case 1:t=u.sent(),i=this.co(this.documents),o=0,s=this.queries,u.label=2;case 2:return o<s.length?[4,rd(this.localStore,a=s[o],i.get(a.name))]:[3,5];case 3:u.sent(),u.label=4;case 4:return o++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Zf(Object.assign({},this.progress),t))]}})})}}();var Al=function(e){this.key=e},xl=function(e){this.key=e},kl=function(){function e(t,i){this.query=t,this.uo=i,this.ao=null,this.current=!1,this.ho=st(),this.mutatedKeys=st(),this.lo=Xu(t),this.fo=new Il(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,i){var o=this,s=i?i.mo:new El,a=i?i.fo:this.fo,u=i?i.mutatedKeys:this.mutatedKeys,c=a,l=!1,d=Ho(this.query)&&a.size===this.query.limit?a.last():null,p=Jo(this.query)&&a.size===this.query.limit?a.first():null;if(t.inorderTraversal(function(w,C){var E=a.get(w),R=Gi(o.query,C)?C:null,L=!!E&&o.mutatedKeys.has(E.key),V=!!R&&(R.hasLocalMutations||o.mutatedKeys.has(R.key)&&R.hasCommittedMutations),H=!1;E&&R?E.data.isEqual(R.data)?L!==V&&(s.track({type:3,doc:R}),H=!0):o.yo(E,R)||(s.track({type:2,doc:R}),H=!0,(d&&o.lo(R,d)>0||p&&o.lo(R,p)<0)&&(l=!0)):!E&&R?(s.track({type:0,doc:R}),H=!0):E&&!R&&(s.track({type:1,doc:E}),H=!0,(d||p)&&(l=!0)),H&&(R?(c=c.add(R),u=V?u.add(w):u.delete(w)):(c=c.delete(w),u=u.delete(w)))}),Ho(this.query)||Jo(this.query))for(;c.size>this.query.limit;){var y=Ho(this.query)?c.last():c.first();c=c.delete(y.key),u=u.delete(y.key),s.track({type:1,doc:y})}return{fo:c,mo:s,Nn:l,mutatedKeys:u}},e.prototype.yo=function(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations},e.prototype.applyChanges=function(t,i,o){var s=this,a=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var u=t.mo.jr();u.sort(function(p,y){return C=y.type,(E=function(R){switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}})(p.type)-E(C)||s.lo(p.doc,y.doc);var C,E}),this.po(o);var c=i?this.Eo():[],l=0===this.ho.size&&this.current?1:0,d=l!==this.ao;return this.ao=l,0!==u.length||d?{snapshot:new hs(this.query,t.fo,a,u,t.mutatedKeys,0===l,d,!1),To:c}:{To:c}},e.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new El,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var i=this;t&&(t.addedDocuments.forEach(function(o){return i.uo=i.uo.add(o)}),t.modifiedDocuments.forEach(function(o){}),t.removedDocuments.forEach(function(o){return i.uo=i.uo.delete(o)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var i=this.ho;this.ho=st(),this.fo.forEach(function(s){t.Io(s.key)&&(t.ho=t.ho.add(s.key))});var o=[];return i.forEach(function(s){t.ho.has(s)||o.push(new xl(s))}),this.ho.forEach(function(s){i.has(s)||o.push(new Al(s))}),o},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=st();var i=this._o(t.documents);return this.applyChanges(i,!0)},e.prototype.Ro=function(){return hs.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},e}(),Ld=function(e,t,i){this.query=e,this.targetId=t,this.view=i},Fd=function(e){this.key=e,this.bo=!1},Ud=function(){function e(t,i,o,s,a,u){this.localStore=t,this.remoteStore=i,this.eventManager=o,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.vo={},this.Po=new $r(function(c){return Wu(c)},Bi),this.Vo=new Map,this.So=new Set,this.Do=new Kt(K.comparator),this.Co=new Map,this.No=new ma,this.xo={},this.ko=new Map,this.Fo=rs.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),e}();function qd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,s,a,u,c;return(0,m.Jh)(this,function(l){switch(l.label){case 0:return i=Ma(e),(a=i.Po.get(t))?(i.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.Ro(),[3,4]):[3,1];case 1:return[4,ti(i.localStore,ge(t))];case 2:return u=l.sent(),c=i.sharedClientState.addLocalQueryTarget(u.targetId),[4,ka(i,t,u.targetId,"current"===c)];case 3:s=l.sent(),i.isPrimaryClient&&cs(i.remoteStore,u),l.label=4;case 4:return[2,s]}})})}function ka(e,t,i,o){return(0,m.mG)(this,void 0,void 0,function(){var s,a,u,c,l,d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:return e.Oo=function(y,w,C){return function(E,R,L,V){return(0,m.mG)(this,void 0,void 0,function(){var H,J,tt;return(0,m.Jh)(this,function(rt){switch(rt.label){case 0:return(H=R.view._o(L)).Nn?[4,as(E.localStore,R.query,!1).then(function(at){return R.view._o(at.documents,H)})]:[3,2];case 1:H=rt.sent(),rt.label=2;case 2:return J=V&&V.targetChanges.get(R.targetId),tt=R.view.applyChanges(H,E.isPrimaryClient,J),[2,(Pa(E,R.targetId,tt.To),tt.snapshot)]}})})}(e,y,w,C)},[4,as(e.localStore,t,!0)];case 1:return s=p.sent(),a=new kl(t,s.Bn),u=a._o(s.documents),c=ia.createSynthesizedTargetChangeForCurrentChange(i,o&&"Offline"!==e.onlineState),l=a.applyChanges(u,e.isPrimaryClient,c),Pa(e,i,l.To),d=new Ld(t,i,a),[2,(e.Po.set(t,d),e.Vo.has(i)?e.Vo.get(i).push(t):e.Vo.set(i,[t]),l.snapshot)]}})})}function Vd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return i=j(e),o=i.Po.get(t),(s=i.Vo.get(o.targetId)).length>1?[2,(i.Vo.set(o.targetId,s.filter(function(u){return!Bi(u,t)})),void i.Po.delete(t))]:i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)?[3,2]:[4,ei(i.localStore,o.targetId,!1).then(function(){i.sharedClientState.clearQueryState(o.targetId),eo(i.remoteStore,o.targetId),si(i,o.targetId)}).catch(tr)]):[3,3];case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return si(i,o.targetId),[4,ei(i.localStore,o.targetId,!0)];case 4:a.sent(),a.label=5;case 5:return[2]}})})}function jd(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:o=Oa(e),c.label=1;case 1:return c.trys.push([1,5,,6]),[4,(l=o.localStore,d=t,y=j(l),w=te.now(),C=d.reduce(function(E,R){return E.add(R.key)},st()),y.persistence.runTransaction("Locally write mutations","readwrite",function(E){return y.Mn.pn(E,C).next(function(R){p=R;for(var L=[],V=0,H=d;V<H.length;V++){var J=H[V],tt=hf(J,p.get(J.key));null!=tt&&L.push(new pn(J.key,tt,Gu(tt.value.mapValue),zt.exists(!0)))}return y._n.addMutationBatch(E,w,L,d)})}).then(function(E){return E.applyToLocalDocumentSet(p),{batchId:E.batchId,changes:p}}))];case 2:return s=c.sent(),o.sharedClientState.addPendingMutation(s.batchId),function(l,d,p){var y=l.xo[l.currentUser.toKey()];y||(y=new Kt(et)),y=y.insert(d,p),l.xo[l.currentUser.toKey()]=y}(o,s.batchId,i),[4,He(o,s.changes)];case 3:return c.sent(),[4,ri(o.remoteStore)];case 4:return c.sent(),[3,6];case 5:return a=c.sent(),u=oi(a,"Failed to persist write"),i.reject(u),[3,6];case 6:return[2]}var l,d,p,y,w,C})})}function Rl(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o;return(0,m.Jh)(this,function(s){switch(s.label){case 0:i=j(e),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,$f(i.localStore,t)];case 2:return o=s.sent(),t.targetChanges.forEach(function(a,u){var c=i.Co.get(u);c&&(Y(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?c.bo=!0:a.modifiedDocuments.size>0?Y(c.bo):a.removedDocuments.size>0&&(Y(c.bo),c.bo=!1))}),[4,He(i,o,t)];case 3:return s.sent(),[3,6];case 4:return[4,tr(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}})})}function Dl(e,t,i){var o=j(e);if(o.isPrimaryClient&&0===i||!o.isPrimaryClient&&1===i){var s=[];o.Po.forEach(function(a,u){var c=u.view.zr(t);c.snapshot&&s.push(c.snapshot)}),function(a,u){var c=j(a);c.onlineState=u;var l=!1;c.queries.forEach(function(d,p){for(var y=0,w=p.listeners;y<w.length;y++)w[y].zr(u)&&(l=!0)}),l&&Aa(c)}(o.eventManager,t),s.length&&o.vo._r(s),o.onlineState=t,o.isPrimaryClient&&o.sharedClientState.setOnlineState(t)}}function Bd(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l;return(0,m.Jh)(this,function(d){switch(d.label){case 0:return(o=j(e)).sharedClientState.updateQueryState(t,"rejected",i),s=o.Co.get(t),(a=s&&s.key)?(u=(u=new Kt(K.comparator)).insert(a,qt.newNoDocument(a,$.min())),c=st().add(a),l=new ra($.min(),new Map,new kt(et),u,c),[4,Rl(o,l)]):[3,2];case 1:return d.sent(),o.Do=o.Do.remove(a),o.Co.delete(t),Na(o),[3,4];case 2:return[4,ei(o.localStore,t,!1).then(function(){return si(o,t,i)}).catch(tr)];case 3:d.sent(),d.label=4;case 4:return[2]}})})}function Gd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:i=j(e),o=t.batch.batchId,a.label=1;case 1:return a.trys.push([1,4,,6]),[4,Yf(i.localStore,t)];case 2:return s=a.sent(),Da(i,o,null),Ra(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),[4,He(i,s)];case 3:return a.sent(),[3,6];case 4:return[4,tr(a.sent())];case 5:return a.sent(),[3,6];case 6:return[2]}})})}function zd(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:o=j(e),a.label=1;case 1:return a.trys.push([1,4,,6]),[4,(u=o.localStore,c=t,l=j(u),l.persistence.runTransaction("Reject batch","readwrite-primary",function(d){var p;return l._n.lookupMutationBatch(d,c).next(function(y){return Y(null!==y),p=y.keys(),l._n.removeMutationBatch(d,y)}).next(function(){return l._n.performConsistencyCheck(d)}).next(function(){return l.Mn.pn(d,p)})}))];case 2:return s=a.sent(),Da(o,t,i),Ra(o,t),o.sharedClientState.updateMutationState(t,"rejected",i),[4,He(o,s)];case 3:return a.sent(),[3,6];case 4:return[4,tr(a.sent())];case 5:return a.sent(),[3,6];case 6:return[2]}var u,c,l})})}function Kd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:_n((i=j(e)).remoteStore)||U("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(l=i.localStore,d=j(l),d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(p){return d._n.getHighestUnacknowledgedBatchId(p)}))];case 2:return-1===(o=c.sent())?[2,void t.resolve()]:((s=i.ko.get(o)||[]).push(t),i.ko.set(o,s),[3,4]);case 3:return a=c.sent(),u=oi(a,"Initialization of waitForPendingWrites() operation failed"),t.reject(u),[3,4];case 4:return[2]}var l,d})})}function Ra(e,t){(e.ko.get(t)||[]).forEach(function(i){i.resolve()}),e.ko.delete(t)}function Da(e,t,i){var o=j(e),s=o.xo[o.currentUser.toKey()];if(s){var a=s.get(t);a&&(i?a.reject(i):a.resolve(),s=s.remove(t)),o.xo[o.currentUser.toKey()]=s}}function si(e,t,i){void 0===i&&(i=null),e.sharedClientState.removeLocalQueryTarget(t);for(var o=0,s=e.Vo.get(t);o<s.length;o++){var a=s[o];e.Po.delete(a),i&&e.vo.Mo(a,i)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(u){e.No.containsKey(u)||Pl(e,u)})}function Pl(e,t){e.So.delete(t.path.canonicalString());var i=e.Do.get(t);null!==i&&(eo(e.remoteStore,i),e.Do=e.Do.remove(t),e.Co.delete(i),Na(e))}function Pa(e,t,i){for(var o=0,s=i;o<s.length;o++){var a=s[o];a instanceof Al?(e.No.addReference(a.key,t),Hd(e,a)):a instanceof xl?(U("SyncEngine","Document no longer in limbo: "+a.key),e.No.removeReference(a.key,t),e.No.containsKey(a.key)||Pl(e,a.key)):z()}}function Hd(e,t){var i=t.key,o=i.path.canonicalString();e.Do.get(i)||e.So.has(o)||(U("SyncEngine","New document in limbo: "+i),e.So.add(o),Na(e))}function Na(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var i=new K(it.fromString(t)),o=e.Fo.next();e.Co.set(o,new Fd(i)),e.Do=e.Do.insert(i,o),cs(e.remoteStore,new es(ge(qr(i.path)),o,2,se.o))}}function He(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:return o=j(e),s=[],a=[],u=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach(function(l,d){u.push(o.Oo(d,t,i).then(function(p){if(p){o.isPrimaryClient&&o.sharedClientState.updateQueryState(d.targetId,p.fromCache?"not-current":"current"),s.push(p);var y=Wf.Pn(d.targetId,p);a.push(y)}}))}),[4,Promise.all(u)]);case 1:return c.sent(),o.vo._r(s),[4,function(l,d){return(0,m.mG)(this,void 0,void 0,function(){var p,y,w,C,E,R,L,H;return(0,m.Jh)(this,function(J){switch(J.label){case 0:p=j(l),J.label=1;case 1:return J.trys.push([1,3,,4]),[4,p.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(tt){return O.forEach(d,function(rt){return O.forEach(rt.bn,function(at){return p.persistence.referenceDelegate.addReference(tt,rt.targetId,at)}).next(function(){return O.forEach(rt.vn,function(at){return p.persistence.referenceDelegate.removeReference(tt,rt.targetId,at)})})})})];case 2:return J.sent(),[3,4];case 3:if(!Yn(y=J.sent()))throw y;return U("LocalStore","Failed to update sequence numbers: "+y),[3,4];case 4:for(w=0,C=d;w<C.length;w++)R=(E=C[w]).targetId,E.fromCache||(L=p.kn.get(R),H=L.withLastLimboFreeSnapshotVersion(L.snapshotVersion),p.kn=p.kn.insert(R,H));return[2]}})})}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}function Jd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return(i=j(e)).currentUser.isEqual(t)?[3,3]:(U("SyncEngine","User change. New user:",t.toKey()),[4,ol(i.localStore,t)]);case 1:return o=s.sent(),i.currentUser=t,(a=i).ko.forEach(function(c){c.forEach(function(l){l.reject(new N(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),a.ko.clear(),i.sharedClientState.handleUserChange(t,o.removedBatchIds,o.addedBatchIds),[4,He(i,o.Ln)];case 2:s.sent(),s.label=3;case 3:return[2]}var a})})}function Qd(e,t){var i=j(e),o=i.Co.get(t);if(o&&o.bo)return st().add(o.key);var s=st(),a=i.Vo.get(t);if(!a)return s;for(var u=0,c=a;u<c.length;u++){var d=i.Po.get(c[u]);s=s.unionWith(d.view.wo)}return s}function Zd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,as((i=j(e)).localStore,t.query,!0)];case 1:return o=a.sent(),s=t.view.Ao(o),[2,(i.isPrimaryClient&&Pa(i,t.targetId,s.To),s)]}})})}function Wd(e){return(0,m.mG)(this,void 0,void 0,function(){var t;return(0,m.Jh)(this,function(i){return[2,cl((t=j(e)).localStore).then(function(o){return He(t,o)})]})})}function Xd(e,t,i,o){return(0,m.mG)(this,void 0,void 0,function(){var s,a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return[4,(c=(s=j(e)).localStore,l=t,d=j(c),p=j(d._n),d.persistence.runTransaction("Lookup mutation documents","readonly",function(y){return p.jt(y,l).next(function(w){return w?d.Mn.pn(y,w):O.resolve(null)})}))];case 1:return null===(a=u.sent())?[3,6]:"pending"!==i?[3,3]:[4,ri(s.remoteStore)];case 2:return u.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(Da(s,t,o||null),Ra(s,t),function(c,l){j(j(c)._n).Gt(l)}(s.localStore,t)):z(),u.label=4;case 4:return[4,He(s,a)];case 5:return u.sent(),[3,7];case 6:U("SyncEngine","Cannot apply mutation batch with id: "+t),u.label=7;case 7:return[2]}var c,l,d,p})})}function Yd(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s,a,u,l,d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:return Ma(i=j(e)),Oa(i),!0!==t||!0===i.$o?[3,3]:(o=i.sharedClientState.getAllActiveQueryTargets(),[4,Nl(i,o.toArray())]);case 1:return s=p.sent(),i.$o=!0,[4,Ea(i.remoteStore,!0)];case 2:for(p.sent(),a=0,u=s;a<u.length;a++)cs(i.remoteStore,u[a]);return[3,7];case 3:return!1!==t||!1===i.$o?[3,7]:(l=[],d=Promise.resolve(),i.Vo.forEach(function(y,w){i.sharedClientState.isLocalQueryTarget(w)?l.push(w):d=d.then(function(){return si(i,w),ei(i.localStore,w,!0)}),eo(i.remoteStore,w)}),[4,d]);case 4:return p.sent(),[4,Nl(i,l)];case 5:return p.sent(),(w=j(i)).Co.forEach(function(C,E){eo(w.remoteStore,E)}),w.No.ts(),w.Co=new Map,w.Do=new Kt(K.comparator),i.$o=!1,[4,Ea(i.remoteStore,!1)];case 6:p.sent(),p.label=7;case 7:return[2]}var w})})}function Nl(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l,d,p,y,w,E,R,L;return(0,m.Jh)(this,function(V){switch(V.label){case 0:o=j(e),s=[],a=[],u=0,c=t,V.label=1;case 1:return u<c.length?(d=void 0,(p=o.Vo.get(l=c[u]))&&0!==p.length?[4,ti(o.localStore,ge(p[0]))]:[3,7]):[3,13];case 2:d=V.sent(),y=0,w=p,V.label=3;case 3:return y<w.length?(E=o.Po.get(w[y]),[4,Zd(o,E)]):[3,6];case 4:(R=V.sent()).snapshot&&a.push(R.snapshot),V.label=5;case 5:return y++,[3,3];case 6:return[3,11];case 7:return[4,ul(o.localStore,l)];case 8:return L=V.sent(),[4,ti(o.localStore,L)];case 9:return d=V.sent(),[4,ka(o,Ml(L),l,!1)];case 10:V.sent(),V.label=11;case 11:s.push(d),V.label=12;case 12:return u++,[3,1];case 13:return[2,(o.vo._r(a),s)]}})})}function Ml(e){return Qu(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $d(e){var t=j(e);return j(j(t.localStore).persistence).fn()}function tp(e,t,i,o){return(0,m.mG)(this,void 0,void 0,function(){var s,a,u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:return(s=j(e)).$o?(U("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!s.Vo.has(t))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,cl(s.localStore)];case 3:return a=c.sent(),u=ra.createSynthesizedRemoteEventForCurrentChange(t,"current"===i),[4,He(s,a,u)];case 4:return c.sent(),[3,8];case 5:return[4,ei(s.localStore,t,!0)];case 6:return c.sent(),si(s,t,o),[3,8];case 7:z(),c.label=8;case 8:return[2]}})})}function ep(e,t,i){return(0,m.mG)(this,void 0,void 0,function(){var o,s,a,u,c,l,d,p,y;return(0,m.Jh)(this,function(C){switch(C.label){case 0:if(!(o=Ma(e)).$o)return[3,10];s=0,a=t,C.label=1;case 1:return s<a.length?o.Vo.has(u=a[s])?(U("SyncEngine","Adding an already active target "+u),[3,5]):[4,ul(o.localStore,u)]:[3,6];case 2:return c=C.sent(),[4,ti(o.localStore,c)];case 3:return l=C.sent(),[4,ka(o,Ml(c),l.targetId,!1)];case 4:C.sent(),cs(o.remoteStore,l),C.label=5;case 5:return s++,[3,1];case 6:d=function(E){return(0,m.Jh)(this,function(R){switch(R.label){case 0:return o.Vo.has(E)?[4,ei(o.localStore,E,!1).then(function(){eo(o.remoteStore,E),si(o,E)}).catch(tr)]:[3,2];case 1:R.sent(),R.label=2;case 2:return[2]}})},p=0,y=i,C.label=7;case 7:return p<y.length?[5,d(y[p])]:[3,10];case 8:C.sent(),C.label=9;case 9:return p++,[3,7];case 10:return[2]}})})}function Ma(e){var t=j(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Rl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bd.bind(null,t),t.vo._r=Pd.bind(null,t.eventManager),t.vo.Mo=Nd.bind(null,t.eventManager),t}function Oa(e){var t=j(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Gd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=zd.bind(null,t),t}var Ol=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(i){switch(i.label){case 0:return this.R=$i(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return i.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return il(this.persistence,new rl,t.initialUser,this.R)},e.prototype.qo=function(t){return new cd(hd.bs,this.R)},e.prototype.Bo=function(t){return new pl},e.prototype.terminate=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),Ll=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).Qo=i,a.cacheSizeBytes=o,a.forceOwnership=s,a.synchronizeTabs=!1,a}return(0,m.ZT)(t,e),t.prototype.initialize=function(i){return(0,m.mG)(this,void 0,void 0,function(){var o=this;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return s.sent(),[4,ed(this.localStore)];case 2:return s.sent(),[4,this.Qo.initialize(this,i)];case 3:return s.sent(),[4,Oa(this.Qo.syncEngine)];case 4:return s.sent(),[4,ri(this.Qo.remoteStore)];case 5:return s.sent(),[4,this.persistence.He(function(){return o.gcScheduler&&!o.gcScheduler.started&&o.gcScheduler.start(o.localStore),Promise.resolve()})];case 6:return s.sent(),[2]}})})},t.prototype.Ko=function(i){return il(this.persistence,new rl,i.initialUser,this.R)},t.prototype.Uo=function(i){return new Bf(this.persistence.referenceDelegate.garbageCollector,i.asyncQueue)},t.prototype.qo=function(i){var o=pa(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey),s=void 0!==this.cacheSizeBytes?Pe.withCacheSize(this.cacheSizeBytes):Pe.DEFAULT;return new Qf(this.synchronizeTabs,o,i.clientId,s,i.asyncQueue,gl(),us(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(i){return new pl},t}(Ol),rp=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o,!1)||this).Qo=i,s.cacheSizeBytes=o,s.synchronizeTabs=!0,s}return(0,m.ZT)(t,e),t.prototype.initialize=function(i){return(0,m.mG)(this,void 0,void 0,function(){var o,s=this;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return a.sent(),o=this.Qo.syncEngine,this.sharedClientState instanceof ba?(this.sharedClientState.syncEngine={ui:Xd.bind(null,o),ai:tp.bind(null,o),hi:ep.bind(null,o),fn:$d.bind(null,o),ci:Wd.bind(null,o)},[4,this.sharedClientState.start()]):[3,3];case 2:a.sent(),a.label=3;case 3:return[4,this.persistence.He(function(u){return(0,m.mG)(s,void 0,void 0,function(){return(0,m.Jh)(this,function(c){switch(c.label){case 0:return[4,Yd(this.Qo.syncEngine,u)];case 1:return c.sent(),this.gcScheduler&&(u&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):u||this.gcScheduler.stop()),[2]}})})})];case 4:return a.sent(),[2]}})})},t.prototype.Bo=function(i){var o=gl();if(!ba.yt(o))throw new N(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var s=pa(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey);return new ba(o,i.asyncQueue,s,i.clientId,i.initialUser)},t}(Ll),La=function(){function e(){}return e.prototype.initialize=function(t,i){return(0,m.mG)(this,void 0,void 0,function(){var o=this;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(a){return Dl(o.syncEngine,a,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Jd.bind(null,this.syncEngine),[4,Ea(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:s.sent(),s.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new Dd},e.prototype.createDatastore=function(t){var o=$i(t.databaseInfo.databaseId),s=new gd(t.databaseInfo);return new bd(t.credentials,s,o)},e.prototype.createRemoteStore=function(t){var i,o,s,a,u,c=this;return i=this.localStore,o=this.datastore,s=t.asyncQueue,a=function(l){return Dl(c.syncEngine,l,0)},u=ml.yt()?new ml:new dd,new wd(i,o,s,a,u)},e.prototype.createSyncEngine=function(t,i){return d=i,p=new Ud(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions),d&&(p.$o=!0),p;var d,p},e.prototype.terminate=function(){return function(t){return(0,m.mG)(this,void 0,void 0,function(){var i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return i=j(t),U("RemoteStore","RemoteStore shutting down."),i.Or.add(5),[4,ni(i)];case 1:return o.sent(),i.Lr.shutdown(),i.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}(),fs=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,i){var o=this;this.muted||setTimeout(function(){o.muted||t(i)},0)},e}(),op=(function(){function e(t,i){var o=this;this.Go=t,this.R=i,this.metadata=new Jt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(s){s&&s.io()?o.metadata.resolve(s.payload.metadata):o.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==s?void 0:s.payload)))},function(s){return o.metadata.reject(s)})}e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i,o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,this.Jo()];case 1:return null===(t=a.sent())?[2,null]:(i=this.zo.decode(t),o=Number(i),isNaN(o)&&this.Yo("length string ("+i+") is not valid number"),[4,this.Xo(o)]);case 2:return s=a.sent(),[2,new Md(JSON.parse(s),t.length+o)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(o.sent())return[3,3];o.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),i=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),i)])}})})},e.prototype.Xo=function(t){return(0,m.mG)(this,void 0,void 0,function(){var i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:o.sent()&&this.Yo("Reached the end of bundle when more is expected."),o.label=2;case 2:return[3,0];case 3:return i=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),i)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return[4,this.Go.read()];case 1:return(t=o.sent()).done||((i=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),i.set(t.value,this.buffer.length),this.buffer=i),[2,t.done]}})})}}(),function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return(0,m.mG)(this,void 0,void 0,function(){var i,o=this;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new N(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(a,u){return(0,m.mG)(this,void 0,void 0,function(){var c,l,d,p,y,w;return(0,m.Jh)(this,function(C){switch(C.label){case 0:return c=j(a),l=Zi(c.R)+"/documents",d={documents:u.map(function(E){return Qi(c.R,E)})},[4,c.$i("BatchGetDocuments",l,d)];case 1:return p=C.sent(),y=new Map,p.forEach(function(E){var L,V,R=(L=c.R,"found"in(V=E)?function(H,J){Y(!!J.found);var tt=Re(H,J.found.name),rt=Mt(J.found.updateTime),at=new ae({mapValue:{fields:J.found.fields}});return qt.newFoundDocument(tt,rt,at)}(L,V):"missing"in V?function(H,J){Y(!!J.missing),Y(!!J.readTime);var tt=Re(H,J.missing),rt=Mt(J.readTime);return qt.newNoDocument(tt,rt)}(L,V):z());y.set(R.key.toString(),R)}),w=[],[2,(u.forEach(function(E){var R=y.get(E.toString());Y(!!R),w.push(R)}),w)]}})})}(this.datastore,t)];case 1:return[2,((i=s.sent()).forEach(function(a){return o.recordVersion(a)}),i)]}})})},e.prototype.set=function(t,i){this.write(i.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,i){try{this.write(i.toMutation(t,this.preconditionForUpdate(t)))}catch(o){this.lastWriteError=o}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new Hi(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i=this;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(s){t.delete(s.key.toString())}),t.forEach(function(s,a){var u=K.fromPath(a);i.mutations.push(new ea(u,i.precondition(u)))}),[4,function(s,a){return(0,m.mG)(this,void 0,void 0,function(){var u,c,l;return(0,m.Jh)(this,function(d){switch(d.label){case 0:return u=j(s),c=Zi(u.R)+"/documents",l={writes:a.map(function(p){return ts(u.R,p)})},[4,u.Ni("Commit",c,l)];case 1:return d.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return o.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var i;if(t.isFoundDocument())i=t.version;else{if(!t.isNoDocument())throw z();i=$.min()}var o=this.readVersions.get(t.key.toString());if(o){if(!i.isEqual(o))throw new N(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),i)},e.prototype.precondition=function(t){var i=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&i?zt.updateTime(i):zt.none()},e.prototype.preconditionForUpdate=function(t){var i=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&i){if(i.isEqual($.min()))throw new N(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return zt.updateTime(i)}return zt.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}()),sp=function(){function e(t,i,o,s){this.asyncQueue=t,this.datastore=i,this.updateFunction=o,this.deferred=s,this.ec=5,this.Zi=new _a(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,m.mG)(t,void 0,void 0,function(){var i,o,s=this;return(0,m.Jh)(this,function(a){return i=new op(this.datastore),(o=this.sc(i))&&o.then(function(u){s.asyncQueue.enqueueAndForget(function(){return i.commit().then(function(){s.deferred.resolve(u)}).catch(function(c){s.ic(c)})})}).catch(function(u){s.ic(u)}),[2]})})})},e.prototype.sc=function(t){try{var i=this.updateFunction(t);return!Jn(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(o){return this.deferred.reject(o),null}},e.prototype.ic=function(t){var i=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return i.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if("FirebaseError"===t.name){var i=t.code;return"aborted"===i||"failed-precondition"===i||!hc(i)}return!1},e}(),ap=function(){function e(t,i,o){var s=this;this.credentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=jt.UNAUTHENTICATED,this.clientId=Nu.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(i,function(a){return(0,m.mG)(s,void 0,void 0,function(){return(0,m.Jh)(this,function(u){switch(u.label){case 0:return U("FirestoreClient","Received user=",a.uid),[4,this.credentialListener(a)];case 1:return u.sent(),this.user=a,[2]}})})})}return e.prototype.getConfiguration=function(){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new N(x.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var i=new Jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,m.mG)(t,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:a.sent(),a.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:a.sent(),a.label=4;case 4:return this.credentials.removeChangeListener(),i.resolve(),[3,6];case 5:return o=a.sent(),s=oi(o,"Failed to shutdown persistence"),i.reject(s),[3,6];case 6:return[2]}})})}),i.promise},e}();function Ul(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o,s=this;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return e.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return i=a.sent(),[4,t.initialize(i)];case 2:return a.sent(),o=i.initialUser,e.setCredentialChangeListener(function(u){return(0,m.mG)(s,void 0,void 0,function(){return(0,m.Jh)(this,function(c){switch(c.label){case 0:return o.isEqual(u)?[3,2]:[4,ol(t.localStore,u)];case 1:c.sent(),o=u,c.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function ql(e,t){return(0,m.mG)(this,void 0,void 0,function(){var i,o;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,Fa(e)];case 1:return i=s.sent(),U("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return o=s.sent(),[4,t.initialize(i,o)];case 3:return s.sent(),e.setCredentialChangeListener(function(a){return function(u,c){return(0,m.mG)(this,void 0,void 0,function(){var l,d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:return(l=j(u)).asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials"),d=_n(l),l.Or.add(3),[4,ni(l)];case 1:return p.sent(),d&&l.Br.set("Unknown"),[4,l.remoteSyncer.handleCredentialChange(c)];case 2:return p.sent(),l.Or.delete(3),[4,to(l)];case 3:return p.sent(),[2]}})})}(t.remoteStore,a)}),e.onlineComponents=t,[2]}})})}function Fa(e){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(U("FirestoreClient","Using default OfflineComponentProvider"),[4,Ul(e,new Ol)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function ds(e){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(U("FirestoreClient","Using default OnlineComponentProvider"),[4,ql(e,new La)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Vl(e){return Fa(e).then(function(t){return t.persistence})}function Ua(e){return Fa(e).then(function(t){return t.localStore})}function jl(e){return ds(e).then(function(t){return t.remoteStore})}function qa(e){return ds(e).then(function(t){return t.syncEngine})}function ai(e){return(0,m.mG)(this,void 0,void 0,function(){var t,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return[4,ds(e)];case 1:return t=o.sent(),[2,((i=t.eventManager).onListen=qd.bind(null,t.syncEngine),i.onUnlisten=Vd.bind(null,t.syncEngine),i)]}})})}function Bl(e,t,i){var o=this;void 0===i&&(i={});var s=new Jt;return e.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(o,void 0,void 0,function(){var a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return a=function(c,l,d,p,y){var w=new fs({next:function(E){l.enqueueAndForget(function(){return Sa(c,C)});var R=E.docs.has(d);!R&&E.fromCache?y.reject(new N(x.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&E.fromCache&&p&&"server"===p.source?y.reject(new N(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):y.resolve(E)},error:function(E){return y.reject(E)}}),C=new xa(qr(d.path),w,{includeMetadataChanges:!0,so:!0});return Ca(c,C)},[4,ai(e)];case 1:return[2,a.apply(void 0,[u.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}function Gl(e,t,i){var o=this;void 0===i&&(i={});var s=new Jt;return e.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(o,void 0,void 0,function(){var a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return a=function(c,l,d,p,y){var w=new fs({next:function(E){l.enqueueAndForget(function(){return Sa(c,C)}),E.fromCache&&"server"===p.source?y.reject(new N(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):y.resolve(E)},error:function(E){return y.reject(E)}}),C=new xa(d,w,{includeMetadataChanges:!0,so:!0});return Ca(c,C)},[4,ai(e)];case 1:return[2,a.apply(void 0,[u.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}var up=function(e,t,i,o,s,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.useFetchStreams=c},ps=function(){function e(t,i){this.projectId=t,this.database=i||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),zl=new Map,Kl=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Hl=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){this.changeListener=i,t.enqueueRetryable(function(){return i(jt.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),cp=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){var o=this;this.changeListener=i,t.enqueueRetryable(function(){return i(o.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),lp=function(){function e(t){var i=this;this.currentUser=jt.UNAUTHENTICATED,this.oc=new Jt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){i.cc++,i.currentUser=i.ac(),i.oc.resolve(),i.changeListener&&i.asyncQueue.enqueueRetryable(function(){return i.changeListener(i.currentUser)})};var o=function(s){U("FirebaseCredentialsProvider","Auth detected"),i.auth=s,i.auth.addAuthTokenListener(i.uc)};t.onInit(function(s){return o(s)}),setTimeout(function(){if(!i.auth){var s=t.getImmediate({optional:!0});s?o(s):(U("FirebaseCredentialsProvider","Auth not yet detected"),i.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,i=this.cc,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(function(s){return t.cc!==i?(U("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):s?(Y("string"==typeof s.accessToken),new Kl(s.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,i){var o=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,m.mG)(o,void 0,void 0,function(){return(0,m.Jh)(this,function(s){switch(s.label){case 0:return[4,this.oc.promise];case 1:return s.sent(),[4,i(this.currentUser)];case 2:return s.sent(),this.changeListener=i,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Y(null===t||"string"==typeof t),new jt(t)},e}(),hp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o,this.type="FirstParty",this.user=jt.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},i=this.hc.auth.getAuthHeaderValueForFirstParty([]);return i&&(t.Authorization=i),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),fp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o}return e.prototype.getToken=function(){return Promise.resolve(new hp(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,i){t.enqueueRetryable(function(){return i(jt.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();function Va(e,t,i){if(!i)throw new N(x.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function ja(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new N(x.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Jl(e,t,i,o){if(!0===t&&!0===o)throw new N(x.INVALID_ARGUMENT,e+" and "+i+" cannot be used together.")}function Ql(e){if(!K.isDocumentKey(e))throw new N(x.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Zl(e){if(K.isDocumentKey(e))throw new N(x.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function ms(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(i){if(i.constructor){var o=/function\s+([^\s(]+)\s*\(/.exec(i.constructor.toString());if(o&&o.length>1)return o[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return"function"==typeof e?"a function":z()}function ot(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new N(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var i=ms(e);throw new N(x.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+i)}return e}function Wl(e,t){if(t<=0)throw new N(x.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var Xl=function(){function e(t){var i;if(void 0===t.host){if(void 0!==t.ssl)throw new N(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(i=t.ssl)||void 0===i||i;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new N(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Jl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),no=function(){function e(t,i){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xl({}),this._settingsFrozen=!1,t instanceof ps?(this._databaseId=t,this._credentials=new Hl):(this._app=t,this._databaseId=function(o){if(!Object.prototype.hasOwnProperty.apply(o.options,["projectId"]))throw new N(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ps(o.options.projectId)}(t),this._credentials=new lp(i))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new N(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new N(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xl(t),void 0!==t.credentials&&(this._credentials=function(i){if(!i)return new Hl;switch(i.type){case"gapi":var o=i.client;return Y(!("object"!=typeof o||null===o||!o.auth||!o.auth.getAuthHeaderValueForFirstParty)),new fp(o,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new N(x.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return(i=zl.get(this))&&(U("ComponentProvider","Removing Datastore"),zl.delete(this),i.terminate()),Promise.resolve();var i},e}(),pt=function(){function e(t,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Tn(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),re=function(){function e(t,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),Tn=function(e){function t(i,o,s){var a=this;return(a=e.call(this,i,o,qr(s))||this)._path=s,a.type="collection",a}return(0,m.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._path.popLast();return i.isEmpty()?null:new pt(this.firestore,null,new K(i))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(i){return new t(this.firestore,i,this._path)},t}(re);function Yl(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,v.m9)(e),Va("collection","path",t),e instanceof no)return Zl(i=it.fromString.apply(it,(0,m.ev)([t],o))),new Tn(e,null,i);if(!(e instanceof pt||e instanceof Tn))throw new N(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zl(i=it.fromString.apply(it,(0,m.ev)([e.path],o)).child(it.fromString(t))),new Tn(e.firestore,null,i)}function gs(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,v.m9)(e),1===arguments.length&&(t=Nu.u()),Va("doc","path",t),e instanceof no)return Ql(i=it.fromString.apply(it,(0,m.ev)([t],o))),new pt(e,null,new K(i));if(!(e instanceof pt||e instanceof Tn))throw new N(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ql(i=e._path.child(it.fromString.apply(it,(0,m.ev)([t],o)))),new pt(e.firestore,e instanceof Tn?e.converter:null,new K(i))}function $l(e,t){return e=(0,v.m9)(e),t=(0,v.m9)(t),(e instanceof pt||e instanceof Tn)&&(t instanceof pt||t instanceof Tn)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function th(e,t){return e=(0,v.m9)(e),t=(0,v.m9)(t),e instanceof re&&t instanceof re&&e.firestore===t.firestore&&Bi(e._query,t._query)&&e.converter===t.converter}var dp=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new _a(this,"async_queue_retry"),this.Ic=function(){var o=us();o&&U("AsyncQueue","Visibility state changed to "+o.visibilityState),t.Zi.Gi()};var i=us();i&&"function"==typeof i.addEventListener&&i.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var i=us();i&&"function"==typeof i.removeEventListener&&i.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var i=this;if(this.Ac(),this._c)return new Promise(function(){});var o=new Jt;return this.Rc(function(){return i._c&&i.Ec?Promise.resolve():(t().then(o.resolve,o.reject),o.promise)}).then(function(){return o.promise})},e.prototype.enqueueRetryable=function(t){var i=this;this.enqueueAndForget(function(){return i.wc.push(t),i.bc()})},e.prototype.bc=function(){return(0,m.mG)(this,void 0,void 0,function(){var t,i=this;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if(0===this.wc.length)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return o.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Yn(t=o.sent()))throw t;return U("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return i.bc()}),o.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var i=this,o=this.dc.then(function(){return i.gc=!0,t().catch(function(s){throw i.yc=s,i.gc=!1,Et("INTERNAL UNHANDLED ERROR: ",(u=(a=s).message||"",a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u)),s;var a,u}).then(function(s){return i.gc=!1,s})});return this.dc=o,o},e.prototype.enqueueAfterDelay=function(t,i,o){var s=this;this.Ac(),this.Tc.indexOf(t)>-1&&(i=0);var a=kd.createAndSchedule(this,t,i,o,function(u){return s.vc(u)});return this.mc.push(a),a},e.prototype.Ac=function(){this.yc&&z()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return(0,m.mG)(this,void 0,void 0,function(){var t;return(0,m.Jh)(this,function(i){switch(i.label){case 0:return[4,t=this.dc];case 1:i.sent(),i.label=2;case 2:if(t!==this.dc)return[3,0];i.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var i=0,o=this.mc;i<o.length;i++)if(o[i].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var i=this;return this.Pc().then(function(){i.mc.sort(function(u,c){return u.targetTimeMs-c.targetTimeMs});for(var o=0,s=i.mc;o<s.length;o++){var a=s[o];if(a.skipDelay(),"all"!==t&&a.timerId===t)break}return i.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var i=this.mc.indexOf(t);this.mc.splice(i,1)},e}();function ui(e){return function(t,i){if("object"!=typeof t||null===t)return!1;for(var o=t,s=0,a=["next","error","complete"];s<a.length;s++){var u=a[s];if(u in o&&"function"==typeof o[u])return!0}return!1}(e)}!function(){function e(){this._progressObserver={},this._taskCompletionResolver=new Jt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}e.prototype.onProgress=function(t,i,o){this._progressObserver={next:t,error:i,complete:o}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,i){return this._taskCompletionResolver.promise.then(t,i)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var bt=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).type="firestore",s._queue=new dp,s._persistenceKey="name"in i?i.name:"[DEFAULT]",s}return(0,m.ZT)(t,e),t.prototype._terminate=function(){return this._firestoreClient||eh(this),this._firestoreClient.terminate()},t}(no);function Lt(e){return e._firestoreClient||eh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function eh(e){var t,a,c,i=e._freezeSettings(),o=(a=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new up(e._databaseId,a,e._persistenceKey,(c=i).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,c.useFetchStreams));e._firestoreClient=new ap(e._credentials,e._queue,o)}function nh(e,t,i){var o=this,s=new Jt;return e.asyncQueue.enqueue(function(){return(0,m.mG)(o,void 0,void 0,function(){var a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),[4,Ul(e,i)];case 1:return u.sent(),[4,ql(e,t)];case 2:return u.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(c=a=u.sent()).name?c.code===x.FAILED_PRECONDITION||c.code===x.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&c instanceof DOMException)||22===c.code||20===c.code||11===c.code))throw a;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),s.reject(a),[3,4];case 4:return[2]}var c})})}).then(function(){return s.promise})}function rh(e){if(e._initialized||e._terminated)throw new N(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ne=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var o=0;o<t.length;++o)if(0===t[o].length)throw new N(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),er=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(Qt.fromBase64String(t))}catch(i){throw new N(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}},e.fromUint8Array=function(t){return new e(Qt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),nr=function(e){this._methodName=e},vs=function(){function e(t,i){if(!isFinite(t)||t<-90||t>90)throw new N(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new N(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return et(this._lat,t._lat)||et(this._long,t._long)},e}(),gp=/^__.*__$/,vp=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return null!==this.fieldMask?new pn(t,this.data,this.fieldMask,i,this.fieldTransforms):new Ki(t,this.data,i,this.fieldTransforms)},e}(),ih=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return new pn(t,this.data,this.fieldMask,i,this.fieldTransforms)},e}();function oh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var sh=function(){function e(t,i,o,s,a,u){this.settings=t,this.databaseId=i,this.R=o,this.ignoreUndefinedProperties=s,void 0===a&&this.Cc(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.$c(t),s},e.prototype.Oc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.Cc(),s},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return bs(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(i){return t.isPrefixOf(i)})||void 0!==this.fieldTransforms.find(function(i){return t.isPrefixOf(i.field)})},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(oh(this.Nc)&&gp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),yp=function(){function e(t,i,o){this.databaseId=t,this.ignoreUndefinedProperties=i,this.R=o||$i(t)}return e.prototype.Uc=function(t,i,o,s){return void 0===s&&(s=!1),new sh({Nc:t,methodName:i,qc:o,path:Te.emptyPath(),Fc:!1,Bc:s},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function rr(e){var t=e._freezeSettings(),i=$i(e._databaseId);return new yp(e._databaseId,!!t.ignoreUndefinedProperties,i)}function ys(e,t,i,o,s,a){void 0===a&&(a={});var u=e.Uc(a.merge||a.mergeFields?2:0,t,i,s);Ka("Data must be an object, but it was:",u,o);var c,l,d=ch(o,u);if(a.merge)c=new Or(u.fieldMask),l=u.fieldTransforms;else if(a.mergeFields){for(var p=[],y=0,w=a.mergeFields;y<w.length;y++){var C=Ha(t,w[y],i);if(!u.contains(C))throw new N(x.INVALID_ARGUMENT,"Field '"+C+"' is specified in your field mask but missing from your input data.");hh(p,C)||p.push(C)}c=new Or(p),l=u.fieldTransforms.filter(function(E){return c.covers(E.field)})}else c=null,l=u.fieldTransforms;return new vp(new ae(d),c,l)}var Ba=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype._toFieldTransform=function(i){if(2!==i.Nc)throw i.Lc(1===i.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return i.fieldMask.push(i.path),null},t.prototype.isEqual=function(i){return i instanceof t},t}(nr);function ah(e,t,i){return new sh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:i},t.databaseId,t.R,t.ignoreUndefinedProperties)}var bp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype._toFieldTransform=function(i){return new zi(i.path,new jr)},t.prototype.isEqual=function(i){return i instanceof t},t}(nr),_p=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,m.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=ah(this,i,!0),s=this.Kc.map(function(u){return ir(u,o)}),a=new Zn(s);return new zi(i.path,a)},t.prototype.isEqual=function(i){return this===i},t}(nr),wp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,m.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=ah(this,i,!0),s=this.Kc.map(function(u){return ir(u,o)}),a=new Wn(s);return new zi(i.path,a)},t.prototype.isEqual=function(i){return this===i},t}(nr),Tp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Qc=o,s}return(0,m.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=new Br(i.R,tc(i.R,this.Qc));return new zi(i.path,o)},t.prototype.isEqual=function(i){return this===i},t}(nr);function Ga(e,t,i,o){var s=e.Uc(1,t,i);Ka("Data must be an object, but it was:",s,o);var a=[],u=ae.empty();Hn(o,function(l,d){var p=Ja(t,l,i);d=(0,v.m9)(d);var y=s.Oc(p);if(d instanceof Ba)a.push(p);else{var w=ir(d,y);null!=w&&(a.push(p),u.set(p,w))}});var c=new Or(a);return new ih(u,c,s.fieldTransforms)}function za(e,t,i,o,s,a){var u=e.Uc(1,t,i),c=[Ha(t,o,i)],l=[s];if(a.length%2!=0)throw new N(x.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var d=0;d<a.length;d+=2)c.push(Ha(t,a[d])),l.push(a[d+1]);for(var p=[],y=ae.empty(),w=c.length-1;w>=0;--w)if(!hh(p,c[w])){var C=c[w],E=l[w];E=(0,v.m9)(E);var R=u.Oc(C);if(E instanceof Ba)p.push(C);else{var L=ir(E,R);null!=L&&(p.push(C),y.set(C,L))}}var V=new Or(p);return new ih(y,V,u.fieldTransforms)}function uh(e,t,i,o){return void 0===o&&(o=!1),ir(i,e.Uc(o?4:3,t))}function ir(e,t){if(lh(e=(0,v.m9)(e)))return Ka("Unsupported field value:",t,e),ch(e,t);if(e instanceof nr)return function(i,o){if(!oh(o.Nc))throw o.Lc(i._methodName+"() can only be used with update() and set()");if(!o.path)throw o.Lc(i._methodName+"() is not currently supported inside arrays");var s=i._toFieldTransform(o);s&&o.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(i,o){for(var s=[],a=0,u=0,c=i;u<c.length;u++){var l=ir(c[u],o.Mc(a));null==l&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(e,t)}return function(i,o){if(null===(i=(0,v.m9)(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof i)return tc(o.R,i);if("boolean"==typeof i)return{booleanValue:i};if("string"==typeof i)return{stringValue:i};if(i instanceof Date){var s=te.fromDate(i);return{timestampValue:Ji(o.R,s)}}if(i instanceof te)return s=new te(i.seconds,1e3*Math.floor(i.nanoseconds/1e3)),{timestampValue:Ji(o.R,s)};if(i instanceof vs)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof er)return{bytesValue:_c(o.R,i._byteString)};if(i instanceof pt){var a=i.firestore._databaseId;if(!a.isEqual(s=o.databaseId))throw o.Lc("Document reference is for database "+a.projectId+"/"+a.database+" but should be for database "+s.projectId+"/"+s.database);return{referenceValue:oa(i.firestore._databaseId||o.databaseId,i._key.path)}}throw o.Lc("Unsupported field value: "+ms(i))}(e,t)}function ch(e,t){var i={};return Lu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Hn(e,function(o,s){var a=ir(s,t.kc(o));null!=a&&(i[o]=a)}),{mapValue:{fields:i}}}function lh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof te||e instanceof vs||e instanceof er||e instanceof pt||e instanceof nr)}function Ka(e,t,i){if(!lh(i)||"object"!=typeof(s=i)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){var o=ms(i);throw t.Lc("an object"===o?e+" a custom object":e+" "+o)}var s}function Ha(e,t,i){if((t=(0,v.m9)(t))instanceof Ne)return t._internalPath;if("string"==typeof t)return Ja(e,t);throw bs("Field path arguments must be of type string or FieldPath.",e,!1,void 0,i)}var Ip=new RegExp("[~\\*/\\[\\]]");function Ja(e,t,i){if(t.search(Ip)>=0)throw bs("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,i);try{return(new(Ne.bind.apply(Ne,(0,m.ev)([void 0],t.split(".")))))._internalPath}catch(o){throw bs("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,i)}}function bs(e,t,i,o,s){var a=o&&!o.isEmpty(),u=void 0!==s,c="Function "+t+"() called with invalid data";i&&(c+=" (via `toFirestore()`)");var l="";return(a||u)&&(l+=" (found",a&&(l+=" in field "+o),u&&(l+=" in document "+s),l+=")"),new N(x.INVALID_ARGUMENT,(c+=". ")+e+l)}function hh(e,t){return e.some(function(i){return i.isEqual(t)})}var ro=function(){function e(t,i,o,s,a){this._firestore=t,this._userDataWriter=i,this._key=o,this._document=s,this._converter=a}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new pt(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return null!==this._document},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Ep(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var i=this._document.data.field(_s("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i)}},e}(),Ep=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(ro);function _s(e,t){return"string"==typeof t?Ja(e,t):t instanceof Ne?t._internalPath:t._delegate._internalPath}var or=function(){function e(t,i){this.hasPendingWrites=t,this.fromCache=i}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),Je=function(e){function t(i,o,s,a,u,c){var l=this;return(l=e.call(this,i,o,s,a,c)||this)._firestore=i,l._firestoreImpl=i,l.metadata=u,l}return(0,m.ZT)(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(i){if(void 0===i&&(i={}),this._document){if(this._converter){var o=new io(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,i)}return this._userDataWriter.convertValue(this._document.data.value,i.serverTimestamps)}},t.prototype.get=function(i,o){if(void 0===o&&(o={}),this._document){var s=this._document.data.field(_s("DocumentSnapshot.get",i));if(null!==s)return this._userDataWriter.convertValue(s,o.serverTimestamps)}},t}(ro),io=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype.data=function(i){return void 0===i&&(i={}),e.prototype.data.call(this,i)},t}(Je),In=function(){function e(t,i,o,s){this._firestore=t,this._userDataWriter=i,this._snapshot=s,this.metadata=new or(s.hasPendingWrites,s.fromCache),this.query=o}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(i){return t.push(i)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,i){var o=this;this._snapshot.docs.forEach(function(s){t.call(i,new io(o._firestore,o._userDataWriter,s.key,s,new or(o._snapshot.mutatedKeys.has(s.key),o._snapshot.fromCache),o.query.converter))})},e.prototype.docChanges=function(t){void 0===t&&(t={});var i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new N(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(o,s){if(o._snapshot.oldDocs.isEmpty()){var a=0;return o._snapshot.docChanges.map(function(c){return{type:"added",doc:new io(o._firestore,o._userDataWriter,c.doc.key,c.doc,new or(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),oldIndex:-1,newIndex:a++}})}var u=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(function(c){return s||3!==c.type}).map(function(c){var l=new io(o._firestore,o._userDataWriter,c.doc.key,c.doc,new or(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),d=-1,p=-1;return 0!==c.type&&(d=u.indexOf(c.doc.key),u=u.delete(c.doc.key)),1!==c.type&&(p=(u=u.add(c.doc)).indexOf(c.doc.key)),{type:Cp(c.type),doc:l,oldIndex:d,newIndex:p}})}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges},e}();function Cp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function fh(e,t){return e instanceof Je&&t instanceof Je?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof In&&t instanceof In&&e._firestore===t._firestore&&th(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function dh(e){if(Jo(e)&&0===e.explicitOrderBy.length)throw new N(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var oo=function(){};function En(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var o=0,s=t;o<s.length;o++){var a=s[o];e=a._apply(e)}return e}var Sp=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).jc=i,a.Wc=o,a.Gc=s,a.type="where",a}return(0,m.ZT)(t,e),t.prototype._apply=function(i){var a,c,o=rr(i.firestore),s=function(a,u,c,l,d,p,y){var w;if(d.isKeyField()){if("array-contains"===p||"array-contains-any"===p)throw new N(x.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+p+"' queries on FieldPath.documentId().");if("in"===p||"not-in"===p){bh(y,p);for(var C=[],E=0,R=y;E<R.length;E++)C.push(yh(l,a,R[E]));w={arrayValue:{values:C}}}else w=yh(l,a,y)}else"in"!==p&&"not-in"!==p&&"array-contains-any"!==p||bh(y,p),w=uh(c,"where",y,"in"===p||"not-in"===p);var V=ue.create(d,p,w);return function(H,J){if(J.g()){var tt=Xs(H);if(null!==tt&&!tt.isEqual(J.field))throw new N(x.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+tt.toString()+"' and '"+J.field.toString()+"'");var rt=Ws(H);null!==rt&&_h(0,J.field,rt)}var at=function(Bt,Xa){for(var lo=0,Ph=Bt.filters;lo<Ph.length;lo++){var Nh=Ph[lo];if(Xa.indexOf(Nh.op)>=0)return Nh.op}return null}(H,function(Bt){switch(Bt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(J.op));if(null!==at)throw new N(x.INVALID_ARGUMENT,at===J.op?"Invalid query. You cannot use more than one '"+J.op.toString()+"' filter.":"Invalid query. You cannot use '"+J.op.toString()+"' filters with '"+at.toString()+"' filters.")}(a,V),V}(i._query,0,o,i.firestore._databaseId,this.jc,this.Wc,this.Gc);return new re(i.firestore,i.converter,(c=(a=i._query).filters.concat([s]),new Ge(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)))},t}(oo),Ap=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).jc=i,s.zc=o,s.type="orderBy",s}return(0,m.ZT)(t,e),t.prototype._apply=function(i){var s,u,o=function(s,a,u){if(null!==s.startAt)throw new N(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==s.endAt)throw new N(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var c=new Ur(a,u);return function(l,d){if(null===Ws(l)){var p=Xs(l);null!==p&&_h(0,p,d.field)}}(s,c),c}(i._query,this.jc,this.zc);return new re(i.firestore,i.converter,(u=(s=i._query).explicitOrderBy.concat([o]),new Ge(s.path,s.collectionGroup,u,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)))},t}(oo),ph=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Hc=o,a.Jc=s,a}return(0,m.ZT)(t,e),t.prototype._apply=function(i){return new re(i.firestore,i.converter,Zu(i._query,this.Hc,this.Jc))},t}(oo),mh=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Yc=o,a.Xc=s,a}return(0,m.ZT)(t,e),t.prototype._apply=function(i){var s,a,o=vh(i,this.type,this.Yc,this.Xc);return new re(i.firestore,i.converter,(a=o,new Ge((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,a,s.endAt)))},t}(oo),gh=function(e){function t(i,o,s){var a=this;return(a=e.call(this)||this).type=i,a.Yc=o,a.Xc=s,a}return(0,m.ZT)(t,e),t.prototype._apply=function(i){var s,a,o=vh(i,this.type,this.Yc,this.Xc);return new re(i.firestore,i.converter,(a=o,new Ge((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,a)))},t}(oo);function vh(e,t,i,o){if(i[0]=(0,v.m9)(i[0]),i[0]instanceof ro)return function(a,u,c,l,d){if(!l)throw new N(x.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var p=[],y=0,w=Vr(a);y<w.length;y++){var C=w[y];if(C.field.isKeyField())p.push(jo(u,l.key));else{var E=l.data.field(C.field);if(Ks(E))throw new N(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+C.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===E){var R=C.field.canonicalString();throw new N(x.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+R+"' (used as the orderBy) does not exist.")}p.push(E)}}return new ji(p,d)}(e._query,e.firestore._databaseId,t,i[0]._document,o);var s=rr(e.firestore);return function(a,u,c,l,d,p){var y=a.explicitOrderBy;if(d.length>y.length)throw new N(x.INVALID_ARGUMENT,"Too many arguments provided to "+l+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var w=[],C=0;C<d.length;C++){var E=d[C];if(y[C].field.isKeyField()){if("string"!=typeof E)throw new N(x.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+l+"(), but got a "+typeof E);if(!Ys(a)&&-1!==E.indexOf("/"))throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+l+"() must be a plain document ID, but '"+E+"' contains a slash.");var R=a.path.child(it.fromString(E));if(!K.isDocumentKey(R))throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+l+"() must result in a valid document path, but '"+R+"' is not because it contains an odd number of segments.");var L=new K(R);w.push(jo(u,L))}else{var V=uh(c,l,E);w.push(V)}}return new ji(w,p)}(e._query,e.firestore._databaseId,s,t,i,o)}function yh(e,t,i){if("string"==typeof(i=(0,v.m9)(i))){if(""===i)throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ys(t)&&-1!==i.indexOf("/"))throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+i+"' contains a '/' character.");var o=t.path.child(it.fromString(i));if(!K.isDocumentKey(o))throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+o+"' is not because it has an odd number of segments ("+o.length+").");return jo(e,new K(o))}if(i instanceof pt)return jo(e,i._key);throw new N(x.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ms(i)+".")}function bh(e,t){if(!Array.isArray(e)||0===e.length)throw new N(x.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new N(x.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function _h(e,t,i){if(!i.isEqual(t))throw new N(x.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+i.toString()+"' instead.")}var Qa=function(){function e(){}return e.prototype.convertValue=function(t,i){switch(void 0===i&&(i="none"),Qn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(Lr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 10:return this.convertObject(t.mapValue,i);default:throw z()}},e.prototype.convertObject=function(t,i){var o=this,s={};return Hn(t.fields,function(a,u){s[a]=o.convertValue(u,i)}),s},e.prototype.convertGeoPoint=function(t){return new vs(Ct(t.latitude),Ct(t.longitude))},e.prototype.convertArray=function(t,i){var o=this;return(t.values||[]).map(function(s){return o.convertValue(s,i)})},e.prototype.convertServerTimestamp=function(t,i){switch(i){case"previous":var o=Uu(t);return null==o?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(Fi(t));default:return null}},e.prototype.convertTimestamp=function(t){var i=dn(t);return new te(i.seconds,i.nanos)},e.prototype.convertDocumentKey=function(t,i){var o=it.fromString(t);Y(Nc(o));var s=new ps(o.get(1),o.get(3)),a=new K(o.popFirst(5));return s.isEqual(i)||Et("Document "+a+" contains a document reference within a different database ("+s.projectId+"/"+s.database+") which is not supported. It will be treated as a reference in the current database ("+i.projectId+"/"+i.database+") instead."),a},e}();function ws(e,t,i){return e?i&&(i.merge||i.mergeFields)?e.toFirestore(t,i):e.toFirestore(t):t}var xp=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,m.ZT)(t,e),t.prototype.convertBytes=function(i){return new er(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new pt(this.firestore,null,o)},t}(Qa),kp=function(){function e(t,i){this._firestore=t,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=rr(t)}return e.prototype.set=function(t,i,o){this._verifyNotCommitted();var s=Cn(t,this._firestore),a=ws(s.converter,i,o),u=ys(this._dataReader,"WriteBatch.set",s._key,a,null!==s.converter,o);return this._mutations.push(u.toMutation(s._key,zt.none())),this},e.prototype.update=function(t,i,o){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];this._verifyNotCommitted();var u,c=Cn(t,this._firestore);return u="string"==typeof(i=(0,v.m9)(i))||i instanceof Ne?za(this._dataReader,"WriteBatch.update",c._key,i,o,s):Ga(this._dataReader,"WriteBatch.update",c._key,i),this._mutations.push(u.toMutation(c._key,zt.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var i=Cn(t,this._firestore);return this._mutations=this._mutations.concat(new Hi(i._key,zt.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new N(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();function Cn(e,t){if((e=(0,v.m9)(e)).firestore!==t)throw new N(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var sr=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,m.ZT)(t,e),t.prototype.convertBytes=function(i){return new er(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new pt(this.firestore,null,o)},t}(Qa);function wh(e,t,i){e=ot(e,pt);var o=ot(e.firestore,bt),s=ws(e.converter,t,i);return so(o,[ys(rr(o),"setDoc",e._key,s,null!==e.converter,i).toMutation(e._key,zt.none())])}function Th(e,t,i){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];e=ot(e,pt);var a=ot(e.firestore,bt),u=rr(a);return so(a,[("string"==typeof(t=(0,v.m9)(t))||t instanceof Ne?za(u,"updateDoc",e._key,t,i,o):Ga(u,"updateDoc",e._key,t)).toMutation(e._key,zt.exists(!0))])}function Ih(e){for(var t,i,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];e=(0,v.m9)(e);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||ui(s[c])||(u=s[c],c++);var l,d,p,y={includeMetadataChanges:u.includeMetadataChanges};if(ui(s[c])){var w=s[c];s[c]=null===(t=w.next)||void 0===t?void 0:t.bind(w),s[c+1]=null===(i=w.error)||void 0===i?void 0:i.bind(w),s[c+2]=null===(o=w.complete)||void 0===o?void 0:o.bind(w)}if(e instanceof pt)d=ot(e.firestore,bt),p=qr(e._key.path),l={next:function(R){s[c]&&s[c](Za(d,e,R))},error:s[c+1],complete:s[c+2]};else{var C=ot(e,re);d=ot(C.firestore,bt),p=C._query;var E=new sr(d);l={next:function(R){s[c]&&s[c](new In(d,E,C,R))},error:s[c+1],complete:s[c+2]},dh(e._query)}return function(R,L,V,H){var J=this,tt=new fs(H),rt=new xa(L,tt,V);return R.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(J,void 0,void 0,function(){var at;return(0,m.Jh)(this,function(Bt){switch(Bt.label){case 0:return at=Ca,[4,ai(R)];case 1:return[2,at.apply(void 0,[Bt.sent(),rt])]}})})}),function(){tt.Wo(),R.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(J,void 0,void 0,function(){var at;return(0,m.Jh)(this,function(Bt){switch(Bt.label){case 0:return at=Sa,[4,ai(R)];case 1:return[2,at.apply(void 0,[Bt.sent(),rt])]}})})})}}(Lt(d),p,y,l)}function so(e,t){return function(i,o){var s=this,a=new Jt;return i.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(s,void 0,void 0,function(){var u;return(0,m.Jh)(this,function(c){switch(c.label){case 0:return u=jd,[4,qa(i)];case 1:return[2,u.apply(void 0,[c.sent(),o,a])]}})})}),a.promise}(Lt(e),t)}function Za(e,t,i){var o=i.docs.get(t._key),s=new sr(e);return new Je(e,s,t._key,o,new or(i.hasPendingWrites,i.fromCache),t.converter)}var Rp=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this)._firestore=i,s}return(0,m.ZT)(t,e),t.prototype.get=function(i){var o=this,s=Cn(i,this._firestore),a=new sr(this._firestore);return e.prototype.get.call(this,i).then(function(u){return new Je(o._firestore,a,s._key,u._document,new or(!1,!1),s.converter)})},t}(function(){function e(t,i){this._firestore=t,this._transaction=i,this._dataReader=rr(t)}return e.prototype.get=function(t){var i=this,o=Cn(t,this._firestore),s=new xp(this._firestore);return this._transaction.lookup([o._key]).then(function(a){if(!a||1!==a.length)return z();var u=a[0];if(u.isFoundDocument())return new ro(i._firestore,s,u.key,u,o.converter);if(u.isNoDocument())return new ro(i._firestore,s,o._key,null,o.converter);throw z()})},e.prototype.set=function(t,i,o){var s=Cn(t,this._firestore),a=ws(s.converter,i,o),u=ys(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,o);return this._transaction.set(s._key,u),this},e.prototype.update=function(t,i,o){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];var u,c=Cn(t,this._firestore);return u="string"==typeof(i=(0,v.m9)(i))||i instanceof Ne?za(this._dataReader,"Transaction.update",c._key,i,o,s):Ga(this._dataReader,"Transaction.update",c._key,i),this._transaction.update(c._key,u),this},e.prototype.delete=function(t){var i=Cn(t,this._firestore);return this._transaction.delete(i._key),this},e}());function Eh(){if("undefined"==typeof Uint8Array)throw new N(x.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ch(){if("undefined"==typeof atob)throw new N(x.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Sh=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return Ch(),new e(er.fromBase64String(t))},e.fromUint8Array=function(t){return Eh(),new e(er.fromUint8Array(t))},e.prototype.toBase64=function(){return Ch(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return Eh(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),Dp=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,i){return function(o,s){rh(o=ot(o,bt));var a=Lt(o),u=o._freezeSettings(),c=new La;return nh(a,c,new Ll(c,u.cacheSizeBytes,null==s?void 0:s.forceOwnership))}(t._delegate,{forceOwnership:i})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(i){rh(i=ot(i,bt));var o=Lt(i),s=i._freezeSettings(),a=new La;return nh(o,a,new rp(a,s.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(i){var o=this;if(i._initialized&&!i._terminated)throw new N(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var s=new Jt;return i._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,m.mG)(o,void 0,void 0,function(){var a;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,function(c){return(0,m.mG)(this,void 0,void 0,function(){return(0,m.Jh)(this,function(d){switch(d.label){case 0:return Jr.yt()?[4,Jr.delete(c+"main")]:[2,Promise.resolve()];case 1:return d.sent(),[2]}})})}(pa(i._databaseId,i._persistenceKey))];case 1:return u.sent(),s.resolve(),[3,3];case 2:return a=u.sent(),s.reject(a),[3,3];case 3:return[2]}})})}),s.promise}(t._delegate)},e}(),Ah=function(){function e(t,i,o){var s=this;this._delegate=i,this.Zc=o,this.INTERNAL={delete:function(){return s.terminate()}},t instanceof ps||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var i=this._delegate._getSettings();t.merge||i.host===t.host||Li("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},i),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,i,o){void 0===o&&(o={}),function(s,a,u,c){var l;void 0===c&&(c={});var d=(s=ot(s,no))._getSettings();if("firestore.googleapis.com"!==d.host&&d.host!==a&&Li("Host has been set in both settings() and useEmulator(), emulator host will be used"),s._setSettings(Object.assign(Object.assign({},d),{host:a+":"+u,ssl:!1})),c.mockUserToken){var p,y;if("string"==typeof c.mockUserToken)p=c.mockUserToken,y=jt.MOCK_USER;else{p=(0,v.Sg)(c.mockUserToken,null===(l=s._app)||void 0===l?void 0:l.options.projectId);var w=c.mockUserToken.sub||c.mockUserToken.user_id;if(!w)throw new N(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new jt(w)}s._credentials=new cp(new Kl(p,y))}}(this._delegate,t,i,o)},e.prototype.enableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,m.mG)(i,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,Vl(t)];case 1:return o=a.sent(),[4,jl(t)];case 2:return s=a.sent(),[2,(o.setNetworkEnabled(!0),u=s,c=j(u),c.Or.delete(0),to(c))]}var u,c})})})}(Lt(ot(this._delegate,bt)))},e.prototype.disableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,m.mG)(i,void 0,void 0,function(){var o,s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return[4,Vl(t)];case 1:return o=a.sent(),[4,jl(t)];case 2:return s=a.sent(),[2,(o.setNetworkEnabled(!1),function(u){return(0,m.mG)(this,void 0,void 0,function(){var c;return(0,m.Jh)(this,function(l){switch(l.label){case 0:return(c=j(u)).Or.add(0),[4,ni(c)];case 1:return l.sent(),c.Br.set("Offline"),[2]}})})}(s))]}})})})}(Lt(ot(this._delegate,bt)))},e.prototype.enablePersistence=function(t){var i=!1,o=!1;return t&&Jl("synchronizeTabs",i=!!t.synchronizeTabs,"experimentalForceOwningTab",o=!!t.experimentalForceOwningTab),i?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,o)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var i=this,o=new Jt;return t.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(i,void 0,void 0,function(){var s;return(0,m.Jh)(this,function(a){switch(a.label){case 0:return s=Kd,[4,qa(t)];case 1:return[2,s.apply(void 0,[a.sent(),o])]}})})}),o.promise}(Lt(ot(this._delegate,bt)))},e.prototype.onSnapshotsInSync=function(t){return o=t,function(s,a){var u=this,c=new fs(a);return s.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(u,void 0,void 0,function(){var l;return(0,m.Jh)(this,function(d){switch(d.label){case 0:return l=function(p,y){j(p).Gr.add(y),y.next()},[4,ai(s)];case 1:return[2,l.apply(void 0,[d.sent(),c])]}})})}),function(){c.Wo(),s.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(u,void 0,void 0,function(){var l;return(0,m.Jh)(this,function(d){switch(d.label){case 0:return l=function(p,y){j(p).Gr.delete(y)},[4,ai(s)];case 1:return[2,l.apply(void 0,[d.sent(),c])]}})})})}}(Lt(ot(this._delegate,bt)),ui(o)?o:{next:o});var o},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new N(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Es(this,Yl(this._delegate,t))}catch(i){throw Zt(i,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new ar(this,gs(this._delegate,t))}catch(i){throw Zt(i,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new co(this,function(i,o){if(i=ot(i,no),Va("collectionGroup","collection id",o),o.indexOf("/")>=0)throw new N(x.INVALID_ARGUMENT,"Invalid collection ID '"+o+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new re(i,null,(s=o,new Ge(it.emptyPath(),s)));var s}(this._delegate,t))}catch(i){throw Zt(i,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var o,i=this;return function(a,u){var c=this,l=new Jt;return a.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(c,void 0,void 0,function(){var d;return(0,m.Jh)(this,function(p){switch(p.label){case 0:return[4,(y=a,ds(y).then(function(w){return w.datastore}))];case 1:return d=p.sent(),new sp(a.asyncQueue,d,u,l).run(),[2]}var y})})}),l.promise}(Lt(o=this._delegate),function(a){return function(o){return t(new xh(i,o))}(new Rp(o,a))})},e.prototype.batch=function(){var t=this;return Lt(this._delegate),new kh(new kp(this._delegate,function(i){return so(t._delegate,i)}))},e.prototype.loadBundle=function(t){throw new N(x.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new N(x.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),Ts=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,m.ZT)(t,e),t.prototype.convertBytes=function(i){return new Sh(new er(i))},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return ar.eu(o,this.firestore,null)},t}(Qa),xh=function(){function e(t,i){this._firestore=t,this._delegate=i,this._userDataWriter=new Ts(t)}return e.prototype.get=function(t){var i=this,o=ur(t);return this._delegate.get(o).then(function(s){return new ao(i._firestore,new Je(i._firestore._delegate,i._userDataWriter,s._key,s._document,s.metadata,o.converter))})},e.prototype.set=function(t,i,o){var s=ur(t);return o?(ja("Transaction.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,a=[],u=3;u<arguments.length;u++)a[u-3]=arguments[u];var c=ur(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,m.ev)([c,i,o],a)),this},e.prototype.delete=function(t){var i=ur(t);return this._delegate.delete(i),this},e}(),kh=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,i,o){var s=ur(t);return o?(ja("WriteBatch.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,a=[],u=3;u<arguments.length;u++)a[u-3]=arguments[u];var c=ur(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,m.ev)([c,i,o],a)),this},e.prototype.delete=function(t){var i=ur(t);return this._delegate.delete(i),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),Is=function(){function e(t,i,o){this._firestore=t,this._userDataWriter=i,this._delegate=o}return e.prototype.fromFirestore=function(t,i){var o=new io(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new uo(this._firestore,o),null!=i?i:{})},e.prototype.toFirestore=function(t,i){return i?this._delegate.toFirestore(t,i):this._delegate.toFirestore(t)},e.nu=function(t,i){var o=e.su,s=o.get(t);s||o.set(t,s=new WeakMap);var a=s.get(i);return a||(a=new e(t,new Ts(t),i),s.set(i,a)),a},e}();Is.su=new WeakMap;var ar=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new Ts(t)}return e.iu=function(t,i,o){if(t.length%2!=0)throw new N(x.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(i,new pt(i._delegate,o,new K(t)))},e.eu=function(t,i,o){return new e(i,new pt(i._delegate,o,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Es(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Es(this.firestore,Yl(this._delegate,t))}catch(i){throw Zt(i,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=(0,v.m9)(t))instanceof pt&&$l(this._delegate,t)},e.prototype.set=function(t,i){i=ja("DocumentReference.set",i);try{return i?wh(this._delegate,t,i):wh(this._delegate,t)}catch(o){throw Zt(o,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,i){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];try{return 1===arguments.length?Th(this._delegate,t):Th.apply(void 0,(0,m.ev)([this._delegate,t,i],o))}catch(a){throw Zt(a,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return so(ot((t=this._delegate).firestore,bt),[new Hi(t._key,zt.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=Rh(i),a=Dh(i,function(u){return new ao(t.firestore,new Je(t.firestore._delegate,t._userDataWriter,u._key,u._document,u.metadata,t._delegate.converter))});return Ih(this._delegate,s,a)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=ot(o,pt);var s=ot(o.firestore,bt),a=Lt(s),u=new sr(s);return function(c,l){var d=this,p=new Jt;return c.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(d,void 0,void 0,function(){var y;return(0,m.Jh)(this,function(w){switch(w.label){case 0:return y=function(C,E,R){return(0,m.mG)(this,void 0,void 0,function(){var L,V;return(0,m.Jh)(this,function(H){switch(H.label){case 0:return H.trys.push([0,2,,3]),[4,(J=C,tt=E,rt=j(J),rt.persistence.runTransaction("read document","readonly",function(at){return rt.Mn.mn(at,tt)}))];case 1:return(V=H.sent()).isFoundDocument()?R.resolve(V):V.isNoDocument()?R.resolve(null):R.reject(new N(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return L=H.sent(),V=oi(L,"Failed to get document '"+E+" from cache"),R.reject(V),[3,3];case 3:return[2]}var J,tt,rt})})},[4,Ua(c)];case 1:return[2,y.apply(void 0,[w.sent(),l,p])]}})})}),p.promise}(a,o._key).then(function(c){return new Je(s,u,o._key,c,new or(null!==c&&c.hasLocalMutations,!0),o.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=ot(o,pt);var s=ot(o.firestore,bt);return Bl(Lt(s),o._key,{source:"server"}).then(function(a){return Za(s,o,a)})}(this._delegate):function(o){o=ot(o,pt);var s=ot(o.firestore,bt);return Bl(Lt(s),o._key).then(function(a){return Za(s,o,a)})}(this._delegate)).then(function(o){return new ao(i.firestore,new Je(i.firestore._delegate,i._userDataWriter,o._key,o._document,o.metadata,i._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Is.nu(this.firestore,t):null))},e}();function Zt(e,t,i){return e.message=e.message.replace(t,i),e}function Rh(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];if("object"==typeof o&&!ui(o))return o}return{}}function Dh(e,t){var i,o,s;return{next:function(a){s.next&&s.next(t(a))},error:null===(i=(s=ui(e[0])?e[0]:ui(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===i?void 0:i.bind(s),complete:null===(o=s.complete)||void 0===o?void 0:o.bind(s)}}var ao=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"ref",{get:function(){return new ar(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,i){return this._delegate.get(t,i)},e.prototype.isEqual=function(t){return fh(this._delegate,t._delegate)},e}(),uo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,m.ZT)(t,e),t.prototype.data=function(i){return this._delegate.data(i)},t}(ao),co=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new Ts(t)}return e.prototype.where=function(t,i,o){try{return new e(this.firestore,En(this._delegate,(u=o,c=i,l=_s("where",s=t),new Sp(l,c,u))))}catch(s){throw Zt(s,/(orderBy|where)\(\)/,"Query.$1()")}var s,u,c,l},e.prototype.orderBy=function(t,i){try{return new e(this.firestore,En(this._delegate,function(o,s){void 0===s&&(s="asc");var a=s,u=_s("orderBy",o);return new Ap(u,a)}(t,i)))}catch(o){throw Zt(o,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,En(this._delegate,(Wl("limit",i=t),new ph("limit",i,"F"))))}catch(i){throw Zt(i,"limit()","Query.limit()")}var i},e.prototype.limitToLast=function(t){try{return new e(this.firestore,En(this._delegate,(Wl("limitToLast",i=t),new ph("limitToLast",i,"L"))))}catch(i){throw Zt(i,"limitToLast()","Query.limitToLast()")}var i},e.prototype.startAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,En(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new mh("startAt",o,!0)}.apply(void 0,t)))}catch(o){throw Zt(o,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,En(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new mh("startAfter",o,!1)}.apply(void 0,t)))}catch(o){throw Zt(o,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,En(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new gh("endBefore",o,!0)}.apply(void 0,t)))}catch(o){throw Zt(o,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,En(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new gh("endAt",o,!1)}.apply(void 0,t)))}catch(o){throw Zt(o,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return th(this._delegate,t._delegate)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=ot(o,re);var s=ot(o.firestore,bt),a=Lt(s),u=new sr(s);return function(c,l){var d=this,p=new Jt;return c.asyncQueue.enqueueAndForget(function(){return(0,m.mG)(d,void 0,void 0,function(){var y;return(0,m.Jh)(this,function(w){switch(w.label){case 0:return y=function(C,E,R){return(0,m.mG)(this,void 0,void 0,function(){var L,V,H,J,tt;return(0,m.Jh)(this,function(rt){switch(rt.label){case 0:return rt.trys.push([0,2,,3]),[4,as(C,E,!0)];case 1:return tt=rt.sent(),L=new kl(E,tt.Bn),V=L._o(tt.documents),H=L.applyChanges(V,!1),R.resolve(H.snapshot),[3,3];case 2:return J=rt.sent(),tt=oi(J,"Failed to execute query '"+E+" against cache"),R.reject(tt),[3,3];case 3:return[2]}})})},[4,Ua(c)];case 1:return[2,y.apply(void 0,[w.sent(),l,p])]}})})}),p.promise}(a,o._query).then(function(c){return new In(s,u,o,c)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=ot(o,re);var s=ot(o.firestore,bt),a=Lt(s),u=new sr(s);return Gl(a,o._query,{source:"server"}).then(function(c){return new In(s,u,o,c)})}(this._delegate):function(o){o=ot(o,re);var s=ot(o.firestore,bt),a=Lt(s),u=new sr(s);return dh(o._query),Gl(a,o._query).then(function(c){return new In(s,u,o,c)})}(this._delegate)).then(function(o){return new Wa(i.firestore,new In(i.firestore._delegate,i._userDataWriter,i._delegate,o._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=Rh(i),a=Dh(i,function(u){return new Wa(t.firestore,new In(t.firestore._delegate,t._userDataWriter,t._delegate,u._snapshot))});return Ih(this._delegate,s,a)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Is.nu(this.firestore,t):null))},e}(),Np=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new uo(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),Wa=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"query",{get:function(){return new co(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(i){return new uo(t._firestore,i)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var i=this;return this._delegate.docChanges(t).map(function(o){return new Np(i._firestore,o)})},e.prototype.forEach=function(t,i){var o=this;this._delegate.forEach(function(s){t.call(i,new uo(o._firestore,s))})},e.prototype.isEqual=function(t){return fh(this._delegate,t._delegate)},e}(),Es=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).firestore=i,s._delegate=o,s}return(0,m.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._delegate.parent;return i?new ar(this.firestore,i):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(i){try{return new ar(this.firestore,void 0===i?gs(this._delegate):gs(this._delegate,i))}catch(o){throw Zt(o,"doc()","CollectionReference.doc()")}},t.prototype.add=function(i){var s,a,u,c,l,o=this;return(s=this._delegate,a=i,u=ot(s.firestore,bt),c=gs(s),l=ws(s.converter,a),so(u,[ys(rr(s.firestore),"addDoc",c._key,l,null!==s.converter,{}).toMutation(c._key,zt.exists(!1))]).then(function(){return c})).then(function(s){return new ar(o.firestore,s)})},t.prototype.isEqual=function(i){return $l(this._delegate,i._delegate)},t.prototype.withConverter=function(i){return new t(this.firestore,this._delegate.withConverter(i?Is.nu(this.firestore,i):null))},t}(co);function ur(e){return ot(e,pt)}var Mp=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._delegate=new(Ne.bind.apply(Ne,(0,m.ev)([void 0],t)))}return e.documentId=function(){return new e(Te.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=(0,v.m9)(t))instanceof Ne&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),Op=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new bp("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Ba("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new _p("arrayUnion",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayUnion",new e(o)},e.arrayRemove=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new wp("arrayRemove",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayRemove",new e(o)},e.increment=function(t){var i=new Tp("increment",t);return i._methodName="FieldValue.increment",new e(i)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}(),Lp=ut(2461),Fp={Firestore:Ah,GeoPoint:vs,Timestamp:te,Blob:Sh,Transaction:xh,WriteBatch:kh,DocumentReference:ar,DocumentSnapshot:ao,Query:co,QueryDocumentSnapshot:uo,QuerySnapshot:Wa,CollectionReference:Es,FieldPath:Mp,FieldValue:Op,setLogLevel:function Pp(e){we.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};!function Up(e){e.INTERNAL.registerComponent(new Lp.wA("firestore",function(o){return t=o.getProvider("app").getImmediate(),i=o.getProvider("auth-internal"),new Ah(t,new bt(t,i),new Dp);var t,i},"PUBLIC").setServiceProps(Object.assign({},Fp))),e.registerVersion("@firebase/firestore","2.4.1")}(ye.Z)},1589:(Ya,cr,ut)=>{ut.r(cr);var ye=ut(8367),m=ut(655),v=ut(492),Wt=ut(2461),Rt="firebasestorage.googleapis.com",Ee="storageBucket",F=function(f){function h(g,_){var I=f.call(this,Me(g),"Firebase Storage: "+_+" ("+Me(g)+")")||this;return I.customData={serverResponse:null},I._baseMessage=I.message,Object.setPrototypeOf(I,h.prototype),I}return(0,m.ZT)(h,f),h.prototype._codeEquals=function(g){return Me(g)===this.code},Object.defineProperty(h.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(g){this.customData.serverResponse=g,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),h}(v.ZR);function Me(f){return"storage/"+f}function Z(){return new F("unknown","An unknown error occurred, please check the error payload for server response.")}function lr(){return new F("canceled","User canceled the upload/download.")}function ht(){return new F("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Le(f){return new F("invalid-argument",f)}function xn(){return new F("app-deleted","The Firebase app was deleted.")}function fr(f){return new F("invalid-root-operation","The operation '"+f+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qe(f,h){return new F("invalid-format","String does not match format '"+f+"': "+h)}function Ze(f){throw new F("internal-error","Internal error: "+f)}var Dt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Se=function f(h,g){this.data=h,this.contentType=g||null};function mt(f,h){switch(f){case Dt.RAW:return new Se(kn(h));case Dt.BASE64:case Dt.BASE64URL:return new Se(We(f,h));case Dt.DATA_URL:return new Se(function be(f){var h=new Xe(f);return h.base64?We(Dt.BASE64,h.rest):function At(f){var h;try{h=decodeURIComponent(f)}catch(g){throw Qe(Dt.DATA_URL,"Malformed data URL.")}return kn(h)}(h.rest)}(h),function Rn(f){return new Xe(f).contentType}(h))}throw Z()}function kn(f){for(var h=[],g=0;g<f.length;g++){var _=f.charCodeAt(g);if(_<=127)h.push(_);else if(_<=2047)h.push(192|_>>6,128|63&_);else if(55296==(64512&_))if(g<f.length-1&&56320==(64512&f.charCodeAt(g+1))){var S=_,P=f.charCodeAt(++g);h.push(240|(_=65536|(1023&S)<<10|1023&P)>>18,128|_>>12&63,128|_>>6&63,128|63&_)}else h.push(239,191,189);else 56320==(64512&_)?h.push(239,191,189):h.push(224|_>>12,128|_>>6&63,128|63&_)}return new Uint8Array(h)}function We(f,h){switch(f){case Dt.BASE64:var g=-1!==h.indexOf("-"),_=-1!==h.indexOf("_");if(g||_)throw Qe(f,"Invalid character '"+(g?"-":"_")+"' found: is it base64url encoded?");break;case Dt.BASE64URL:var S=-1!==h.indexOf("+"),P=-1!==h.indexOf("/");if(S||P)throw Qe(f,"Invalid character '"+(S?"+":"/")+"' found: is it base64 encoded?");h=h.replace(/-/g,"+").replace(/_/g,"/")}var B;try{B=function dr(f){return atob(f)}(h)}catch(W){throw Qe(f,"Invalid character found")}for(var q=new Uint8Array(B.length),G=0;G<B.length;G++)q[G]=B.charCodeAt(G);return q}var Xe=function f(h){this.base64=!1,this.contentType=null;var g=h.match(/^data:([^,]+)?,/);if(null===g)throw Qe(Dt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var _=g[1]||null;null!=_&&(this.base64=function pr(f,h){return f.length>=h.length&&f.substring(f.length-h.length)===h}(_,";base64"),this.contentType=this.base64?_.substring(0,_.length-";base64".length):_),this.rest=h.substring(h.indexOf(",")+1)},Fe={STATE_CHANGED:"state_changed"},vt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Dn(f){switch(f){case"running":case"pausing":case"canceling":return vt.RUNNING;case"paused":return vt.PAUSED;case"success":return vt.SUCCESS;case"canceled":return vt.CANCELED;default:return vt.ERROR}}var fe=(()=>{return(f=fe||(fe={}))[f.NO_ERROR=0]="NO_ERROR",f[f.NETWORK_ERROR=1]="NETWORK_ERROR",f[f.ABORT=2]="ABORT",fe;var f})(),Ae=function(){function f(){var h=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=fe.NO_ERROR,this.sendPromise_=new Promise(function(g){h.xhr_.addEventListener("abort",function(){h.errorCode_=fe.ABORT,g()}),h.xhr_.addEventListener("error",function(){h.errorCode_=fe.NETWORK_ERROR,g()}),h.xhr_.addEventListener("load",function(){g()})})}return f.prototype.send=function(h,g,_,I){if(this.sent_)throw Ze("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(g,h,!0),void 0!==I)for(var S in I)I.hasOwnProperty(S)&&this.xhr_.setRequestHeader(S,I[S].toString());return void 0!==_?this.xhr_.send(_):this.xhr_.send(),this.sendPromise_},f.prototype.getErrorCode=function(){if(!this.sent_)throw Ze("cannot .getErrorCode() before sending");return this.errorCode_},f.prototype.getStatus=function(){if(!this.sent_)throw Ze("cannot .getStatus() before sending");try{return this.xhr_.status}catch(h){return-1}},f.prototype.getResponseText=function(){if(!this.sent_)throw Ze("cannot .getResponseText() before sending");return this.xhr_.responseText},f.prototype.abort=function(){this.xhr_.abort()},f.prototype.getResponseHeader=function(h){return this.xhr_.getResponseHeader(h)},f.prototype.addUploadProgressListener=function(h){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",h)},f.prototype.removeUploadProgressListener=function(h){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",h)},f}(),Pn=function(){function f(){}return f.prototype.createConnection=function(){return function Ue(){return new Ae}()},f}(),Ft=function(){function f(h,g){this.bucket=h,this.path_=g}return Object.defineProperty(f.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),f.prototype.fullServerUrl=function(){var h=encodeURIComponent;return"/b/"+h(this.bucket)+"/o/"+h(this.path)},f.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},f.makeFromBucketSpec=function(h,g){var _;try{_=f.makeFromUrl(h,g)}catch(I){return new f(h,"")}if(""===_.path)return _;throw function _t(f){return new F("invalid-default-bucket","Invalid default bucket '"+f+"'.")}(h)},f.makeFromUrl=function(h,g){var _=null,I="([A-Za-z0-9.\\-_]+)",B=new RegExp("^gs://"+I+"(/(.*))?$","i");function G($t){$t.path_=decodeURIComponent($t.path)}for(var X=g.replace(/[.]/g,"\\."),Xt=[{regex:B,indices:{bucket:1,path:3},postModify:function S($t){"/"===$t.path.charAt($t.path.length-1)&&($t.path_=$t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+X+"/v[A-Za-z0-9_]+/b/"+I+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:G},{regex:new RegExp("^https?://"+(g===Rt?"(?:storage.googleapis.com|storage.cloud.google.com)":g)+"/"+I+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:G}],_e=0;_e<Xt.length;_e++){var hn=Xt[_e],fn=hn.regex.exec(h);if(fn){var Yt=fn[hn.indices.path];Yt||(Yt=""),_=new f(fn[hn.indices.bucket],Yt),hn.postModify(_);break}}if(null==_)throw function fo(f){return new F("invalid-url","Invalid URL '"+f+"'.")}(h);return _},f}(),fi=function(){function f(h){this.promise_=Promise.reject(h)}return f.prototype.getPromise=function(){return this.promise_},f.prototype.cancel=function(h){},f}();function $e(f){return"string"==typeof f||f instanceof String}function k(f){return b()&&f instanceof Blob}function b(){return"undefined"!=typeof Blob}function T(f,h,g,_){if(_<h)throw Le("Invalid value for '"+f+"'. Expected "+h+" or greater.");if(_>g)throw Le("Invalid value for '"+f+"'. Expected "+g+" or less.")}function A(f,h){var g=h.match(/^(\w+):\/\/.+/),I=h;return null==(null==g?void 0:g[1])&&(I="https://"+h),I+"/v0"+f}function M(f){var h=encodeURIComponent,g="?";for(var _ in f)f.hasOwnProperty(_)&&(g=g+(h(_)+"=")+h(f[_])+"&");return g.slice(0,-1)}var D=function(){function f(h,g,_,I,S,P,B,q,G,W,X){var ft=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=h,this.method_=g,this.headers_=_,this.body_=I,this.successCodes_=S.slice(),this.additionalRetryCodes_=P.slice(),this.callback_=B,this.errorCallback_=q,this.progressCallback_=W,this.timeout_=G,this.pool_=X,this.promise_=new Promise(function(Nt,ct){ft.resolve_=Nt,ft.reject_=ct,ft.start_()})}return f.prototype.start_=function(){var h=this;function _(I,S){var P=h.resolve_,B=h.reject_,q=S.connection;if(S.wasSuccessCode)try{var G=h.callback_(q,q.getResponseText());!function gr(f){return void 0!==f}(G)?P():P(G)}catch(X){B(X)}else if(null!==q)(W=Z()).serverResponse=q.getResponseText(),B(h.errorCallback_?h.errorCallback_(q,W):W);else if(S.canceled)B(W=h.appDelete_?xn():lr());else{var W;B(W=function hi(){return new F("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}())}}this.canceled_?_(0,new Q(!1,null,!0)):this.backoffId_=function mr(f,h,g){var _=1,I=null,S=!1,P=0;function B(){return 2===P}var q=!1;function G(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];q||(q=!0,h.apply(null,ct))}function W(ct){I=setTimeout(function(){I=null,f(X,B())},ct)}function X(ct){for(var dt=[],Tt=1;Tt<arguments.length;Tt++)dt[Tt-1]=arguments[Tt];if(!q){if(ct)return void G.call.apply(G,(0,m.ev)([null,ct],dt));var Gt;if(B()||S)return void G.call.apply(G,(0,m.ev)([null,ct],dt));_<64&&(_*=2),1===P?(P=2,Gt=0):Gt=1e3*(_+Math.random()),W(Gt)}}var ft=!1;function Nt(ct){ft||(ft=!0,!q&&(null!==I?(ct||(P=2),clearTimeout(I),W(0)):ct||(P=1)))}return W(0),setTimeout(function(){S=!0,Nt(!0)},g),Nt}(function g(I,S){if(S)I(!1,new Q(!1,null,!0));else{var P=h.pool_.createConnection();h.pendingConnection_=P,null!==h.progressCallback_&&P.addUploadProgressListener(B),P.send(h.url_,h.method_,h.body_,h.headers_).then(function(){null!==h.progressCallback_&&P.removeUploadProgressListener(B),h.pendingConnection_=null;var q=P.getErrorCode()===fe.NO_ERROR,G=P.getStatus();if(q&&!h.isRetryStatusCode_(G)){var X=-1!==h.successCodes_.indexOf(G);I(!0,new Q(X,P))}else{var W=P.getErrorCode()===fe.ABORT;I(!1,new Q(!1,null,W))}})}function B(q){null!==h.progressCallback_&&h.progressCallback_(q.loaded,q.lengthComputable?q.total:-1)}},_,this.timeout_)},f.prototype.getPromise=function(){return this.promise_},f.prototype.cancel=function(h){this.canceled_=!0,this.appDelete_=h||!1,null!==this.backoffId_&&function Ye(f){f(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()},f.prototype.isRetryStatusCode_=function(h){var g=h>=500&&h<600,I=-1!==[408,429].indexOf(h),S=-1!==this.additionalRetryCodes_.indexOf(h);return g||I||S},f}(),Q=function f(h,g,_){this.wasSuccessCode=h,this.connection=g,this.canceled=!!_};function yr(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function di(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];var g=yr();if(void 0!==g){for(var _=new g,I=0;I<f.length;I++)_.append(f[I]);return _.getBlob()}if(b())return new Blob(f);throw new F("unsupported-environment","This browser doesn't seem to support creating Blobs")}var On=function(){function f(h,g){var _=0,I="";k(h)?(this.data_=h,_=h.size,I=h.type):h instanceof ArrayBuffer?(g?this.data_=new Uint8Array(h):(this.data_=new Uint8Array(h.byteLength),this.data_.set(new Uint8Array(h))),_=this.data_.length):h instanceof Uint8Array&&(g?this.data_=h:(this.data_=new Uint8Array(h.length),this.data_.set(h)),_=h.length),this.size_=_,this.type_=I}return f.prototype.size=function(){return this.size_},f.prototype.type=function(){return this.type_},f.prototype.slice=function(h,g){if(k(this.data_)){var I=function pi(f,h,g){return f.webkitSlice?f.webkitSlice(h,g):f.mozSlice?f.mozSlice(h,g):f.slice?f.slice(h,g):null}(this.data_,h,g);return null===I?null:new f(I)}return new f(new Uint8Array(this.data_.buffer,h,g-h),!0)},f.getBlob=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];if(b()){var _=h.map(function(q){return q instanceof f?q.data_:q});return new f(di.apply(null,_))}var I=h.map(function(q){return $e(q)?mt(Dt.RAW,q).data:q.data_}),S=0;I.forEach(function(q){S+=q.byteLength});var P=new Uint8Array(S),B=0;return I.forEach(function(q){for(var G=0;G<q.length;G++)P[B++]=q[G]}),new f(P,!0)},f.prototype.uploadData=function(){return this.data_},f}();function Ln(f){var h;try{h=JSON.parse(f)}catch(g){return null}return function Mn(f){return"object"==typeof f&&!Array.isArray(f)}(h)?h:null}function go(f){var h=f.lastIndexOf("/",f.length-2);return-1===h?f:f.slice(h+1)}function vo(f,h){return h}var Pt=function f(h,g,_,I){this.server=h,this.local=g||h,this.writable=!!_,this.xform=I||vo},tn=null;function br(){if(tn)return tn;var f=[];f.push(new Pt("bucket")),f.push(new Pt("generation")),f.push(new Pt("metageneration")),f.push(new Pt("name","fullPath",!0));var g=new Pt("name");g.xform=function h(S,P){return function yo(f){return!$e(f)||f.length<2?f:go(f)}(P)},f.push(g);var I=new Pt("size");return I.xform=function _(S,P){return void 0!==P?Number(P):P},f.push(I),f.push(new Pt("timeCreated")),f.push(new Pt("updated")),f.push(new Pt("md5Hash",null,!0)),f.push(new Pt("cacheControl",null,!0)),f.push(new Pt("contentDisposition",null,!0)),f.push(new Pt("contentEncoding",null,!0)),f.push(new Pt("contentLanguage",null,!0)),f.push(new Pt("contentType",null,!0)),f.push(new Pt("metadata","customMetadata",!0)),tn=f}function _r(f,h,g){var _=Ln(h);return null===_?null:function gi(f,h,g){for(var _={type:"file"},I=g.length,S=0;S<I;S++){var P=g[S];_[P.local]=P.xform(_,h[P.server])}return function mi(f,h){Object.defineProperty(f,"ref",{get:function g(){var S=new Ft(f.bucket,f.fullPath);return h._makeStorageReference(S)}})}(_,f),_}(f,_,g)}function yt(f,h){for(var g={},_=h.length,I=0;I<_;I++){var S=h[I];S.writable&&(g[S.server]=f[S.local])}return JSON.stringify(g)}var Fn="prefixes";var de=function f(h,g,_,I){this.url=h,this.method=g,this.handler=_,this.timeout=I,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function pe(f){if(!f)throw Z()}function Tr(f,h){return function g(_,I){var S=_r(f,I,h);return pe(null!==S),S}}function en(f){return function h(g,_){var I;return I=401===g.getStatus()?g.getResponseText().includes("Firebase App Check token is invalid")?function li(){return new F("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}():function Ce(){return new F("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===g.getStatus()?function Sn(f){return new F("quota-exceeded","Quota for bucket '"+f+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(f.bucket):403===g.getStatus()?function An(f){return new F("unauthorized","User does not have permission to access '"+f+"'.")}(f.path):_,I.serverResponse=_.serverResponse,I}}function nn(f){var h=en(f);return function g(_,I){var S=h(_,I);return 404===_.getStatus()&&(S=function ie(f){return new F("object-not-found","Object '"+f+"' does not exist.")}(f.path)),S.serverResponse=I.serverResponse,S}}function bi(f,h,g){var I=A(h.fullServerUrl(),f.host),P=f.maxOperationRetryTime,B=new de(I,"GET",Tr(f,g),P);return B.errorHandler=nn(h),B}function ks(f,h,g,_,I){var S={};S.prefix=h.isRoot?"":h.path+"/",g&&g.length>0&&(S.delimiter=g),_&&(S.pageToken=_),I&&(S.maxResults=I);var B=A(h.bucketOnlyServerUrl(),f.host),G=f.maxOperationRetryTime,W=new de(B,"GET",function vi(f,h){return function g(_,I){var S=function xs(f,h,g){var _=Ln(g);return null===_?null:function As(f,h,g){var _={prefixes:[],items:[],nextPageToken:g.nextPageToken};if(g[Fn])for(var I=0,S=g[Fn];I<S.length;I++){var B=S[I].replace(/\/$/,""),q=f._makeStorageReference(new Ft(h,B));_.prefixes.push(q)}if(g.items)for(var G=0,W=g.items;G<W.length;G++)q=f._makeStorageReference(new Ft(h,W[G].name)),_.items.push(q);return _}(f,h,_)}(f,h,I);return pe(null!==S),S}}(f,h.bucket),G);return W.urlParams=S,W.errorHandler=en(h),W}function _o(f,h,g){var _=Object.assign({},g);return _.fullPath=f.path,_.size=h.size(),_.contentType||(_.contentType=function bo(f,h){return f&&f.contentType||h&&h.type()||"application/octet-stream"}(null,h)),_}var qn=function f(h,g,_,I){this.current=h,this.total=g,this.finalized=!!_,this.metadata=I||null};function Er(f,h){var g=null;try{g=f.getResponseHeader("X-Goog-Upload-Status")}catch(I){pe(!1)}return pe(!!g&&-1!==(h||["active"]).indexOf(g)),g}var rn=function f(h,g,_){var I=function Nn(f){return"function"==typeof f}(h)||null!=g||null!=_;if(I)this.next=h,this.error=g,this.complete=_;else{var S=h;this.next=S.next,this.error=S.error,this.complete=S.complete}};function on(f){return function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];Promise.resolve().then(function(){return f.apply(void 0,h)})}}var Io=function(){function f(h,g,_){var I=this;void 0===_&&(_=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=h,this._blob=g,this._metadata=_,this._mappings=br(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(S){I._request=void 0,I._chunkMultiplier=1,S._codeEquals("canceled")?(I._needToFetchStatus=!0,I.completeTransitions_()):(I._error=S,I._transition("error"))},this._metadataErrorHandler=function(S){I._request=void 0,S._codeEquals("canceled")?I.completeTransitions_():(I._error=S,I._transition("error"))},this._promise=new Promise(function(S,P){I._resolve=S,I._reject=P,I._start()}),this._promise.then(null,function(){})}return f.prototype._makeProgressCallback=function(){var h=this,g=this._transferred;return function(_){return h._updateProgress(g+_)}},f.prototype._shouldDoResumable=function(h){return h.size()>262144},f.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},f.prototype._resolveToken=function(h){var g=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(_){var I=_[0],S=_[1];switch(g._state){case"running":h(I,S);break;case"canceling":g._transition("canceled");break;case"pausing":g._transition("paused")}})},f.prototype._createResumable=function(){var h=this;this._resolveToken(function(g,_){var I=function wo(f,h,g,_,I){var S=h.bucketOnlyServerUrl(),P=_o(h,_,I),B={name:P.fullPath},q=A(S,f.host),W={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+_.size(),"X-Goog-Upload-Header-Content-Type":P.contentType,"Content-Type":"application/json; charset=utf-8"},X=yt(P,g),ct=new de(q,"POST",function Nt(dt){var Tt;Er(dt);try{Tt=dt.getResponseHeader("X-Goog-Upload-URL")}catch(xe){pe(!1)}return pe($e(Tt)),Tt},f.maxUploadRetryTime);return ct.urlParams=B,ct.headers=W,ct.body=X,ct.errorHandler=en(h),ct}(h._ref.storage,h._ref._location,h._mappings,h._blob,h._metadata),S=h._ref.storage._makeRequest(I,g,_);h._request=S,S.getPromise().then(function(P){h._request=void 0,h._uploadUrl=P,h._needToFetchStatus=!1,h.completeTransitions_()},h._errorHandler)})},f.prototype._fetchStatus=function(){var h=this,g=this._uploadUrl;this._resolveToken(function(_,I){var S=function Cr(f,h,g,_){var q=new de(g,"POST",function S(G){var W=Er(G,["active","final"]),X=null;try{X=G.getResponseHeader("X-Goog-Upload-Size-Received")}catch(Nt){pe(!1)}X||pe(!1);var ft=Number(X);return pe(!isNaN(ft)),new qn(ft,_.size(),"final"===W)},f.maxUploadRetryTime);return q.headers={"X-Goog-Upload-Command":"query"},q.errorHandler=en(h),q}(h._ref.storage,h._ref._location,g,h._blob),P=h._ref.storage._makeRequest(S,_,I);h._request=P,P.getPromise().then(function(B){B=B,h._request=void 0,h._updateProgress(B.current),h._needToFetchStatus=!1,B.finalized&&(h._needToFetchMetadata=!0),h.completeTransitions_()},h._errorHandler)})},f.prototype._continueUpload=function(){var h=this,g=262144*this._chunkMultiplier,_=new qn(this._transferred,this._blob.size()),I=this._uploadUrl;this._resolveToken(function(S,P){var B;try{B=function Rs(f,h,g,_,I,S,P,B){var q=new qn(0,0);if(P?(q.current=P.current,q.total=P.total):(q.current=0,q.total=_.size()),_.size()!==q.total)throw function he(){return new F("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}();var G=q.total-q.current,W=G;I>0&&(W=Math.min(W,I));var X=q.current,ct={"X-Goog-Upload-Command":W===G?"upload, finalize":"upload","X-Goog-Upload-Offset":""+q.current},dt=_.slice(X,X+W);if(null===dt)throw ht();var Xt=new de(g,"POST",function Tt(_e,hn){var $t,fn=Er(_e,["active","final"]),je=q.current+W,Yt=_.size();return $t="final"===fn?Tr(h,S)(_e,hn):null,new qn(je,Yt,"final"===fn,$t)},h.maxUploadRetryTime);return Xt.headers=ct,Xt.body=dt.uploadData(),Xt.progressCallback=B||null,Xt.errorHandler=en(f),Xt}(h._ref._location,h._ref.storage,I,h._blob,g,h._mappings,_,h._makeProgressCallback())}catch(G){return h._error=G,void h._transition("error")}var q=h._ref.storage._makeRequest(B,S,P);h._request=q,q.getPromise().then(function(G){h._increaseMultiplier(),h._request=void 0,h._updateProgress(G.current),G.finalized?(h._metadata=G.metadata,h._transition("success")):h.completeTransitions_()},h._errorHandler)})},f.prototype._increaseMultiplier=function(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},f.prototype._fetchMetadata=function(){var h=this;this._resolveToken(function(g,_){var I=bi(h._ref.storage,h._ref._location,h._mappings),S=h._ref.storage._makeRequest(I,g,_);h._request=S,S.getPromise().then(function(P){h._request=void 0,h._metadata=P,h._transition("success")},h._metadataErrorHandler)})},f.prototype._oneShotUpload=function(){var h=this;this._resolveToken(function(g,_){var I=function Un(f,h,g,_,I){var S=h.bucketOnlyServerUrl(),P={"X-Goog-Upload-Protocol":"multipart"},q=function B(){for(var Xt="",_e=0;_e<2;_e++)Xt+=Math.random().toString().slice(2);return Xt}();P["Content-Type"]="multipart/related; boundary="+q;var G=_o(h,_,I),W=yt(G,g),Nt=On.getBlob("--"+q+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+W+"\r\n--"+q+"\r\nContent-Type: "+G.contentType+"\r\n\r\n",_,"\r\n--"+q+"--");if(null===Nt)throw ht();var ct={name:G.fullPath},dt=A(S,f.host),xe=f.maxUploadRetryTime,Gt=new de(dt,"POST",Tr(f,g),xe);return Gt.urlParams=ct,Gt.headers=P,Gt.body=Nt.uploadData(),Gt.errorHandler=en(h),Gt}(h._ref.storage,h._ref._location,h._mappings,h._blob,h._metadata),S=h._ref.storage._makeRequest(I,g,_);h._request=S,S.getPromise().then(function(P){h._request=void 0,h._metadata=P,h._updateProgress(h._blob.size()),h._transition("success")},h._errorHandler)})},f.prototype._updateProgress=function(h){var g=this._transferred;this._transferred=h,this._transferred!==g&&this._notifyObservers()},f.prototype._transition=function(h){if(this._state!==h)switch(h){case"canceling":case"pausing":this._state=h,void 0!==this._request&&this._request.cancel();break;case"running":var g="paused"===this._state;this._state=h,g&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=h,this._notifyObservers();break;case"canceled":this._error=lr(),this._state=h,this._notifyObservers()}},f.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(f.prototype,"snapshot",{get:function(){var h=Dn(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:h,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),f.prototype.on=function(h,g,_,I){var S=this,P=new rn(g,_,I);return this._addObserver(P),function(){S._removeObserver(P)}},f.prototype.then=function(h,g){return this._promise.then(h,g)},f.prototype.catch=function(h){return this.then(null,h)},f.prototype._addObserver=function(h){this._observers.push(h),this._notifyObserver(h)},f.prototype._removeObserver=function(h){var g=this._observers.indexOf(h);-1!==g&&this._observers.splice(g,1)},f.prototype._notifyObservers=function(){var h=this;this._finishPromise(),this._observers.slice().forEach(function(_){h._notifyObserver(_)})},f.prototype._finishPromise=function(){if(void 0!==this._resolve){var h=!0;switch(Dn(this._state)){case vt.SUCCESS:on(this._resolve.bind(null,this.snapshot))();break;case vt.CANCELED:case vt.ERROR:on(this._reject.bind(null,this._error))();break;default:h=!1}h&&(this._resolve=void 0,this._reject=void 0)}},f.prototype._notifyObserver=function(h){switch(Dn(this._state)){case vt.RUNNING:case vt.PAUSED:h.next&&on(h.next.bind(h,this.snapshot))();break;case vt.SUCCESS:h.complete&&on(h.complete.bind(h))();break;default:h.error&&on(h.error.bind(h,this._error))()}},f.prototype.resume=function(){var h="paused"===this._state||"pausing"===this._state;return h&&this._transition("running"),h},f.prototype.pause=function(){var h="running"===this._state;return h&&this._transition("pausing"),h},f.prototype.cancel=function(){var h="running"===this._state||"pausing"===this._state;return h&&this._transition("canceling"),h},f}(),me=function(){function f(h,g){this._service=h,this._location=g instanceof Ft?g:Ft.makeFromUrl(g,h.host)}return f.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},f.prototype._newRef=function(h,g){return new f(h,g)},Object.defineProperty(f.prototype,"root",{get:function(){var h=new Ft(this._location.bucket,"");return this._newRef(this._service,h)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"name",{get:function(){return go(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){var h=function po(f){if(0===f.length)return null;var h=f.lastIndexOf("/");return-1===h?"":f.slice(0,h)}(this._location.path);if(null===h)return null;var g=new Ft(this._location.bucket,h);return new f(this._service,g)},enumerable:!1,configurable:!0}),f.prototype._throwIfRoot=function(h){if(""===this._location.path)throw fr(h)},f}();function Sr(f){var h={prefixes:[],items:[]};return Ti(f,h).then(function(){return h})}function Ti(f,h,g){return(0,m.mG)(this,void 0,void 0,function(){var I,S,P;return(0,m.Jh)(this,function(B){switch(B.label){case 0:return[4,sn(f,{pageToken:g})];case 1:return I=B.sent(),(S=h.prefixes).push.apply(S,I.prefixes),(P=h.items).push.apply(P,I.items),null==I.nextPageToken?[3,3]:[4,Ti(f,h,I.nextPageToken)];case 2:B.sent(),B.label=3;case 3:return[2]}})})}function sn(f,h){return(0,m.mG)(this,void 0,void 0,function(){var g,_;return(0,m.Jh)(this,function(I){switch(I.label){case 0:return null!=h&&"number"==typeof h.maxResults&&T("options.maxResults",1,1e3,h.maxResults),_=ks(f.storage,f._location,"/",(g=h||{}).pageToken,g.maxResults),[4,f.storage.makeRequestWithTokens(_)];case 1:return[2,I.sent().getPromise()]}})})}function So(f){return(0,m.mG)(this,void 0,void 0,function(){var h;return(0,m.Jh)(this,function(g){switch(g.label){case 0:return f._throwIfRoot("getDownloadURL"),h=function Ir(f,h,g){var I=A(h.fullServerUrl(),f.host),P=f.maxOperationRetryTime,B=new de(I,"GET",function yi(f,h){return function g(_,I){var S=_r(f,I,h);return pe(null!==S),function wt(f,h,g){var _=Ln(h);if(null===_||!$e(_.downloadTokens))return null;var I=_.downloadTokens;if(0===I.length)return null;var S=encodeURIComponent;return I.split(",").map(function(q){var W=f.fullPath;return A("/b/"+S(f.bucket)+"/o/"+S(W),g)+M({alt:"media",token:q})})[0]}(S,I,f.host)}}(f,g),P);return B.errorHandler=nn(h),B}(f.storage,f._location,br()),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,g.sent().getPromise().then(function(_){if(null===_)throw function hr(){return new F("no-download-url","The given file does not have any download URLs.")}();return _})]}})})}function jn(f,h){var g=function mo(f,h){var g=h.split("/").filter(function(_){return _.length>0}).join("/");return 0===f.length?g:f+"/"+g}(f._location.path,h),_=new Ft(f._location.bucket,g);return new me(f.storage,_)}function Ar(f){return/^[A-Za-z]+:\/\//.test(f)}function Ei(f,h){if(f instanceof un){var g=f;if(null==g._bucket)throw function Oe(){return new F("no-default-bucket","No default bucket found. Did you set the '"+Ee+"' property when initializing the app?")}();var _=new me(g,g._bucket);return null!=h?Ei(_,h):_}return void 0!==h?jn(f,h):f}function Ao(f,h){if(h&&Ar(h)){if(f instanceof un)return function Ii(f,h){return new me(f,h)}(f,h);throw Le("To use ref(service, url), the first argument must be a Storage instance.")}return Ei(f,h)}function an(f,h){var g=null==h?void 0:h[Ee];return null==g?null:Ft.makeFromBucketSpec(g,f)}var un=function(){function f(h,g,_,I,S,P){this.app=h,this._authProvider=g,this._appCheckProvider=_,this._pool=I,this._url=S,this._firebaseVersion=P,this._bucket=null,this._host=Rt,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=S?Ft.makeFromBucketSpec(S,this._host):an(this._host,this.app.options)}return Object.defineProperty(f.prototype,"host",{get:function(){return this._host},set:function(h){this._host=h,this._bucket=null!=this._url?Ft.makeFromBucketSpec(this._url,h):an(h,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(h){T("time",0,Number.POSITIVE_INFINITY,h),this._maxUploadRetryTime=h},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(h){T("time",0,Number.POSITIVE_INFINITY,h),this._maxOperationRetryTime=h},enumerable:!1,configurable:!0}),f.prototype._getAuthToken=function(){return(0,m.mG)(this,void 0,void 0,function(){var h,g;return(0,m.Jh)(this,function(_){switch(_.label){case 0:return this._overrideAuthToken?[2,this._overrideAuthToken]:(h=this._authProvider.getImmediate({optional:!0}))?[4,h.getToken()]:[3,2];case 1:if(null!==(g=_.sent()))return[2,g.accessToken];_.label=2;case 2:return[2,null]}})})},f.prototype._getAppCheckToken=function(){return(0,m.mG)(this,void 0,void 0,function(){var h;return(0,m.Jh)(this,function(_){switch(_.label){case 0:return(h=this._appCheckProvider.getImmediate({optional:!0}))?[4,h.getToken()]:[3,2];case 1:return[2,_.sent().token];case 2:return[2,null]}})})},f.prototype._delete=function(){return this._deleted||(this._deleted=!0,this._requests.forEach(function(h){return h.cancel()}),this._requests.clear()),Promise.resolve()},f.prototype._makeStorageReference=function(h){return new me(this,h)},f.prototype._makeRequest=function(h,g,_){var I=this;if(this._deleted)return new fi(xn());var S=function vr(f,h,g,_,I,S){var P=M(f.urlParams),B=f.url+P,q=Object.assign({},f.headers);return function Cs(f,h){h&&(f["X-Firebase-GMPID"]=h)}(q,h),function xt(f,h){null!==h&&h.length>0&&(f.Authorization="Firebase "+h)}(q,g),function qe(f,h){f["X-Firebase-Storage-Version"]="webjs/"+(null!=h?h:"AppManager")}(q,S),function Ss(f,h){null!==h&&(f["X-Firebase-AppCheck"]=h)}(q,_),new D(B,f.method,q,f.body,f.successCodes,f.additionalRetryCodes,f.handler,f.errorHandler,f.timeout,f.progressCallback,I)}(h,this._appId,g,_,this._pool,this._firebaseVersion);return this._requests.add(S),S.getPromise().then(function(){return I._requests.delete(S)},function(){return I._requests.delete(S)}),S},f.prototype.makeRequestWithTokens=function(h){return(0,m.mG)(this,void 0,void 0,function(){var g;return(0,m.Jh)(this,function(S){switch(S.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return g=S.sent(),[2,this._makeRequest(h,g[0],g[1])]}})})},f}();function Rr(f,h){return Ao(f=(0,v.m9)(f),h)}var Gn=function(){function f(h,g,_){this._delegate=h,this.task=g,this.ref=_}return Object.defineProperty(f.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),f}(),Do=function(){function f(h,g){this._delegate=h,this._ref=g,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(f.prototype,"snapshot",{get:function(){return new Gn(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),f.prototype.then=function(h,g){var _=this;return this._delegate.then(function(I){if(h)return h(new Gn(I,_,_._ref))},g)},f.prototype.on=function(h,g,_,I){var S=this,P=void 0;return g&&(P="function"==typeof g?function(B){return g(new Gn(B,S,S._ref))}:{next:g.next?function(B){return g.next(new Gn(B,S,S._ref))}:void 0,complete:g.complete||void 0,error:g.error||void 0}),this._delegate.on(h,P,_||void 0,I||void 0)},f}(),cn=function(){function f(h,g){this._delegate=h,this._service=g}return Object.defineProperty(f.prototype,"prefixes",{get:function(){var h=this;return this._delegate.prefixes.map(function(g){return new ln(g,h._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"items",{get:function(){var h=this;return this._delegate.items.map(function(g){return new ln(g,h._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),f}(),ln=function(){function f(h,g){this._delegate=h,this.storage=g}return Object.defineProperty(f.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),f.prototype.toString=function(){return this._delegate.toString()},f.prototype.child=function(h){var g=function ko(f,h){return jn(f,h)}(this._delegate,h);return new f(g,this.storage)},Object.defineProperty(f.prototype,"root",{get:function(){return new f(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){var h=this._delegate.parent;return null==h?null:new f(h,this.storage)},enumerable:!1,configurable:!0}),f.prototype.put=function(h,g){return this._throwIfRoot("put"),new Do(function Si(f,h,g){return function Eo(f,h,g){return f._throwIfRoot("uploadBytesResumable"),new Io(f,new On(h),g)}(f=(0,v.m9)(f),h,g)}(this._delegate,h,g),this)},f.prototype.putString=function(h,g,_){void 0===g&&(g=Dt.RAW),this._throwIfRoot("putString");var I=mt(g,h),S=(0,m.pi)({},_);return null==S.contentType&&null!=I.contentType&&(S.contentType=I.contentType),new Do(new Io(this._delegate,new On(I.data,!0),S),this)},f.prototype.listAll=function(){var h=this;return function Ds(f){return Sr(f=(0,v.m9)(f))}(this._delegate).then(function(g){return new cn(g,h.storage)})},f.prototype.list=function(h){var g=this;return function xo(f,h){return sn(f=(0,v.m9)(f),h)}(this._delegate,h||void 0).then(function(_){return new cn(_,g.storage)})},f.prototype.getMetadata=function(){return function xr(f){return function Co(f){return(0,m.mG)(this,void 0,void 0,function(){var h;return(0,m.Jh)(this,function(g){switch(g.label){case 0:return f._throwIfRoot("getMetadata"),h=bi(f.storage,f._location,br()),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,g.sent().getPromise()]}})})}(f=(0,v.m9)(f))}(this._delegate)},f.prototype.updateMetadata=function(h){return function Bn(f,h){return function Ut(f,h){return(0,m.mG)(this,void 0,void 0,function(){var g;return(0,m.Jh)(this,function(_){switch(_.label){case 0:return f._throwIfRoot("updateMetadata"),g=function _i(f,h,g,_){var S=A(h.fullServerUrl(),f.host),B=yt(g,_),G=f.maxOperationRetryTime,W=new de(S,"PATCH",Tr(f,_),G);return W.headers={"Content-Type":"application/json; charset=utf-8"},W.body=B,W.errorHandler=nn(h),W}(f.storage,f._location,h,br()),[4,f.storage.makeRequestWithTokens(g)];case 1:return[2,_.sent().getPromise()]}})})}(f=(0,v.m9)(f),h)}(this._delegate,h)},f.prototype.getDownloadURL=function(){return function Ai(f){return So(f=(0,v.m9)(f))}(this._delegate)},f.prototype.delete=function(){return this._throwIfRoot("delete"),function kr(f){return function Vn(f){return(0,m.mG)(this,void 0,void 0,function(){var h;return(0,m.Jh)(this,function(g){switch(g.label){case 0:return f._throwIfRoot("deleteObject"),h=function wi(f,h){var _=A(h.fullServerUrl(),f.host),B=new de(_,"DELETE",function P(q,G){},f.maxOperationRetryTime);return B.successCodes=[200,204],B.errorHandler=nn(h),B}(f.storage,f._location),[4,f.storage.makeRequestWithTokens(h)];case 1:return[2,g.sent().getPromise()]}})})}(f=(0,v.m9)(f))}(this._delegate)},f.prototype._throwIfRoot=function(h){if(""===this._delegate._location.path)throw fr(h)},f}(),Dr=function(){function f(h,g){this.app=h,this._delegate=g}return Object.defineProperty(f.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),f.prototype.ref=function(h){if(Ar(h))throw Le("ref() expected a child path but got a URL, use refFromURL instead.");return new ln(Rr(this._delegate,h),this)},f.prototype.refFromURL=function(h){if(!Ar(h))throw Le("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Ft.makeFromUrl(h,this._delegate.host)}catch(g){throw Le("refFromUrl() expected a valid full URL but got an invalid one.")}return new ln(Rr(this._delegate,h),this)},f.prototype.setMaxUploadRetryTime=function(h){this._delegate.maxUploadRetryTime=h},f.prototype.setMaxOperationRetryTime=function(h){this._delegate.maxOperationRetryTime=h},f.prototype.useEmulator=function(h,g,_){void 0===_&&(_={}),function Ro(f,h,g,_){void 0===_&&(_={}),function Ci(f,h,g,_){void 0===_&&(_={}),f.host="http://"+h+":"+g;var I=_.mockUserToken;I&&(f._overrideAuthToken="string"==typeof I?I:(0,v.Sg)(I,f.app.options.projectId))}(f,h,g,_)}(this._delegate,h,g,_)},f}();function Ps(f,h){var g=h.instanceIdentifier,_=f.getProvider("app").getImmediate(),I=f.getProvider("auth-internal"),S=f.getProvider("app-check-internal");return new Dr(_,new un(_,I,S,new Pn,g,ye.Z.SDK_VERSION))}!function ki(f){var h={TaskState:vt,TaskEvent:Fe,StringFormat:Dt,Storage:un,Reference:ln};f.INTERNAL.registerComponent(new Wt.wA("storage",Ps,"PUBLIC").setServiceProps(h).setMultipleInstances(!0)),f.registerVersion("@firebase/storage","0.7.1")}(ye.Z)}}]);